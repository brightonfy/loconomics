!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function AccountActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSectionNavBar("Account")});exports.init=A.init},{"../components/Activity":66}],2:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery");require("jquery-ui");var A=Activity["extends"](function AddJobTitlesActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Scheduling");var ac=this.$activity.find("#addJobTitles-search"),vw=this.viewModel;ac.autocomplete({source:function(request,response){vw.searchBy(request.term).then(function(results){response(results)})},autoFocus:!1,minLength:0,select:function(event,ui){return ui&&ui.item&&ui.item.value?(vw.addItem(ui.item),!1):void 0},focus:function(event,ui){return!ui||!ui.item||!ui.item.positionSingular,$(this).val(ui.item.positionSingular),!1}})});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/scheduling";var link=this.requestData.cancelLink||referrer;this.app.model.onboarding.updateNavBar(this.navBar)||this.convertToCancelAction(this.navBar.leftAction(),link)},A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.viewModel.searchText(""),this.viewModel.jobTitles.removeAll(),this.updateNavBarState()};var ko=require("knockout");function ViewModel(app){this.isSearching=ko.observable(!1),this.isSaving=ko.observable(!1),this.isLocked=this.isSaving,this.searchText=ko.observable(""),this.jobTitles=ko.observableArray([]),this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isSaving()?"saving...":"Save"},this),this.unsavedChanges=ko.pureComputed(function(){return!!this.jobTitles().length},this),this.searchBy=function searchBy(text){return app.model.rest.get("job-titles/autocomplete",{search:text})["catch"](function(err){app.modals.showError({error:err})})}.bind(this),this.search=function search(){this.searchBy(this.searchText())}.bind(this),this.addItem=function addItem(item){var foundIndex=this.findItem(item);-1===foundIndex&&this.jobTitles.push(item)}.bind(this),this.add=function add(){var s=this.searchText();s&&(this.addItem({value:0,label:s}),this.searchText(""))}.bind(this),this.findItem=function findItem(jobTitle){var foundIndex=-1;return this.jobTitles().some(function(item,index){return 0!==jobTitle.value&&item.value===jobTitle.value||item.label===jobTitle.label?(foundIndex=index,!0):void 0}),foundIndex},this.remove=function remove(jobTitle){var removeIndex=this.findItem(jobTitle);removeIndex>-1&&this.jobTitles.splice(removeIndex,1)}.bind(this),this.save=function save(){this.isSaving(!0),Promise.all(this.jobTitles().map(function(jobTitle){return app.model.userJobProfile.createUserJobTitle({jobTitleID:jobTitle.value,jobTitleName:jobTitle.label})})).then(function(){this.searchText(""),this.isSaving(!1),this.jobTitles.removeAll(),app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()}.bind(this))["catch"](function(error){this.searchText(""),this.isSaving(!1),app.modals.showError({title:"Impossible to add one or more job titles",error:error})}.bind(this))}.bind(this)}},{"../components/Activity":66,knockout:!1}],3:[function(require,module,exports){"use strict";var ko=require("knockout"),Address=require("../models/Address"),Activity=require("../components/Activity"),A=Activity["extends"](function AddressEditorActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Locations");var app=this.app,viewModel=this.viewModel;this.registerHandler({target:this.viewModel.address,handler:function(address){address&&!address.postalCode._hasLookup&&(address.postalCode._hasLookup=!0,ko.computed(function(){var postalCode=this.postalCode();postalCode&&!/^\s*$/.test(postalCode)&&app.model.postalCodes.getItem(postalCode).then(function(info){info&&(address.city(info.city),address.stateProvinceCode(info.stateProvinceCode),address.stateProvinceName(info.stateProvinceName),viewModel.errorMessages.postalCode(""))})["catch"](function(err){address.city(""),address.stateProvinceCode(""),address.stateProvinceName("");var msg="string"==typeof err?err:null;msg||err&&err.responseJSON&&err.responseJSON.errorMessage?viewModel.errorMessages.postalCode(msg||err.responseJSON.errorMessage):console.error("Server error validating Zip Code",err)})},address).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}}))}}),this.viewModel.onSave=function(addressID){this.requestData.returnNewAsSelected===!0?(this.requestData.addressID=addressID,this.app.shell.goBack(this.requestData)):this.app.successSave()}.bind(this)});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceAddresses/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)},A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.viewModel.wasRemoved(!1);var params=options&&options.route&&options.route.segments||[],kind=params[0]||"",isService=kind===Address.kind.service,jobTitleID=isService?0|params[1]:0,addressID=isService?0|params[2]:0|params[1],serviceType=params[2]||"";if(this.viewModel.jobTitleID(jobTitleID),this.viewModel.addressID(addressID),this.updateNavBarState(),addressID)this.app.model.serviceAddresses.getItemVersion(jobTitleID,addressID).then(function(addressVersion){addressVersion?(this.viewModel.addressVersion(addressVersion),this.viewModel.header("Edit Location")):(this.viewModel.addressVersion(null),this.viewModel.header("Unknow location or was deleted"))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else switch(this.viewModel.addressVersion(this.app.model.serviceAddresses.newItemVersion({jobTitleID:jobTitleID})),serviceType){case"serviceArea":this.viewModel.address().isServiceArea(!0),this.viewModel.address().isServiceLocation(!1),this.viewModel.header("Add a service area");break;case"serviceLocation":this.viewModel.address().isServiceArea(!1),this.viewModel.address().isServiceLocation(!0),this.viewModel.header("Add a service location");break;default:this.viewModel.address().isServiceArea(!0),this.viewModel.address().isServiceLocation(!0),this.viewModel.header("Add a location")}};function ViewModel(app){this.header=ko.observable("Edit Location"),this.errorMessages={postalCode:ko.observable("")},this.jobTitleID=ko.observable(0),this.addressID=ko.observable(0),this.addressVersion=ko.observable(null),this.address=ko.pureComputed(function(){var v=this.addressVersion();return v?v.version:null},this),this.isLoading=app.model.serviceAddresses.state.isLoading,this.isSaving=app.model.serviceAddresses.state.isSaving,this.isDeleting=app.model.serviceAddresses.state.isDeleting,this.wasRemoved=ko.observable(!1),this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.serviceAddresses.state.isLocked()},this),this.isNew=ko.pureComputed(function(){var add=this.address();return!add||!add.updatedDate()},this),this.submitText=ko.pureComputed(function(){var v=this.addressVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this),this.unsavedChanges=ko.pureComputed(function(){var v=this.addressVersion();return v&&v.areDifferent()},this),this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this),this.save=function(){app.model.serviceAddresses.setItem(this.address().model.toPlainObject()).then(function(serverData){this.address().model.updateWith(serverData),this.addressVersion().push({evenIfObsolete:!0}),this.onSave(serverData.addressID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this),this.confirmRemoval=function(){app.modals.confirm({title:"Delete location",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this),this.remove=function(){app.model.serviceAddresses.delItem(this.jobTitleID(),this.addressID()).then(function(){this.wasRemoved(!0),app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this),this.serviceRadiusOptions=ko.observableArray([{value:.5,label:"0.5 miles"},{value:1,label:"1 mile"},{value:2,label:"2 miles"},{value:3,label:"3 miles"},{value:4,label:"4 miles"},{value:5,label:"5 miles"},{value:10,label:"10 miles"},{value:25,label:"25 miles"},{value:50,label:"50 miles"}])}},{"../components/Activity":66,"../models/Address":71,knockout:!1}],4:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),Appointment=require("../models/Appointment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var Activity=require("../components/Activity"),A=Activity["extends"](function AppointmentActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.menuItem="calendar",this.$appointmentView=this.$activity.find("#calendarAppointmentView"),this.$chooseNew=$("#calendarChooseNew"),this.viewModel=new ViewModel(this.app);var backActionSettings={link:"calendar/",icon:Activity.NavAction.goBack.icon(),isTitle:!0,text:"Calendar"};this.navBar=new Activity.NavBar({title:"",leftAction:new Activity.NavAction(backActionSettings),rightAction:Activity.NavAction.goHelpIndex}),ko.computed(function(){var editMode=this.viewModel.editMode(),isNew=this.viewModel.appointmentCardView()&&this.viewModel.appointmentCardView().isNew(),date=this.viewModel.currentDate();if(editMode)if(isNew){var cancelLink=this.viewModel.appointmentCardView();cancelLink=cancelLink&&cancelLink.progress&&cancelLink.progress.cancelLink,this.convertToCancelAction(this.navBar.leftAction(),cancelLink||this.requestData.cancelLink)}else this.navBar.leftAction().model.updateWith({link:null,text:"cancel",handler:this.viewModel.appointmentCardView().confirmCancel.bind(this)});else{var defLink=backActionSettings.link,defBackText=backActionSettings.text,link=date?defLink+date.toISOString():defLink,text=date?moment(date).format("dddd [(]M/D[)]"):defBackText;this.navBar.leftAction().model.updateWith($.extend({},backActionSettings,{link:link,text:text,handler:null}))}},this),this.registerHandler({target:this.viewModel.currentAppointment,handler:function(apt){if(apt&&(apt.id()===Appointment.specialIds.newBooking||apt.id()===Appointment.specialIds.newEvent)&&!apt.__idDateHandlersAttached){apt.__idDateHandlersAttached=!0;var prevID=apt.id();apt.id.subscribe(function relocateList(){var id=apt.id();prevID>0||0>=id||(prevID=id,this.viewModel.setCurrent(null,id).then(function(){this.viewModel.updateUrl()}.bind(this)))}.bind(this))}}.bind(this)._delayed(10)})});exports.init=A.init,A.prototype.show=function show(options){if(Activity.prototype.show.call(this,options),!this.requestData.cancelLink){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url;var reg=/\/?appointment\/([^\/]*)\/((\-3)|(\-4))/i;referrer&&reg.test(referrer)&&referrer.replace(reg,"/appointment/$1/"),this.requestData.cancelLink=referrer}var s1=options&&options.route&&options.route.segments[0],s2=options&&options.route&&options.route.segments[1],s3=options&&options.route&&options.route.segments[2],date,datetime,id,type,isNumber=/^\-?\d+$/;isNumber.test(s1)?(id=0|s1,type=s2):(date=getDateWithoutTime(s1),datetime=s1&&new Date(s1)||date,id=0|s2,type=s3);var setupCard=function(){var cardApi=this.viewModel.appointmentCardView();cardApi?(this.viewModel.appointmentCardView().currentID()<=0&&this.viewModel.appointmentCardView().item().startTime(datetime),cardApi.passIn(this.requestData)):setTimeout(setupCard,80)}.bind(this);this.viewModel.setCurrent(date,id,type).then(setupCard)};var Appointment=require("../models/Appointment");function findAppointmentInList(list,id){var found=null,index=-1;return list.some(function(apt,i){return apt.id()===id?(found=apt,index=i,!0):void 0}),{item:found,index:index}}var CalendarEvent=require("../models/CalendarEvent"),Booking=require("../models/Booking");function ViewModel(app){this.app=app,this.currentDate=ko.observable(new Date),this.currentID=ko.observable(0),this.currentIndex=ko.observable(0),this.editMode=ko.observable(!1),this.isLoading=ko.observable(!1),this.dateAvailability=ko.observable(),this.appointments=ko.pureComputed(function(){var dateAvail=this.dateAvailability();return dateAvail&&dateAvail.appointmentsList()||[]},this),this.appointmentCardView=ko.observable(null);var loadingAppointment=new Appointment({id:Appointment.specialIds.loading,summary:"Loading..."}),newEmptyDateAppointment=function newEmptyDateAppointment(){return new Appointment({id:Appointment.specialIds.emptyDate,summary:"You have nothing scheduled",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newUnavailableAppointment=function newUnavailableAppointment(){return new Appointment({id:Appointment.specialIds.unavailable,summary:"You`re unavailable all day",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newFreeAppointment=function newFreeAppointment(){return new Appointment({id:Appointment.specialIds.free,summary:"Free",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newEventAppointment=function newEventAppointment(){return new Appointment({id:Appointment.specialIds.newEvent,summary:"New event...",sourceEvent:new CalendarEvent})},newBookingAppointment=function newBookingAppointment(){return new Appointment({id:Appointment.specialIds.newBooking,summary:"New booking...",sourceEvent:new CalendarEvent,sourceBooking:new Booking})};this.currentAppointment=ko.observable(loadingAppointment),this.updateUrl=function updateUrl(){var apt=this.currentAppointment(),aptId=apt.id(),found=/appointment\/([^\/]+)\/(\-?\d+)/i.exec(window.location),urlId=found&&0|found[2],urlDate=found&&found[1],curDateStr=getDateWithoutTime(apt.startTime()).toISOString();if(!found||urlId!==aptId.toString()||urlDate!==curDateStr){var url="appointment/"+curDateStr+"/"+aptId;""===urlId?this.app.shell.replaceState(null,null,url):this.app.shell.pushState(null,null,url)}},this.goPrevious=function goPrevious(){if(!this.editMode()){var index=this.currentIndex()-1;if(0>index){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var prevDate=m.subtract(1,"days").toDate();this.setCurrent(prevDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index),this.currentID(apt.id()),this.currentAppointment(apt),this.updateUrl()}}},this.goNext=function goNext(){if(!this.editMode()){var index=this.currentIndex()+1;if(index>=this.appointments().length){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var nextDate=m.add(1,"days").toDate();this.setCurrent(nextDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index),this.currentID(apt.id()),this.currentAppointment(apt),this.updateUrl()}}},this.getSpecialItem=function(id){switch(id){default:return newEmptyDateAppointment();case Appointment.specialIds.free:return newFreeAppointment();case Appointment.specialIds.newEvent:return newEventAppointment();case Appointment.specialIds.newBooking:return newBookingAppointment();case Appointment.specialIds.loading:return loadingAppointment;case Appointment.specialIds.unavailable:return newUnavailableAppointment()}},this.setItemFromCurrentList=function(id){var list=this.appointments(),index,item;if(-1>id)item=this.getSpecialItem(id),index=-1;else if(0===list.length)index=-1,item=0===this.dateAvailability().workDayMinutes()?newUnavailableAppointment():newEmptyDateAppointment();else if(item=list[0],index=0,id)if(id>0){var found=findAppointmentInList(list,id);found.item&&(item=found.item,index=found.index)}else item=this.getSpecialItem(id),index=-1;this.currentID(item.id()),this.currentIndex(index),this.currentAppointment(item)};var _setCurrent=function setCurrent(date,id,type){if(date=date&&getDateWithoutTime(date)||null,date&&this.currentDate(date),date)return this.isLoading(!0),app.model.calendar.getDateAvailability(date).then(function(dateAvail){this.isLoading(!1),this.dateAvailability(dateAvail),this.setItemFromCurrentList(id)}.bind(this))["catch"](function(err){this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this));if(id>0){this.isLoading(!0);var notFound=function notFound(){return this.isLoading(!1),_setCurrent(new Date)}.bind(this),ids={};return"booking"===type?ids.bookingID=id:ids.calendarEventID=id,app.model.calendar.getAppointment(ids).then(function(item){if(item){var itDate=getDateWithoutTime(item.startTime());return this.isLoading(!1),_setCurrent(itDate,item.id())}return notFound()}.bind(this))["catch"](notFound)}return 0>id?_setCurrent(new Date,id):_setCurrent(new Date)}.bind(this),promiseSetCurrent=Promise.resolve();this.setCurrent=function setCurrent(date,id,type){return promiseSetCurrent=promiseSetCurrent.then(function(){return _setCurrent(date,id,type)})}}},{"../components/Activity":66,"../components/DatePicker":67,"../models/Appointment":72,"../models/Booking":73,"../models/CalendarEvent":76,"../utils/getDateWithoutTime":123,knockout:!1,moment:!1}],5:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),$=require("jquery"),A=Activity["extends"](function BookMeButtonActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.Freelancer,this.navBar=Activity.createSubsectionNavBar("Scheduling"),this.registerHandler({target:this.$activity,event:"click",selector:"textarea",handler:function(){$(this).select()}}),this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){if(!err||"save"!==err.task){var msg="Error loading data to build the Button.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.marketplaceProfile.sync();var jobID=0|state.route.segments[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){var marketplaceProfile=app.model.marketplaceProfile;this.bookCode=ko.computed(function(){return marketplaceProfile.data.bookCode()}),this.jobTitleID=ko.observable(0),this.type=ko.observable("medium"),this.isLocked=marketplaceProfile.isLocked;var buttonTemplate='<!-- begin Loconomics book-me-button --><a style="display:inline-block"><img alt="" style="border:none" /></a><!-- end Loconomics book-me-button -->',linkTemplate="<!-- begin Loconomics book-me-button --><a><span></span></a><!-- end Loconomics book-me-button -->";this.buttonHtmlCode=ko.pureComputed(function(){if(marketplaceProfile.isLoading())return"loading...";var type=this.type(),tpl=buttonTemplate;"link"===type&&(tpl=linkTemplate);var siteUrl=$("html").attr("data-site-url"),linkUrl=siteUrl+"/book/"+this.bookCode()+"/"+this.jobTitleID()+"/",imgUrl=siteUrl+"/img/extern/book-me-button-"+type+".png",code=generateButtonCode({tpl:tpl,label:"Click here to book me now (on loconomics.com)",linkUrl:linkUrl,imgUrl:imgUrl});return code},this),this.copyCode=function(){},this.sendByEmail=function(){}}function generateButtonCode(options){var $btn=$($.parseHTML("<div>"+options.tpl+"</div>"));return $btn.find("a").attr("href",options.linkUrl).find("span").text(options.label),$btn.find("img").attr("src",options.imgUrl).attr("alt",options.label),$btn.html()}},{"../components/Activity":66,knockout:!1}],6:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),Activity=require("../components/Activity"),A=Activity["extends"](function CalendarActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar("Calendar"),this.$datepicker=this.$activity.find("#calendarDatePicker"),this.$dailyView=this.$activity.find("#calendarDailyView"),this.$dateTitle=this.$activity.find(".CalendarDateHeader > .btn"),this.$chooseNew=$("#calendarChooseNew"),this.$datepicker.show().datepicker({extraClasses:"DatePicker--tagged"}),this.tagAvailability=datepickerAvailability.create(this.app,this.$datepicker,this.viewModel.isLoading),this.registerHandler({target:this.viewModel.currentDate,handler:function(date){if(date){var mdate=moment(date);if(mdate.isValid()){var isoDate=mdate.toISOString();return this.$datepicker.removeClass("is-visible"),this.$datepicker.datepicker("getValue").toISOString()!==isoDate&&this.$datepicker.datepicker("setValue",date,!0),void this.app.shell.pushState(null,null,"calendar/"+isoDate)}}this.viewModel.currentDate(getDateWithoutTime())}.bind(this)}),this.registerHandler({target:this.$dailyView,event:"swipeleft swiperight",handler:function(e){e.preventDefault();var dir="swipeleft"===e.type?"next":"prev";$(document).trigger("touchend"),this.$datepicker.datepicker("moveValue",dir,"date")}.bind(this)}),this.registerHandler({target:this.$dateTitle,event:"click",handler:function(e){this.$datepicker.toggleClass("is-visible"),e.preventDefault(),e.stopPropagation()}.bind(this)}),this.registerHandler({target:this.$datepicker,event:"dateChanged",handler:function(e){"days"===e.viewMode&&this.viewModel.currentDate(getDateWithoutTime(e.date))}.bind(this)}),this.viewModel.currentDate(getDateWithoutTime())});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var sdate=options.route&&options.route.segments&&options.route.segments[0],date;if(sdate){var mdate=moment(sdate);date=mdate.isValid()?getDateWithoutTime(mdate.toDate()):null}date||(date=getDateWithoutTime()),this.viewModel.previousDate=null,this.viewModel.currentDate(date),this.tagAvailability(date,!0)};var Appointment=require("../models/Appointment"),TimeSlotViewModel=require("../viewmodels/TimeSlot");function ViewModel(app){this.currentDate=ko.observable(getDateWithoutTime());var fullDayFree=[Appointment.newFreeSlot({date:this.currentDate()})];this.currentDate.subscribe(function(date){date&&(fullDayFree[0].startTime(date),fullDayFree[0].endTime(date))},this),this.slotsSource=ko.observable(fullDayFree),this.slots=ko.computed(function(){var slots=this.slotsSource();return slots.length>1&&(slots=slots.filter(function(slot){return slot.id()!==Appointment.specialIds.unavailable})),slots.map(TimeSlotViewModel.fromAppointment)},this),this.isLoading=ko.observable(!1),this.previousDate=this.currentDate().toISOString(),this.currentDate.subscribe(function(date){date=new Date(Date.parse(date.toISOString())),date.toISOString()!==this.previousDate&&(this.previousDate=date.toISOString(),this.isLoading(!0),app.model.calendar.getDateAvailability(date).then(function(dateAvail){date.toISOString()===this.currentDate().toISOString()&&(this.slotsSource(dateAvail.list()),this.isLoading(!1))}.bind(this))["catch"](function(err){this.slotsSource(fullDayFree),this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)))}.bind(this))}},{"../components/Activity":66,"../components/DatePicker":67,"../models/Appointment":72,"../utils/datepickerAvailability":120,"../utils/getDateWithoutTime":123,"../viewmodels/TimeSlot":146,knockout:!1,moment:!1}],7:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),ko=require("knockout"),A=Activity["extends"](function CalendarSyncingActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.Freelancer,this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"}),this.registerHandler({target:this.$activity.find("#calendarSync-icalExportUrl"),event:"click",handler:function(){$(this).select()}}),this.registerHandler({target:this.app.model.calendarSyncing,event:"error",handler:function(err){var msg="save"===err.task?"Error saving calendar syncing settings.":"Error loading calendar syncing settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.calendarSyncing.sync(),this.viewModel.discard()};function ViewModel(app){var calendarSyncing=app.model.calendarSyncing,syncVersion=calendarSyncing.newVersion();syncVersion.isObsolete.subscribe(function(itIs){itIs&&syncVersion.pull({evenIfNewer:!0})}),this.sync=syncVersion.version,this.isLocked=ko.pureComputed(function(){return this.isLocked()||this.isReseting()},calendarSyncing),this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},calendarSyncing),this.resetText=ko.pureComputed(function(){return this.isReseting()?"reseting...":"Reset Private URL"},calendarSyncing),this.discard=function discard(){syncVersion.pull({evenIfNewer:!0})},this.save=function save(){syncVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})},this.reset=function reset(){calendarSyncing.resetExportUrl()}}},{"../components/Activity":66,knockout:!1}],8:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),is=require("is_js"),A=Activity["extends"](function ClientEditionActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("clients",{backLink:"clients"}),this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){if(clientID){var found=/clientEditor\/(\-?\d+)/i.exec(window.location),urlID=found&&0|found[1];found&&urlID===clientID||this.app.shell.replaceState(null,null,"clientEditor/"+clientID)}}.bind(this)}),this.viewModel.onSave=function(clientID){this.requestData.returnNewAsSelected===!0?(this.requestData.clientID=clientID,this.app.shell.goBack(this.requestData)):this.app.successSave()}.bind(this)});exports.init=A.init;var ko=require("knockout");A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/clients";var link=this.requestData.cancelLink||referrer;this.convertToCancelAction(this.navBar.leftAction(),link)},A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.clientID(0),this.updateNavBarState();var params=state&&state.route&&state.route.segments||[],clientID=0|params[0];if(clientID)this.viewModel.clientID(clientID),this.app.model.customers.createItemVersion(clientID).then(function(clientVersion){clientVersion?(this.viewModel.clientVersion(clientVersion),this.viewModel.header("Edit Client")):(this.viewModel.clientVersion(null),this.viewModel.header("Unknow client or was deleted"))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading client data",error:err})}.bind(this));else{var presetData=this.requestData.presetData||{};presetData.editable!==!1&&(presetData.editable=!0),this.viewModel.clientVersion(this.app.model.customers.newItem(presetData)),this.viewModel.header("Add a Client"),this.requestData.newForSearchText&&clientDataFromSearchText(this.requestData.newForSearchText||"",this.viewModel.client())}};function seemsAPhoneNumber(str){return/\d{3,}/.test(str||"")}function clientDataFromSearchText(txt,client){if(is.email(txt))client.email(txt);else if(seemsAPhoneNumber(txt))client.phone(txt);else{var nameParts=txt.split(" ",2);client.firstName(nameParts[0]),nameParts.length>1&&client.lastName(nameParts[1])}}function ViewModel(app){this.clientID=ko.observable(0),this.clientVersion=ko.observable(null),this.client=ko.pureComputed(function(){var v=this.clientVersion();return v?v.version:null},this),this.header=ko.observable(""),this.isLoading=app.model.customers.state.isLoading,this.isSyncing=app.model.customers.state.isSyncing,this.isSaving=app.model.customers.state.isSaving,this.isLocked=ko.pureComputed(function(){return app.model.customers.state.isLocked()||this.isDeleting()},this),this.isReadOnly=ko.pureComputed(function(){var c=this.client();return c&&!c.editable()},this),this.isDeleting=app.model.customers.state.isDeleting,this.wasRemoved=ko.observable(!1),this.isNew=ko.pureComputed(function(){var c=this.client();return!c||!c.updatedDate()},this),this.submitText=ko.pureComputed(function(){var v=this.clientVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":this.isNew()?"Add client":v&&v.areDifferent()?"Save changes":"Saved"},this),this.unsavedChanges=ko.pureComputed(function(){var v=this.clientVersion();return v&&v.areDifferent()},this),this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this),this.save=function(){app.model.customers.setItem(this.client().model.toPlainObject()).then(function(serverData){this.client().model.updateWith(serverData),this.clientVersion().push({evenIfObsolete:!0}),this.onSave(serverData.customerUserID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this),this.confirmRemoval=function(){app.modals.confirm({title:"Delete client",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this),this.remove=function(){app.model.customers.delItem(this.clientID()).then(function(){this.wasRemoved(!0),app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this),this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]),this.selectedBirthMonth=ko.computed({read:function(){var c=this.client();if(c){var birthMonth=c.birthMonth();return birthMonth?this.months()[birthMonth-1]:null}return null},write:function(month){var c=this.client();c&&c.birthMonth(month&&month.id||null)},owner:this}),this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);this.validEmail=ko.pureComputed(function(){var c=this.client();if(c){var e=c.email();return is.email(e)?e:""}return""},this),this.validPhone=ko.pureComputed(function(){var c=this.client();if(c){var e=c.phone();return seemsAPhoneNumber(e)?e:""}return""},this);var foundPublicUser=function foundPublicUser(user){
var c=this.client();if(c&&c.customerUserID()!==user.customerUserID&&(c.email()===user.email||c.phone()===user.phone)){var msg="We`ve found an existing record for {0}. Would you like to add him to your clients?".replace(/\{0\}/g,user.firstName);app.modals.confirm({title:"Customer found at loconomics.com",message:msg}).then(function(){var notes=c.notesAboutCustomer();c.model.updateWith(user),c.notesAboutCustomer(notes),this.clientID(user.customerUserID)}.bind(this))["catch"](function(){})}}.bind(this);ko.computed(function(){var c=this.client();if(c){var email=c.email(),phone=c.phone();(email||phone)&&app.model.customers.publicSearch({email:email,phone:phone}).then(function(r){r&&r[0]&&foundPublicUser(r[0])}.bind(this))["catch"](function(){})}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}})}},{"../components/Activity":66,is_js:!1,knockout:!1}],9:[function(require,module,exports){"use strict";var $=require("jquery"),ko=require("knockout"),Activity=require("../components/Activity"),textSearch=require("../utils/textSearch"),A=Activity["extends"](function ClientsActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"cms"}),this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(),this.$index=this.$activity.find("#clientsIndex"),this.$listView=this.$activity.find("#clientsListView"),this.registerHandler({target:this.viewModel.selectedClient,handler:function(theSelectedClient){this.requestData&&this.requestData.selectClient===!0&&theSelectedClient&&(this.requestData.selectedClientID=theSelectedClient.customerUserID(),this.app.shell.goBack(this.requestData),this.requestData=null)}.bind(this)}),this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();this.viewModel.headerText(itIs?"Select a client":""),this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title(""),this.requestData.cancelLink?this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink):(this.navBar.leftAction().model.updateWith(this.defaultLeftAction),this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle)),itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):itIs||this.navBar.leftAction().handler(null)},A.prototype.show=function show(state){return Activity.prototype.show.call(this,state),this.viewModel.searchText(""),this.viewModel.selectedClient(null),this.viewModel.requestData=this.requestData,state.returnNewAsSelected===!0&&state.clientID?void setTimeout(function(){delete state.returnNewAsSelected,this.requestData.selectedClientID=state.clientID,this.app.shell.goBack(this.requestData)}.bind(this),1):(this.viewModel.isSelectionMode(state.selectClient===!0),this.updateNavBarState(),void this.app.model.customers.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this)))};function ViewModel(app){this.headerText=ko.observable(""),this.isSelectionMode=ko.observable(!1),this.clients=app.model.customers.list,this.isLoading=app.model.customers.state.isLoading,this.isSyncing=app.model.customers.state.isSyncing,this.searchText=ko.observable(""),this.getFilteredList=function getFilteredList(){var s=(this.searchText()||"").toLowerCase();return this.clients().filter(function(client){if(!client)return!1;var found=textSearch(s,client.fullName());return found?!0:(found=textSearch(s,client.email()))?!0:found=textSearch(s,client.phone())})},this.filteredClients=ko.computed(function(){return this.getFilteredList()},this),this.groupedClients=ko.computed(function(){var clients=this.filteredClients().sort(function(clientA,clientB){var a=clientA.firstName().toLowerCase(),b=clientB.firstName().toLowerCase();return a===b?0:a>b?1:-1}),groups=[],latestGroup=null,latestLetter=null;return clients.forEach(function(client){var letter=(client.firstName()[0]||"").toUpperCase();letter!==latestLetter?(latestGroup={letter:letter,clients:[client]},groups.push(latestGroup),latestLetter=letter):latestGroup.clients.push(client)}),groups},this),this.publicSearchResults=ko.observableArray([]),this.publicSearchRunning=ko.observable(null),ko.computed(function(){var filtered=this.filteredClients(),searchText=this.searchText(),request=null;0===filtered.length&&searchText?(this.publicSearchResults([]),request=app.model.customers.publicSearch({fullName:searchText,email:searchText,phone:searchText}),this.publicSearchRunning(request),request.then(function(r){this.publicSearchResults(r)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error when on remote clients search",error:err})}).then(function(){this.publicSearchRunning()===request&&this.publicSearchRunning(null)}.bind(this))):(this.publicSearchResults([]),request=this.publicSearchRunning(),request&&request.xhr&&request.xhr.abort&&(request.xhr.abort(),this.publicSearchRunning(null)))},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}}),this.addRemoteClient=function(client,event){var data=client.model&&client.model.toPlainObject()||client,request=$.extend({},this.requestData,{presetData:data,returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request),event.preventDefault(),event.stopImmediatePropagation()}.bind(this),this.addNew=function(data,event){event.preventDefault(),event.stopImmediatePropagation();var request=$.extend({},this.requestData,{newForSearchText:this.searchText(),returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request)}.bind(this),this.selectedClient=ko.observable(null),this.selectClient=function(selectedClient,event){event.preventDefault(),event.stopImmediatePropagation(),this.selectedClient(selectedClient)}.bind(this)}},{"../components/Activity":66,"../utils/textSearch":139,knockout:!1}],10:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function CmsActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSectionNavBar("Client management")});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.customers.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this))};var numeral=require("numeral");function ViewModel(app){this.clients=app.model.customers.list,this.clientsCount=ko.pureComputed(function(){var cs=this.clients();return 0>=cs?"0 clients":1===cs?"1 client":numeral(0|cs.length).format("0,0")+" clients"},this)}},{"../components/Activity":66,knockout:!1,numeral:!1}],11:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity["extends"](function ContactFormActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Talk to us")});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Support: given a bad VOC Element name:",elementName):console.log("Feedback Support: Accessing without specify an element, using General (0)"),this.viewModel.vocElementID(elementID)};var ko=require("knockout");function ViewModel(app){this.message=ko.observable(""),this.wasSent=ko.observable(!1),this.isSending=ko.observable(!1),this.vocElementID=ko.observable(0);var updateWasSent=function(){this.wasSent(!1)}.bind(this);this.message.subscribe(updateWasSent),this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":this.wasSent()?"Sent":"Send"},this),this.send=function send(){this.isSending(!0),app.model.feedback.postSupport({message:this.message(),vocElementID:this.vocElementID()}).then(function(){this.message(""),this.wasSent(!0)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}.bind(this)}},{"../components/Activity":66,"../models/VocElementEnum":101,knockout:!1}],12:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function ContactInfoActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Owner information",{backLink:"ownerInfo"}),this.defaultNavBar=this.navBar.model.toPlainObject(),this.registerHandler({target:this.app.model.userProfile,event:"error",handler:function(err){var msg="save"===err.task?"Error saving contact data.":"Error loading contact data.";this.app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)}),this.registerHandler({target:this.app.model.homeAddress,event:"error",handler:function(err){var msg="save"===err.task?"Error saving address details.":"Error loading address details.";this.app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)});var app=this.app,viewModel=this.viewModel;ko.computed(function(){var postalCode=this.postalCode(),address=this;postalCode&&!/^\s*$/.test(postalCode)&&app.model.postalCodes.getItem(postalCode).then(function(info){info&&(address.city(info.city),address.stateProvinceCode(info.stateProvinceCode),address.stateProvinceName(info.stateProvinceName),viewModel.errorMessages.postalCode(""))})["catch"](function(err){address.city(""),address.stateProvinceCode(""),address.stateProvinceName("");var msg="string"==typeof err?err:null;msg||err&&err.responseJSON&&err.responseJSON.errorMessage?viewModel.errorMessages.postalCode(msg||err.responseJSON.errorMessage):console.error("Server error validating Zip Code",err)})},this.viewModel.address).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}})});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar)},A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.discard(),this.updateNavBarState(),this.app.model.userProfile.sync(),this.app.model.homeAddress.sync()};function ViewModel(app){this.headerText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"How can we reach you?":"Contact information"}),this.errorMessages={postalCode:ko.observable("")};var userProfile=app.model.userProfile,profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})}),this.profile=profileVersion.version,this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]),this.selectedBirthMonth=ko.computed({read:function(){var birthMonth=this.profile.birthMonth();return birthMonth?this.months()[birthMonth-1]:null},write:function(month){this.profile.birthMonth(month&&month.id||null)},owner:this}),this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);var homeAddress=app.model.homeAddress,homeAddressVersion=homeAddress.newVersion();homeAddressVersion.isObsolete.subscribe(function(itIs){itIs&&homeAddressVersion.pull({evenIfNewer:!0})}),this.address=homeAddressVersion.version,this.isLocked=ko.computed(function(){return userProfile.isLocked()||homeAddress.isLocked()},this),this.isLoading=ko.computed(function(){return userProfile.isLoading()||homeAddress.isLoading()},this),this.isSaving=ko.computed(function(){return userProfile.isSaving()||homeAddress.isSaving()},this),this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this),this.discard=function discard(){profileVersion.pull({evenIfNewer:!0}),homeAddressVersion.pull({evenIfNewer:!0})}.bind(this),this.save=function save(){Promise.all([profileVersion.pushSave(),homeAddressVersion.pushSave()]).then(function(){app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})}.bind(this)}},{"../components/Activity":66,knockout:!1}],13:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function ConversationActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Inbox",{backLink:"inbox"})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.threadID(0),this.viewModel.thread(null);var params=state&&state.route&&state.route.segments||[],threadID=0|params[0];this.viewModel.threadID(threadID),threadID?this.viewModel.thread.sync(threadID)["catch"](function(err){this.app.modals.showError({title:"Error loading conversation",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):this.app.modals.showError({title:"Conversation Not Found"}).then(function(){this.app.shell.goBack()}.bind(this))};var ko=require("knockout");function ViewModel(app){this.isLoading=app.model.messaging.state.isLoading,this.isSyncing=app.model.messaging.state.isSyncing,this.isSaving=app.model.messaging.state.isSaving,this.threadID=ko.observable(null),this.thread=app.model.messaging.createWildcardItem(),this.subject=ko.pureComputed(function(){var m=this.thread();return this.isLoading()?"Loading...":m&&(m.subject()||"").replace(/^\s+|\s+$/g,"")||"Conversation without subject"},this),this.bookingID=ko.pureComputed(function(){var msg=this.thread()&&this.thread().messages()[0];return msg&&"booking"===(msg.auxT()||"").toLowerCase()&&msg.auxID()?msg.auxID():null},this)}},{"../components/Activity":66,knockout:!1}],14:[function(require,module,exports){"use strict";var ko=require("knockout"),Time=require("../utils/Time"),moment=require("moment"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),Activity=require("../components/Activity"),A=Activity["extends"](function DatetimePickerActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("",{helpId:"datetimePickerHelp"}),this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(),this.$datePicker=this.$activity.find("#datetimePickerDatePicker"),this.$timePicker=this.$activity.find("#datetimePickerTimePicker"),this.$datePicker.show().datepicker({extraClasses:"DatePicker--tagged"}),this.tagAvailability=datepickerAvailability.create(this.app,this.$datePicker,this.viewModel.isLoading),this.registerHandler({target:this.$datePicker,event:"dateChanged",handler:function(e){"days"===e.viewMode&&this.viewModel.selectedDate(e.date)}.bind(this)}),this.registerHandler({target:this.viewModel.selectedDate,handler:function(date){this.bindDateData(date)}.bind(this)}),this.registerHandler({target:this.viewModel.selectedDatetime,handler:function(datetime){datetime&&(this.requestData.selectedDatetime=datetime,this.requestData.allowBookUnavailableTime=this.viewModel.allowBookUnavailableTime(),this.app.shell.goBack(this.requestData))}.bind(this)}),this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this),this.bindDateData(this.viewModel.selectedDate()).then(function(){this.tagAvailability(this.viewModel.selectedDate())}.bind(this))});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var header=this.requestData.headerText;this.viewModel.headerText(header||"Select date and time"),this.requestData.title?this.navBar.title(this.requestData.title):(this.navBar.title(""),this.navBar.leftAction().text(this.requestData.navTitle||"")),this.requestData.cancelLink?this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink):(this.navBar.leftAction().model.updateWith(this.defaultLeftAction),this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle),this.navBar.leftAction().handler(this.returnRequest))},A.prototype.show=function show(state){this.viewModel.selectedDatetime(null),this.viewModel.pickedTime(null),this.viewModel.allowBookUnavailableTime(!1),Activity.prototype.show.call(this,state),this.viewModel.requiredDuration(0|this.requestData.requiredDuration),this.viewModel.selectedDate(getDateWithoutTime(this.requestData.selectedDatetime)),this.$datePicker.datepicker("setValue",this.viewModel.selectedDate(),!0),this.__firstShowDone||(this.__firstShowDone=!0,this.$datePicker.datepicker("fill")),this.updateNavBarState()},A.prototype.bindDateData=function bindDateData(date){return this.viewModel.isLoading(!0),this.app.model.calendar.getDateAvailability(date).then(function(data){this.viewModel.dateAvail(data)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this))};function ViewModel(app){this.headerText=ko.observable("Select a time"),this.selectedDate=ko.observable(getDateWithoutTime()),this.isLoading=ko.observable(!1),this.requiredDuration=ko.observable(0),this.durationDisplay=ko.pureComputed(function(){var fullMinutes=this.requiredDuration();if(0>=fullMinutes)return"";var hours=Math.floor(fullMinutes/60),minutes=fullMinutes%60,text="";return hours>0&&(text+=moment.duration({hours:hours}).humanize()+" "),minutes>0&&(text+=moment.duration({minutes:minutes}).humanize()),text},this),this.dateAvail=ko.observable(),this.groupedSlots=ko.computed(function(){var requiredDuration=this.requiredDuration(),datePart=this.dateAvail()&&this.dateAvail().date()||new Date,groups=[{group:"Morning",slots:[],starts:new Time(datePart,0,0),ends:new Time(datePart,12,0)},{group:"Afternoon",slots:[],starts:new Time(datePart,12,0),ends:new Time(datePart,17,0)},{group:"Evening",slots:[],starts:new Time(datePart,17,0),ends:new Time(datePart,24,0)}],slots=this.dateAvail()&&this.dateAvail().getFreeTimeSlots(requiredDuration)||[];return slots.forEach(function(slot){groups.some(function(group){return slot>=group.starts&&slot<group.ends?(group.slots.push(slot),!0):void 0})}),groups},this),this.selectedDatetime=ko.observable(null),this.selectDatetime=function(selectedDatetime,event){event.preventDefault(),event.stopImmediatePropagation(),this.selectedDatetime(selectedDatetime)}.bind(this),this.pickedTime=ko.observable(),this.allowBookUnavailableTime=ko.observable(!1),this.getPickedDatetime=function(){var t=this.pickedTime();if(!(t instanceof Date)){var timespan=moment.duration(t);t=moment(this.selectedDate()).startOf("day").add(timespan).toDate()}return t},this.setPickedAsSelected=function(){this.allowBookUnavailableTime(!0),this.selectedDatetime(this.getPickedDatetime())}.bind(this),this.showTimePicker=function(){app.modals.showTimePicker({title:"Book an unavailable time",selectedTime:null,unsetLabel:"Cancel"}).then(function(pickedValue){pickedValue.time&&(this.pickedTime(pickedValue.time),this.setPickedAsSelected())}.bind(this))["catch"](function(){})}.bind(this)}},{"../components/Activity":66,"../components/DatePicker":67,"../utils/Time":115,"../utils/datepickerAvailability":120,"../utils/getDateWithoutTime":123,knockout:!1,moment:!1}],15:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function FaqsActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel,this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Talk to us"),setSomeTestingData(this.viewModel)});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.searchText("")};var ko=require("knockout");function ViewModel(){this.faqs=ko.observableArray([]),this.searchText=ko.observable(""),this.filteredFaqs=ko.pureComputed(function(){var s=this.searchText().toLowerCase();return this.faqs().filter(function(v){var n=v&&v.title()||"";return n+=v&&v.description()||"",n=n.toLowerCase(),n.indexOf(s)>-1})},this)}var Model=require("../models/Model");function Faq(values){Model(this),this.model.defProperties({id:0,title:"",description:""},values)}function setSomeTestingData(viewModel){var testdata=[new Faq({id:1,title:"How do I set up a marketplace profile?",description:"Description about how I set up a marketplace profile"}),new Faq({id:2,title:"Another faq",description:"Another description"})];viewModel.faqs(testdata)}},{"../components/Activity":66,"../models/Model":89,knockout:!1}],16:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function FeedbackActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSectionNavBar("Talk to us")});exports.init=A.init},{"../components/Activity":66}],17:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity["extends"](function FeedbackFormActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Talk to us")});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Ideas: given a bad VOC Element name:",elementName):console.log("Feedback Ideas: Accessing feedback without specify an element, using General (0)"),this.viewModel.vocElementID(elementID)};var ko=require("knockout");function ViewModel(app){this.message=ko.observable(""),this.becomeCollaborator=ko.observable(!1),this.wasSent=ko.observable(!1),this.isSending=ko.observable(!1),this.vocElementID=ko.observable(0);var updateWasSent=function(){this.wasSent(!1)}.bind(this);this.message.subscribe(updateWasSent),this.becomeCollaborator.subscribe(updateWasSent),this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":this.wasSent()?"Sent":"Send"},this),this.send=function send(){this.isSending(!0),app.model.feedback.postIdea({message:this.message(),becomeCollaborator:this.becomeCollaborator(),vocElementID:this.vocElementID()}).then(function(){this.message(""),this.becomeCollaborator(!1),this.wasSent(!0)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}.bind(this)}},{"../components/Activity":66,"../models/VocElementEnum":101,knockout:!1}],18:[function(require,module,exports){"use strict";var ko=require("knockout"),_=require("lodash"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function FreelancerPricingActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling"}),this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(),this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?Promise.all([this.app.model.jobTitles.getJobTitle(jobTitleID),this.app.model.pricingTypes.getList()]).then(function(data){var jobTitle=data[0];return this.viewModel.jobTitle(jobTitle),this.updateNavBarState(),this.app.model.freelancerPricing.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.freelancerPricing.asModel(list);var preset=this.requestData.selectedPricing||[],selection=this.viewModel.selectedPricing;list.forEach(function(item){var preSelected=preset.some(function(pr){return pr.freelancerPricingID===item.freelancerPricingID()?!0:void 0})||!1;item.isSelected=ko.observable(preSelected),preSelected&&selection.push(item)}),this.viewModel.list(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this)):(this.viewModel.list([]),this.viewModel.jobTitle(null),this.updateNavBarState())}.bind(this)}),this.viewModel.returnSelected=function(pricing,jobTitleID){this.requestData.selectedPricing=pricing,this.requestData.selectedJobTitleID=jobTitleID,this.app.shell.goBack(this.requestData)}.bind(this),this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();if(this.viewModel.headerText(itIs?"Select services":"Services"),!this.app.model.onboarding.updateNavBar(this.navBar)){if(this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title(""),this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction),this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduling";this.navBar.leftAction().link(jid?"/jobtitles/"+jid:"/scheduling"),this.navBar.leftAction().text(jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)}},A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.viewModel.jobTitleID(0),this.viewModel.selectedPricing.removeAll(),this.viewModel.requestData=this.requestData,this.viewModel.isSelectionMode(this.requestData.selectPricing===!0);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];0===jobTitleID&&options.selectedJobTitleID>0&&(jobTitleID=0|options.selectedJobTitleID);var isAdditionMode="new"===params[0]||"new"===params[1];if(isAdditionMode){var ref=this.app.shell.referrerRoute;ref=ref&&ref.url||"/",this.requestData.cancelLink=ref,this.viewModel.cancelLink(ref)}else this.viewModel.cancelLink("/freelancerPricing/"+this.viewModel.jobTitleID());this.viewModel.isAdditionMode(isAdditionMode),this.updateNavBarState(),this.viewModel.jobTitleID(jobTitleID),0===jobTitleID&&this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile");function ViewModel(app){this.headerText=ko.observable("Services"),this.jobTitleID=ko.observable(0),this.jobTitle=ko.observable(null),this.isAdditionMode=ko.observable(!1),this.cancelLink=ko.observable(null),this.jobTitles=new UserJobProfile(app),this.jobTitles.baseUrl("/freelancerPricing"),this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());var url="freelancerPricing/"+jobTitle.jobTitleID();return this.isAdditionMode()&&(url+="/new"),!1}.bind(this),this.list=ko.observableArray([]),this.isLoading=ko.computed(function(){return app.model.freelancerPricing.state.isLoading()||app.model.pricingTypes.state.isLoading()||app.model.jobTitles.state.isLoading()}),this.isLocked=this.isLoading,this.isSelectionMode=ko.observable(!1),this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":"Save and continue"},this),this.groupedPricing=ko.computed(function(){var list=this.list(),isSelection=this.isSelectionMode(),groupNamePrefix=isSelection?"Select ":"",groups=[],groupsList=[];this.isAdditionMode()||(groups=_.groupBy(list,function(pricingItem){return pricingItem.pricingTypeID()}),groupsList=Object.keys(groups).map(function(key){var gr={pricing:groups[key],type:app.model.pricingTypes.getObservableItem(key)};return gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr),gr}));var pricingTypes=this.jobTitle()&&this.jobTitle().pricingTypes();return pricingTypes&&pricingTypes.length&&pricingTypes.forEach(function(jobType){var typeID=jobType.pricingTypeID();if(!groups.hasOwnProperty(typeID)){var gr={pricing:[],type:app.model.pricingTypes.getObservableItem(typeID)};gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr),groupsList.push(gr)}}),groupsList},this),this.selectedPricing=ko.observableArray([]),this.togglePricingSelection=function(pricing){var inIndex=-1,isSelected=this.selectedPricing().some(function(selectedPricing,index){return selectedPricing===pricing?(inIndex=index,!0):void 0});pricing.isSelected(!isSelected),isSelected?this.selectedPricing.splice(inIndex,1):this.selectedPricing.push(pricing)}.bind(this),this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasPricing=this.list().length>0;return isin&&hasPricing},this),this.endSelection=function(data,event){app.model.onboarding.inProgress()?app.model.onboarding.goNext():this.returnSelected(this.selectedPricing().map(function(pricing){return{freelancerPricingID:ko.unwrap(pricing.freelancerPricingID),totalPrice:ko.unwrap(pricing.price)}}),this.jobTitleID()),event.preventDefault(),event.stopImmediatePropagation()}.bind(this),this.editPricing=function(pricing){app.shell.go("freelancerPricingEditor/"+this.jobTitleID()+"/"+pricing.freelancerPricingID())}.bind(this),this.tapPricing=function(pricing,event){this.isSelectionMode()?this.togglePricingSelection(pricing):this.editPricing(pricing),event.preventDefault(),event.stopImmediatePropagation()}.bind(this),this.tapNewPricing=function(group,event){var url="#!freelancerPricingEditor/"+this.jobTitleID()+"/new/"+(group.type()&&group.type().pricingTypeID()),request=$.extend({},this.requestData,{selectedJobTitleID:this.jobTitleID()});request.cancelLink||$.extend(request,{cancelLink:this.cancelLink()}),this.isSelectionMode()&&(request.selectedPricing=this.selectedPricing().map(function(pricing){return{freelancerPricingID:ko.unwrap(pricing.freelancerPricingID),totalPrice:ko.unwrap(pricing.totalPrice)}})),app.shell.go(url,request),event.preventDefault(),event.stopImmediatePropagation()}.bind(this)}},{"../components/Activity":66,"../viewmodels/UserJobProfile":147,knockout:!1,lodash:!1}],19:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),PricingType=require("../models/PricingType"),A=Activity["extends"](function FreelancerPricingEditorActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Services"),this.viewModel.onSave=function(pricing){this.requestData.selectedPricing?(this.requestData.selectedPricing.push({freelancerPricingID:pricing.freelancerPricingID,totalPrice:pricing.totalPrice}),this.app.shell.goBack(this.requestData)):this.app.successSave()}.bind(this)});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/freelancerPricing/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)},A.prototype.show=function show(options){Activity.prototype.show.call(this,options),
this.viewModel.wasRemoved(!1),this.viewModel.freelancerPricingVersion(null),this.viewModel.pricingType(null);var params=options&&options.route&&options.route.segments||[],jobTitleID=0|params[0],pricingTypeID="new"===params[1]?0|params[2]:0,freelancerPricingID=0|params[1];this.viewModel.jobTitleID(jobTitleID),this.viewModel.freelancerPricingID(freelancerPricingID),this.updateNavBarState();var pricingSetup=function pricingSetup(){var c=this.viewModel.current();c&&(c.pricing.name(c.type.fixedName()||c.pricing.name()||c.type.suggestedName()),c.pricing.refreshNoPriceRate()),this.viewModel.isLoading(!1)}.bind(this),showInvalidRequestError=function(){this.viewModel.isLoading(!1),this.app.modals.showError({title:"Invalid request",error:{jobTitleID:jobTitleID,pricingTypeID:pricingTypeID,freelancerPricingID:freelancerPricingID}}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this);this.viewModel.isLoading(!0),pricingTypeID?this.app.model.pricingTypes.getItem(pricingTypeID).then(function(type){type?(this.viewModel.pricingType(type),this.viewModel.freelancerPricingVersion(this.app.model.freelancerPricing.newItemVersion({jobTitleID:jobTitleID,pricingTypeID:pricingTypeID})),pricingSetup()):showInvalidRequestError()}.bind(this)):freelancerPricingID?this.app.model.freelancerPricing.getItemVersion(jobTitleID,freelancerPricingID).then(function(freelancerPricingVersion){return freelancerPricingVersion?this.app.model.pricingTypes.getItem(freelancerPricingVersion.version.pricingTypeID()).then(function(type){type?(this.viewModel.pricingType(type),this.viewModel.freelancerPricingVersion(freelancerPricingVersion),pricingSetup()):showInvalidRequestError()}.bind(this)):void showInvalidRequestError()}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):showInvalidRequestError()};function ViewModel(app){this.isLoading=ko.observable(!1),this.isSaving=app.model.freelancerPricing.state.isSaving,this.isSyncing=app.model.freelancerPricing.state.isSyncing,this.isDeleting=app.model.freelancerPricing.state.isDeleting,this.jobTitleID=ko.observable(0),this.freelancerPricingID=ko.observable(0),this.moneySymbol=ko.observable("$"),this.pricingType=ko.observable(new PricingType),this.freelancerPricingVersion=ko.observable(null),this.freelancerPricing=ko.pureComputed(function(){var v=this.freelancerPricingVersion();return v?v.version:null},this),this.header=ko.pureComputed(function(){if(this.isLoading())return"Loading...";if(this.freelancerPricingVersion()){var t=this.pricingType();return t&&t.singularName()||"Service"}return"Unknow service or was deleted"},this),this.current=ko.pureComputed(function(){var t=this.pricingType(),p=this.freelancerPricing();return t&&p?{type:t,pricing:p}:null},this),this.wasRemoved=ko.observable(!1),this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.freelancerPricing.state.isLocked()},this),this.isNew=ko.pureComputed(function(){var p=this.freelancerPricing();return p&&!p.updatedDate()},this),this.submitText=ko.pureComputed(function(){var v=this.freelancerPricingVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this),this.unsavedChanges=ko.pureComputed(function(){var v=this.freelancerPricingVersion();return v&&v.areDifferent()},this),this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this),this.save=function(){app.model.freelancerPricing.setItem(this.freelancerPricing().model.toPlainObject()).then(function(serverData){this.freelancerPricing().model.updateWith(serverData),this.freelancerPricingVersion().push({evenIfObsolete:!0}),this.onSave(serverData)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this),this.confirmRemoval=function(){var p=this.pricingType();app.modals.confirm({title:"Delete "+(p&&p.singularName()),message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this),this.remove=function(){app.model.freelancerPricing.delItem(this.jobTitleID(),this.freelancerPricingID()).then(function(){this.wasRemoved(!0),app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this)}},{"../components/Activity":66,"../models/PricingType":93,knockout:!1}],20:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),AppointmentView=require("../viewmodels/AppointmentView"),A=Activity["extends"](function HomeActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar(null),this.$nextBooking=this.$activity.find("#homeNextBooking"),this.$upcomingBookings=this.$activity.find("#homeUpcomingBookings"),this.$inbox=this.$activity.find("#homeInbox"),this.$performance=this.$activity.find("#homePerformance"),this.$getMore=this.$activity.find("#homeGetMore"),setSomeTestingData(this.viewModel)});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var v=this.viewModel,app=this.app,appModel=this.app.model;if(this.requestData.completedOnboarding)switch(this.requestData.completedOnboarding){case"welcome":this.app.modals.showNotification({title:"Congrats",message:"You're all ready to start scheduling clients. Click + to start adding bookings and clients."})}var preapareShowErrorFor=function preapareShowErrorFor(title){return function(err){this.app.modals.showError({title:title,error:err})}.bind(this)}.bind(this);v.upcomingBookings.items().length?v.upcomingBookings.isSyncing(!0):v.upcomingBookings.isLoading(!0),appModel.bookings.getUpcomingBookings().then(function(upcoming){if(upcoming.nextBookingID){var previousID=v.nextBooking()&&v.nextBooking().sourceBooking().bookingID();upcoming.nextBookingID!==previousID&&(v.nextBooking()?v.nextBooking.isSyncing(!0):v.nextBooking.isLoading(!0),appModel.calendar.getAppointment({bookingID:upcoming.nextBookingID}).then(function(apt){v.nextBooking(new AppointmentView(apt,app))})["catch"](preapareShowErrorFor("Error loading next booking")).then(function(){v.nextBooking.isLoading(!1),v.nextBooking.isSyncing(!1)}))}else v.nextBooking(null);v.upcomingBookings.today.quantity(upcoming.today.quantity),v.upcomingBookings.today.time(upcoming.today.time&&new Date(upcoming.today.time)),v.upcomingBookings.tomorrow.quantity(upcoming.tomorrow.quantity),v.upcomingBookings.tomorrow.time(upcoming.tomorrow.time&&new Date(upcoming.tomorrow.time)),v.upcomingBookings.nextWeek.quantity(upcoming.nextWeek.quantity),v.upcomingBookings.nextWeek.time(upcoming.nextWeek.time&&new Date(upcoming.nextWeek.time))})["catch"](preapareShowErrorFor("Error loading upcoming bookings")).then(function(){v.upcomingBookings.isLoading(!1),v.upcomingBookings.isSyncing(!1)});var MessageView=require("../models/MessageView");v.inbox.messages().length?v.inbox.isSyncing(!0):v.inbox.isLoading(!0),appModel.messaging.getList().then(function(threads){v.inbox.messages(threads().map(MessageView.fromThread.bind(null,app)))})["catch"](preapareShowErrorFor("Error loading latest messages")).then(function(){v.inbox.isLoading(!1),v.inbox.isSyncing(!1)})};var UpcomingBookingsSummary=require("../models/UpcomingBookingsSummary"),MailFolder=require("../models/MailFolder"),PerformanceSummary=require("../models/PerformanceSummary"),GetMore=require("../models/GetMore");function ViewModel(){this.upcomingBookings=new UpcomingBookingsSummary,this.upcomingBookings.isLoading=ko.observable(!1),this.upcomingBookings.isSyncing=ko.observable(!1),this.nextBooking=ko.observable(null),this.nextBooking.isLoading=ko.observable(!1),this.nextBooking.isSyncing=ko.observable(!1),this.inbox=new MailFolder({topNumber:4}),this.inbox.isLoading=ko.observable(!1),this.inbox.isSyncing=ko.observable(!1),this.performance=new PerformanceSummary,this.getMore=new GetMore}function setSomeTestingData(viewModel){viewModel.performance.earnings.currentAmount(2400),viewModel.performance.earnings.nextAmount(6200.54),viewModel.performance.timeBooked.percent(.93),viewModel.getMore.model.updateWith({availability:!1,payments:!0,profile:!0,coop:!1})}},{"../components/Activity":66,"../models/GetMore":81,"../models/MailFolder":85,"../models/MessageView":88,"../models/PerformanceSummary":90,"../models/UpcomingBookingsSummary":98,"../viewmodels/AppointmentView":141,knockout:!1}],21:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),MessageView=require("../models/MessageView"),textSearch=require("../utils/textSearch"),A=Activity["extends"](function InboxActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSectionNavBar("Inbox")});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.app.model.messaging.getList().then(function(threads){this.viewModel.sourceThreads(threads())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading messages",error:err})}.bind(this))};function ViewModel(app){this.isLoading=app.model.messaging.state.isLoading,this.isSyncing=app.model.messaging.state.isSyncing,this.sourceThreads=ko.observableArray([]),this.searchText=ko.observable(""),this.threads=ko.pureComputed(function(){var t=this.sourceThreads(),s=this.searchText();return t?s?t.filter(function(thread){var found=!1;return found=textSearch(s,thread.subject()),found||thread.messages().some(function(msg){return found=textSearch(s,msg.bodyText())}),found}).map(MessageView.fromThread.bind(null,app)):t.map(MessageView.fromThread.bind(null,app)):[]},this)}},{"../components/Activity":66,"../models/MessageView":88,"../utils/textSearch":139,knockout:!1}],22:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function IndexActivity(){Activity.apply(this,arguments),this.accessLevel=null,this.navBar=Activity.createSectionNavBar(null),this.navBar.rightAction(null)});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.user().isAnonymous()||this.app.goDashboard()}},{"../components/Activity":66}],23:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function JobtitlesActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"/scheduling"}),this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?(this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list),this.viewModel.addresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading addresses.",error:err})}.bind(this)),this.app.model.freelancerPricing.getList(jobTitleID).then(function(list){list=this.app.model.freelancerPricing.asModel(list),this.viewModel.pricing(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading services.",error:err})}.bind(this)),this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading the job title.",error:err})}.bind(this))):(this.viewModel.addresses([]),this.viewModel.pricing([]),this.viewModel.jobTitleName("Job Title"))}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{},jobID=0|params[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){this.jobTitleID=ko.observable(0),this.jobTitleName=ko.observable("Job Title"),this.addresses=ko.observable([]),this.pricing=ko.observable([]),this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.freelancerPricing.state.isLoading()},this),this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";return 1===count?one:count+more},this),this.pricingCount=ko.pureComputed(function(){var count=this.pricing().length,one="1 service",more=" services";return 1===count?one:count+more},this)}},{"../components/Activity":66,knockout:!1}],24:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function LearnMoreActivity(){Activity.apply(this,arguments),this.accessLevel=null,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar(null),this.navBar.rightAction(null)});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options),options&&options.route&&options.route.segments&&options.route.segments.length&&this.viewModel.profile(options.route.segments[0])};function ViewModel(){this.profile=ko.observable("customer")}},{"../components/Activity":66,knockout:!1}],25:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function LoginActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Anonymous,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar("Log in"),this.navBar.rightAction(null),this.registerHandler({target:this.viewModel.isLogingIn,handler:function(v){if(v===!0){var $btn=this.$activity.find('[type="submit"]');$btn.button("loading"),this.viewModel.loginError("");var ended=function ended(){this.viewModel.isLogingIn(!1),$btn.button("reset")}.bind(this);if(this.viewModel.username.error()||this.viewModel.password.error())return this.viewModel.loginError("Review your data"),void ended();this.app.model.login(this.viewModel.username(),this.viewModel.password()).then(function(){this.viewModel.loginError(""),ended(),this.viewModel.username(""),this.viewModel.password(""),this.app.goDashboard()}.bind(this))["catch"](function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";this.viewModel.loginError(msg),ended()}.bind(this))}}.bind(this)}),this.registerHandler({target:this.viewModel.loginError,handler:function(err){var input=this.$activity.find(":input").get(0);err?input.focus():input.blur()}.bind(this)})});exports.init=A.init;var FormCredentials=require("../viewmodels/FormCredentials");function ViewModel(){var credentials=new FormCredentials;this.username=credentials.username,this.password=credentials.password,this.loginError=ko.observable(""),this.isLogingIn=ko.observable(!1),this.performLogin=function performLogin(){this.isLogingIn(!0)}.bind(this)}},{"../components/Activity":66,"../viewmodels/FormCredentials":142,knockout:!1}],26:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function LogoutActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.logout().then(function(){var newAnon=this.app.model.user().constructor.newAnonymous();this.app.model.user().model.updateWith(newAnon),this.app.shell.go("/")}.bind(this))}},{"../components/Activity":66}],27:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function MarketplaceJobtitlesActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Marketplace profile",{backLink:"/marketplaceProfile"}),this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?(this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list),this.viewModel.addresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading addresses.",error:err})}.bind(this)),this.app.model.freelancerPricing.getList(jobTitleID).then(function(list){list=this.app.model.freelancerPricing.asModel(list),this.viewModel.pricing(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading services.",error:err})}.bind(this)),this.app.model.userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.jobTitle(job.jobTitle),this.viewModel.userJobTitle(job.userJobTitle)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading your job title.",error:err})}.bind(this))):(this.viewModel.addresses([]),this.viewModel.pricing([]))}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{},jobID=0|params[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){this.jobTitleID=ko.observable(0),this.jobTitle=ko.observable(null),this.userJobTitle=ko.observable(null),this.jobTitleName=ko.pureComputed(function(){var j=this.jobTitle();return j&&j.singularName()||"Job Title"},this),this.isActiveStatus=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&1===j.statusID()||!1},write:function(v){var status=this.userJobTitle()&&this.userJobTitle().statusID();v===!0&&3===status?this.userJobTitle().statusID(1):v===!1&&1===status&&this.userJobTitle().statusID(3)},owner:this}),this.statusLabel=ko.pureComputed(function(){return this.isActiveStatus()?"ON":"OFF"},this),this.cancellationPolicyLabel=ko.pureComputed(function(){var pid=this.userJobTitle()&&this.userJobTitle().cancellationPolicyID();return pid||"Unknow"},this),this.instantBooking=ko.pureComputed(function(){return this.userJobTitle()&&this.userJobTitle().instantBooking()},this),this.instantBookingLabel=ko.pureComputed(function(){return this.instantBooking()?"ON":"OFF"},this),this.toggleInstantBooking=function(){var current=this.instantBooking();this.userJobTitle()&&this.userJobTitle().instantBooking(!current)},this.addresses=ko.observable([]),this.pricing=ko.observable([]),this.licenseCertifications=ko.observable([]),this.workPhotos=ko.observable([]),this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.freelancerPricing.state.isLoading()},this),this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";return 1===count?one:count+more},this),this.pricingCount=ko.pureComputed(function(){var count=this.pricing().length,one="1 service",more=" services";return 1===count?one:count+more},this),this.licenseCertificationsSummary=ko.pureComputed(function(){var lc=this.licenseCertifications();if(lc&&lc.length){var verified=0,pending=0;return lc.forEach(function(l){l&&1===l.statusID()?verified++:l&&2===l.statusID()&&pending++}),verified+" verified, "+pending+" pending"}return"There are not verifications"},this),this.workPhotosSummary=ko.pureComputed(function(){var wp=this.workPhotos();return wp&&wp.length>1?wp.length+" images":wp&&1===wp.length?"1 image":"No images"},this)}},{"../components/Activity":66,knockout:!1}],28:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),ko=require("knockout"),moment=require("moment"),A=Activity["extends"](function MarketplaceProfileActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar("Marketplace Profile"),this.viewModel.showMarketplaceInfo(!0),this.viewModel.baseUrl("/marketplaceJobtitles")});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.sync()};function ViewModel(app){var jobVm=new UserJobProfileViewModel(app);return jobVm.verificationsCount=ko.observable(3),jobVm.displayedVerificationsNumber=ko.computed(function(){var verificationsCount=this.verificationsCount();return"("+verificationsCount+")"},jobVm),jobVm.verificationsSecondaryText=ko.computed(function(){var verificationsLimit=10,count=this.verificationsCount(),remaining=verificationsLimit-count;return remaining>0?"You can add up to "+remaining+" more":"You cannot add more"},jobVm),jobVm.displayedLastBackgroundCheck=ko.computed(function(){var lastDate=new Date(2014,10,14);return moment(lastDate).format("L")},jobVm),jobVm}},{"../components/Activity":66,"../viewmodels/UserJobProfile":147,knockout:!1,moment:!1}],29:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function OwnerInfoActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"account"})});exports.init=A.init},{"../components/Activity":66}],30:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function PrivacySettingsActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.LoggedUser,this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"account"}),this.registerHandler({target:this.app.model.privacySettings,event:"error",handler:function(err){var msg="save"===err.task?"Error saving privacy settings.":"Error loading privacy settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.privacySettings.sync(),this.viewModel.discard()};function ViewModel(app){var privacySettings=app.model.privacySettings,settingsVersion=privacySettings.newVersion();settingsVersion.isObsolete.subscribe(function(itIs){itIs&&settingsVersion.pull({evenIfNewer:!0})}),this.settings=settingsVersion.version,this.isLocked=privacySettings.isLocked,this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},privacySettings),this.discard=function discard(){settingsVersion.pull({evenIfNewer:!0})}.bind(this),this.save=function save(){settingsVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this)}},{"../components/Activity":66,knockout:!1}],31:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),A=Activity["extends"](function SchedulingActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new UserJobProfileViewModel(this.app),this.navBar=Activity.createSectionNavBar("Scheduling")});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.viewModel.sync()}},{"../components/Activity":66,"../viewmodels/UserJobProfile":147}],32:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),moment=require("moment"),A=Activity["extends"](function SchedulingPreferencesActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.Freelancer,this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"}),this.registerHandler({target:this.app.model.schedulingPreferences,event:"error",handler:function(err){var msg="save"===err.task?"Error saving scheduling preferences.":"Error loading scheduling preferences.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init,A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.app.model.schedulingPreferences.sync(),this.viewModel.discard()};function ViewModel(app){var schedulingPreferences=app.model.schedulingPreferences,prefsVersion=schedulingPreferences.newVersion();prefsVersion.isObsolete.subscribe(function(itIs){itIs&&prefsVersion.pull({evenIfNewer:!0})}),this.prefs=prefsVersion.version,this.isLocked=schedulingPreferences.isLocked,this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},schedulingPreferences),this.discard=function discard(){prefsVersion.pull({evenIfNewer:!0})}.bind(this),this.save=function save(){prefsVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this),this.incrementsExample=ko.pureComputed(function(){for(var str="e.g. ",incSize=this.incrementsSizeInMinutes(),m=moment({hour:10,minute:0}),hours=[m.format("HH:mm")],i=1;4>i;i++)hours.push(m.add(incSize,"minutes").format("HH:mm"));return str+=hours.join(", ")},this.prefs)}},{"../components/Activity":66,knockout:!1,moment:!1}],33:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function ServiceAddressesActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Freelancer,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling"}),this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(),this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){return this.viewModel.jobTitle(jobTitle),this.updateNavBarState(),this.app.model.serviceAddresses.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.serviceAddresses.asModel(list),this.viewModel.sourceAddresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this)):(this.viewModel.sourceAddresses([]),this.viewModel.jobTitle(null),this.updateNavBarState())}.bind(this)}),this.viewModel.returnSelected=function(addressID,jobTitleID){this.requestData.selectedAddressID=addressID,this.requestData.selectedJobTitleID=jobTitleID,this.app.shell.goBack(this.requestData)}.bind(this),this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();if(this.viewModel.headerText(itIs?"Select or add a service location":"Locations"),!this.app.model.onboarding.updateNavBar(this.navBar)){if(this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title(""),this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction),this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduling";this.navBar.leftAction().link(jid?"/jobtitles/"+jid:"/scheduling"),this.navBar.leftAction().text(jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)}},A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.viewModel.jobTitleID(0),this.viewModel.requestData=this.requestData,this.viewModel.isSelectionMode(options.selectAddress===!0),this.viewModel.clientID(options.clientID||null);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];return options.returnNewAsSelected===!0&&options.addressID?void setTimeout(function(){delete options.returnNewAsSelected,this.viewModel.returnSelected(options.addressID,jobTitleID)}.bind(this),1):(this.viewModel.jobTitleID(jobTitleID),this.updateNavBarState(),void(0===jobTitleID&&this.viewModel.jobTitles.sync()))};var UserJobProfile=require("../viewmodels/UserJobProfile");function ViewModel(app){this.headerText=ko.observable("Locations"),this.jobTitleID=ko.observable(0),this.jobTitle=ko.observable(null),this.isSelectionMode=ko.observable(!1),this.clientID=ko.observable(null),this.jobTitles=new UserJobProfile(app),this.jobTitles.baseUrl("/serviceAddress"),this.jobTitles.selectJobTitle=function(jobTitle){return this.jobTitleID(jobTitle.jobTitleID()),!1}.bind(this),this.sourceAddresses=ko.observableArray([]),this.addresses=ko.computed(function(){var list=this.sourceAddresses();return this.isSelectionMode()&&(list=list.filter(function(add){return add.isServiceLocation()})),list},this),this.isSyncing=app.model.serviceAddresses.state.isSyncing(),this.isLoading=ko.computed(function(){var add=app.model.serviceAddresses.state.isLoading(),jobs=this.jobTitles.isLoading();return add||jobs},this),this.goNext=function(){app.model.onboarding.inProgress()&&app.model.onboarding.goNext()},this.selectAddress=function(selectedAddress,event){this.isSelectionMode()===!0?this.returnSelected(selectedAddress.addressID(),selectedAddress.jobTitleID()):app.shell.go("addressEditor/service/"+this.jobTitleID()+"/"+selectedAddress.addressID()),event.preventDefault(),event.stopImmediatePropagation()}.bind(this),this.addServiceLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceLocation",request=$.extend({},this.requestData,{returnNewAsSelected:this.isSelectionMode()});app.shell.go(url,request)}.bind(this),this.addServiceArea=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceArea",request=$.extend({},this.requestData,{returnNewAsSelected:this.isSelectionMode()});app.shell.go(url,request)}.bind(this),this.addClientLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/clientLocation/"+this.clientID(),request=$.extend({},this.requestData,{returnNewAsSelected:this.isSelectionMode()});app.shell.go(url,request)}.bind(this),this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasItems=this.sourceAddresses().length>0;return isin&&hasItems},this)}},{"../components/Activity":66,"../viewmodels/UserJobProfile":147,knockout:!1}],34:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function SignupActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.Anonymous,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSectionNavBar(null),this.navBar.rightAction(null),this.registerHandler({target:this.viewModel.isSigningUp,handler:function(v){if(v===!0){var $btn=this.$activity.find('[type="submit"]');$btn.button("loading"),this.viewModel.signupError("");var ended=function ended(){this.viewModel.isSigningUp(!1),$btn.button("reset")}.bind(this);if(this.viewModel.username.error()||this.viewModel.password.error())return this.viewModel.signupError("Review your data"),void ended();this.app.model.signup(this.viewModel.username(),this.viewModel.password(),this.viewModel.profile()).then(function(signupData){this.viewModel.signupError(""),ended(),this.app.model.onboarding.setStep(signupData.onboardingStep),this.viewModel.username(""),this.viewModel.password(""),this.app.goDashboard()}.bind(this))["catch"](function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";
this.viewModel.signupError(msg),ended()}.bind(this))}}.bind(this)}),this.registerHandler({target:this.viewModel.signupError,handler:function(err){var input=this.$activity.find(":input").get(0);err?input.focus():input.blur()}.bind(this)})});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options),options&&options.route&&options.route.segments&&options.route.segments.length&&this.viewModel.profile(options.route.segments[0])};var FormCredentials=require("../viewmodels/FormCredentials");function ViewModel(){var credentials=new FormCredentials;this.username=credentials.username,this.password=credentials.password,this.signupError=ko.observable(""),this.isSigningUp=ko.observable(!1),this.performSignup=function performSignup(){this.isSigningUp(!0)}.bind(this),this.profile=ko.observable("customer")}},{"../components/Activity":66,"../viewmodels/FormCredentials":142,knockout:!1}],35:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter,Activity=require("../components/Activity"),A=Activity["extends"](function TextEditorActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser,this.viewModel=new ViewModel(this.app),this.navBar=Activity.createSubsectionNavBar(""),this.navBar.leftAction().handler(function(){this.emit("cancel")}.bind(this.viewModel)),this.$textarea=this.$activity.find("textarea"),this.textarea=this.$textarea.get(0),this.registerHandler({target:this.viewModel,event:"saved",handler:function(){this.requestData.text=this.viewModel.text(),this.app.shell.goBack(this.requestData)}.bind(this)}),this.registerHandler({target:this.viewModel,event:"cancel",handler:function(){this.app.shell.goBack(this.requestData)}.bind(this)})});exports.init=A.init,A.prototype.show=function show(options){Activity.prototype.show.call(this,options),this.navBar.leftAction().text(this.requestData.navTitle||""),this.viewModel.headerText(this.requestData.header),this.viewModel.text(this.requestData.text),this.textarea.focus(),this.$textarea.click(),window.scrollTo(0,0)};function ViewModel(){this.headerText=ko.observable("Text"),this.text=ko.observable(""),this.cancel=function cancel(){this.emit("cancel")},this.save=function save(){this.emit("saved")}}ViewModel._inherits(EventEmitter)},{"../components/Activity":66,events:!1,knockout:!1}],36:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function WeeklyScheduleActivity(){Activity.apply(this,arguments),this.viewModel=new ViewModel(this.app),this.accessLevel=this.app.UserType.Freelancer,this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"}),this.defaultNavBar=this.navBar.model.toPlainObject(),this.registerHandler({target:this.app.model.simplifiedWeeklySchedule,event:"error",handler:function(err){var msg="save"===err.task?"Error saving your weekly schedule.":"Error loading your weekly schedule.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init,A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar)},A.prototype.show=function show(state){Activity.prototype.show.call(this,state),this.updateNavBarState(),this.app.model.simplifiedWeeklySchedule.sync(),this.viewModel.discard()};function ViewModel(app){var simplifiedWeeklySchedule=app.model.simplifiedWeeklySchedule,scheduleVersion=simplifiedWeeklySchedule.newVersion();scheduleVersion.isObsolete.subscribe(function(itIs){itIs&&scheduleVersion.pull({evenIfNewer:!0})}),this.schedule=scheduleVersion.version,this.isLocked=simplifiedWeeklySchedule.isLocked,this.isSaving=simplifiedWeeklySchedule.isSaving,this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},simplifiedWeeklySchedule),this.discard=function discard(){scheduleVersion.pull({evenIfNewer:!0})},this.save=function save(){scheduleVersion.pushSave().then(function(){app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})}}},{"../components/Activity":66,knockout:!1}],37:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function WelcomeActivity(){Activity.apply(this,arguments),this.accessLevel=this.app.UserType.LoggedUser;var app=this.app;this.viewModel={startOnboarding:function startOnboarding(){app.model.onboarding.goNext()}},this.navBar=new Activity.NavBar({title:null,leftAction:Activity.NavAction.goLogout,rightAction:null})});exports.init=A.init},{"../components/Activity":66}],38:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),propTools=require("./utils/jsPropertiesTools"),getObservable=require("./utils/getObservable");exports.registerAll=function(){ko.components.register("app-navbar-action",{template:{element:"navbar-action-template"},viewModel:function(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}}),ko.components.register("app-unlabeled-input",{template:{element:"unlabeled-input-template"},viewModel:function(params){this.value=getObservable(params.value),this.placeholder=getObservable(params.placeholder),this.disable=getObservable(params.disable);var userAttr=getObservable(params.attr);this.attr=ko.pureComputed(function(){var attr=userAttr()||{};return $.extend({},attr,{"aria-label":this.placeholder(),placeholder:this.placeholder(),type:this.type()})},this);var type=getObservable(params.type);this.type=ko.computed(function(){return type()||"text"},this)}}),ko.components.register("app-feedback-entry",{template:{element:"feedback-entry-template"},viewModel:function(params){this.section=getObservable(params.section||""),this.url=ko.pureComputed(function(){return"/feedbackForm/"+this.section()},this)}}),ko.components.register("app-time-slot-tile",{template:{element:"time-slot-tile-template"},viewModel:require("./viewmodels/TimeSlot")}),ko.components.register("app-loading-spinner",{template:{element:"loading-spinner-template"},viewModel:function(params){var base="loadingSpinner";this.mod=getObservable(params.mod||""),this.cssClass=ko.pureComputed(function(){var c=base,mods=(this.mod()||"").split(" ");return mods.length&&(c+=" "+base+"--"+mods.join(" "+base+"--")),c},this)}}),ko.components.register("app-appointment-card",{template:{element:"appointment-card-template"},viewModel:require("./viewmodels/AppointmentCard")}),ko.components.register("app-job-titles-list",{template:{element:"job-titles-list-template"},viewModel:function(params){this.jobTitles=getObservable(params.jobTitles||[]),this.selectJobTitle=params.selectJobTitle||function(){},this.showMarketplaceInfo=getObservable(params.showMarketplaceInfo||!1)}})}},{"./utils/getObservable":124,"./utils/jsPropertiesTools":127,"./viewmodels/AppointmentCard":140,"./viewmodels/TimeSlot":146,knockout:!1}],39:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),NavBar=require("./viewmodels/NavBar"),NavAction=require("./viewmodels/NavAction");exports["extends"]=function(app){function adjustUserBar(){var user=app.model.user();user.isAnonymous()&&app.navBar().leftAction(NavAction.menuOut)}app.navBar=ko.observable(null);var refreshNav=function refreshNav(){$(".AppNav").trigger("contentChange")},autoRefreshNav=function autoRefreshNav(action){action&&(action.text.subscribe(refreshNav),action.isTitle.subscribe(refreshNav),action.icon.subscribe(refreshNav),action.isMenu.subscribe(refreshNav))};app.updateAppNav=function updateAppNav(activity,state){"navBar"in activity?app.navBar(activity.navBar):app.navBar(new NavBar),state&&state.route&&state.route.query&&state.route.query.mustReturn&&app.navBar().leftAction(NavAction.goBack),adjustUserBar(),refreshNav(),autoRefreshNav(app.navBar().leftAction()),autoRefreshNav(app.navBar().rightAction())},app.updateMenu=function updateMenu(name){var $menu=$(".App-menus .navbar-collapse");$menu.find("li").removeClass("active"),$menu.find(".go-"+name).closest("li").addClass("active"),$menu.filter(":visible").collapse("hide")},app.setupNavBarBinding=function setupNavBarBinding(){var siteUrl=$("html").attr("data-site-url");app.navBarBinding={navBar:app.navBar,photoUrl:ko.observable(siteUrl+"/en-US/Profile/Photo/"),userName:ko.observable("Me")},ko.applyBindings(app.navBarBinding,$(".AppNav").get(0))},app.performsNavBarBack=function performsNavBarBack(options){var nav=this.navBar(),left=nav&&nav.leftAction(),$btn=$(".SmartNavBar-edge.left > a.SmartNavBar-btn");if(left&&!left.isMenu()){var event=$.Event("click");event.options=options||{},$btn.trigger(event)}else this.shell&&this.shell.goBack()};var lastNotificationTimer=null;app.showNavBarNotification=function showNavBarNotification(settings){var msg=settings&&settings.message||"Hello World!",duration=settings&&settings.duration||2e3,transitionDuration=settings&&settings.transitionDuration||400,$el=$(".AppNav .SmartNavBar-notification");$el.text(msg),$el.fadeIn(transitionDuration).queue(function(){$el.off("click.manualHide").on("click.manualHide",function(){$el.fadeOut(transitionDuration)}),clearTimeout(lastNotificationTimer),lastNotificationTimer=setTimeout(function(){$el.fadeOut(transitionDuration)},duration),$(this).dequeue()})}}},{"./viewmodels/NavAction":143,"./viewmodels/NavBar":144,knockout:!1}],40:[function(require,module,exports){"use strict";var Activity=require("./components/Activity"),EmptyActivity=Activity["extends"](function EmptyActivity(){Activity.apply(this,arguments),this.accessLevel=null,this.viewModel={},this.navBar=Activity.createSectionNavBar()});module.exports={_test:EmptyActivity,calendar:require("./activities/calendar"),datetimePicker:require("./activities/datetimePicker"),clients:require("./activities/clients"),freelancerPricing:require("./activities/freelancerPricing"),serviceAddresses:require("./activities/serviceAddresses"),textEditor:require("./activities/textEditor"),home:require("./activities/home"),appointment:require("./activities/appointment"),index:require("./activities/index"),login:require("./activities/login"),logout:require("./activities/logout"),learnMore:require("./activities/learnMore"),signup:require("./activities/signup"),contactInfo:require("./activities/contactInfo"),welcome:require("./activities/welcome"),addressEditor:require("./activities/addressEditor"),account:require("./activities/account"),inbox:require("./activities/inbox"),conversation:require("./activities/conversation"),scheduling:require("./activities/scheduling"),jobtitles:require("./activities/jobtitles"),feedback:require("./activities/feedback"),faqs:require("./activities/faqs"),feedbackForm:require("./activities/feedbackForm"),contactForm:require("./activities/contactForm"),cms:require("./activities/cms"),clientEditor:require("./activities/clientEditor"),schedulingPreferences:require("./activities/schedulingPreferences"),calendarSyncing:require("./activities/calendarSyncing"),weeklySchedule:require("./activities/weeklySchedule"),bookMeButton:require("./activities/bookMeButton"),ownerInfo:require("./activities/ownerInfo"),privacySettings:require("./activities/privacySettings"),addJobTitles:require("./activities/addJobTitles"),freelancerPricingEditor:require("./activities/freelancerPricingEditor"),marketplaceProfile:require("./activities/marketplaceProfile"),marketplaceJobtitles:require("./activities/marketplaceJobtitles")}},{"./activities/account":1,"./activities/addJobTitles":2,"./activities/addressEditor":3,"./activities/appointment":4,"./activities/bookMeButton":5,"./activities/calendar":6,"./activities/calendarSyncing":7,"./activities/clientEditor":8,"./activities/clients":9,"./activities/cms":10,"./activities/contactForm":11,"./activities/contactInfo":12,"./activities/conversation":13,"./activities/datetimePicker":14,"./activities/faqs":15,"./activities/feedback":16,"./activities/feedbackForm":17,"./activities/freelancerPricing":18,"./activities/freelancerPricingEditor":19,"./activities/home":20,"./activities/inbox":21,"./activities/index":22,"./activities/jobtitles":23,"./activities/learnMore":24,"./activities/login":25,"./activities/logout":26,"./activities/marketplaceJobtitles":27,"./activities/marketplaceProfile":28,"./activities/ownerInfo":29,"./activities/privacySettings":30,"./activities/scheduling":31,"./activities/schedulingPreferences":32,"./activities/serviceAddresses":33,"./activities/signup":34,"./activities/textEditor":35,"./activities/weeklySchedule":36,"./activities/welcome":37,"./components/Activity":66}],41:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery-mobile"),require("./utils/jquery.multiline");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits"),require("./utils/Function.prototype._delayed"),require("./utils/Function.prototype.name-polyfill"),require("es6-promise").polyfill();var layoutUpdateEvent=require("layoutUpdateEvent"),AppModel=require("./appmodel/AppModel");require("./locales/en-US-LC");var attachFastClick=require("fastclick").attach;function preBootstrapWorkarounds(){function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}$(document).on("click.bs.collapse.data-api.workaround",'[data-toggle="collapse"]',function(){var $t=$(this),$target=getTargetFromTrigger($t),data=$target&&$target.data("bs.collapse");data&&(data.$trigger=$t)})}var app={shell:require("./app.shell"),model:new AppModel,activities:require("./app.activities"),modals:require("./app.modals"),goDashboard:function goDashboard(){goDashboard._going!==!0&&setTimeout(function(){goDashboard._going=!0;var onboarding=this.model.onboarding.stepUrl();onboarding?this.shell.go(onboarding):this.shell.go("home"),setTimeout(function(){goDashboard._going=!1},1)}.bind(this),1)}};require("./app-navbar")["extends"](app),require("./app-components").registerAll(),app.getActivity=function getActivity(name){var activity=this.activities[name];if(activity){var $act=this.shell.items.find(name);if($act&&$act.length)return activity.init($act,this)}return null},app.getActivityControllerByRoute=function getActivityControllerByRoute(route){var actName=route.name||this.shell.indexName;return this.getActivity(actName)},app.shell.accessControl=require("./utils/accessControl")(app),app.UserType=require("./models/User").UserType,app.successSave=function successSave(settings){settings=$.extend({message:"Your changes have been saved",link:null},settings),this.showNavBarNotification(settings),settings.link?this.shell.go(settings.link):this.performsNavBarBack({silentMode:!0})};var appInit=function appInit(){attachFastClick(document.body),layoutUpdateEvent.layoutUpdateEvent+=" orientationchange",layoutUpdateEvent.on();var trigLayout=function trigLayout(){$(window).trigger("layoutUpdate")};window.addEventListener("native.keyboardshow",trigLayout),window.addEventListener("native.keyboardhide",trigLayout),window.StatusBar&&window.StatusBar.overlaysWebView(!1),setTimeout(function(){$(window).trigger("layoutUpdate")},200),preBootstrapWorkarounds(),require("bootstrap"),bootknock.plugIn(ko),require("./utils/bootstrapSwitchBinding").plugIn(ko),window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&window.cordova.plugins.Keyboard.disableScroll(!1),$(document).on("click","[data-shell]",function(e){var cmdline=$(this).attr("data-shell")||"",args=cmdline.split(" "),cmd=args[0];cmd&&"function"==typeof app.shell[cmd]&&(app.shell[cmd].apply(app.shell,args.slice(1)),e.stopImmediatePropagation(),e.preventDefault())}),window.cordova&&$(document).on("click",'[target="_blank"], [target="_system"]',function(e){window.open(this.getAttribute("href"),this.getAttribute("target")),e.preventDefault()}),app.shell.on(app.shell.events.itemReady,function($act,state){var routeName=app.shell.currentRoute.name,actName=$act.data("activity");if(routeName===actName){var activity=app.getActivity(actName);if(activity.show(state),routeName=app.shell.currentRoute.name,routeName===actName){var menuItem=activity.menuItem||actName;app.updateMenu(menuItem),app.updateAppNav(activity,state)}}}),app.shell.on(app.shell.events.closed,function($act){var actName=$act.data("activity"),activity=app.getActivity(actName);activity.hide&&activity.hide()}),app.shell.on("error",function(err){app.modals.showError({error:err})});var scrollToElement=require("./utils/scrollToElement");app.shell.on("fragmentNavigation",function(href){if("#"===href)console.warn('Navigation to an empty fragment, this may be not wanted. For root links, use "/"; on script handled links, call event.preventDefault; A touch event was listened on a link, but not the click event.');else{var target=$(href);target.length&&scrollToElement(target,{animation:{duration:300}})}}),app.setupNavBarBinding();var SmartNavBar=require("./components/SmartNavBar"),navBars=SmartNavBar.getAll();navBars.forEach(function(navbar){$(navbar.el).on("contentChange",function(){navbar.refresh()})});var togglingBackdrop=!1;$(document).on("show.bs.collapse hide.bs.collapse",".AppNav .navbar-collapse",function(e){if(!togglingBackdrop){togglingBackdrop=!0;var enabled="show"===e.type;$("body").toggleClass("use-backdrop",enabled),$("body").toggleClass("has-appNav-open",enabled),$(".collapsing, .collapse.in").collapse("hide"),togglingBackdrop=!1}}),app.model.on("error",function(err){app.modals.showError({error:err})}),$(document).on("focus",'[data-autoselect="true"]',function(){$(this).select()});var alertError=function(err){app.modals.showError({title:"There was an error loading",error:err})};app.model.init().then(app.shell.run.bind(app.shell),alertError).then(function(){$("html").addClass("is-ready"),window.navigator&&window.navigator.splashscreen&&window.navigator.splashscreen.hide(),ko.computed(function(){var n=app.model.userProfile.data.firstName();app.navBarBinding.userName(n||"Me")}),app.model.onboarding.init(app);var step=app.model.user().onboardingStep();if(step&&app.model.onboarding.setStep(step)){var url=app.model.onboarding.stepUrl();app.shell.go(url)}},alertError),window.app=app};$(window.cordova?function(){$(document).on("deviceready",appInit)}:appInit)},{"./app-components":38,"./app-navbar":39,"./app.activities":40,"./app.modals":42,"./app.shell":43,"./appmodel/AppModel":54,"./components/SmartNavBar":68,"./locales/en-US-LC":69,"./models/User":99,"./utils/Function.prototype._delayed":105,"./utils/Function.prototype._inherits":106,"./utils/Function.prototype.name-polyfill":107,"./utils/accessControl":116,"./utils/bootknockBindingHelpers":118,"./utils/bootstrapSwitchBinding":119,"./utils/jquery.multiline":126,"./utils/scrollToElement":129,"es6-promise":!1,knockout:!1}],42:[function(require,module,exports){"use strict";var $=require("jquery");exports.getErrorMessageFrom=function getErrorMessageFrom(err,defaultText){if(defaultText=defaultText||"Unknow error",err){if("string"==typeof err)return err||defaultText;err=err.responseJSON||err;var msg=err.name&&err.name+": "||"";if(msg+=err.errorMessage||err.message||"",err.errors)msg+="\n"+exports.stringifyErrorsList(err.errors);else try{var jserr=JSON.stringify(err),hasMoreInfo=jserr&&"{}"!==jserr;if(hasMoreInfo){hasMoreInfo=!1;var messagePropertiesList=["name","errorMessage","message","errors"];Object.keys(err).forEach(function(key){-1===messagePropertiesList.indexOf(key)&&(hasMoreInfo=!0)})}hasMoreInfo&&(msg+="\n\nTechnical details: "+jserr)}catch(ex){console.log("Impossible to stringify JSON error",err,ex)}return msg||defaultText}return defaultText},exports.stringifyErrorsList=function(errors){var msg="";return msg=Array.isArray(errors)?errors.join("\n"):Object.keys(errors).map(function(key){return errors[key].join("\n")}).join("\n")},exports.showError=function showErrorModal(options){var modal=$("#errorModal"),header=modal.find("#errorModal-label"),body=modal.find("#errorModal-body");options=options||{};var msg=body.data("default-text");return msg=exports.getErrorMessageFrom(options.error||options.message,msg),body.multiline(msg),header.text(options.title||header.data("default-text")),new Promise(function(resolve){modal.modal("show"),modal.on("hide.bs.modal",function(){resolve()})})},exports.confirm=function confirm(options){var modal=$("#confirmModal"),header=modal.find("#confirmModal-label"),body=modal.find("#confirmModal-body"),yesBtn=modal.find("#confirmModal-yesBtn"),noBtn=modal.find("#confirmModal-noBtn");options=options||{};var title=header.data("default-text"),msg=body.data("default-text"),yes=yesBtn.data("default-text"),no=noBtn.data("default-text");return body.multiline(options.message||msg),header.text(options.title||title),yesBtn.text(options.yes||yes),noBtn.text(options.no||no),new Promise(function(resolve,reject){modal.modal("show"),yesBtn.on("click",function(){resolve()}),noBtn.on("click",function(){reject()}),modal.on("hide.bs.modal",function(){reject()})})},exports.showNotification=function showNotification(options){var modal=$("#notificationModal"),header=modal.find("#notificationModal-label"),body=modal.find("#notificationModal-body");options=options||{};var msg=options.message||body.data("default-text");return body.multiline(msg),header.text(options.title||header.data("default-text")),new Promise(function(resolve){modal.modal("show"),modal.on("hide.bs.modal",function(){resolve()})})},exports.showTimePicker=require("./modals/timePicker").show},{"./modals/timePicker":70}],43:[function(require,module,exports){"use strict";var baseUrl=window.location.pathname,History=require("./utils/shell/hashbangHistory"),shell=require("./utils/shell/index"),Shell=shell.Shell,DomItemsManager=shell.DomItemsManager,shell=new Shell({root:"body",baseUrl:baseUrl,forceHashbang:!0,indexName:"index",linkEvent:"click",loader:null,history:History,domItemsManager:new DomItemsManager({idAttributeName:"data-activity"})});module.exports=shell},{"./utils/shell/hashbangHistory":134,"./utils/shell/index":135}],44:[function(require,module,exports){"use strict";var localforage=require("localforage");exports.plugIn=function(AppModel){AppModel.prototype.tryLogin=function tryLogin(){return localforage.getItem("credentials").then(function(credentials){if(credentials)return this.login(credentials.username,credentials.password);throw new Error("No saved credentials")}.bind(this))},AppModel.prototype.login=function login(username,password){return this.rest.extraHeaders=null,this.rest.post("login",{username:username,password:password,returnProfile:!0}).then(performLocalLogin(this,username,password))},AppModel.prototype.logout=function logout(){return this.rest.extraHeaders=null,localforage.removeItem("credentials"),localforage.removeItem("profile"),this.clearLocalData(),this.rest.post("logout"),Promise.resolve()},AppModel.prototype.signup=function signup(username,password,profileType){return this.rest.extraHeadres=null,this.rest.post("signup?utm_source=app",{username:username,password:password,profileType:profileType,returnProfile:!0}).then(performLocalLogin(this,username,password))}};function performLocalLogin(thisAppModel,username,password){return function(logged){return thisAppModel.clearLocalData().then(function(){return thisAppModel.rest.extraHeaders={alu:logged.userID,alk:logged.authKey},localforage.setItem("credentials",{userID:logged.userID,username:username,password:password,authKey:logged.authKey}),localforage.setItem("profile",logged.profile),thisAppModel.user().model.updateWith(logged.profile),logged})}}},{localforage:!1}],45:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getBookings:function(filters){return appModel.rest.get("bookings",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Booking(rawItem)})})}}};return api.getBookingsByDates=function getBookingsByDates(date,end){return end=end||moment(date).clone().add(1,"days").toDate(),api.remote.getBookings({start:date,end:end}).then(function(bookings){var arr=ko.observableArray(bookings);return arr})},api.getUpcomingBookings=function getUpcomingBookings(){return appModel.rest.get("upcoming-bookings")},api.getBooking=function getBooking(id){return id?appModel.rest.get("bookings/"+id).then(function(booking){return new Booking(booking)}):Promise.reject("The bookingID is required to get a booking")},api.appointmentToSimplifiedBooking=function(apt){return{bookingID:apt.sourceBooking().bookingID(),customerUserID:apt.customerUserID(),addressID:apt.addressID(),startTime:apt.startTime(),pricing:apt.pricing().map(function(pricing){return pricing.freelancerPricingID()}),preNotesToClient:apt.preNotesToClient(),preNotesToSelf:apt.preNotesToSelf(),postNotesToClient:apt.postNotesToClient(),postNotesToSelf:apt.postNotesToSelf()}},api.bookingToSimplifiedBooking=function(booking){return{bookingID:booking().bookingID(),customerUserID:booking.customerUserID(),addressID:booking.addressID(),startTime:booking.startTime(),pricing:booking.bookingRequest().pricingEstimate().details().pricing.map(function(pricing){return pricing.freelancerPricingID()}),preNotesToClient:booking.preNotesToClient(),preNotesToSelf:booking.preNotesToSelf(),postNotesToClient:booking.postNotesToClient(),postNotesToSelf:booking.postNotesToSelf()}},api.setBooking=function setBooking(booking,allowBookUnavailableTime){booking=booking.bookingID?api.bookingToSimplifiedBooking(booking):booking.sourceBooking?api.appointmentToSimplifiedBooking(booking):booking;var id=booking.bookingID||"",method=id?"put":"post";return booking.allowBookUnavailableTime=allowBookUnavailableTime||!1,appModel.rest[method]("freelancer-bookings/"+id,booking).then(function(serverBooking){return new Booking(serverBooking)})},api}},{"../models/Booking":73,knockout:!1,moment:!1}],46:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),DateAvailability=require("../models/DateAvailability"),DateCache=require("../utils/DateCache"),moment=require("moment"),_=require("lodash"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this),this.setMaxListeners(30)}Api._inherits(EventEmitter);var api=new Api,cache=new DateCache({Model:DateAvailability,ttl:{minutes:10}});api.clearCache=function clearCache(){cache.clear(),this.emit("clearCache")},appModel.on("clearLocalData",function(){api.clearCache()}),api.getAppointment=function getAppointment(ids){return ids.calendarEventID?appModel.calendarEvents.getEvent(ids.calendarEventID).then(Appointment.fromCalendarEvent):ids.bookingID?appModel.bookings.getBooking(ids.bookingID).then(function(booking){return appModel.calendarEvents.getEvent(booking.confirmedDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):Promise.reject("Unrecognized ID")},api.setAppointment=function setAppointment(apt,allowBookUnavailableTime){return apt.sourceBooking()?appModel.bookings.setBooking(apt,allowBookUnavailableTime).then(function(booking){return api.clearCache(),appModel.calendarEvents.getEvent(booking.confirmedDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):apt.sourceEvent()?appModel.calendarEvents.setEvent(apt).then(function(event){return Appointment.fromCalendarEvent(event)}):Promise.reject(new Error("Unrecognized appointment object"))};var getRemoteAppointmentsByDate=function getRemoteAppointmentsByDate(date){return Promise.all([appModel.bookings.getBookingsByDates(date),appModel.calendarEvents.getEventsByDates(date)]).then(function(group){var events=group[1],bookings=group[0],apts=[];return events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings())),apts})},getRemoteDateAvailability=function getRemoteDateAvailability(date){return Promise.all([getRemoteAppointmentsByDate(date),appModel.simplifiedWeeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var apts=result[0],settings=result[1],weekDaySchedule=settings.weekDays[date.getDay()](),prefs=result[2],dateInfo={date:date,appointmentsList:apts||[],weekDaySchedule:weekDaySchedule,schedulingPreferences:prefs};return dateInfo})};api.getDateAvailability=function getDateAvailability(date){var cached=cache.getSingle(date);return cached?Promise.resolve(cached):getRemoteDateAvailability(date).then(function(dateInfo){return cache.set(date,dateInfo).data})};var getRemoteAppointmentsByDates=function getRemoteAppointmentsByDates(start,end){return Promise.all([appModel.bookings.getBookingsByDates(start,end),appModel.calendarEvents.getEventsByDates(start,end)]).then(function(group){var events=group[1],bookings=group[0],apts=[];events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings()));for(var grouped=_.groupBy(apts,function(apt){return moment(apt.startTime()).format("YYYY-MM-DD")}),date=new Date(start);end>=date;){var key=moment(date).format("YYYY-MM-DD");grouped.hasOwnProperty(key)||(grouped[key]=[]),date.setDate(date.getDate()+1)}return grouped})},getRemoteDatesAvailability=function getRemoteDatesAvailability(start,end){return Promise.all([getRemoteAppointmentsByDates(start,end),appModel.simplifiedWeeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var aptsDates=result[0],settings=result[1],results={},prefs=result[2];return Object.keys(aptsDates).forEach(function(dateKey){var date=moment(dateKey,"YYYY-MM-DD").toDate(),weekDaySchedule=settings.weekDays[date.getDay()](),dateInfo={date:date,appointmentsList:aptsDates[dateKey]||[],weekDaySchedule:weekDaySchedule,schedulingPreferences:prefs};results[dateKey]=dateInfo}),results})};return api.getDatesAvailability=function getDatesAvailability(start,end){var cacheResults=cache.get(start,end);return null===cacheResults.minHole?Promise.resolve(cacheResults.byDate):getRemoteDatesAvailability(cacheResults.minHole,cacheResults.maxHole).then(function(results){return Object.keys(results).forEach(function(dateKey){cacheResults.byDate[dateKey]=cache.set(dateKey,results[dateKey]).data}),cacheResults.byDate})},api}},{"../models/Appointment":72,"../models/DateAvailability":79,"../utils/DateCache":104,events:!1,lodash:!1,moment:!1}],47:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getCalendarEvents:function(filters){return appModel.rest.get("events",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new CalendarEvent(rawItem)})})}}};return api.getEventsByDates=function getEventsByDates(date,end){return end=end||moment(date).clone().add(1,"days").toDate(),api.remote.getCalendarEvents({start:date,end:end}).then(function(events){var arr=ko.observableArray(events);return arr})},api.getEvent=function getEvent(id){return id?appModel.rest.get("events/"+id).then(function(event){return new CalendarEvent(event)}):Promise.reject("The calendarEventID is required to get an event")},api.appointmentToSimplifiedEvent=function(apt){var rrule=apt.sourceEvent().recurrenceRule();rrule&&(rrule=apt.sourceEvent().recurrenceRule().model.toPlainObject());var occs=apt.sourceEvent().recurrenceOccurrences();return occs&&(occs=occs.map(function(occ){return occ&&occ.model.toPlainObject()||null}).filter(function(occ){return null!==occ})),{calendarEventID:apt.id()<0?0:apt.id(),eventTypeID:apt.sourceEvent().eventTypeID(),
summary:apt.summary(),description:apt.description(),availabilityTypeID:apt.sourceEvent().availabilityTypeID(),location:apt.addressSummary(),startTime:apt.startTime(),endTime:apt.endTime(),isAllDay:apt.sourceEvent().isAllDay(),recurrenceRule:rrule,recurrenceOccurrences:occs}},api.setEvent=function setEvent(event){event=event.calendarEventID?event.model.toPlainObject():event.sourceEvent?api.appointmentToSimplifiedEvent(event):event;var id=event.calendarEventID||"",method=id?"put":"post";return appModel.rest[method]("events"+(id?"/":"")+id,event).then(function(serverEvent){return new CalendarEvent(serverEvent)})},api}},{"../models/CalendarEvent":76,knockout:!1,moment:!1}],48:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return appModel.rest.get("calendar-syncing")},push:function push(){return appModel.rest.put("calendar-syncing",this.data.model.toPlainObject())}});return rem.isReseting=ko.observable(!1),rem.resetExportUrl=function resetExportUrl(){return rem.isReseting(!0),appModel.rest.post("calendar-syncing/reset-export-url").then(function(updatedSyncSettings){return rem.data.model.updateWith(updatedSyncSettings),rem.isReseting(!1),updatedSyncSettings})},appModel.on("clearLocalData",function(){rem.clearCache()}),rem}},{"../models/CalendarSyncing":77,"../utils/RemoteModel":113,knockout:!1}],49:[function(require,module,exports){"use strict";var Customer=require("../models/Customer"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"customerUserID",Model:Customer});api.addLocalforageSupport("customers"),api.addRestSupport(appModel.rest,"customers"),appModel.on("clearLocalData",function(){api.clearCache()});var publicSearchRequest=null;return api.publicSearch=function publicSearch(search){if(publicSearchRequest&&publicSearchRequest.abort)try{publicSearchRequest.abort()}catch(abortErr){console.error("Error aborting request",abortErr)}var request=appModel.rest.get("customers/public-search",search);return publicSearchRequest=request.xhr,request=request["catch"](function(err){return err&&"abort"===err.statusText?[]:err}),request.xhr=publicSearchRequest,request},api}},{"../models/Customer":78,"../utils/ListRemoteModel":111}],50:[function(require,module,exports){"use strict";exports.create=function create(appModel){var getUserDeviceInfo=function getUserDeviceInfo(){var dev=window.device||{platform:"web",model:"unknow",cordova:"",version:""};return{userAgent:navigator.userAgent,platform:dev.platform,version:dev.version,model:dev.model,cordova:dev.cordova}};return{postIdea:function postIdea(values){return values.userDevice=JSON.stringify(getUserDeviceInfo()),appModel.rest.post("feedback/ideas",values)},postSupport:function postSupport(values){return values.userDevice=JSON.stringify(getUserDeviceInfo()),appModel.rest.post("feedback/support",values)}}}},{}],51:[function(require,module,exports){"use strict";var FreelancerPricing=require("../models/FreelancerPricing"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"freelancerPricingID",Model:FreelancerPricing});return api.addLocalforageSupport("freelancer-pricing/"),api.addRestSupport(appModel.rest,"freelancer-pricing/"),appModel.on("clearLocalData",function(){api.clearCache()}),api}},{"../models/FreelancerPricing":80,"../utils/GroupListRemoteModel":108}],52:[function(require,module,exports){"use strict";var Address=require("../models/Address"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new Address,ttl:{minutes:1},localStorageName:"homeAddress",fetch:function fetch(){return appModel.rest.get("addresses/home")},push:function push(){return appModel.rest.put("addresses/home",this.data.model.toPlainObject())}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem}},{"../models/Address":71,"../utils/RemoteModel":113}],53:[function(require,module,exports){"use strict";var localforage=require("localforage"),JobTitle=require("../models/JobTitle"),ko=require("knockout");exports.create=function create(appModel){var api={state:{isLoading:ko.observable(!1)}},cache={jobTitles:{}};return api.clearCache=function clearCache(){cache.jobTitles={}},appModel.on("clearLocalData",function(){api.clearCache()}),api.getJobTitle=function getJobTitle(id){return id?cache.jobTitles[id]?Promise.resolve(cache.jobTitles[id]):(api.state.isLoading(!0),localforage.getItem("jobTitles/"+id).then(function(jobTitle){return jobTitle?(cache.jobTitles[id]=new JobTitle(jobTitle),api.state.isLoading(!1),cache.jobTitles[id]):appModel.rest.get("job-titles/"+id).then(function(raw){return localforage.setItem("jobTitles/"+id,raw),cache.jobTitles[id]=new JobTitle(raw),api.state.isLoading(!1),cache.jobTitles[id]})})["catch"](function(err){return api.state.isLoading(!1),err})):Promise.reject("Needs an ID to get a Job Title")},api}},{"../models/JobTitle":82,knockout:!1,localforage:!1}],54:[function(require,module,exports){var ko=require("knockout"),$=require("jquery"),Rest=require("../utils/Rest"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;function AppModel(){EventEmitter.call(this),this.setMaxListeners(30)}AppModel._inherits(EventEmitter),module.exports=AppModel,require("./AppModel-account").plugIn(AppModel),AppModel.prototype.loadLocalCredentials=function loadLocalCredentials(){return new Promise(function(resolve){var resolveAnyway=function(doesnMatter){console.warning("App Model Init err",doesnMatter),resolve()};localforage.getItem("credentials").then(function(credentials){credentials&&credentials.userID&&credentials.username&&credentials.authKey?(this.rest.extraHeaders={alu:credentials.userID,alk:credentials.authKey},this.userProfile.once("error",function(err){this.emit("error",{message:"Impossible to load your data. Please check your Internet connection",error:err})}.bind(this)),this.userProfile.load().then(function(profile){profile?resolve():this.tryLogin().then(resolve,resolveAnyway)}.bind(this),resolveAnyway)["catch"](function(){})):resolve()}.bind(this),resolveAnyway)}.bind(this))},AppModel.prototype.init=function init(){return localforage.config({name:"LoconomicsApp",version:.1,size:4980736,storeName:"keyvaluepairs",description:"Loconomics App",driver:localforage.LOCALSTORAGE}),localforage.getItem("config").then(function(config){return config=config||{},config.siteUrl?$("html").attr("data-site-url",config.siteUrl):config.siteUrl=$("html").attr("data-site-url"),this.rest=new Rest(config.siteUrl+"/api/v1/en-US/"),this.rest.onAuthorizationRequired=function(retry){this.tryLogin().then(function(){retry()})}.bind(this),this.loadModules(),this.loadLocalCredentials()}.bind(this))},AppModel.prototype.loadModules=function loadModules(){this.userProfile=require("./AppModel.userProfile").create(this),this.user=ko.computed(function(){return this.userProfile.data},this),this.onboarding=require("./AppModel.onboarding").create(this),this.schedulingPreferences=require("./AppModel.schedulingPreferences").create(this),this.calendarSyncing=require("./AppModel.calendarSyncing").create(this),this.simplifiedWeeklySchedule=require("./AppModel.simplifiedWeeklySchedule").create(this),this.marketplaceProfile=require("./AppModel.marketplaceProfile").create(this),this.homeAddress=require("./AppModel.homeAddress").create(this),this.privacySettings=require("./AppModel.privacySettings").create(this),this.bookings=require("./AppModel.bookings").create(this),this.calendarEvents=require("./AppModel.calendarEvents").create(this),this.jobTitles=require("./AppModel.jobTitles").create(this),this.userJobProfile=require("./AppModel.userJobProfile").create(this),this.calendar=require("./AppModel.calendar").create(this),this.serviceAddresses=require("./AppModel.serviceAddresses").create(this),this.freelancerPricing=require("./AppModel.freelancerPricing").create(this),this.pricingTypes=require("./AppModel.pricingTypes").create(this),this.messaging=require("./AppModel.messaging").create(this),this.customers=require("./AppModel.customers").create(this),this.postalCodes=require("./AppModel.postalCodes").create(this),this.feedback=require("./AppModel.feedback").create(this)},AppModel.prototype.clearLocalData=function clearLocalData(){return localforage.getItem("config").then(function(config){localforage.clear(),config&&localforage.setItem("config",config),this.emit("clearLocalData")}.bind(this))}},{"../utils/Rest":114,"./AppModel-account":44,"./AppModel.bookings":45,"./AppModel.calendar":46,"./AppModel.calendarEvents":47,"./AppModel.calendarSyncing":48,"./AppModel.customers":49,"./AppModel.feedback":50,"./AppModel.freelancerPricing":51,"./AppModel.homeAddress":52,"./AppModel.jobTitles":53,"./AppModel.marketplaceProfile":55,"./AppModel.messaging":56,"./AppModel.onboarding":57,"./AppModel.postalCodes":58,"./AppModel.pricingTypes":59,"./AppModel.privacySettings":60,"./AppModel.schedulingPreferences":61,"./AppModel.serviceAddresses":62,"./AppModel.simplifiedWeeklySchedule":63,"./AppModel.userJobProfile":64,"./AppModel.userProfile":65,events:!1,knockout:!1,localforage:!1}],55:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return appModel.rest.get("marketplace-profile")},push:function push(){return appModel.rest.put("marketplace-profile",this.data.model.toPlainObject())}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem}},{"../models/MarketplaceProfile":86,"../utils/RemoteModel":113}],56:[function(require,module,exports){"use strict";var Thread=require("../models/Thread"),CacheControl=require("../utils/CacheControl"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"threadID",Model:Thread});api.addLocalforageSupport("messaging"),api.addRestSupport(appModel.rest,"messaging"),appModel.on("clearLocalData",function(){api.clearCache()});var fullThreadsCache={},fetchThreadRemote=function(threadID){return appModel.rest.get("messaging/"+threadID,{limit:1e3}).then(function(thread){if(thread){thread=new Thread(thread);var cached=fullThreadsCache[threadID];return cached?(cached.control.latest=new Date,cached.thread=thread):(fullThreadsCache[threadID]={control:new CacheControl({ttl:{minutes:1}}),thread:thread},fullThreadsCache[threadID].control.latest=new Date),thread}throw new Error("Not Found")})},markAsEndedAndFollowUp=function(any){return api.state.isSyncing(!1),api.state.isLoading(!1),any};return api.getItem=function getItem(threadID){var cached=fullThreadsCache[threadID];return cached&&cached.thread?cached.control.mustRevalidate()?(api.state.isSyncing(!0),fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)):Promise.resolve(cached.thread):(api.state.isLoading(!0),fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp))},api}},{"../models/Thread":97,"../utils/CacheControl":103,"../utils/ListRemoteModel":111}],57:[function(require,module,exports){"use strict";var OnboardingProgress=require("../viewmodels/OnboardingProgress"),NavAction=require("../viewmodels/NavAction");exports.create=function create(appModel){var api=new OnboardingProgress;return api.init=function init(app){api.app=app},api.setStep=function(stepReference){if(stepReference){var stepItems=stepReference.split(":",2),group=stepItems[0],step=stepItems[1]||group;if(this.setStepByName(step))return!0;var groupSteps=OnboardingProgress.predefinedStepGroups[group];if(groupSteps&&(this.steps(groupSteps),this.group(group),this.setStepByName(step)))return!0}return this.model.reset(),!1},api.updateNavBar=function(navBar){var yep=this.inProgress();return yep&&(navBar.leftAction(NavAction.goLogout),navBar.title(this.progressText())),yep},api.goNext=function goNext(){var current=this.stepNumber();current++,current>this.totalSteps()?(this.stepNumber(-1),appModel.userProfile.saveOnboardingStep(null),this.app.shell.go("/",{completedOnboarding:api.group()})):(this.stepNumber(current),appModel.userProfile.saveOnboardingStep(this.stepReference()),this.app.shell.go(this.stepUrl()))},api.goPrevious=function goPrevious(){var current=this.stepNumber();current--,current>=0&&current<=this.totalSteps()?this.stepNumber(current):this.stepNumber(0),appModel.userProfile.saveOnboardingStep(this.stepReference()),this.app.shell.go(this.stepUrl())},api}},{"../viewmodels/NavAction":143,"../viewmodels/OnboardingProgress":145}],58:[function(require,module,exports){"use strict";exports.create=function create(appModel){var api={},cache={};return api.getItem=function getItem(postalCode){return postalCode=postalCode||"",/^\s*$/.test(postalCode)?Promise.reject("Postal Code Not Valid"):cache.hasOwnProperty(postalCode)?Promise.resolve(cache[postalCode]):appModel.rest.get("postal-codes/"+postalCode).then(function(info){return info&&(cache[postalCode]=info),info})},appModel.on("clearLocalData",function(){cache={}}),api}},{}],59:[function(require,module,exports){"use strict";var PricingType=require("../models/PricingType"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"pricingTypeID",Model:PricingType});return api.addLocalforageSupport("pricing-types"),api.addRestSupport(appModel.rest,"pricing-types"),appModel.on("clearLocalData",function(){api.clearCache()}),api}},{"../models/PricingType":93,"../utils/ListRemoteModel":111}],60:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return appModel.rest.get("privacy-settings")},push:function push(){return appModel.rest.put("privacy-settings",this.data.model.toPlainObject())}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem}},{"../models/PrivacySettings":94,"../utils/RemoteModel":113}],61:[function(require,module,exports){"use strict";var SchedulingPreferences=require("../models/SchedulingPreferences"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new SchedulingPreferences,ttl:{minutes:1},localStorageName:"schedulingPreferences",fetch:function fetch(){return appModel.rest.get("scheduling-preferences")},push:function push(){return appModel.rest.put("scheduling-preferences",this.data.model.toPlainObject()).then(function(result){return appModel.calendar.clearCache(),result})}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem}},{"../models/SchedulingPreferences":95,"../utils/RemoteModel":113}],62:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"addressID",Model:Address});return api.addLocalforageSupport("addresses/service/"),api.addRestSupport(appModel.rest,"addresses/service/"),appModel.on("clearLocalData",function(){api.clearCache()}),api}},{"../models/Address":71,"../utils/GroupListRemoteModel":108}],63:[function(require,module,exports){"use strict";var SimplifiedWeeklySchedule=require("../models/SimplifiedWeeklySchedule"),RemoteModel=require("../utils/RemoteModel"),moment=require("moment"),defaultSlotSize=15,weekDayProperties=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];exports.create=function create(appModel){var rem=new RemoteModel({data:new SimplifiedWeeklySchedule,ttl:{minutes:1},localStorageName:"weeklySchedule",fetch:function fetch(){return appModel.rest.get("availability/weekly-schedule").then(fromWeeklySchedule)},push:function push(){var plainData={"all-time":!1,"json-data":{}};return this.data.isAllTime()===!0?plainData["all-time"]=!0:plainData["json-data"]=JSON.stringify(toWeeklySchedule(this.data.model.toPlainObject(!0))),appModel.rest.put("availability/weekly-schedule",plainData).then(fromWeeklySchedule).then(function(result){return appModel.calendar.clearCache(),result})}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem};function fromWeeklySchedule(weeklySchedule){var simpleWS={timeZone:weeklySchedule.timeZone||""};if("unavailable"!==weeklySchedule.defaultStatus||"available"!==weeklySchedule.status)throw{name:"input-format",message:"Weekly schedule, given statuses not supported, status: "+weeklySchedule.status+", defaultStatus: "+weeklySchedule.defaultStatus};var slotSize=0|(weeklySchedule.slotSize||defaultSlotSize);return Object.keys(weeklySchedule.slots).forEach(function(weekday){if(-1!==weekDayProperties.indexOf(weekday)){var dayslots=weeklySchedule.slots[weekday],from=null,to=null,previous=null;if(dayslots.some(function(slot){var minutes=0|moment.duration(slot).asMinutes();if(null===from)from=minutes,previous=minutes;else{if(previous+slotSize!==minutes)return!0;to=minutes,previous=minutes}}),null!==from){var simpleDay={from:from,to:0};simpleWS[weekday]=simpleDay,null!==to?simpleDay.to=to+slotSize:simpleDay.to=from+slotSize}}}),simpleWS}function toWeeklySchedule(simplifiedWeeklySchedule){var slotSize=defaultSlotSize,weeklySchedule={status:"available",defaultAvailability:"unavailable",slots:{},slotSize:slotSize,timeZone:simplifiedWeeklySchedule.timeZone};return Object.keys(simplifiedWeeklySchedule).forEach(function(weekday){if(-1!==weekDayProperties.indexOf(weekday)){var simpleDay=simplifiedWeeklySchedule[weekday],from=0|simpleDay.from,to=0|simpleDay.to;if(weeklySchedule.slots[weekday]=[],to>from)for(var previous=from;to>previous;)weeklySchedule.slots[weekday].push(minutesToTimeString(previous)),previous+=slotSize}}),weeklySchedule}function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}},{"../models/SimplifiedWeeklySchedule":96,"../utils/RemoteModel":113,moment:!1}],64:[function(require,module,exports){"use strict";var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),ko=require("knockout"),$=require("jquery");exports.create=function create(appModel){var api={},defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};api.list=ko.observableArray([]),api.syncList=function syncList(){return api.getUserJobProfile().then(function(list){return api.list(list),list})},api.clearCache=function clearCache(){cache.userJobProfile.cache.latest=null,cache.userJobProfile.list=[],cache.userJobTitles={}},appModel.on("clearLocalData",function(){api.clearCache()});function mapToUserJobProfile(rawItems){return cache.userJobProfile.list=[],cache.userJobTitles={},rawItems&&rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);cache.userJobProfile.list.push(m),setGetUserJobTitleToCache(rawItem)}),api.list(cache.userJobProfile.list),cache.userJobProfile.cache.latest=new Date,cache.userJobProfile.list}function getUserJobProfileFromLocal(){return localforage.getItem("userJobProfile").then(function(userJobProfile){return userJobProfile?mapToUserJobProfile(userJobProfile):null})}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};c.model?c.model.model.updateWith(rawItem):c.model=new UserJobTitle(rawItem),c.cache?c.cache.latest=new Date:c.cache=new CacheControl({ttl:defaultTtl});var fullList=cache.userJobProfile.list;if(fullList){var found=null;fullList.some(function(it){return it.jobTitleID()===rawItem.jobTitleID?(found=it,!0):void 0}),found?found.model.updateWith(rawItem):fullList.push(c.model)}return c.model}var fetchUserJobProfile=function(){return appModel.rest.get("user-job-profile").then(function(raw){return localforage.setItem("userJobProfile",raw),mapToUserJobProfile(raw)})};api.getUserJobProfile=function(){return cache.userJobProfile.cache.mustRevalidate()?cache.userJobProfile.list?fetchUserJobProfile():getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data?data:remotePromise}):Promise.resolve(cache.userJobProfile.list)};var fetchUserJobTitle=function(jobTitleID){return appModel.rest.get("user-job-profile/"+jobTitleID).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})},pushNewUserJobTitle=function(values){return appModel.rest.post("user-job-profile",$.extend({jobTitleID:0,jobTitleName:"",intro:"",cancellationPolicyID:null,instantBooking:!1},values)).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};return api.getUserJobTitle=function(jobTitleID){return jobTitleID?!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()?fetchUserJobTitle(jobTitleID):cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model?Promise.resolve(cache.userJobTitles[jobTitleID].model):getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model})["catch"](fetchUserJobTitle.bind(null,jobTitleID)):Promise.reject("Job Title ID required")},api.createUserJobTitle=function(values){return pushNewUserJobTitle(values)},api.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return api.getUserJobTitle(jobTitleID).then(function(userJobTitle){if(!userJobTitle)throw{name:"Not Found",message:"You have not this job title in your profile. Maybe was deleted from your profile recently."};return Promise.all([userJobTitle,appModel.jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle)throw{name:"Not Found",message:"The job title does not exist."};return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})},api}},{"../models/UserJobTitle":100,"../utils/CacheControl":103,knockout:!1,localforage:!1}],65:[function(require,module,exports){"use strict";var User=require("../models/User"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:User.newAnonymous(),ttl:{minutes:1},localStorageName:"profile",fetch:function fetch(){return appModel.rest.get("profile")},push:function push(){return appModel.rest.put("profile",this.data.model.toPlainObject())}});return appModel.on("clearLocalData",function(){rem.clearCache()}),rem.saveOnboardingStep=function saveOnboardingStep(stepReference){return"undefined"==typeof stepReference?stepReference=rem.data.onboardingStep():rem.data.onboardingStep(stepReference),appModel.rest.put("profile/tracking",{onboardingStep:stepReference}).then(function(){localforage.setItem(rem.localStorageName,rem.data.model.toPlainObject())})},rem}},{"../models/User":99,"../utils/RemoteModel":113,localforage:!1}],66:[function(require,module,exports){"use strict";var ko=require("knockout"),NavAction=require("../viewmodels/NavAction"),NavBar=require("../viewmodels/NavBar");require("../utils/Function.prototype._inherits");function Activity($activity,app){this.$activity=$activity,this.app=app,this.accessLevel=app.UserType.None,this.viewState={},this.requestData=null,this.navBar=new NavBar({title:null,leftAction:null,rightAction:null})}module.exports=Activity,Activity.prototype.show=function show(options){this.__bindingDone||(ko.applyBindings(this.viewModel||{},this.$activity.get(0)),this.__bindingDone=!0),options=options||{},this.requestData=options,this._handlers&&this._handlersAreConnected!==!0&&(this._handlers.forEach(function(settings){if(!settings.event&&settings.target.subscribe){var subscription=settings.target.subscribe(settings.handler);settings._subscription=subscription,settings._latestSubscribedValue!==settings.target()&&settings.handler.call(settings.target,settings.target())}else settings.selector?settings.target.on(settings.event,settings.selector,settings.handler):settings.target.on?settings.target.on(settings.event,settings.handler):console.error("Activity.show: Bad registered handler",settings)}),this._handlersAreConnected=!0)},Activity.prototype.hide=function hide(){this._handlers&&(this._handlers.forEach(function(settings){settings._subscription?(settings._subscription.dispose(),settings._latestSubscribedValue=settings.target()):settings.target.off?settings.selector?settings.target.off(settings.event,settings.selector,settings.handler):settings.target.off(settings.event,settings.handler):settings.target.removeListener?settings.target.removeListener(settings.event,settings.handler):console.error("Activity.hide: Bad registered handler",settings)}),this._handlersAreConnected=!1)},Activity.prototype.registerHandler=function registerHandler(settings){if(!settings)throw new Error("Register require a settings object");if(!settings.target||!settings.target.on&&!settings.target.subscribe)throw new Error("Target is null or not a jQuery, EventEmmiter or Observable object");if("function"!=typeof settings.handler)throw new Error("Handler must be a function.");if(!settings.event&&!settings.target.subscribe)throw new Error("Event is null; it's required for non observable objects");this._handlers=this._handlers||[],this._handlers.push(settings)},Activity.NavBar=NavBar,Activity.NavAction=NavAction,Activity.createSectionNavBar=function createSectionNavBar(title){return new NavBar({title:title,leftAction:NavAction.menuIn,rightAction:NavAction.menuNewItem})},Activity.createSubsectionNavBar=function createSubsectionNavBar(title,options){options=options||{};var goBackOptions={text:title,isTitle:!0};return options.backLink&&(goBackOptions.link=options.backLink,goBackOptions.isShell=!1),new NavBar({title:"",leftAction:NavAction.goBack.model.clone(goBackOptions),rightAction:options.helpId?NavAction.goHelpIndex.model.clone({link:"#"+options.helpId}):NavAction.goHelpIndex})},Activity.prototype.createCancelAction=function createCancelAction(cancelLink){var app=this.app,action=new NavAction({link:cancelLink,text:"cancel",handler:function(event){var link=this.link(),eoptions=event&&event.options||{},goLink=function(){link?app.shell.go(link):app.shell.goBack()};eoptions.silentMode?goLink():app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){goLink()})}});return action},Activity.prototype.convertToCancelAction=function convertToCancelAction(actionModel,cancelLink){var cancel=this.createCancelAction(cancelLink);actionModel.model.updateWith(cancel),actionModel.handler(cancel.handler())};var singlentonInstances={},createSingleton=function createSingleton(ActivityClass,$activity,app){if(singlentonInstances[ActivityClass.name]instanceof ActivityClass)return singlentonInstances[ActivityClass.name];var s=new ActivityClass($activity,app);return singlentonInstances[ActivityClass.name]=s,s};Activity["extends"]=function extendsActivity(ClassFn){return ClassFn._inherits(Activity),ClassFn.init=createSingleton.bind(null,ClassFn),ClassFn}},{"../utils/Function.prototype._inherits":106,"../viewmodels/NavAction":143,"../viewmodels/NavBar":144,knockout:!1}],67:[function(require,module,exports){var $=require("jquery"),classes={component:"DatePicker",months:"DatePicker-months",days:"DatePicker-days",monthDay:"day",month:"month",year:"year",years:"DatePicker-years",weekDays:"DatePicker-weekDays",active:"active"},events={dayRendered:"dayRendered",dateChanged:"dateChanged",show:"show",hide:"hide",dateSet:"dateSet",viewDateChanged:"viewDateChanged"},DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10},{clsName:"day",navFnc:"Date",navStep:1}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","M","Tu","W","Th","F","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||0===parts.length)throw new Error("Invalid date format.");return{separator:separator,parts:parts}},parseDate:function(date,format){var parts=date.split(format.separator),val;if(date=new Date,date.setHours(0),date.setMinutes(0),date.setSeconds(0),date.setMilliseconds(0),parts.length===format.parts.length){for(var year=date.getFullYear(),day=date.getDate(),month=date.getMonth(),i=0,cnt=format.parts.length;cnt>i;i++)switch(val=parseInt(parts[i],10)||1,format.parts[i]){case"dd":case"d":day=val,date.setDate(val);break;case"mm":case"m":month=val-1,date.setMonth(val-1);break;case"yy":year=2e3+val,date.setFullYear(2e3+val);break;case"yyyy":year=val,date.setFullYear(val)}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d,val.mm=(val.m<10?"0":"")+val.m,date=[];for(var i=0,cnt=format.parts.length;cnt>i;i++)date.push(val[format.parts[i]]);return date.join(format.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="'+classes.component+'"><div class="'+classes.days+'"><table class=" table-condensed">'+DPGlobal.headTemplate+'<tbody></tbody></table></div><div class="'+classes.months+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+'</table></div><div class="'+classes.years+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table></div></div>",DPGlobal.modesSet={date:DPGlobal.modes[3],month:DPGlobal.modes[0],year:DPGlobal.modes[1],decade:DPGlobal.modes[2]};var DatePicker=function(element,options){if(this.element=$(element),this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy"),this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on"):!1,this.isPlaceholder=this.element.is(".calendar-placeholder"),this.picker=$(DPGlobal.template).appendTo(this.isPlaceholder?this.element:"body").on("click",$.proxy(this.click,this)),this.picker.addClass(this.isPlaceholder?"":"dropdown-menu"),options.extraClasses&&this.picker.addClass(options.extraClasses),this.isPlaceholder?(this.picker.show(),"today"==this.element.data("date")&&(this.date=new Date,this.set()),this.element.trigger({type:events.show,date:this.date})):this.isInput?this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)}):this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this)),this.element.on("swipeleft",function(e){e.preventDefault(),this.moveDate("next");
}.bind(this)).on("swiperight",function(e){e.preventDefault(),this.moveDate("prev")}.bind(this)),this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0,"string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}if(this.viewMode=options.viewMode||this.element.data("date-viewmode")||0,"string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode,this.weekStart=options.weekStart||this.element.data("date-weekstart")||0,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.onRender=options.onRender,this.fillDow(),this.fillMonths(),this.update(),this.showMode()};DatePicker.prototype={constructor:DatePicker,_triggerViewDateChange:function(){var viewModeName=DPGlobal.modes[this.viewMode].clsName;this.element.trigger(events.viewDateChanged,[{viewDate:this.viewDate,viewMode:viewModeName}])},show:function(e){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),$(window).off("resize.datepicker").on("resize.datepicker",$.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),!this.isInput;var that=this;$(document).off("mousedown.datepicker").on("mousedown.datepicker",function(ev){0===$(ev.target).closest("."+classes.component).length&&that.hide()}),this.element.trigger({type:events.show,date:this.date})},hide:function(){this.picker.hide(),$(window).off("resize.datepicker",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||$(document).off("mousedown.datepicker",this.hide),this.element.trigger({type:events.hide,date:this.date})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);this.isInput?this.element.prop("value",formated):(this.component&&this.element.find("input").prop("value",formated),this.element.data("date",formated)),this.element.trigger(events.dateSet,[this.date,formated])},setValue:function(newDate,dontNotify){"string"==typeof newDate?this.date=DPGlobal.parseDate(newDate,this.format):this.date=new Date(newDate),this.set(),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill(),this._triggerViewDateChange(),dontNotify!==!0&&this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})},getValue:function(){return this.date},getViewDate:function(){return this.viewDate},moveValue:function(dir,mode){return-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())?(mode=mode?DPGlobal.modesSet[mode]:DPGlobal.modes[this.viewMode],this.date["set"+mode.navFnc].call(this.date,this.date["get"+mode.navFnc].call(this.date)+mode.navStep*("prev"===dir?-1:1)),this.setValue(this.date),this.date):void 0},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},update:function(newDate){this.date=DPGlobal.parseDate("string"==typeof newDate?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill(),this._triggerViewDateChange()},getDaysElements:function(){return this.picker.find("."+classes.days+" ."+classes.monthDay)},fillDow:function(){for(var dowCnt=this.weekStart,html='<tr class="'+classes.weekDays+'">';dowCnt<this.weekStart+7;)html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>";html+="</tr>",this.picker.find("."+classes.days+" thead").append(html)},fillMonths:function(){for(var html="",i=0;12>i;)html+='<span class="'+classes.month+'">'+DPGlobal.dates.monthsShort[i++]+"</span>";this.picker.find("."+classes.months+" td").append(html)},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf(),prevMonth=new Date(year,month-1,28,0,0,0,0),lastDayPrevMonth=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());if(prevMonth.setDate(lastDayPrevMonth),prevMonth.setDate(lastDayPrevMonth-(prevMonth.getDay()-this.weekStart+7)%7),this._prevDate&&this._prevDate.getMonth()===this.viewDate.getMonth()){var tbody=this.picker.find("."+classes.days+" tbody");tbody.find("."+classes.monthDay+"."+classes.active).removeClass(classes.active);var diff=lastDayPrevMonth-prevMonth.getDate(),index=diff+this.date.getDate(),irow=index/7|0,icol=index%7;return tbody.find("tr:eq("+irow+") td:eq("+icol+")").addClass(classes.active),void(this._prevDate=new Date(this.viewDate))}this._prevDate=new Date(this.viewDate),this.picker.find("."+classes.days+" th:eq(1)").html(DPGlobal.dates.months[month]+" "+year);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42),nextMonth=nextMonth.valueOf();var html=[],clsName,prevY,prevM;if(this._daysCreated!==!0){for(var r=0;6>r;r++){html.push("<tr>");for(var c=0;7>c;c++)html.push('<td class="'+classes.monthDay+'"><span>&nbsp;</span></td>');html.push("</tr>")}this.picker.find("."+classes.days+" tbody").empty().append(html.join("")),this._daysCreated=!0}for(var weekTr=this.picker.find("."+classes.days+" tbody tr:first-child()"),dayTd=null;prevMonth.valueOf()<nextMonth;){var currentWeekDayIndex=prevMonth.getDay()-this.weekStart;clsName=this.onRender(prevMonth),prevY=prevMonth.getFullYear(),prevM=prevMonth.getMonth(),month>prevM&&prevY===year||year>prevY?clsName+=" old":(prevM>month&&prevY===year||prevY>year)&&(clsName+=" new"),prevMonth.valueOf()===currentDate&&(clsName+=" "+classes.active),dayTd=weekTr.find("td:eq("+currentWeekDayIndex+")"),dayTd.attr("class",classes.monthDay+" "+clsName).data("date-time",prevMonth.toISOString()).children("span").text(prevMonth.getDate()),this.picker.trigger(events.dayRendered,[dayTd]),prevMonth.getDay()===this.weekEnd&&(weekTr=weekTr.next("tr")),prevMonth.setDate(prevMonth.getDate()+1)}var currentYear=this.date.getFullYear(),months=this.picker.find("."+classes.months).find("th:eq(1)").html(year).end().find("span").removeClass(classes.active);currentYear===year&&months.eq(this.date.getMonth()).addClass(classes.active),html="",year=10*parseInt(year/10,10);var yearCont=this.picker.find("."+classes.years).find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;var i;if(this._yearsCreated!==!0){for(i=-1;11>i;i++)html+='<span class="'+classes.year+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:"")+'">'+year+"</span>",year+=1;yearCont.html(html),this._yearsCreated=!0}else{var yearSpan=yearCont.find("span:first-child()");for(i=-1;11>i;i++)yearSpan.text(year).attr("class","year"+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:"")),year+=1,yearSpan=yearSpan.next()}},moveDate:function(dir,mode){-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())&&(mode=mode||this.viewMode,this.viewDate["set"+DPGlobal.modes[mode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[mode].navFnc].call(this.viewDate)+DPGlobal.modes[mode].navStep*("prev"===dir?-1:1)),this.fill(),this._triggerViewDateChange(),this.set())},click:function(e){e.stopPropagation(),e.preventDefault();var target=$(e.target).closest("span.month, span.year, td, th");if(1===target.length){var month,year,completeMonthYear=function completeMonthYear(){0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})),this.showMode(-1),this.fill(),this.set()}.bind(this);if(target.hasClass("switch"))this.showMode(1);else if(target.hasClass("prev")||target.hasClass("next"))this.moveDate(target[0].className);else if(target.hasClass(classes.month))month=target.parent().find("span").index(target),this.viewDate.setMonth(month),completeMonthYear(),this._triggerViewDateChange();else if(target.hasClass(classes.year))year=parseInt(target.text(),10)||0,this.viewDate.setFullYear(year),completeMonthYear(),this._triggerViewDateChange();else if(target.hasClass(classes.monthDay)&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;month=this.viewDate.getMonth(),month+=target.hasClass("old")?-1:target.hasClass("new")?1:0,year=this.viewDate.getFullYear(),this.date=new Date(year,month,day,0,0,0,0),this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0),this.fill(),this._triggerViewDateChange(),this.set(),this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation(),e.preventDefault()},showMode:function(dir){dir&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir))),this.picker.find(">div").hide().filter("."+classes.component+"-"+DPGlobal.modes[this.viewMode].clsName).show()}},$.fn.datepicker=function(option){var vals=Array.prototype.slice.call(arguments,1),returned;return this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;return data||$this.data("datepicker",data=new DatePicker(this,$.extend({},$.fn.datepicker.defaults,options))),"string"==typeof option&&(returned=data[option].apply(data,vals),"undefined"!=typeof returned)?!1:void 0}),"undefined"!=typeof returned?returned:this},$.fn.datepicker.defaults={onRender:function(){return""}},$.fn.datepicker.Constructor=DatePicker,exports.DatePicker=DatePicker,exports.defaults=DPGlobal,exports.utils=DPGlobal},{}],68:[function(require,module,exports){var $=require("jquery"),clearNode=function(node){for(;node.firstChild;)node.removeChild(node.firstChild)},textboxResize=function textboxResize(el){var leftbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.left")[0],rightbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.right")[0];"undefined"==typeof leftbtn&&(leftbtn={offsetWidth:0,className:""}),"undefined"==typeof rightbtn&&(rightbtn={offsetWidth:0,className:""});var margin=Math.max(leftbtn.offsetWidth,rightbtn.offsetWidth);el.style.marginLeft=margin+"px",el.style.marginRight=margin+"px";var tooLong=el.offsetWidth<el.scrollWidth?!0:!1;tooLong&&(leftbtn.offsetWidth<rightbtn.offsetWidth?(el.style.marginLeft=leftbtn.offsetWidth+"px",el.style.textAlign="right"):(el.style.marginRight=rightbtn.offsetWidth+"px",el.style.textAlign="left"),tooLong=el.offsetWidth<el.scrollWidth?!0:!1,tooLong&&(new RegExp("arrow").test(leftbtn.className)&&(clearNode(leftbtn.childNodes[1]),el.style.marginLeft="26px"),new RegExp("arrow").test(rightbtn.className)&&(clearNode(rightbtn.childNodes[1]),el.style.marginRight="26px")))};exports.textboxResize=textboxResize;var SmartNavBar=function SmartNavBar(el){this.el=el,this.refresh=function refresh(){var h=$(el).children("h1").get(0);h&&textboxResize(h)},this.refresh()};exports.SmartNavBar=SmartNavBar,exports.getAll=function getAll(){var all=$(".SmartNavBar");return $.map(all,function(item){return new SmartNavBar(item)})},exports.refreshAll=function refreshAll(){$(".SmartNavBar > h1").each(function(){textboxResize(this)})}},{}],69:[function(require,module,exports){"use strict";var moment=require("moment"),current=moment.locale();moment.locale("en-US-LC",{meridiemParse:/[ap]\.?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"p":"P":isLower?"a":"A"},calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"M/D"},longDateFormat:{LT:"h:mma",LTS:"h:mm:ssa",L:"MM/DD/YYYY",l:"M/D/YYYY",LL:"MMMM Do YYYY",ll:"MMM D YYYY",LLL:"MMMM Do YYYY LT",lll:"MMM D YYYY LT",LLLL:"dddd, MMMM Do YYYY LT",llll:"ddd, MMM D YYYY LT"}}),moment.locale(current)},{moment:!1}],70:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery");function twoDigits(n){return Math.floor(n/10)+""+n%10}exports.show=function showTimePicker(options){var modal=$("#timePickerModal"),vm=modal.data("viewmodel");return vm||(vm=new TimePickerModel,ko.applyBindings(vm,modal.get(0)),modal.data("viewmodel",vm)),options=options||{},vm.title(options.title||"Select time"),vm.stepInMinutes(options.stepInMinutes||5),"string"==typeof options.selectedTime?vm.selectedTimeString(options.selectedTime):vm.selectedTime(options.selectedTime||{}),vm.unsetLabel(options.unsetLabel||"Remove"),vm.selectLabel(options.selectLabel||"Select"),new Promise(function(resolve,reject){var unset=function(){resolve(null),modal.modal("hide")},select=function(){resolve({time:vm.selectedTime(),timeString:vm.selectedTimeString()}),modal.modal("hide")};modal.off("hide.bs.modal"),modal.on("hide.bs.modal",reject),modal.off("click",".timePickerModal-unset"),modal.on("click",".timePickerModal-unset",unset),modal.off("click",".timePickerModal-select"),modal.on("click",".timePickerModal-select",select),modal.modal("show")})};function TimePickerModel(){var vm={title:ko.observable(""),pickedHour:ko.observable(null),pickedMinute:ko.observable(null),pickedAmpm:ko.observable(null),stepInMinutes:ko.observable(5),unsetLabel:ko.observable("Remove"),selectLabel:ko.observable("Select")};return vm.locale=ko.observable({lang:"en",region:"US"}),vm.hourValues=ko.computed(function(){var region=this.locale().region,step=this.stepInMinutes()/60|0;0>=step&&(step=1);var values=[],i;if("US"===region)for(values.push({value:0,label:12}),i=1;12>i;i+=step)values.push({value:i,label:i});else for(i=0;24>i;i+=step)values.push({value:i,label:i});return values},vm),vm.minuteValues=ko.computed(function(){var step=0|this.stepInMinutes();if(0>=step&&(step=1),step>=60)return[];for(var values=[],i=0;60>i;i+=step)values.push({value:i,label:twoDigits(i)});return values},vm),vm.ampmValues=ko.computed(function(){var region=this.locale().region,values=[];return"US"===region&&(values.push({value:0,label:"AM"}),values.push({value:12,label:"PM"})),values},vm),vm.selectedTime=ko.computed({read:function(){return{hours:this.pickedHour()+this.pickedAmpm(),minutes:this.pickedMinute(),seconds:0}},write:function(v){if("object"!=typeof v)throw new Error("Invalid input for the time picker. Value:",v);v=v||{};var region=this.locale().region;"US"===region?(this.pickedHour(v.hours/12|0),this.pickedMinute(0|v.minutes),this.pickedAmpm(v.hours%12|0)):(this.pickedHour(0|v.hours),this.pickedMinute(0|v.minutes),this.pickedAmpm(0))},owner:vm}),vm.selectedTimeString=ko.computed({read:function(){var t=this.selectedTime();return twoDigits(t.hours)+":"+twoDigits(t.minutes)+":"+twoDigits(t.seconds)},write:function(v){v=v||"";var parts=v.split(":");this.selectedTime({hours:0|parts[0],minutes:0|parts[1],seconds:0|parts[2]})},owner:vm}),vm}},{knockout:!1}],71:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Address(values){Model(this),this.model.defProperties({addressID:0,addressName:"",jobTitleID:0,userID:0,addressLine1:null,addressLine2:null,postalCode:null,city:null,stateProvinceCode:null,stateProvinceName:null,countryCode:null,latitude:null,longitude:null,specialInstructions:null,isServiceArea:!1,isServiceLocation:!1,serviceRadius:0,createdDate:null,updatedDate:null,kind:""},values),this.singleLine=ko.computed(function(){var list=[this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()];return list.filter(function(v){return!!v}).join(", ")},this);var countries={US:"United States",ES:"Spain"};this.countryName=ko.computed(function(){return countries[this.countryCode()]||"unknow"},this),this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}module.exports=Address,Address.kind={home:"home",billing:"billing",service:"service"}},{"./Model":89,knockout:!1}],72:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PricingEstimateDetail=require("./PricingEstimateDetail"),CalendarEvent=require("./CalendarEvent"),Booking=require("./Booking");function Appointment(values){Model(this),this.model.defProperties({id:null,startTime:null,endTime:null,summary:"New booking",description:null,isAllDay:!1,price:0,customerUserID:null,pricing:{Model:PricingEstimateDetail,isArray:!0},addressID:null,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,jobTitleID:0,readOnly:!1,sourceEvent:{Model:CalendarEvent,defaultValue:null},sourceBooking:{Model:Booking,defaultValue:null}},values),this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this),this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this),this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this),this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this),this.itStarted=ko.pureComputed(function(){return this.startTime()&&new Date>=this.startTime()},this),this.itEnded=ko.pureComputed(function(){return this.endTime()&&new Date>=this.endTime()},this),this.isNew=ko.pureComputed(function(){return!this.id()},this),this.stateHeader=ko.pureComputed(function(){var text="";return this.id()>0&&this.sourceEvent()&&(text=this.sourceBooking()?this.itStarted()?this.itEnded()?"Completed":"Now":"Upcoming":"Calendar block"),text},this)}module.exports=Appointment,Appointment.fromCalendarEvent=function fromCalendarEvent(event){var apt=new Appointment;return apt.id(event.calendarEventID()),apt.startTime(event.startTime()),apt.endTime(event.endTime()),apt.summary(event.summary()),apt.description(event.description()),apt.isAllDay(event.isAllDay()),apt.readOnly(event.readOnly()),apt.sourceEvent(event),apt},Appointment.fromBooking=function fromBooking(booking,event){var apt=Appointment.fromCalendarEvent(event);apt.customerUserID(booking.bookingRequest().customerUserID()),apt.addressID(booking.bookingRequest().addressID()),apt.jobTitleID(booking.bookingRequest().jobTitleID()),apt.pricing(booking.bookingRequest().pricingEstimate().details()),apt.preNotesToClient(booking.preNotesToClient()),apt.postNotesToClient(booking.postNotesToClient()),apt.preNotesToSelf(booking.preNotesToSelf()),apt.postNotesToSelf(booking.postNotesToSelf()),apt.readOnly(!1);var prices=booking.bookingRequest()&&booking.bookingRequest().pricingEstimate();return prices&&apt.price(prices.totalPrice()-prices.pFeePrice()),apt.sourceBooking(booking),apt},Appointment.listFromCalendarEventsBookings=function listFromCalendarEventsBookings(events,bookings){return events.map(function(event){var booking=null;return bookings.some(function(searchBooking){var found=searchBooking.confirmedDateID()===event.calendarEventID();return found?(booking=searchBooking,!0):void 0}),booking?Appointment.fromBooking(booking,event):Appointment.fromCalendarEvent(event)})},Appointment.specialIds={loading:0,emptyDate:-1,free:-2,newEvent:-3,newBooking:-4,unavailable:-5,preparationTime:-6};var Time=require("../utils/Time");Appointment.newFreeSlot=function newFreeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.free,startTime:start,endTime:end,summary:options.text||"Free",description:null})},Appointment.newUnavailableSlot=function newUnavailableSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.unavailable,startTime:start,endTime:end,summary:options.text||"Unavailable",description:null})},Appointment.newPreparationTimeSlot=function newPreparationTimeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.preparationTime,startTime:start,endTime:end,summary:options.text||"Preparation time",description:null})}},{"../utils/Time":115,"./Booking":73,"./CalendarEvent":76,"./Model":89,"./PricingEstimateDetail":92,knockout:!1,moment:!1}],73:[function(require,module,exports){"use strict";var Model=require("./Model"),BookingRequest=require("./BookingRequest");function Booking(values){Model(this),this.model.defProperties({bookingID:0,bookingRequestID:0,confirmedDateID:null,totalPricePaidByCustomer:null,totalServiceFeesPaidByCustomer:null,totalPaidToFreelancer:null,totalServiceFeesPaidByFreelancer:null,bookingStatusID:null,pricingAdjustmentApplied:!1,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,reviewedByFreelancer:!1,reviewedByCustomer:!1,createdDate:null,updatedDate:null,bookingRequest:new BookingRequest},values)}module.exports=Booking},{"./BookingRequest":74,"./Model":89}],74:[function(require,module,exports){"use strict";var Model=require("./Model"),PricingEstimate=require("./PricingEstimate");module.exports=function BookingRequest(values){Model(this),this.model.defProperties({bookingRequestID:0,bookingTypeID:0,customerUserID:0,freelancerUserID:0,jobTitleID:0,pricingEstimateID:0,bookingRequestStatusID:0,specialRequests:null,preferredDateID:null,alternativeDate1ID:null,alternativeDate2ID:null,addressID:null,cancellationPolicyID:null,instantBooking:!1,createdDate:null,updatedDate:null,pricingEstimate:new PricingEstimate},values)}},{"./Model":89,"./PricingEstimate":91}],75:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function BookingSummary(values){Model(this),this.model.defProperties({quantity:0,concept:"",time:null,timeFormat:" [@] h:mma"},values),this.phrase=ko.pureComputed(function(){var t=this.timeFormat()&&this.time()&&moment(this.time()).format(this.timeFormat())||"";return this.concept()+t},this),this.url=ko.pureComputed(function(){var url=this.time()&&"/calendar/"+this.time().toISOString();return url},this)}module.exports=BookingSummary},{"./Model":89,knockout:!1,moment:!1}],76:[function(require,module,exports){"use strict";var Model=require("./Model");function RecurrenceRule(values){Model(this),this.model.defProperties({frequencyTypeID:0,interval:1,until:null,count:null,ending:null,selectedWeekDays:[],monthlyWeekDay:!1,incompatible:!1,tooMany:!1},values)}function RecurrenceOccurrence(values){Model(this),this.model.defProperties({startTime:null,endTime:null},values)}function CalendarEvent(values){Model(this),values&&(values.startTime=values.startTime&&new Date(Date.parse(values.startTime))||null,values.endTime=values.endTime&&new Date(Date.parse(values.endTime))||null),this.model.defProperties({calendarEventID:0,userID:0,eventTypeID:3,summary:"",availabilityTypeID:0,startTime:null,endTime:null,kind:0,isAllDay:!1,timeZone:"Z",location:null,updatedDate:null,createdDate:null,description:"",readOnly:!1,recurrenceRule:{Model:RecurrenceRule},recurrenceOccurrences:{isArray:!0,Model:RecurrenceOccurrence}},values)}module.exports=CalendarEvent,CalendarEvent.RecurrenceRule=RecurrenceRule,CalendarEvent.RecurrenceOccurrence=RecurrenceOccurrence},{"./Model":89}],77:[function(require,module,exports){"use strict";var Model=require("./Model");function CalendarSyncing(values){Model(this),this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}module.exports=CalendarSyncing},{"./Model":89}],78:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Customer(values){Model(this),this.model.defProperties({customerUserID:0,firstName:"",lastName:"",secondLastName:"",email:"",phone:null,canReceiveSms:!1,birthMonthDay:null,birthMonth:null,notesAboutCustomer:null,createdDate:null,updatedDate:null,editable:!1},values),this.fullName=ko.pureComputed(function(){return(this.firstName()||"")+" "+(this.lastName()||"")},this),this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this)}module.exports=Customer},{"./Model":89,knockout:!1}],79:[function(require,module,exports){"use strict";var Model=require("../models/Model"),Appointment=require("../models/Appointment"),WeekDaySchedule=require("../models/WeekDaySchedule"),SchedulingPreferences=require("../models/SchedulingPreferences"),moment=require("moment"),ko=require("knockout"),availabilityCalculation=require("../utils/availabilityCalculation"),getDateWithoutTime=require("../utils/getDateWithoutTime");function DateAvailability(values){Model(this),this.model.defProperties({date:null,weekDaySchedule:{Model:WeekDaySchedule},appointmentsList:{isArray:!0,Model:Appointment},schedulingPreferences:{Model:SchedulingPreferences}},values),this.list=ko.pureComputed(function(){return availabilityCalculation.fillDayAvailability(this.date(),this.appointmentsList(),this.weekDaySchedule(),this.schedulingPreferences())},this),this.workDayMinutes=ko.pureComputed(function(){var schedule=this.weekDaySchedule();return schedule.to()-schedule.from()|0},this),this.availableMinutes=ko.pureComputed(function(){return this.list().reduce(function(minutes,apt){if(apt.id()===Appointment.specialIds.free){var et=moment(apt.endTime()),st=moment(apt.startTime());minutes+=et.diff(st,"minutes")}return minutes},0)},this),this.availablePercent=ko.pureComputed(function(){return Math.round(this.availableMinutes()/this.workDayMinutes()*100)},this),this.availableTag=ko.pureComputed(function(){var perc=this.availablePercent(),date=this.date(),today=getDateWithoutTime();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"},this),this.getFreeTimeSlots=function getFreeTimeSlots(duration,slotSizeMinutes){slotSizeMinutes=slotSizeMinutes||this.schedulingPreferences().incrementsSizeInMinutes(),duration||(duration=slotSizeMinutes);var date=this.date(),today=getDateWithoutTime();if(today>date||this.availableMinutes()<=0)return[];var slots=[];return this.list().forEach(function(apt){apt.id()===Appointment.specialIds.free&&slots.push.apply(slots,createTimeSlots(apt.startTime(),apt.endTime(),slotSizeMinutes,duration))}),slots}}module.exports=DateAvailability;function createTimeSlots(from,to,size,duration){var i=moment(from),d,slots=[],now=new Date,enought;if(from>=to)return slots;for(;i.toDate()<to;)d=i.clone().toDate(),enought=i.clone().add(duration,"minutes").toDate(),d>=now&&to>=enought&&slots.push(d),i.add(size,"minutes");return slots}},{"../models/Appointment":72,"../models/Model":89,"../models/SchedulingPreferences":95,"../models/WeekDaySchedule":102,"../utils/availabilityCalculation":117,"../utils/getDateWithoutTime":123,knockout:!1,moment:!1}],80:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),numeral=require("numeral");function FreelancerPricing(values){Model(this),this.model.defProperties({freelancerPricingID:0,freelancerUserID:0,jobTitleID:0,pricingTypeID:0,name:"",description:null,price:null,serviceDurationMinutes:null,firstTimeClientsOnly:!1,numberOfSessions:1,priceRate:null,priceRateUnit:"hour",noPriceRate:!1,isPhone:!1,serviceAttributes:[],createdDate:null,updatedDate:null},values),this.model.defID(["freelancerPricingID"]),this.noPriceRate.subscribe(function(enabled){enabled===!0&&this.priceRate(null)},this),this.refreshNoPriceRate=function refreshNoPriceRate(){if(this.freelancerPricingID()&&(0|this.priceRate())<=0){var ts=this.model.dataTimestamp();this.noPriceRate(!0),this.model.dataTimestamp(ts)}};var is=require("is_js");this.durationHoursPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)/60|0},write:function(hours){var minutes=0|this.durationMinutesPart();hours=parseInt(hours,10),is.not.number(hours)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*(0|hours)+minutes)},owner:this}),this.durationMinutesPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)%60},write:function(minutes){var hours=0|this.durationHoursPart();minutes=parseInt(minutes,10),is.not.number(minutes)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*hours+(0|minutes))},owner:this}),this.durationText=ko.pureComputed(function(){var minutes=this.serviceDurationMinutes()||0;return minutes?numeral(minutes).format("0,0")+" minutes":""},this),this.sessionsAndDuration=ko.pureComputed(function(){var sessions=this.numberOfSessions(),dur=this.durationText();return sessions>1?sessions+" sessions, "+dur:dur},this),this.displayedPrice=ko.pureComputed(function(){var price=this.price(),rate=this.priceRate(),unit=this.priceRateUnit(),result=price||rate;return result=numeral(result).format("$0,0"),!price&&rate&&unit&&(result+="/"+unit),result},this)}module.exports=FreelancerPricing},{"./Model":89,is_js:!1,knockout:!1,numeral:!1}],81:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem");function GetMore(values){Model(this),this.model.defProperties({availability:!1,payments:!1,profile:!1,coop:!0},values);var availableItems={availability:new ListViewItem({contentLine1:"Complete your availability to create a cleaner calendar",markerIcon:"fa fa-fw fa-calendar"}),payments:new ListViewItem({contentLine1:"Start accepting payments through Loconomics",markerIcon:"fa ion ion-card"}),profile:new ListViewItem({contentLine1:"Activate your profile in the marketplace",markerIcon:"fa ion ion-cash"}),coop:new ListViewItem({contentLine1:"Learn more about our cooperative",actionIcon:"fa fa-gavel"})};this.items=ko.pureComputed(function(){var items=[];return Object.keys(availableItems).forEach(function(key){this[key]()&&items.push(availableItems[key])}.bind(this)),items},this)}module.exports=GetMore},{"./ListViewItem":84,"./Model":89,knockout:!1}],82:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");function JobTitle(values){Model(this),this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values),this.model.defID(["jobTitleID"]),this.pricingTypes=ko.observableArray([]),values&&values.pricingTypes&&values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}module.exports=JobTitle},{"./JobTitlePricingType":83,"./Model":89,knockout:!1}],83:[function(require,module,exports){"use strict";var Model=require("./Model");function JobTitlePricingType(values){Model(this),this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values),this.model.defID(["pricingTypeID","clientTypeID"])}module.exports=JobTitlePricingType},{"./Model":89}],84:[function(require,module,exports){"use strict";var Model=require("./Model");function ListViewItem(values){Model(this),this.model.defProperties({markerLine1:null,markerLine2:null,markerIcon:null,contentLine1:"",contentLine2:null,link:"#",actionIcon:null,actionText:null,classNames:""},values)}module.exports=ListViewItem},{"./Model":89}],85:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),_=require("lodash");function MailFolder(values){Model(this),this.model.defProperties({messages:[],topNumber:10},values),this.top=ko.pureComputed(function top(num){return num&&this.topNumber(num),_.first(this.messages(),this.topNumber())},this)}module.exports=MailFolder},{"./Model":89,knockout:!1,lodash:!1}],86:[function(require,module,exports){"use strict";var Model=require("./Model");function MarketplaceProfile(values){Model(this),this.model.defProperties({userID:0,publicBio:"",freelancerProfileUrlSlug:"",freelancerProfileUrl:"",freelancerWebsiteUrl:"",bookCode:"",createdDate:null,updatedDate:null},values)}module.exports=MarketplaceProfile},{"./Model":89}],87:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function Message(values){Model(this),this.model.defProperties({messageID:0,
threadID:0,sentByUserID:null,typeID:null,auxT:null,auxID:null,bodyText:"",createdDate:null,updatedDate:null},values),this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this),this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}module.exports=Message},{"./Model":89,knockout:!1,moment:!1}],88:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function MessageView(values,app){Model(this),this.model.defProperties({id:0,createdDate:null,updatedDate:null,subject:"",content:null,link:"#",tag:"",classNames:"",sourceThread:null,sourceMessage:null},values),this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this),this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this),this.quickDateTime=ko.pureComputed(function(){var date=this.createdDate(),m=moment(date).locale("en-US-LC"),t=moment().startOf("day");return m.isAfter(t)?m.format("LT"):m.fromNow()},this),this.customer=ko.computed(function(){var s=this.sourceMessage();if(!s||!app)return null;var cid=s.sentByUserID();return cid?cid===app.model.userProfile.data.userID()?app.model.userProfile.data:app.model.customers.getObservableItem(cid,!0)():null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}module.exports=MessageView,MessageView.fromThread=function(app,thread){var msg=thread.messages();msg=msg&&msg[0]||null;var tag,classNames;return"Booking"===msg.auxT()?(tag="Booking",classNames="text-success"):"BookingRequest"===msg.auxT()&&(tag="Booking request",classNames="text-warning"),new MessageView({sourceThread:thread,sourceMessage:msg,id:thread.threadID(),createdDate:thread.createdDate(),updatedDate:thread.updatedDate(),subject:thread.subject(),content:msg&&msg.bodyText()||"",link:"#!/conversation/"+thread.threadID(),tag:tag,classNames:classNames},app)}},{"./Model":89,knockout:!1,moment:!1}],89:[function(require,module,exports){"use strict";var ko=require("knockout");ko.mapping=require("knockout.mapping");var $=require("jquery"),clone=function(obj){return $.extend(!0,{},obj)},cloneValue=function(val,deepCopy){return"object"==typeof val?val instanceof Date?new Date(val):deepCopy===!0?val instanceof Array?val.map(function(item){return cloneValue(item,!0)}):null===val?null:val&&val.model instanceof Model?val.model.toPlainObject(deepCopy):clone(val):deepCopy===!1?val:void 0:val};function Model(modelObject){if(!(this instanceof Model)){var model=new Model(modelObject);return modelObject.model=model,model}this.modelObject=modelObject,this.propertiesList=[],this.fieldsList=[],this.propertiesDefs={},this.fieldsDefs={},this.mappingOptions={},this.dataTimestamp=ko.observable(new Date).extend({rateLimit:0})}module.exports=Model;function prepareValueByDef(val,def){return def.isArray&&!Array.isArray(val)&&(val="undefined"!=typeof val?[val]:[]),def&&def.Model&&(Array.isArray(val)?val=val.map(function(item){return item instanceof def.Model||null===item||"undefined"==typeof item?item:new def.Model(item)}):val instanceof def.Model||null===val||"undefined"==typeof val||(val=new def.Model(val))),val}function createDef(givenVal,initialVal){var def,isModel=givenVal&&givenVal.model instanceof Model,isArray=Array.isArray(givenVal),isObject="object"==typeof givenVal&&!(givenVal instanceof Date);return null===givenVal||isModel||!isObject||isArray?(def={defaultValue:givenVal,isArray:isArray},isModel&&(def.Model=givenVal.constructor)):def=givenVal,initialVal="undefined"==typeof initialVal?def.defaultValue:initialVal,def.initialValue=prepareValueByDef(initialVal,def),def}Model.prototype.defProperties=function defProperties(properties,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,propertiesList=this.propertiesList,defs=this.propertiesDefs,dataTimestamp=this.dataTimestamp;Object.keys(properties).forEach(function(key){var def=createDef(properties[key],initialValues[key]);defs[key]=def,modelObject[key]=Array.isArray(def.initialValue)?ko.observableArray(def.initialValue):ko.observable(def.initialValue),modelObject[key]._defaultValue=def.defaultValue,modelObject[key]._initialValue=def.initialValue,modelObject[key].subscribe(function(){dataTimestamp(new Date)}),propertiesList.push(key)}),dataTimestamp(new Date)},Model.prototype.defFields=function defFields(fields,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,defs=this.fieldsDefs,fieldsList=this.fieldsList;Object.keys(fields).each(function(key){var def=createDef(fields[key],initialValues[key]);defs[key]=def,modelObject[key]=def.initialValue,fieldsList.push(key)})},Model.prototype.defID=function defID(fieldsNames){if(this.idFieldsNames=fieldsNames,1===fieldsNames.length){var field=fieldsNames[0];this.modelObject.id=ko.pureComputed(function(){return this[field]()},this.modelObject)}else this.modelObject.id=ko.pureComputed(function(){return fieldsNames.map(function(fieldName){return this[fieldName]()}.bind(this))},this.modelObject)},Model.prototype.regTimestamp=function regTimestampProperty(propertyName){var prop=this.modelObject[propertyName];if("function"!=typeof prop)throw new Error("There is no observable property with name ["+propertyName+"] to register as timestamp.");this.dataTimestamp.subscribe(function(timestamp){prop(timestamp)})},Model.prototype.toPlainObject=function toPlainObject(deepCopy){var plain={},modelObj=this.modelObject;function setValue(property,val){var clonedValue=cloneValue(val,deepCopy);"undefined"!=typeof clonedValue&&(plain[property]=clonedValue)}return this.propertiesList.forEach(function(property){var val=modelObj[property]();setValue(property,val)}),this.fieldsList.forEach(function(field){var val=modelObj[field];setValue(field,val)}),plain},Model.prototype.updateWith=function updateWith(data,deepCopy){var timestamp=null;data&&data.model instanceof Model&&(timestamp=data.model.dataTimestamp(),data=data.model.toPlainObject(deepCopy));var target=this.modelObject,defs=this.propertiesDefs;this.propertiesList.forEach(function(property){var val=data[property],def=defs[property];"undefined"!=typeof val&&target[property](prepareValueByDef(val,def))}),defs=this.fieldsDefs,this.fieldsList.forEach(function(field){var val=data[field],def=defs[field];"undefined"!=typeof val&&(target[field]=prepareValueByDef(val,def))}),timestamp&&this.modelObject.model.dataTimestamp(timestamp)},Model.prototype.mapData=function mapData(data,optionalMapping){ko.mapping.fromJS(data,optionalMapping||this.mappingOptions,this.modelObject)},Model.prototype.clone=function clone(data,deepCopy){var plain=this.toPlainObject(deepCopy),cloned=new this.modelObject.constructor(plain);return data?cloned.model.updateWith(data):cloned.model.dataTimestamp(this.modelObject.model.dataTimestamp()),cloned},Model.prototype.touch=function touch(){this.dataTimestamp(new Date(Date()+1))},Model.prototype.reset=function reset(presets){var newInstance=new this.modelObject.constructor(presets);this.updateWith(newInstance,!0)}},{knockout:!1,"knockout.mapping":!1}],90:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem"),moment=require("moment"),numeral=require("numeral");function PerformanceSummary(values){Model(this),values=values||{},this.earnings=new Earnings(values.earnings);var earningsLine=new ListViewItem;earningsLine.markerLine1=ko.computed(function(){var num=numeral(this.currentAmount()).format("$0,0");return num},this.earnings),earningsLine.contentLine1=ko.computed(function(){return this.currentConcept()},this.earnings),earningsLine.markerLine2=ko.computed(function(){var num=numeral(this.nextAmount()).format("$0,0");return num},this.earnings),earningsLine.contentLine2=ko.computed(function(){return this.nextConcept()},this.earnings),this.timeBooked=new TimeBooked(values.timeBooked);var timeBookedLine=new ListViewItem;timeBookedLine.markerLine1=ko.computed(function(){var num=numeral(this.percent()).format("0%");return num},this.timeBooked),timeBookedLine.contentLine1=ko.computed(function(){return this.concept()},this.timeBooked),this.items=ko.pureComputed(function(){var items=[];return items.push(earningsLine),items.push(timeBookedLine),items},this)}module.exports=PerformanceSummary;function Earnings(values){Model(this),this.model.defProperties({currentAmount:0,currentConceptTemplate:"already paid this month",nextAmount:0,nextConceptTemplate:"projected {month} earnings"},values),this.currentConcept=ko.pureComputed(function(){var month=moment().format("MMMM");return this.currentConceptTemplate().replace(/\{month\}/,month)},this),this.nextConcept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.nextConceptTemplate().replace(/\{month\}/,month)},this)}function TimeBooked(values){Model(this),this.model.defProperties({percent:0,conceptTemplate:"of available time booked in {month}"},values),this.concept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.conceptTemplate().replace(/\{month\}/,month)},this)}},{"./ListViewItem":84,"./Model":89,knockout:!1,moment:!1,numeral:!1}],91:[function(require,module,exports){"use strict";var Model=require("./Model"),PricingEstimateDetail=require("./PricingEstimateDetail");module.exports=function PricingEstimate(values){Model(this),this.model.defProperties({pricingEstimateID:0,pricingEstimateRevision:0,serviceDurationHours:null,firstSessionDurationHours:null,subtotalPrice:null,feePrice:null,totalPrice:null,pFeePrice:null,subtotalRefunded:null,feeRefunded:null,totalRefunded:null,dateRefunded:null,createdDate:null,updatedDate:null,details:{Model:PricingEstimateDetail,isArray:!0}},values)}},{"./Model":89,"./PricingEstimateDetail":92}],92:[function(require,module,exports){"use strict";var Model=require("./Model");module.exports=function PricingEstimateDetail(values){Model(this),this.model.defProperties({freelancerPricingID:0,freelancerPricingDataInput:null,customerPricingDataInput:null,hourlyPrice:null,subtotalPrice:null,feePrice:null,totalPrice:null,serviceDurationHours:null,firstSessionDurationHours:null,createdDate:null,updatedDate:null},values)}},{"./Model":89}],93:[function(require,module,exports){"use strict";var Model=require("./Model");function PricingType(values){Model(this),this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,freelancerDescription:null,priceCalculation:null,isAddon:!1,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:!1,includeServiceAttributes:!1,includeSpecialPromotion:!1,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesCustomerMessage:null,withoutServiceAttributesFreelancerMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values),this.model.defID(["pricingTypeID"])}module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":89}],94:[function(require,module,exports){"use strict";var Model=require("./Model");function PrivacySettings(values){Model(this),this.model.defProperties({userID:0,smsBookingCommunication:!1,phoneBookingCommunication:!1,loconomicsCommunityCommunication:!1,loconomicsDbmCampaigns:!1,profileSeoPermission:!1,loconomicsMarketingCampaigns:!1,coBrandedPartnerPermissions:!1,createdDate:null,updatedDate:null},values),this.model.defID(["userID"])}module.exports=PrivacySettings},{"./Model":89}],95:[function(require,module,exports){"use strict";var Model=require("./Model");function SchedulingPreferences(values){Model(this),this.model.defProperties({advanceTime:24,betweenTime:0,incrementsSizeInMinutes:15},values)}module.exports=SchedulingPreferences},{"./Model":89}],96:[function(require,module,exports){"use strict";var ko=require("knockout"),moment=require("moment-timezone"),Model=require("./Model"),WeekDaySchedule=require("./WeekDaySchedule");function detectLocalTimezone(){var year=(new Date).getFullYear(),winter=new Date(year,1,1),winOff=winter.getTimezoneOffset(),summer=new Date(year,6,1),sumOff=summer.getTimezoneOffset(),found=null;return moment.tz.names().some(function(tz){var zone=moment.tz.zone(tz);return zone.offset(winter)===winOff&&zone.offset(summer)===sumOff?(found=zone,!0):void 0}),found}function SimplifiedWeeklySchedule(values){Model(this),this.model.defProperties({sunday:new WeekDaySchedule,monday:new WeekDaySchedule,tuesday:new WeekDaySchedule,wednesday:new WeekDaySchedule,thursday:new WeekDaySchedule,friday:new WeekDaySchedule,saturday:new WeekDaySchedule,isAllTime:!1,timeZone:""},values),this.weekDays=[this.sunday,this.monday,this.tuesday,this.wednesday,this.thursday,this.friday,this.saturday],this.timeZoneDisplayName=ko.computed(function(){var tzid=this.timeZone(),tz=moment.tz(tzid),name=tz.tz();if(!name){var localtz=detectLocalTimezone();localtz&&(tz=moment.tz(localtz.name)),tz&&(name=tz.tz()),name&&setTimeout(function(){this.timeZone(name)}.bind(this),1)}return name?name:""},this)}module.exports=SimplifiedWeeklySchedule},{"./Model":89,"./WeekDaySchedule":102,knockout:!1,"moment-timezone":!1}],97:[function(require,module,exports){"use strict";var Model=require("./Model"),Message=require("./Message");function Thread(values){Model(this),this.model.defProperties({threadID:0,customerUserID:null,freelancerUserID:null,jobTitleID:null,statusID:null,subject:null,messages:{isArray:!0,Model:Message},createdDate:null,updatedDate:null},values)}module.exports=Thread},{"./Message":87,"./Model":89}],98:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary");function UpcomingBookingsSummary(){Model(this),this.today=new BookingSummary({concept:"more today",timeFormat:" [ending @] h:mma"}),this.tomorrow=new BookingSummary({concept:"tomorrow",timeFormat:" [starting @] h:mma"}),this.nextWeek=new BookingSummary({concept:"next week",timeFormat:null}),this.items=ko.pureComputed(function(){var items=[];return items.push(this.today),items.push(this.tomorrow),items.push(this.nextWeek),items},this)}module.exports=UpcomingBookingsSummary},{"./BookingSummary":75,"./Model":89,knockout:!1}],99:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),UserType={None:0,Anonymous:1,Customer:2,Freelancer:4,Admin:8,LoggedUser:14,User:15,System:16};function User(values){Model(this),this.model.defProperties({userID:0,email:"",firstName:"",lastName:"",secondLastName:"",businessName:"",alternativeEmail:"",phone:"",canReceiveSms:"",birthMonthDay:null,birthMonth:null,isFreelancer:!1,isCustomer:!1,isMember:!1,isAdmin:!1,onboardingStep:null,accountStatusID:0,createdDate:null,updatedDate:null},values),this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];return this.lastName()&&nameParts.push(this.lastName()),this.secondLastName()&&nameParts.push(this.secondLastName),nameParts.join(" ")},this),this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this),this.userType=ko.pureComputed({read:function(){var c=this.isCustomer(),p=this.isFreelancer(),a=this.isAdmin(),userType=0;return this.isAnonymous()&&(userType|=UserType.Anonymous),c&&(userType|=UserType.Customer),p&&(userType|=UserType.Freelancer),a&&(userType|=UserType.Admin),userType},owner:this}),this.isAnonymous=ko.pureComputed(function(){return this.userID()<1},this),this.isUserType=function isUserType(type){return this.userType()&type}.bind(this)}module.exports=User,User.UserType=UserType,User.newAnonymous=function newAnonymous(){return new User({userID:0,email:"",firstName:"",onboardingStep:null})}},{"./Model":89,knockout:!1}],100:[function(require,module,exports){"use strict";var Model=require("./Model");function UserJobTitle(values){Model(this),this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:!1,createdDate:null,updatedDate:null},values),this.model.defID(["userID","jobTitleID"])}module.exports=UserJobTitle},{"./Model":89}],101:[function(require,module,exports){"use strict";module.exports={general:0,nps:1,signup:2,calendar:3,inbox:4,scheduling:5,cms:6,payments:7,performance:8,marketplaceProfile:9,mobileFriendly:10,desktopFriendly:11,coopBenefits:12,coopFee:13,senseOfCommunity:14,customerServiceAgents:15,helpPages:16}},{}],102:[function(require,module,exports){"use strict";var Model=require("./Model"),moment=require("moment"),ko=require("knockout");function WeekDaySchedule(values){Model(this),this.model.defProperties({from:0,to:0},values),this.isEnabled=ko.computed({read:function(){return"number"==typeof this.from()&&"number"==typeof this.to()&&this.from()<this.to()},write:function(val){val===!0?(this.fromHour(9),this.toHour(17)):(this.toHour(0),this.from(0))},owner:this}).extend({rateLimit:0}),this.isAllDay=ko.computed({read:function(){return 0===this.from()&&1440===this.to()},write:function(){this.from(0),this.to(1440)},owner:this}).extend({rateLimit:0}),this.fromHour=ko.computed({read:function(){return Math.floor(this.from()/60)},write:function(hours){this.from(60*hours|0)},owner:this}),this.toHour=ko.computed({read:function(){return Math.ceil(this.to()/60)},write:function(hours){this.to(60*hours|0)},owner:this}),this.fromTime=ko.computed({read:function(){return minutesToTimeString(0|this.from())},write:function(time){this.from(timeStringToMinutes(time))},owner:this}),this.toTime=ko.computed({read:function(){return minutesToTimeString(0|this.to())},write:function(time){this.to(timeStringToMinutes(time))},owner:this})}module.exports=WeekDaySchedule;function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}function timeStringToMinutes(time){return 0|moment.duration(time).asMinutes()}},{"./Model":89,knockout:!1,moment:!1}],103:[function(require,module,exports){"use strict";var moment=require("moment");function CacheControl(options){options=options||{},this.ttl=moment.duration(options.ttl).asMilliseconds(),this.latest=options.latest||null,this.mustRevalidate=function mustRevalidate(){var tdiff=this.latest&&new Date-this.latest||Number.POSITIVE_INFINITY;return tdiff>this.ttl},this.touch=function touch(){this.latest=new Date}}module.exports=CacheControl},{moment:!1}],104:[function(require,module,exports){"use strict";var moment=require("moment"),CacheControl=require("./CacheControl");module.exports=function DateCache(settings){this.Model=settings&&settings.Model||null,this.ttl=settings&&settings.ttl||{minutes:1},this.byDate={},this.clear=function(){this.byDate={}},this.getSingle=function(date){var dateKey=date;return date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD")),this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?this.byDate[dateKey].data:null},this.remove=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD")),delete this.byDate[dateKey]},this.get=function(start,end){for(var date=new Date(start),resultsPerDate={},holes=[],minRequest=null,maxRequest=null;end>=date;){var dateKey=moment(date).format("YYYY-MM-DD");this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?resultsPerDate[dateKey]=this.byDate[dateKey].data:holes.push(new Date(date)),date.setDate(date.getDate()+1)}return holes.sort(function(a,b){return a===b?0:b>a?-1:1}),minRequest=holes.length?holes[0]:null,maxRequest=holes.length?holes[holes.length-1]:null,{byDate:resultsPerDate,holes:holes,minHole:minRequest,maxHole:maxRequest}},this.set=function(date,data){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));var c=this.byDate[dateKey];return c&&c.data?this.Model?c.data.model.updateWith(data):c.data=data:(c={data:this.Model?new this.Model(data):data,control:new CacheControl({ttl:this.ttl})},this.byDate[dateKey]=c),c.control.touch(),c}}},{"./CacheControl":103,moment:!1}],105:[function(require,module,exports){Function.prototype._delayed=function delayed(milliseconds){var fn=this;return function(){var context=this,args=arguments;setTimeout(function(){fn.apply(context,args)},milliseconds)}}},{}],106:[function(require,module,exports){Function.prototype._inherits=function _inherits(superCtor){this.prototype=Object.create(superCtor.prototype,{constructor:{value:this,enumerable:!1,writable:!0,configurable:!0}})}},{}],107:[function(require,module,exports){"use strict";(function f(){}).name||Object.defineProperty(Function.prototype,"name",{get:function(){var name=this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1];return Object.defineProperty(this,"name",{value:name}),name}})},{}],108:[function(require,module,exports){"use strict";var ko=require("knockout"),IndexedGroupListCache=require("./IndexedGroupListCache");function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupListRemoteModel(settings){settings=settings||{},settings.listTtl=required(settings.listTtl,"listTtl is required"),settings.groupIdField=required(settings.groupIdField,"groupIdField is required"),settings.itemIdField=required(settings.itemIdField,"itemIdField is required"),settings.Model=settings.Model||null,this.settings=settings,this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedGroupListCache({listTtl:settings.listTtl,groupIdField:settings.groupIdField,itemIdField:settings.itemIdField});this.clearCache=cache.clearCache,this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);function notImplemented(){throw new Error("Not Implemented")}this.fetchGroupFromLocal=notImplemented,this.fetchGroupFromRemote=notImplemented,this.pushGroupToLocal=notImplemented,this.pushGroupToRemote=notImplemented,this.removeItemFromRemote=notImplemented;var api=this;api.getList=function getList(groupID){var cacheEntry=cache.getGroupCache(groupID);return cacheEntry.control.mustRevalidate()?cacheEntry.list?(api.state.isSyncing(!0),this.fetchGroupFromRemote(groupID).then(function(data){return data=data||[],cache.setGroupCache(groupID,data),this.pushGroupToLocal(groupID,data),api.state.isLoading(!1),api.state.isSyncing(!1),data}.bind(this))["catch"](function(err){return api.state.isLoading(!1),api.state.isSyncing(!1),err})):(api.state.isLoading(!0),this.fetchGroupFromLocal(groupID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchGroupFromRemote(groupID).then(function(serverData){return cache.setGroupCache(groupID,serverData),this.pushGroupToLocal(groupID,serverData),api.state.isSyncing(!1),serverData}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){return data=data||[],cache.setGroupCache(groupID,data),this.pushGroupToLocal(groupID,data),api.state.isLoading(!1),data}.bind(this))["catch"](function(err){return api.state.isLoading(!1),api.state.isSyncing(!1),err})):Promise.resolve(cacheEntry.list)},api.getItem=function getItem(groupID,itemID){return api.getList(groupID).then(function(){var cacheItem=cache.getItemCache(groupID,itemID);if(!cacheItem)throw console.warn("GroupListRemoteModel Not found",groupID,itemID,settings.Model),new Error("Not Found");return cacheItem.item})},api.setItem=function setItem(data){return api.state.isSaving(!0),this.pushGroupToRemote(data).then(function(serverData){if(serverData){var groupID=serverData[settings.groupIdField];cache.setItemCache(groupID,serverData[settings.itemIdField],serverData),this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list)}return api.state.isSaving(!1),serverData}.bind(this))["catch"](function(err){return api.state.isSaving(!1),err})},api.delItem=function delItem(groupID,itemID){return api.state.isDeleting(!0),this.removeItemFromRemote(groupID,itemID).then(function(removedData){return cache.delItemCache(groupID,itemID),this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list),api.state.isDeleting(!1),removedData}.bind(this))["catch"](function(err){return api.state.isDeleting(!1),err})},api.getObservableItem=function getObservableItem(groupID,itemID,asModel){var firstValue=cache.getItemCache(groupID,itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(asModel?api.asModel(firstValue):firstValue);return obs.sync=function syncObservableItem(){return api.getItem(groupID,itemID).then(function(item){asModel?obs().model.updateWith(item):obs(item)})},firstValue||obs.sync(),obs},api.asModel=function asModel(object){var Model=this.settings.Model;return Array.isArray(object)?object.map(function(item){return new Model(item)}):new Model(object)},api.getItemModel=function getItemModel(groupID,itemID){return api.getItem(groupID,itemID).then(function(data){return data?api.asModel(data):null})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(groupID,itemID){return api.getItemModel(groupID,itemID).then(function(model){return model?new ModelVersion(model):null})},api.newItemVersion=function newItemVersion(values){var version=new ModelVersion(new this.settings.Model(values));return version.version.model.touch(),version}}module.exports=GroupListRemoteModel,GroupListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchGroupFromLocal=function fetchFromLocal(groupID){return localforage.getItem(baseName+groupID)},this.pushGroupToLocal=function pushToLocal(groupID,data){return localforage.setItem(baseName+groupID,data)}},GroupListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchGroupFromRemote=function fetchFromRemote(groupID){return restClient.get(baseUrl+groupID)},this.pushGroupToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],method=data[this.settings.itemIdField]?"put":"post",url=baseUrl+groupID+(itemID?"/"+itemID:"");return restClient[method](url,data)},this.removeItemFromRemote=function removeItemFromRemote(groupID,itemID){return restClient["delete"](baseUrl+groupID+"/"+itemID)}}},{"../utils/ModelVersion":112,"./IndexedGroupListCache":109,knockout:!1,localforage:!1}],109:[function(require,module,exports){"use strict";var CacheControl=require("./CacheControl");function createIndex(list,byField){var index={};return list.forEach(function(item,itemIndex){index[item[byField]]={index:itemIndex,item:item}}),index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function IndexedGroupListCache(settings){settings=settings||{},settings.ttl=settings.ttl||0,settings.listTtl=settings.listTtl||settings.ttl||0,settings.groupIdField=required(settings.groupIdField,"groupIdField is required"),settings.itemIdField=required(settings.itemIdField,"itemIdField is required");var cache={};this.clearCache=function clearCache(){cache={}};function newCacheEntry(list){return{control:new CacheControl({ttl:settings.listTtl}),list:list||null,index:list&&createIndex(list,settings.itemIdField)||{}}}function setGroupCache(groupID,list){var cacheEntry=cache[groupID];cacheEntry?(cacheEntry.list=list||[],cacheEntry.index=createIndex(list||[],settings.itemIdField)):cacheEntry=cache[groupID]=newCacheEntry(list),cacheEntry.control.latest=new Date}this.setGroupCache=setGroupCache;function getGroupCache(groupID){var cacheEntry=cache[groupID];return cacheEntry||newCacheEntry()}this.getGroupCache=getGroupCache;function getItemCache(groupID,itemID){var cacheEntry=cache[groupID];return cacheEntry?cacheEntry.index[itemID]||null:null}this.getItemCache=getItemCache;function setItemCache(groupID,itemID,item){var cacheEntry=cache[groupID]||newCacheEntry([]),itemEntry=cacheEntry.index[itemID];if(itemEntry)cacheEntry.list[itemEntry.index]=item,itemEntry.item=item;else{var itemIndex=cacheEntry.list.push(item)-1;cacheEntry.index[itemID]={index:itemIndex,item:item}}}this.setItemCache=setItemCache;function delItemCache(groupID,itemID){var groupEntry=cache[groupID]||null;if(groupEntry){var itemEntry=groupEntry.index[itemID];itemEntry&&(groupEntry.list.splice(itemEntry.index,1),delete groupEntry.index[itemID],Object.keys(groupEntry.index).forEach(function(key){groupEntry.index[key]>itemEntry.index&&groupEntry.index[key]--}))}}this.delItemCache=delItemCache;function delGroupCache(groupID){var groupEntry=cache[groupID]||null;groupEntry&&delete cache[groupID]}this.delGroupCache=delGroupCache}module.exports=IndexedGroupListCache},{"./CacheControl":103}],110:[function(require,module,exports){"use strict";var CacheControl=require("./CacheControl"),jsPropertiesTools=require("./jsPropertiesTools"),ko=require("knockout");function createItemIndexEntry(list,itemIndex){return{index:itemIndex,get item(){return list[this.index]}}}function createIndex(list,byField){var index={};return list.forEach(function(item,itemIndex){index[ko.unwrap(item[byField])]=createItemIndexEntry(list,itemIndex)}),index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function defaultItemAdapter(oldItem,newItem){return newItem}function IndexedListCache(settings){settings=settings||{},settings.ttl=settings.ttl||0,settings.listTtl=settings.listTtl||settings.ttl||0,settings.itemIdField=required(settings.itemIdField,"itemIdField is required"),settings.itemAdapter="function"==typeof settings.itemAdapter?settings.itemAdapter:defaultItemAdapter;var unused=!0,cache={control:new CacheControl({ttl:settings.listTtl}),list:ko.observableArray([]),index:{}};this.clearCache=function clearCache(){cache.control.latest=null,cache.list([]),cache.index={},unused=!0};function getItemCache(itemID){return cache.index[itemID]||null}this.getItemCache=getItemCache;function adaptItem(newItem){var oldItem=getItemCache(ko.unwrap(newItem[settings.itemIdField]));return settings.itemAdapter(oldItem,newItem)}function adaptList(list){return(list||[]).map(adaptItem)}function setList(list){cache.list(adaptList(list)),cache.index=createIndex(cache.list(),settings.itemIdField),cache.control.latest=new Date,unused=!1}jsPropertiesTools.defineGetter(this,"control",function(){return cache.control}),jsPropertiesTools.defineGetter(this,"list",function(){return cache.list}),jsPropertiesTools.defineSetter(this,"list",function(list){return setList(list)}),jsPropertiesTools.defineGetter(this,"index",function(){return cache.index}),jsPropertiesTools.defineGetter(this,"unused",function(){return unused});function setItemCache(item){var itemID=ko.unwrap(item[settings.itemIdField]),itemEntry=cache.index[itemID];if(itemEntry)cache.list()[itemEntry.index]=adaptItem(item);else{var itemIndex=cache.list.push(adaptItem(item))-1;
cache.index[itemID]=createItemIndexEntry(cache.list(),itemIndex)}}this.setItemCache=setItemCache;function delItemCache(itemID){var itemEntry=cache.index[itemID];itemEntry&&(cache.list.splice(itemEntry.index,1),delete cache.index[itemID],Object.keys(cache.index).forEach(function(key){cache.index[key]>itemEntry.index&&cache.index[key]--}))}this.delItemCache=delItemCache}module.exports=IndexedListCache},{"./CacheControl":103,"./jsPropertiesTools":127,knockout:!1}],111:[function(require,module,exports){"use strict";var ko=require("knockout"),IndexedListCache=require("./IndexedListCache");function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function ListRemoteModel(settings){settings=settings||{},settings.listTtl=required(settings.listTtl,"listTtl is required"),settings.itemIdField=required(settings.itemIdField,"itemIdField is required"),settings.Model=settings.Model||null,this.settings=settings,this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};function itemAdapter(oldItem,newItem){return settings.Model?oldItem&&oldItem instanceof settings.Model?(oldItem.model.updateWith(newItem),oldItem):new settings.Model(newItem):newItem}var cache=new IndexedListCache({listTtl:settings.listTtl,itemIdField:settings.itemIdField,itemAdapter:itemAdapter});this.clearCache=cache.clearCache,this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);function notImplemented(){throw new Error("Not Implemented")}this.fetchListFromLocal=notImplemented,this.fetchListFromRemote=notImplemented,this.pushListToLocal=notImplemented,this.pushListToRemote=notImplemented,this.removeItemFromRemote=notImplemented;function getPlainCachedList(){var arr=cache.list();return arr.map(function(item){return item&&settings.Model&&item instanceof settings.Model?item.model.toPlainObject():item})}var api=this;api.list=cache.list,api.sync=function sync(){return api.getList()},api.getList=function getList(){return cache.control.mustRevalidate()?cache.unused?(api.state.isLoading(!0),this.fetchListFromLocal().then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchListFromRemote().then(function(serverData){return cache.list=serverData,this.pushListToLocal(serverData),api.state.isSyncing(!1),serverData}.bind(this))["catch"](function(err){return data?(api.state.isSyncing(!1),void console.error("ListRemoteModel: remote synchronization failed",err)):err});return data?data:remotePromise}.bind(this)).then(function(data){return data=data||[],cache.list=data,this.pushListToLocal(data),api.state.isLoading(!1),cache.list}.bind(this))["catch"](function(err){return api.state.isLoading(!1),api.state.isSyncing(!1),err})):(api.state.isSyncing(!0),this.fetchListFromRemote().then(function(data){return data=data||[],cache.list=data,this.pushListToLocal(data),api.state.isLoading(!1),api.state.isSyncing(!1),cache.list}.bind(this))["catch"](function(err){return api.state.isLoading(!1),api.state.isSyncing(!1),err})):Promise.resolve(cache.list)},api.getItem=function getItem(itemID){return api.getList().then(function(){var cacheItem=cache.getItemCache(itemID);if(!cacheItem)throw console.warn("ListRemoteModel Not found",itemID,settings.Model),new Error("Not Found");return cacheItem.item})},api.getObservableItem=function getObservableItem(itemID){var firstValue=cache.getItemCache(itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(firstValue);return obs.sync=function syncObservableItem(){return api.getItem(itemID).then(function(itemModel){obs(itemModel)})},firstValue||obs.sync(),obs},api.createWildcardItem=function createWildcardItem(){var hasID=function(id){return null!==id&&"undefined"!=typeof id},obs=ko.observable(void 0),lastID;return obs.sync=function syncObservableItem(itemID){var idChanged=hasID(itemID)&&itemID!==lastID;if(lastID=hasID(itemID)?itemID:lastID,idChanged){var cachedItem=cache.getItemCache(lastID);cachedItem&&cachedItem.item&&obs(cachedItem.item)}return api.getItem(lastID).then(function(itemModel){return obs(itemModel),itemModel})},obs.newItem=function newItem(defaults){obs(settings.Model?new settings.Model(defaults):defaults||{})},obs},api.setItem=function setItem(data){return api.state.isSaving(!0),this.pushListToRemote(data).then(function(serverData){return serverData&&(cache.setItemCache(serverData),this.pushListToLocal(getPlainCachedList())),api.state.isSaving(!1),serverData}.bind(this))["catch"](function(err){return api.state.isSaving(!1),err})},api.delItem=function delItem(itemID){return api.state.isDeleting(!0),this.removeItemFromRemote(itemID).then(function(removedData){return cache.delItemCache(itemID),this.pushListToLocal(getPlainCachedList()),api.state.isDeleting(!1),removedData}.bind(this))["catch"](function(err){return api.state.isDeleting(!1),err})};var ModelVersion=require("../utils/ModelVersion");api.createItemVersion=function createItemVersion(itemID){return api.getItem(itemID).then(function(model){return model?new ModelVersion(model):null})},api.newItem=function newItem(values){var version=new ModelVersion(new settings.Model(values));return version.version.model.touch(),version}}module.exports=ListRemoteModel,ListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchListFromLocal=function fetchListFromLocal(){return localforage.getItem(baseName)},this.pushListToLocal=function pushListToLocal(data){return localforage.setItem(baseName,data)}},ListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchListFromRemote=function fetchListFromRemote(){return restClient.get(baseUrl)},this.pushListToRemote=function pushListToRemote(data){var itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"");return restClient[method](url,data)},this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+"/"+itemID)}}},{"../utils/ModelVersion":112,"./IndexedListCache":110,knockout:!1,localforage:!1}],112:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter;function ModelVersion(original){EventEmitter.call(this),this.original=original,this.version=original.model.clone(null,!0),this.areDifferent=ko.pureComputed(function areDifferent(){return this.original.model.dataTimestamp()!==this.version.model.dataTimestamp()},this).extend({rateLimit:0}),this.isNewer=ko.pureComputed(function isNewer(){return this.original.model.dataTimestamp()<this.version.model.dataTimestamp()},this).extend({rateLimit:0}),this.isObsolete=ko.pureComputed(function isComputed(){return this.original.model.dataTimestamp()>this.version.model.dataTimestamp()},this).extend({rateLimit:0})}module.exports=ModelVersion,ModelVersion._inherits(EventEmitter),ModelVersion.prototype.getRollback=function getRollback(from){if("version"===from)return createRollbackFunction(this.version);if("original"===from)return createRollbackFunction(this.original);throw new Error("from value not valid")},ModelVersion.prototype.pull=function pull(options){options=options||{};var result=!1,rollback=null;return(options.evenIfNewer||!this.isNewer())&&(rollback=createRollbackFunction(this.version),this.version.model.updateWith(this.original,!0),result=!0),this.emit("pull",result,rollback),result},ModelVersion.prototype.push=function push(options){options=options||{};var result=!1,rollback=null;return(options.evenIfObsolete||!this.isObsolete())&&(rollback=createRollbackFunction(this.original),this.original.model.updateWith(this.version,!0),result=!0),this.emit("push",result,rollback),result},ModelVersion.prototype.sync=function sync(){return this.isNewer()?this.push():this.isObsolete()?this.pull():!1};function createRollbackFunction(modelInstance){var backedData=modelInstance.model.toPlainObject(!0),backedTimestamp=modelInstance.model.dataTimestamp();return function rollback(){modelInstance.model.updateWith(backedData,!0),modelInstance.model.dataTimestamp(backedTimestamp)}}},{events:!1,knockout:!1}],113:[function(require,module,exports){"use strict";var ModelVersion=require("../utils/ModelVersion"),CacheControl=require("../utils/CacheControl"),ko=require("knockout"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;function RemoteModel(options){EventEmitter.call(this),options=options||{};var firstTimeLoad=!0;if(this.isLoading=ko.observable(!1),this.isSaving=ko.observable(!1),this.isSyncing=ko.observable(!1),this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this),!options.data)throw new Error("RemoteModel data must be set on constructor and no changed later");this.data=options.data,this.cache=new CacheControl({ttl:options.ttl}),this.clearCache=function clearCache(){this.cache.latest=null,this.data.model.reset()},this.localStorageName=options.localStorageName||null,this.getData=function getData(){return this.load(),this.data},this.newVersion=function newVersion(){var v=new ModelVersion(this.data);return this.isLoading.subscribe(function(isIt){isIt||v.pull({evenIfNewer:!0})}),v.pushSave=function pushSave(){var rollback=v.getRollback("original");return v.push({evenIfObsolete:!0}),this.save().then(function(){v.pull({evenIfNewer:!0})})["catch"](function(error){return rollback(),error})}.bind(this),v},this.fetch=options.fetch||function fetch(){throw new Error("Not implemented")},this.push=options.push||function push(){throw new Error("Not implementd")};var loadFromRemote=function loadFromRemote(){return this.fetch().then(function(serverData){if(!serverData)throw new Error('Remote model did not returned data, response must be a "Not Found"');return this.data.model.updateWith(serverData,!0),this.localStorageName&&localforage.setItem(this.localStorageName,serverData),this.isLoading()?this.emit("loaded",serverData):this.emit("synced",serverData),this.isLoading(!1),this.isSyncing(!1),this.cache.latest=new Date,this.data}.bind(this))["catch"](function(err){var wasLoad=this.isLoading();this.isLoading(!1),this.isSyncing(!1);var errPkg={task:wasLoad?"load":"sync",error:err};return EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg),err}.bind(this))}.bind(this);this.load=function load(){if(this.cache.mustRevalidate()){firstTimeLoad?this.isLoading(!0):this.isSyncing(!0);var promise=null;return promise=firstTimeLoad&&this.localStorageName?localforage.getItem(this.localStorageName).then(function(localData){return localData?(this.data.model.updateWith(localData,!0),this.isLoading(!1),this.isSyncing(!1),loadFromRemote()["catch"](function(){}),this.data):loadFromRemote()}.bind(this)):loadFromRemote(),firstTimeLoad?(firstTimeLoad=!1,promise):(promise["catch"](function(){}),Promise.resolve(this.data))}return Promise.resolve(this.data)},this.save=function save(){this.isSaving(!0);var ts=this.data.model.dataTimestamp();return this.push().then(function(serverData){return this.data.model.updateWith(serverData,!0),this.data.model.dataTimestamp(ts),this.localStorageName&&localforage.setItem(this.localStorageName,serverData),this.emit("saved",serverData),this.isSaving(!1),this.cache.latest=new Date,this.data}.bind(this))["catch"](function(err){this.isSaving(!1);var errPkg={task:"save",error:err};return EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg),err}.bind(this))},this.sync=function sync(){this.load()["catch"](function(){})}}module.exports=RemoteModel,RemoteModel._inherits(EventEmitter)},{"../utils/CacheControl":103,"../utils/ModelVersion":112,events:!1,knockout:!1,localforage:!1}],114:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery.ajaxQueue");function lowerFirstLetter(n){return n&&n[0]&&n[0].toLowerCase&&n[0].toLowerCase()+n.slice(1)||n}function lowerCamelizeObject(obj){if(!obj||"object"!=typeof obj)return obj;var ret=Array.isArray(obj)?[]:{};for(var k in obj)if(obj.hasOwnProperty(k)){var newk=lowerFirstLetter(k);ret[newk]="object"==typeof obj[k]?lowerCamelizeObject(obj[k]):obj[k]}return ret}function Rest(optionsOrUrl){var url="string"==typeof optionsOrUrl?optionsOrUrl:optionsOrUrl&&optionsOrUrl.url;this.baseUrl=url,this.extraHeaders=null}Rest.prototype.get=function get(apiUrl,data){return this.request(apiUrl,"get",data)},Rest.prototype.put=function get(apiUrl,data){return this.request(apiUrl,"put",data)},Rest.prototype.post=function get(apiUrl,data){return this.request(apiUrl,"post",data)},Rest.prototype["delete"]=function get(apiUrl,data){return this.request(apiUrl,"delete",data)},Rest.prototype.putFile=function putFile(apiUrl,data){return this.request(apiUrl,"delete",data,"multipart/form-data")},Rest.prototype.request=function request(apiUrl,httpMethod,data,contentType){var thisRest=this,url=this.baseUrl+apiUrl,xhr=$.ajaxQueue({url:url,cache:!1,dataType:"json",method:httpMethod,headers:this.extraHeaders,data:data&&JSON.parse(JSON.stringify(data)),contentType:contentType||"application/x-www-form-urlencoded"}),promiseXhr=Promise.resolve(xhr).then(lowerCamelizeObject)["catch"](function(err){if(401===err.status){var retry=request.bind(this,apiUrl,httpMethod,data,contentType),retryPromise=thisRest.onAuthorizationRequired(retry);if(retryPromise)return Promise.resolve(retryPromise)["catch"](function(){return err})}return err});return promiseXhr.xhr=xhr,promiseXhr},Rest.prototype.onAuthorizationRequired=function onAuthorizationRequired(){},module.exports=Rest},{}],115:[function(require,module,exports){function Time(date,hour,minute,second){return date instanceof Date||(second=minute,minute=hour,hour=date,date=new Date),new Date(date.getFullYear(),date.getMonth(),date.getDate(),hour||0,minute||0,second||0)}module.exports=Time},{}],116:[function(require,module,exports){"use strict";module.exports=function createAccessControl(app){return function accessControl(route){var activity=app.getActivityControllerByRoute(route),user=app.model.user(),currentType=user&&user.userType();if(activity&&activity.accessLevel){var can=activity.accessLevel&currentType;if(!can)return{requiredLevel:activity.accessLevel,currentType:currentType}}return null}}},{}],117:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),moment=require("moment");exports.sortAppointments=function(a,b){var as=a.startTime(),ae=a.endTime(),bs=b.startTime(),be=b.endTime();if(null===as)return-1;if(null===bs)return 1;var eq=as.toISOString()===bs.toISOString();return eq?null===ae?-1:null===be?1:ae-be:as-bs},exports.fillPreparationTimeSlots=function fillPreparationTimeSlots(date,slots,preparationHours){var prevEnd=date;slots.forEach(function(slot,index){if(slot.id()>0&&slot.sourceBooking()){var end=slot.startTime(),start=moment(end).subtract(preparationHours,"hours").toDate();end>prevEnd&&(start=prevEnd>start?prevEnd:start,slots.splice(index,0,Appointment.newPreparationTimeSlot({start:start,end:end})))}prevEnd=slot.endTime()})},exports.fillDayAvailability=function fillDayAvailability(date,appointmentsList,weekDaySchedule,schedulingPreferences){var slots=appointmentsList.slice(0);slots.sort(exports.sortAppointments),exports.fillPreparationTimeSlots(date,slots,schedulingPreferences.betweenTime());var filledSlots=[],zeroTime="00:00:00",last=zeroTime,lastDateTime=null,timeFormat="HH:mm:ss";if(0===slots.length){var fullStart=moment(date).startOf("day"),fullEnd=fullStart.clone().add(1,"days");filledSlots=exports.createScheduleSlots({start:fullStart.toDate(),end:fullEnd.toDate()},weekDaySchedule)}else{slots.forEach(function(slot){var start=slot.startTime(),s=moment(start),end=slot.endTime(),e=moment(end);s.format(timeFormat)>last&&(null===lastDateTime&&(lastDateTime=new Date(start.getFullYear(),start.getMonth(),start.getDate(),0,0,0)),filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:start},weekDaySchedule))),filledSlots.push(slot),lastDateTime=end,last=e.format(timeFormat)});var lastEnd=lastDateTime&&moment(lastDateTime).format(timeFormat);if(lastEnd!==zeroTime){var nextMidnight=new Date(lastDateTime.getFullYear(),lastDateTime.getMonth(),lastDateTime.getDate()+1,0,0,0);filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:nextMidnight},weekDaySchedule))}}return filledSlots},exports.createScheduleSlots=function createScheduleSlots(range,weekDaySchedule){var list=[],start=range.start,end=range.end,date=moment(start).startOf("day"),from=moment(date).add({minutes:weekDaySchedule.from()}).toDate(),to=moment(date).add({minutes:weekDaySchedule.to()}).toDate(),beforeSchedule=from>start&&from>=end,afterSchedule=end>to&&start>=to,insideSchedule=start>=from&&to>=end;if(beforeSchedule||afterSchedule)list.push(Appointment.newUnavailableSlot({start:start,end:end}));else if(insideSchedule)list.push(Appointment.newFreeSlot({start:start,end:end}));else{var crossStart=from>start&&end>from,crossEnd=to>start&&end>to;crossStart&&list.push(Appointment.newUnavailableSlot({start:start,end:from})),crossEnd&&list.push(Appointment.newUnavailableSlot({start:to,end:end})),crossStart&&crossEnd?list.push(Appointment.newFreeSlot({start:from,end:to})):crossStart?list.push(Appointment.newFreeSlot({start:from,end:end})):crossEnd&&list.push(Appointment.newFreeSlot({start:start,end:to}))}return list.sort(exports.sortAppointments)}},{"../models/Appointment":72,moment:!1}],118:[function(require,module,exports){"use strict";var $=require("jquery");exports.i18n=null;function createHelpers(ko){var helpers={};return helpers.popover={update:function(element,valueAccessor){var srcOptions=ko.unwrap(valueAccessor()),options=$.extend(!0,{},srcOptions);options.content=ko.unwrap(srcOptions.content),options.content?(options.content=exports.i18n&&exports.i18n.t(options.content)||options.content,$(element).popover("destroy").popover(options),$(element).is(":focus")&&$(element).popover("show")):$(element).popover("destroy")}},helpers}function plugIn(ko,prefix){var name,helpers=createHelpers(ko);for(var h in helpers)(!helpers.hasOwnProperty||helpers.hasOwnProperty(h))&&(name=prefix?prefix+h[0].toUpperCase()+h.slice(1):h,ko.bindingHandlers[name]=helpers[h])}exports.plugIn=plugIn,exports.createBindingHelpers=createHelpers},{}],119:[function(require,module,exports){"use strict";var $=require("jquery");require("bootstrap"),require("bootstrap-switch"),exports.plugIn=function plugIn(ko,prefix){ko.bindingHandlers[prefix?prefix+"switch":"switch"]={init:function(element,valueAccessor){$(element).bootstrapSwitch(),$(element).on("switchChange.bootstrapSwitch",function(e,state){var v=valueAccessor()||{},oldState=!!ko.unwrap(v.state),newState=!!state;oldState!==newState&&(ko.isObservable(v.state)?ko.isWriteableObservable(v.state)&&v.state(newState):v.state=newState)})},update:function(element,valueAccessor){var srcOptions=valueAccessor(),options=srcOptions||{};options=ko.toJS(options);var $el=$(element);Object.keys(options).forEach(function(key){$el.bootstrapSwitch(key,options[key])})}}}},{}],120:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment");exports.create=function createDatepickerAvailability(app,$datepicker,isLoading){var daysElements=$datepicker.datepicker("getDaysElements"),prevMonth=null;app.model.calendar.on("clearCache",function(dates){dates?dates.some(function(date){return date.getMonth()===prevMonth?(prevMonth=null,!0):void 0}):prevMonth=null});var tagAvailability=function tagAvailability(date,refresh){var month=date.getMonth();if(month!==prevMonth||refresh){prevMonth=month;var start=moment(date).clone().startOf("month").startOf("week"),end=start.clone().add(6,"weeks");isLoading&&isLoading(!0),app.model.calendar.getDatesAvailability(start,end).then(function(resultByDates){month===$datepicker.datepicker("getViewDate").getMonth()&&daysElements.each(function(){var $dateTd=$(this),id=$dateTd.data("date-time"),dateAvail=resultByDates[moment(id).format("YYYY-MM-DD")];if(id&&dateAvail){var cellClass=$dateTd.attr("class").replace(/(^|\s)tag-[^\s]+/,""),cls="";switch(dateAvail.availableTag()){case"past":cls="tag-muted";break;case"full":cls="tag-blank";break;case"medium":cls="tag-dark";break;case"low":cls="tag-warning";break;case"none":cls="tag-danger"}$dateTd.attr("class",cellClass+" "+cls)}})})["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){isLoading&&isLoading(!1)}.bind(this))}};return $datepicker.on("viewDateChanged",function(e,d){"days"===d.viewMode&&tagAvailability(d.viewDate)}),tagAvailability}},{moment:!1}],121:[function(require,module,exports){"use strict";var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp("["+specials.join("\\")+"]","g"),escapeRegExp=function(str){return str.replace(regex,"\\$&")};module.exports=escapeRegExp},{}],122:[function(require,module,exports){"use strict";var specials=["#","&","~","=",">","'",":",'"',"!",";",","],regexSpecials=[".","*","+","|","[","]","(",")","/","^","$"],sRE=new RegExp("("+specials.join("|")+"|\\"+regexSpecials.join("|\\")+")","g");module.exports=function(selector){return selector.replace(sRE,"\\$1")}},{}],123:[function(require,module,exports){"use strict";module.exports=function getDateWithoutTime(date){return date?date instanceof Date||(date=new Date(date)):date=new Date,new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}},{}],124:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function getObservable(obsOrValue){return"function"==typeof obsOrValue?obsOrValue:ko.observable(obsOrValue)}},{knockout:!1}],125:[function(require,module,exports){"user strict";module.exports=function getUrlQuery(url){url=url||window.location.href;var vars=[],hash,queryIndex=url.indexOf("?");if(queryIndex>-1)for(var hashes=url.slice(queryIndex+1).split("&"),i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[0]),vars[hash[0]]=hash[1];return vars}},{}],126:[function(require,module,exports){"use strict";var $=require("jquery");$.fn.multiline=function(text){return this.text(text),this.html(this.html().replace(/\n/g,"<br/>")),this}},{}],127:[function(require,module,exports){"use strict";function accessorDescriptor(field,fun){var desc={enumerable:!0,configurable:!0};return desc[field]=fun,desc}function defineGetter(obj,prop,get){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("get",get));if(Object.prototype.__defineGetter__)return obj.__defineGetter__(prop,get);throw new Error("browser does not support getters")}function defineSetter(obj,prop,set){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("set",set));if(Object.prototype.__defineSetter__)return obj.__defineSetter__(prop,set);throw new Error("browser does not support setters")}module.exports={defineGetter:defineGetter,defineSetter:defineSetter}},{}],128:[function(require,module,exports){"use strict";var map={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o"};module.exports=function removeAccent(str){for(var res="",c,i=0,l=str.length;l>i;i++)c=str.charAt(i),res+=map[c]||c;return res}},{}],129:[function(require,module,exports){"use strict";var $=require("jquery");module.exports=function scrollToElement(el,options){var parent=$(el).parent(),topOffset=options&&options.topOffset||0,animation=options&&options.animation,atRoot=!1;do{if(!parent||!parent.length)return;atRoot=parent.get(0)===document.documentElement;var relativeTop=atRoot?el.position().top:el.offset().top,elementTop=relativeTop-topOffset,scrollingTop=elementTop+parent.scrollTop()-parent.offset().top;atRoot?animation?$("html,body").stop().animate({scrollTop:elementTop},animation):window.scroll(0,elementTop):animation?parent.stop().animate({scrollTop:scrollingTop},animation):parent.scrollTop(scrollingTop),parent=parent.parent()}while(!atRoot)}},{}],130:[function(require,module,exports){"use strict";var $=require("jquery"),escapeSelector=require("../escapeSelector");function DomItemsManager(settings){this.idAttributeName=settings.idAttributeName||"id",this.allowDuplicates=!!settings.allowDuplicates||!1,this.root=settings.root||"body",this.$root=null,this.switchDelay=settings.switchDelay||140}module.exports=DomItemsManager,DomItemsManager.prototype.getAllItems=function getAllItems(){return this.$root.children("["+this.idAttributeName+"]")},DomItemsManager.prototype.find=function find(containerName,root){var $root=$(root||this.$root);return $root.children("["+this.idAttributeName+'="'+escapeSelector(containerName)+'"]')},DomItemsManager.prototype.getActive=function getActive(){return this.$root.children("["+this.idAttributeName+"]:visible")},DomItemsManager.prototype.inject=function inject(name,html){html=html.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"");var $html=$("<div/>",{html:html}),$c=this.find(name,$html);if(0===$c.length&&($c=$html.attr(this.idAttributeName,name)),!this.allowDuplicates){var $prev=this.find(name);$prev.length>0&&($prev.replaceWith($c),$c=$prev)}$c.appendTo(this.$root)},DomItemsManager.prototype["switch"]=function switchActiveItem($from,$to,shell,state){var toName=state.route.name;this.disableAccess();function hideit(){var fromIsHidden=$from.is("[hidden]");$from.length>0&&!fromIsHidden?(shell.emit(shell.events.willClose,$from,state),$from.find(":focus").blur(),$from.attr("hidden","hidden").css("display","none").css("z-index",""),shell.emit(shell.events.closed,$from,state)):$from.find(":focus").blur()}var toIsHidden=$to.is("[hidden]");if(toIsHidden)shell.emit(shell.events.willOpen,$to,state),$to.css("zIndex",-1),$to.removeAttr("hidden").css("display","block"),shell.emit(shell.events.itemReady,$to,state),setTimeout(function(){toName===shell.currentRoute.name&&(hideit(),$to.css("zIndex",2),this.enableAccess(),shell.emit(shell.events.opened,$to,state))}.bind(this),this.switchDelay);else{if(toName!==shell.currentRoute.name)return;shell.emit(shell.events.itemReady,$to,state),this.enableAccess(),hideit()}},DomItemsManager.prototype.init=function init(){this.$root=$(this.root||"body"),this.getAllItems().attr("hidden","hidden").css("display","none"),$('<div class="items-backstage"/>').css({background:this.$root.css("background-color")||"white",position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:0}).appendTo(this.$root);var $disableLayer=$('<div class="items-disable-layer"/>').css({background:"White",opacity:0,position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:-1}).appendTo(this.$root);this.disableAccess=function(){$disableLayer.css("zIndex",90900)},this.enableAccess=function(){$disableLayer.css("zIndex",-2)}}},{"../escapeSelector":122}],131:[function(require,module,exports){"use strict";var deps=require("./dependencies");function Shell(settings){deps.EventEmitter.call(this),this.$=settings.jquery||deps.jquery,this.$root=this.$(settings.root),this.baseUrl=settings.baseUrl||"",this.forceHashbang=settings.forceHashbang||!1,this.linkEvent=settings.linkEvent||"click",this.parseUrl=(settings.parseUrl||deps.parseUrl).bind(this,this.baseUrl),this.absolutizeUrl=(settings.absolutizeUrl||deps.absolutizeUrl).bind(this,this.baseUrl),this.history=settings.history||window.history,this.indexName=settings.indexName||"index",this.items=settings.domItemsManager,this.loader="undefined"==typeof settings.loader?deps.loader:settings.loader,this.loader&&(this.loader.baseUrl=this.baseUrl),this.events={willOpen:"shell-will-open",willClose:"shell-will-close",itemReady:"shell-item-ready",closed:"shell-closed",opened:"shell-opened"},this.accessControl=settings.accessControl||deps.accessControl,this.nonAccessName=settings.nonAccessName||"index",this.currentRoute=null,this.referrerRoute=null}Shell.prototype=Object.create(deps.EventEmitter.prototype,{constructor:{value:Shell,enumerable:!1,writable:!0,configurable:!0}}),module.exports=Shell,Shell.prototype.go=function go(url,state){return this.forceHashbang?/^#!/.test(url)||(url="#!"+url):url=this.absolutizeUrl(url),this.history.pushState(state,void 0,url),this.replace(state)},Shell.prototype.goBack=function goBack(state,steps){steps=0-(steps||1),0>steps&&Math.abs(steps)>=this.history.length?this.go(this.indexName):(this._pendingStateUpdate=state,this.history.go(steps))},Shell.prototype.getUpdatedState=function getUpdatedState(state){state=this._pendingStateUpdate||state||this.history.state||{},this._pendingStateUpdate=null;var isHashBang=/#!/.test(location.href)||this.forceHashbang,link=(isHashBang?location.hash:location.pathname)+(location.search||"");return state.route=this.parseUrl(link),state},Shell.prototype._getLocationRoutedUrl=function(){var reg=/^#!/;return reg.test(window.location.hash)?window.location.hash:window.location.pathname+window.location.search+window.location.hash},Shell.prototype._refreshReferrer=function(){this.referrerRoute=this.parseUrl(this._getLocationRoutedUrl())},Shell.prototype._refreshCurrent=function(){this.currentRoute=this.parseUrl(this._getLocationRoutedUrl())},Shell.prototype.replaceState=function replaceState(state,title,url){this._refreshReferrer(),this.history.replaceState(state,title,url),this._refreshCurrent()},Shell.prototype.pushState=function pushState(state,title,url){this._refreshReferrer(),this.history.pushState(state,title,url),this._refreshCurrent()},Shell.prototype.replace=function replace(state){state=this.getUpdatedState(state),state.route.root===!0&&(state.route=this.parseUrl(this.indexName)),this.referrerRoute=this.currentRoute,this.currentRoute=state.route;var accessError=this.accessControl(state.route);if(accessError)return this.go(this.nonAccessName,accessError);var $cont=this.items.find(state.route.name),shell=this,promise=null;if($cont&&$cont.length)promise=new Promise(function(resolve,reject){try{var $oldCont=shell.items.getActive();$oldCont=$oldCont.not($cont),shell.items["switch"]($oldCont,$cont,shell,state),resolve()}catch(ex){reject(ex)}});else if(this.loader)promise=this.loader.load(state.route).then(function(html){return shell.items.inject(state.route.name,html),shell.items.find(state.route.name).length?shell.replace(state):void 0});else{var err=new Error("Page not found ("+state.route.name+")");
console.warn("Shell Page not found, state:",state),promise=Promise.reject(err),setTimeout(function(){this.goBack()}.bind(this),1)}var thisShell=this;return promise["catch"](function(err){return err instanceof Error||(err=new Error(err)),console.error("Shell, unexpected error.",err),thisShell.emit("error",err),err}),promise},Shell.prototype.run=function run(){var shell=this;this.$(window).on(this.history.popstateEvent||"popstate",function(event){var state=event.state||event.originalEvent&&event.originalEvent.state||shell.history.state;shell.replace(state)});var linkWorking=null,linkWorkingDelay=80;this.$(document).on(this.linkEvent,"[href], [data-href]",function(e){if(linkWorking)return!1;linkWorking=setTimeout(function(){linkWorking=null},linkWorkingDelay);var $t=shell.$(this),href=$t.attr("href")||$t.data("href");if(!/^[a-z]+:/i.test(href)){if(shell.forceHashbang&&/^#([^!]|$)/.test(href))return e.preventDefault(),void shell.emit("fragmentNavigation",href,this,e);e.preventDefault(),setTimeout(function(){shell.go(href)},1)}}),this.items.init(),this.replace()}},{"./dependencies":133}],132:[function(require,module,exports){"use strict";var sanitizeUrl=require("./sanitizeUrl"),escapeRegExp=require("../escapeRegExp");function absolutizeUrl(baseUrl,url){url=sanitizeUrl(url);var matchBase=new RegExp("^"+escapeRegExp(baseUrl),"i");return matchBase.test(url)?url:sanitizeUrl(baseUrl+url)}module.exports=absolutizeUrl},{"../escapeRegExp":121,"./sanitizeUrl":138}],133:[function(require,module,exports){"use strict";module.exports={parseUrl:null,absolutizeUrl:null,jquery:null,loader:null,accessControl:function allowAll(){return null},EventEmitter:null}},{}],134:[function(require,module,exports){"use strict";var $=require("jquery"),sanitizeUrl=require("./sanitizeUrl"),getUrlQuery=require("../getUrlQuery"),session=sessionStorage.getItem("hashbangHistory.store");session=session?JSON.parse(session):{states:[]};function getSuid(hash){var suid=+getUrlQuery(hash)._suid;return isNaN(suid)?null:suid}function setSuid(hash,suid){var qs=getUrlQuery(hash);qs.push("_suid"),qs._suid=suid;for(var query=[],i=0;i<qs.length;i++)query.push(qs[i]+"="+encodeURIComponent(qs[qs[i]]));if(query=query.join("&")){var index=hash.indexOf("?");index>-1&&(hash=hash.substr(0,index)),hash+="?"+query}return hash}function persist(){setTimeout(function(){sessionStorage.setItem("hashbangHistory.store",JSON.stringify(session))},1500)}function checkState(state){return state?Object.keys(state).length>0?state:null:state}function cannonicalUrl(url){url=sanitizeUrl(url||"");var ihash=url.indexOf("#");return ihash>-1&&(url=url.substr(ihash+1)),url=url.replace(/^!/,"")}var latestPushedReplacedUrl=null,hashbangHistory={pushState:function pushState(state,title,url){if(url=cannonicalUrl(url),state=checkState(state)||null,null!==state){session.states.push(state);var suid=session.states.length-1;url=setSuid(url,suid),persist()}latestPushedReplacedUrl=url,location.hash="#!"+url},replaceState:function replaceState(state,title,url){url=cannonicalUrl(url);var suid=getSuid(url),hasOldState=null!==suid;state=checkState(state)||null,(null!==state||hasOldState)&&(hasOldState?session.states[suid]=state:(session.states.push(state),suid=session.states.length-1,url=setSuid(url,suid)),persist()),latestPushedReplacedUrl=url,location.hash="#!"+url},get state(){var suid=getSuid(location.hash);return null!==suid?session.states[suid]:null},get length(){return window.history.length},go:function go(offset){window.history.go(offset)},back:function back(){window.history.back()},forward:function forward(){window.history.forward()}},$w=$(window);$w.on("hashchange",function(e){var url=e.originalEvent.newURL;if(url=cannonicalUrl(url),url!==latestPushedReplacedUrl){var suid=getSuid(url),state=null;null!==suid&&(state=session.states[suid]),$w.trigger(new $.Event("popstate",{state:state}),"hashbangHistory")}}),$w.on("popstate",function(e,source){"hashbangHistory"!==source&&(e.preventDefault(),e.stopImmediatePropagation())}),module.exports=hashbangHistory},{"../getUrlQuery":125,"./sanitizeUrl":138}],135:[function(require,module,exports){"use strict";var deps=require("./dependencies"),DomItemsManager=require("./DomItemsManager"),parseUrl=require("./parseUrl"),absolutizeUrl=require("./absolutizeUrl"),$=require("jquery"),loader=require("./loader"),EventEmitter=require("events").EventEmitter;$.extend(deps,{parseUrl:parseUrl,absolutizeUrl:absolutizeUrl,jquery:$,loader:loader,EventEmitter:EventEmitter});var Shell=require("./Shell");exports.Shell=Shell,exports.DomItemsManager=DomItemsManager},{"./DomItemsManager":130,"./Shell":131,"./absolutizeUrl":132,"./dependencies":133,"./loader":136,"./parseUrl":137,events:!1}],136:[function(require,module,exports){"use strict";var $=require("jquery");module.exports={baseUrl:"/",load:function load(route){return new Promise(function(resolve,reject){console.log("Shell loading on demand",route.name,route),$.ajax({url:module.exports.baseUrl+route.name+".html",cache:!1}).then(resolve,reject)})}}},{}],137:[function(require,module,exports){"use strict";var getUrlQuery=require("../getUrlQuery"),escapeRegExp=require("../escapeRegExp");function parseUrl(baseUrl,link){link=link||"";var rawUrl=link;link=link.replace(/^#!/,"").replace(/^#/,""),link=link.replace(/^\/|^\.\//,"");var query=getUrlQuery(link||"?");link=link.replace(/\?.*$/,"");var path=link.replace(new RegExp("^"+escapeRegExp(baseUrl),"i"),""),match=/^\/?([^\/\.]+)[^\/]*(\/.*)*$/.exec(path),parsed={root:!0,name:null,segments:null,path:null,url:rawUrl,query:query};return match&&(parsed.root=!1,match[1]&&(parsed.name=match[1],match[2]?(parsed.path=match[2],parsed.segments=match[2].replace(/^\//,"").split("/")):(parsed.path="/",parsed.segments=[]))),parsed}module.exports=parseUrl},{"../escapeRegExp":121,"../getUrlQuery":125}],138:[function(require,module,exports){"use strict";function sanitizeUrl(url){return url.replace(/\.{2,}/g,"").replace(/\/{2,}/g,"/")}module.exports=sanitizeUrl},{}],139:[function(require,module,exports){"use strict";var removeAccent=require("./removeAccent");module.exports=function textSearch(search,text){var s=removeAccent(search||"").toLowerCase(),t=removeAccent(text||"").toLowerCase();return t.indexOf(s)>-1}},{"./removeAccent":128}],140:[function(require,module,exports){var ko=require("knockout"),moment=require("moment"),getObservable=require("../utils/getObservable"),Appointment=require("../models/Appointment"),AppointmentView=require("../viewmodels/AppointmentView"),ModelVersion=require("../utils/ModelVersion"),getDateWithoutTime=require("../utils/getDateWithoutTime"),PricingEstimateDetail=require("../models/PricingEstimateDetail");function AppointmentCardViewModel(params){this.sourceItem=getObservable(params.sourceItem);var app=this.app=ko.unwrap(params.app);this.editMode=getObservable(params.editMode),this.editedVersion=ko.observable(null),this.isSaving=ko.observable(!1),this.isLoading=getObservable(params.isLoading),this.isLocked=ko.computed(function(){return this.isSaving()||this.isLoading()},this),this.item=ko.observable(AppointmentView(this.sourceItem(),app)),this.allowBookUnavailableTime=ko.observable(!1),this.currentID=ko.pureComputed(function(){var it=this.item();return it&&it.id()||0},this),this.currentDatetime=ko.pureComputed(function(){return this.item()&&this.item().startTime()||new Date},this),this.currentDate=ko.pureComputed(function(){return getDateWithoutTime(this.item()&&this.item().startTime())},this),this.isNew=ko.computed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this),this.isBooking=ko.computed(function(){return this.item()&&this.item().sourceBooking()},this),this.isEvent=ko.computed(function(){return this.item()&&this.item().sourceEvent()&&!this.item().sourceBooking()},this),this.headerClass=ko.pureComputed(function(){return this.isBooking()?this.editMode()?"Card-title--warning":"Card-title--primary":this.isEvent()?"Card-title--danger":""},this),this.newAppointmentVisible=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.free||id===Appointment.specialIds.emptyDate||id===Appointment.specialIds.unavailable},this),this.editScheduleVisible=ko.pureComputed(function(){return this.currentID()===Appointment.specialIds.unavailable},this),this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?this.isNew()&&this.isBooking()?"Book":"Save changes":"Saved"},this),this.sourceItem.subscribe(function(sourceItem){this.item(AppointmentView(sourceItem,app)),this.editedVersion(null),this.editMode(!1),this.isNew()&&this.editMode(!0)},this),this.editMode.subscribe(function(isEdit){if(!(this.currentID()<=0)||this.isNew())if(isEdit){var version=new ModelVersion(this.sourceItem());version.version.sourceEvent(this.sourceItem().sourceEvent()),version.version.sourceBooking(this.sourceItem().sourceBooking()),this.editedVersion(version),this.item(AppointmentView(version.version,app)),this.isNew()&&this.isEvent()&&(this.item().sourceEvent().availabilityTypeID(0),this.item().isAllDay(!1),this.item().sourceEvent().eventTypeID(3),this.item().summary(""))}else this.item(AppointmentView(this.sourceItem(),app))},this),this.edit=function edit(){this.isLocked()||this.editMode(!0)}.bind(this),this.save=function save(){if(!this.isLocked()){var version=this.editedVersion();version&&version.areDifferent()&&(this.isSaving(!0),app.model.calendar.setAppointment(version.version,this.allowBookUnavailableTime()).then(function(savedApt){if(version.original.model.updateWith(savedApt),version.pull({evenIfNewer:!0}),this.editMode(!1),this.isBooking()){var msg=this.item().customer().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Confirmed!",message:msg})}}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this)))}}.bind(this),this.cancel=function cancel(){this.isLocked()||(this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0}),this.editMode(!1))}.bind(this),this.confirmCancel=function confirmCancel(){this.app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this))}.bind(this);var editFieldOn=function editFieldOn(activity,data){if(data.appointment=this.item().model.toPlainObject(!0),data.cancelLink=this.cancelLink,this.progress&&!this.progress.ended){data.progress=this.progress;var step=data.progress.step||1,total=data.progress.total||1;data.title=step+" of "+total,data.navTitle=null}else data.progress=this.progress,data.title=null,data.navTitle=this.isBooking()?"Booking":"Event";app.shell.go(activity,data)}.bind(this);this.pickDateTime=function pickDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().startTime(),datetimeField:"startTime",headerText:"Select the start time",requiredDuration:this.item().getServiceDurationMinutes()})}.bind(this),this.pickEndDateTime=function pickEndDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().endTime(),datetimeField:"endTime",headerText:"Select the end time"})}.bind(this),this.pickClient=function pickClient(){this.isLocked()||editFieldOn("clients",{selectClient:!0,selectedClientID:this.item().sourceBooking().bookingRequest().customerUserID()})}.bind(this),this.pickService=function pickService(){this.isLocked()||editFieldOn("freelancerPricing/"+this.item().jobTitleID(),{selectPricing:!0,selectedPricing:this.item().pricing().map(function(pricing){return{freelancerPricingID:ko.unwrap(pricing.freelancerPricingID),totalPrice:ko.unwrap(pricing.totalPrice)}})})}.bind(this),this.changePrice=function changePrice(){this.isLocked()}.bind(this),this.pickLocation=function pickLocation(){this.isLocked()||editFieldOn("serviceAddresses/"+this.item().jobTitleID(),{selectAddress:!0,selectedAddressID:this.item().addressID()})}.bind(this);var textFieldsHeaders={preNotesToClient:"Notes to client",postNotesToClient:"Notes to client (afterwards)",preNotesToSelf:"Notes to self",postNotesToSelf:"Booking summary",summary:"What?"};this.editTextField=function editTextField(field){this.isLocked()||editFieldOn("textEditor",{request:"textEditor",field:field,title:this.isNew()?"New booking":"Booking",header:textFieldsHeaders[field],text:this.item()[field]()})}.bind(this),"function"==typeof params.api&&params.api(this),ko.computed(function calculateEndTime(){var duration=this.item().serviceDurationMinutes(),start=moment(this.item().startTime()),end;this.isBooking()&&start.isValid()&&(end=start.add(duration,"minutes").toDate(),this.item().endTime(end))},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}AppointmentCardViewModel.prototype.passIn=function passIn(requestData){if(requestData.appointment?(this.editMode(!0),this.item().model.updateWith(requestData.appointment)):this.isNew()||this.cancel(),"textEditor"===requestData.request&&this.item()[requestData.field](requestData.text),requestData.selectClient===!0&&this.item().customerUserID(requestData.selectedClientID),"undefined"!=typeof requestData.selectedDatetime){var field=requestData.datetimeField;this.item()[field](requestData.selectedDatetime),this.allowBookUnavailableTime(requestData.allowBookUnavailableTime)}if(requestData.selectedJobTitleID&&this.item().jobTitleID(requestData.selectedJobTitleID),requestData.selectAddress===!0&&this.item().addressID(requestData.selectedAddressID),requestData.selectPricing===!0&&this.item().pricing(requestData.selectedPricing.map(function(pricing){return new PricingEstimateDetail(pricing)})),this.isNew())if(requestData&&requestData.cancelLink)this.cancelLink=requestData.cancelLink;else{var referrerUrl=this.app.shell.referrerRoute;referrerUrl=referrerUrl&&referrerUrl.url||"calendar",this.cancelLink=referrerUrl}if(this.currentID()===Appointment.specialIds.newBooking)if(requestData.progress){if(requestData.progress){this.progress=requestData.progress;var step=this.progress.step||1;2>step?(this.progress.step=2,this.pickService()):3>step?(requestData.progress.step=3,this.pickDateTime()):4>step?(requestData.progress.step=4,this.pickLocation()):this.progress.ended=!0}}else this.progress={step:1,total:4,ended:!1},this.pickClient();else this.progress=null},module.exports=AppointmentCardViewModel},{"../models/Appointment":72,"../models/PricingEstimateDetail":92,"../utils/ModelVersion":112,"../utils/getDateWithoutTime":123,"../utils/getObservable":124,"../viewmodels/AppointmentView":141,knockout:!1,moment:!1}],141:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function AppointmentView(appointment,app){return appointment._isAppointmentView?appointment:(appointment._isAppointmentView=!0,appointment.customer=ko.computed(function(){var b=this.sourceBooking();if(!b)return null;var cid=this.customerUserID();return cid?app.model.customers.getObservableItem(cid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),appointment.address=ko.computed(function(){var aid=this.addressID(),jid=this.jobTitleID();return aid&&jid?app.model.serviceAddresses.getObservableItem(jid,aid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),appointment.addressSummary=ko.computed(function(){var eventData=this.sourceEvent(),add=this.address();return add&&add.singleLine()||eventData&&eventData.location()||""},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),appointment.pricingWithInfo=ko.computed(function(){var b=this.sourceBooking();if(!b)return[];var jid=this.jobTitleID(),details=this.pricing();return details.map(function(det){return PricingEstimateDetailView(det,jid,app)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}}),appointment.servicesSummary=ko.computed(function(){return this.pricingWithInfo().map(function(service){return service.freelancerPricing().name()}).join(", ")},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),appointment.getServiceDurationMinutes=function(){var pricing=this.pricingWithInfo(),sum=pricing.reduce(function(prev,service){return prev+service.freelancerPricing().serviceDurationMinutes()},0);return sum},appointment.serviceDurationMinutes=ko.computed(function(){return this.getServiceDurationMinutes()},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),ko.computed(function(){var pricing=appointment.pricing();this.price(pricing.reduce(function(prev,cur){return prev+cur.totalPrice()},0))},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),appointment)};function PricingEstimateDetailView(pricingEstimateDetail,jobTitleID,app){return pricingEstimateDetail.freelancerPricing=ko.computed(function(){var pid=this.freelancerPricingID();return app.model.freelancerPricing.getObservableItem(jobTitleID,pid,!0)()},pricingEstimateDetail).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}}),pricingEstimateDetail}},{knockout:!1}],142:[function(require,module,exports){"use strict";var ko=require("knockout");function FormCredentials(){this.username=ko.observable(""),this.password=ko.observable("");var emailRegexp=/^[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+@[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+$/;this.username.error=ko.observable(""),this.username.subscribe(function(v){v?emailRegexp.test(v)?this.username.error(""):this.username.error("Is not a valid email"):this.username.error("Required")}.bind(this)),this.password.error=ko.observable(""),this.password.subscribe(function(v){var err="";v||(err="Required"),this.password.error(err)}.bind(this))}module.exports=FormCredentials},{knockout:!1}],143:[function(require,module,exports){var Model=require("../models/Model");function NavAction(values){Model(this),this.model.defProperties({link:"",icon:"",text:"",isTitle:!1,isModal:!1,isShell:!1,isMenu:!1,handler:null},values),this.runHandler=function runHandler(obj,event){var handler=this.handler();handler&&(event.stopImmediatePropagation(),event.preventDefault(),handler.call(this,event,obj))}.bind(this)}module.exports=NavAction,NavAction.prototype.getHref=function getHref(){return this.handler()||this.isMenu()||this.isModal()||this.isShell()?"#":this.link()},NavAction.prototype.getModalTarget=function getModalTarget(){return this.handler()||this.isMenu()||!this.isModal()||this.isShell()?"":this.link()},NavAction.prototype.getShellCommand=function getShellCommand(){return this.handler()||this.isMenu()||!this.isShell()?"":this.link()},NavAction.prototype.getMenuID=function getMenuID(){return this.handler()||!this.isMenu()?"":this.link()},NavAction.prototype.getMenuLink=function getMenuLink(){return this.handler()||!this.isMenu()?"":"#"+this.link()},NavAction.goHome=new NavAction({link:"/",icon:"fa ion ion-stats-bars"}),NavAction.goBack=new NavAction({link:"goBack",icon:"fa ion ion-ios-arrow-left",isShell:!0}),NavAction.menuIn=new NavAction({link:"menuIn",icon:"menu",isMenu:!0}),NavAction.menuOut=new NavAction({link:"menuOut",icon:"menu",isMenu:!0}),NavAction.menuNewItem=new NavAction({link:"menuNewItem",icon:"fa ion ion-ios-plus-empty",isMenu:!0}),NavAction.goHelpIndex=new NavAction({link:"#helpIndex",text:"help",isModal:!0}),NavAction.goLogin=new NavAction({link:"/login",text:"log-in"}),NavAction.goLogout=new NavAction({link:"/logout",text:"log-out"}),NavAction.goSignup=new NavAction({link:"/signup",text:"sign-up"})},{"../models/Model":89}],144:[function(require,module,exports){var Model=require("../models/Model");function NavBar(values){Model(this),this.model.defProperties({title:"",leftAction:null,rightAction:null},values)}module.exports=NavBar},{"../models/Model":89}],145:[function(require,module,exports){var Model=require("../models/Model"),ko=require("knockout");function OnboardingProgress(values){Model(this),this.model.defProperties({group:"",stepNumber:-1,steps:[]},values),this.totalSteps=ko.pureComputed(function(){return this.steps().length-1},this),this.stepName=ko.pureComputed(function(){var num=this.stepNumber(),tot=this.steps().length;if(tot>0&&num>-1&&tot>num){var name=this.steps()[num]||"";return name}return null},this),this.stepUrl=ko.pureComputed(function(){var url=this.stepName();return url&&!/^\//.test(url)&&(url="/"+url),url},this),this.stepReference=ko.pureComputed(function(){return this.group()+":"+this.stepName()},this),this.progressText=ko.pureComputed(function(){return this.stepNumber()+" of "+this.totalSteps()},this),this.inProgress=ko.pureComputed(function(){return!!this.stepUrl()},this)}module.exports=OnboardingProgress,OnboardingProgress.prototype.setStepByName=function setStepByName(name){var stepIndex=this.steps().indexOf(name);return stepIndex>-1?(this.stepNumber(stepIndex),!0):!1},OnboardingProgress.predefinedStepGroups={welcome:["welcome","addJobTitles","weeklySchedule","contactInfo"],marketplace:[],payment:[]}},{"../models/Model":89,knockout:!1}],146:[function(require,module,exports){"use strict";var getObservable=require("../utils/getObservable");function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null),this.endTime=getObservable(params.endTime||null),this.subject=getObservable(params.subject||null),this.description=getObservable(params.description||null),this.link=getObservable(params.link||null),this.actionIcon=getObservable(params.actionIcon||null),this.actionText=getObservable(params.actionText||null),this.classNames=getObservable(params.classNames||null)}module.exports=TimeSlotViewModel;var numeral=require("numeral"),Appointment=require("../models/Appointment");TimeSlotViewModel.fromAppointment=function fromAppointment(apt){var link="#!appointment/"+apt.startTime().toISOString()+"/"+apt.id();apt.id()===Appointment.specialIds.preparationTime&&(link="#!schedulingPreferences?mustReturn=1");var classNames=null;return Appointment.specialIds.free===apt.id()?classNames="Tile--tag-gray-lighter ":apt.id()>0&&apt.sourceBooking()?(classNames=apt.sourceBooking().confirmedDateID()?"Tile--tag-primary ":"Tile--tag-warning ",classNames+="ItemAddonTile--largerContent "):classNames="Tile--tag-danger ",new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,subject:apt.summary,description:apt.description,link:link,actionIcon:apt.sourceBooking()?null:apt.sourceEvent()?"fa ion ion-ios-arrow-right":apt.id()?null:"fa ion ion-plus",actionText:apt.sourceBooking()&&apt.sourceBooking().bookingRequest()&&apt.sourceBooking().bookingRequest().pricingEstimate()?numeral(apt.sourceBooking().bookingRequest().pricingEstimate().totalPrice()||0).format("$0.00"):null,classNames:classNames})}},{"../models/Appointment":72,"../utils/getObservable":124,numeral:!1}],147:[function(require,module,exports){"use strict";var ko=require("knockout");function UserJobProfileViewModel(app){this.showMarketplaceInfo=ko.observable(!1);var jobTitlesIndex={};function syncJobTitle(jobTitleID){return app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){jobTitlesIndex[jobTitleID]=jobTitle})}function attachJobTitle(userJobTitle){userJobTitle.jobTitle=ko.computed(function(){return jobTitlesIndex[this.jobTitleID()]},userJobTitle),userJobTitle.displayedSingularName=ko.computed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Unknow"},userJobTitle)}function attachMarketplaceStatus(userJobtitle){userJobtitle.marketplaceStatusHtml=ko.pureComputed(function(){var status=this.statusID();return 1===status?'Marketplace profile: <strong class="text-success">ON</strong>':3===status?'Marketplace profile: <strong class="text-danger">OFF</strong>':'<span class="text-danger">There are steps left to activate</span>'},userJobtitle)}function attachExtras(userJobtitle){attachJobTitle(userJobtitle),attachMarketplaceStatus(userJobtitle)}this.userJobProfile=ko.observableArray([]),app.model.userJobProfile.list.subscribe(function(list){Promise.all(list.map(function(userJobTitle){return syncJobTitle(userJobTitle.jobTitleID())})).then(function(){list.forEach(attachExtras),this.userJobProfile(list),this.isLoading(!1),this.isSyncing(!1),this.thereIsError(!1)}.bind(this))["catch"](showLoadingError)},this),this.isFirstTime=ko.observable(!0),this.isLoading=ko.observable(!1),this.isSyncing=ko.observable(!1),this.thereIsError=ko.observable(!1),this.baseUrl=ko.observable("/jobtitles"),this.selectJobTitle=function(jobTitle){return app.shell.go(this.baseUrl()+"/"+jobTitle.jobTitleID()),!1}.bind(this);var showLoadingError=function showLoadingError(err){app.modals.showError({title:"An error happening when loading your job profile.",error:err&&err.error||err}),this.isLoading(!1),this.isSyncing(!1),this.thereIsError(!0)}.bind(this);this.sync=function sync(){var firstTime=this.isFirstTime();this.isFirstTime(!1),firstTime?this.isLoading(!0):this.isSyncing(!0),app.model.userJobProfile.syncList()["catch"](showLoadingError)}.bind(this)}module.exports=UserJobProfileViewModel},{knockout:!1}]},{},[41]);