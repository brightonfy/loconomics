(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(){var numeral,VERSION="1.5.3",languages={},currentLanguage="en",zeroFormat=null,defaultFormat="0,0",hasModule=typeof module!=="undefined"&&module.exports;function Numeral(number){this._value=number}function toFixed(value,precision,roundingFunction,optionals){var power=Math.pow(10,precision),optionalsRegExp,output;output=(roundingFunction(value*power)/power).toFixed(precision);if(optionals){optionalsRegExp=new RegExp("0{1,"+optionals+"}$");output=output.replace(optionalsRegExp,"")}return output}function formatNumeral(n,format,roundingFunction){var output;if(format.indexOf("$")>-1){output=formatCurrency(n,format,roundingFunction)}else if(format.indexOf("%")>-1){output=formatPercentage(n,format,roundingFunction)}else if(format.indexOf(":")>-1){output=formatTime(n,format)}else{output=formatNumber(n._value,format,roundingFunction)}return output}function unformatNumeral(n,string){var stringOriginal=string,thousandRegExp,millionRegExp,billionRegExp,trillionRegExp,suffixes=["KB","MB","GB","TB","PB","EB","ZB","YB"],bytesMultiplier=false,power;if(string.indexOf(":")>-1){n._value=unformatTime(string)}else{if(string===zeroFormat){n._value=0}else{if(languages[currentLanguage].delimiters.decimal!=="."){string=string.replace(/\./g,"").replace(languages[currentLanguage].delimiters.decimal,".")}thousandRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.thousand+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$");millionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.million+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$");billionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.billion+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$");trillionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.trillion+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$");for(power=0;power<=suffixes.length;power++){bytesMultiplier=string.indexOf(suffixes[power])>-1?Math.pow(1024,power+1):false;if(bytesMultiplier){break}}n._value=(bytesMultiplier?bytesMultiplier:1)*(stringOriginal.match(thousandRegExp)?Math.pow(10,3):1)*(stringOriginal.match(millionRegExp)?Math.pow(10,6):1)*(stringOriginal.match(billionRegExp)?Math.pow(10,9):1)*(stringOriginal.match(trillionRegExp)?Math.pow(10,12):1)*(string.indexOf("%")>-1?.01:1)*((string.split("-").length+Math.min(string.split("(").length-1,string.split(")").length-1))%2?1:-1)*Number(string.replace(/[^0-9\.]+/g,""));n._value=bytesMultiplier?Math.ceil(n._value):n._value}}return n._value}function formatCurrency(n,format,roundingFunction){var symbolIndex=format.indexOf("$"),openParenIndex=format.indexOf("("),minusSignIndex=format.indexOf("-"),space="",spliceIndex,output;if(format.indexOf(" $")>-1){space=" ";format=format.replace(" $","")}else if(format.indexOf("$ ")>-1){space=" ";format=format.replace("$ ","")}else{format=format.replace("$","")}output=formatNumber(n._value,format,roundingFunction);if(symbolIndex<=1){if(output.indexOf("(")>-1||output.indexOf("-")>-1){output=output.split("");spliceIndex=1;if(symbolIndex<openParenIndex||symbolIndex<minusSignIndex){spliceIndex=0}output.splice(spliceIndex,0,languages[currentLanguage].currency.symbol+space);output=output.join("")}else{output=languages[currentLanguage].currency.symbol+space+output}}else{if(output.indexOf(")")>-1){output=output.split("");output.splice(-1,0,space+languages[currentLanguage].currency.symbol);output=output.join("")}else{output=output+space+languages[currentLanguage].currency.symbol}}return output}function formatPercentage(n,format,roundingFunction){var space="",output,value=n._value*100;if(format.indexOf(" %")>-1){space=" ";format=format.replace(" %","")}else{format=format.replace("%","")}output=formatNumber(value,format,roundingFunction);if(output.indexOf(")")>-1){output=output.split("");output.splice(-1,0,space+"%");output=output.join("")}else{output=output+space+"%"}return output}function formatTime(n){var hours=Math.floor(n._value/60/60),minutes=Math.floor((n._value-hours*60*60)/60),seconds=Math.round(n._value-hours*60*60-minutes*60);return hours+":"+(minutes<10?"0"+minutes:minutes)+":"+(seconds<10?"0"+seconds:seconds)}function unformatTime(string){var timeArray=string.split(":"),seconds=0;if(timeArray.length===3){seconds=seconds+Number(timeArray[0])*60*60;seconds=seconds+Number(timeArray[1])*60;seconds=seconds+Number(timeArray[2])}else if(timeArray.length===2){seconds=seconds+Number(timeArray[0])*60;seconds=seconds+Number(timeArray[1])}return Number(seconds)}function formatNumber(value,format,roundingFunction){var negP=false,signed=false,optDec=false,abbr="",abbrK=false,abbrM=false,abbrB=false,abbrT=false,abbrForce=false,bytes="",ord="",abs=Math.abs(value),suffixes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],min,max,power,w,precision,thousands,d="",neg=false;if(value===0&&zeroFormat!==null){return zeroFormat}else{if(format.indexOf("(")>-1){negP=true;format=format.slice(1,-1)}else if(format.indexOf("+")>-1){signed=true;format=format.replace(/\+/g,"")}if(format.indexOf("a")>-1){abbrK=format.indexOf("aK")>=0;abbrM=format.indexOf("aM")>=0;abbrB=format.indexOf("aB")>=0;abbrT=format.indexOf("aT")>=0;abbrForce=abbrK||abbrM||abbrB||abbrT;if(format.indexOf(" a")>-1){abbr=" ";format=format.replace(" a","")}else{format=format.replace("a","")}if(abs>=Math.pow(10,12)&&!abbrForce||abbrT){abbr=abbr+languages[currentLanguage].abbreviations.trillion;value=value/Math.pow(10,12)}else if(abs<Math.pow(10,12)&&abs>=Math.pow(10,9)&&!abbrForce||abbrB){abbr=abbr+languages[currentLanguage].abbreviations.billion;value=value/Math.pow(10,9)}else if(abs<Math.pow(10,9)&&abs>=Math.pow(10,6)&&!abbrForce||abbrM){abbr=abbr+languages[currentLanguage].abbreviations.million;value=value/Math.pow(10,6)}else if(abs<Math.pow(10,6)&&abs>=Math.pow(10,3)&&!abbrForce||abbrK){abbr=abbr+languages[currentLanguage].abbreviations.thousand;value=value/Math.pow(10,3)}}if(format.indexOf("b")>-1){if(format.indexOf(" b")>-1){bytes=" ";format=format.replace(" b","")}else{format=format.replace("b","")}for(power=0;power<=suffixes.length;power++){min=Math.pow(1024,power);max=Math.pow(1024,power+1);if(value>=min&&value<max){bytes=bytes+suffixes[power];if(min>0){value=value/min}break}}}if(format.indexOf("o")>-1){if(format.indexOf(" o")>-1){ord=" ";format=format.replace(" o","")}else{format=format.replace("o","")}ord=ord+languages[currentLanguage].ordinal(value)}if(format.indexOf("[.]")>-1){optDec=true;format=format.replace("[.]",".")}w=value.toString().split(".")[0];precision=format.split(".")[1];thousands=format.indexOf(",");if(precision){if(precision.indexOf("[")>-1){precision=precision.replace("]","");precision=precision.split("[");d=toFixed(value,precision[0].length+precision[1].length,roundingFunction,precision[1].length)}else{d=toFixed(value,precision.length,roundingFunction)}w=d.split(".")[0];if(d.split(".")[1].length){d=languages[currentLanguage].delimiters.decimal+d.split(".")[1]}else{d=""}if(optDec&&Number(d.slice(1))===0){d=""}}else{w=toFixed(value,null,roundingFunction)}if(w.indexOf("-")>-1){w=w.slice(1);neg=true}if(thousands>-1){w=w.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+languages[currentLanguage].delimiters.thousands)}if(format.indexOf(".")===0){w=""}return(negP&&neg?"(":"")+(!negP&&neg?"-":"")+(!neg&&signed?"+":"")+w+d+(ord?ord:"")+(abbr?abbr:"")+(bytes?bytes:"")+(negP&&neg?")":"")}}numeral=function(input){if(numeral.isNumeral(input)){input=input.value()}else if(input===0||typeof input==="undefined"){input=0}else if(!Number(input)){input=numeral.fn.unformat(input)}return new Numeral(Number(input))};numeral.version=VERSION;numeral.isNumeral=function(obj){return obj instanceof Numeral};numeral.language=function(key,values){if(!key){return currentLanguage}if(key&&!values){if(!languages[key]){throw new Error("Unknown language : "+key)}currentLanguage=key}if(values||!languages[key]){loadLanguage(key,values)}return numeral};numeral.languageData=function(key){if(!key){return languages[currentLanguage]}if(!languages[key]){throw new Error("Unknown language : "+key)}return languages[key]};numeral.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(number){var b=number%10;return~~(number%100/10)===1?"th":b===1?"st":b===2?"nd":b===3?"rd":"th"},currency:{symbol:"$"}});numeral.zeroFormat=function(format){zeroFormat=typeof format==="string"?format:null};numeral.defaultFormat=function(format){defaultFormat=typeof format==="string"?format:"0.0"};function loadLanguage(key,values){languages[key]=values}if("function"!==typeof Array.prototype.reduce){Array.prototype.reduce=function(callback,opt_initialValue){"use strict";if(null===this||"undefined"===typeof this){throw new TypeError("Array.prototype.reduce called on null or undefined")}if("function"!==typeof callback){throw new TypeError(callback+" is not a function")}var index,value,length=this.length>>>0,isValueSet=false;if(1<arguments.length){value=opt_initialValue;isValueSet=true}for(index=0;length>index;++index){if(this.hasOwnProperty(index)){if(isValueSet){value=callback(value,this[index],index,this)}else{value=this[index];isValueSet=true}}}if(!isValueSet){throw new TypeError("Reduce of empty array with no initial value")}return value}}function multiplier(x){var parts=x.toString().split(".");if(parts.length<2){return 1}return Math.pow(10,parts[1].length)}function correctionFactor(){var args=Array.prototype.slice.call(arguments);return args.reduce(function(prev,next){var mp=multiplier(prev),mn=multiplier(next);return mp>mn?mp:mn},-Infinity)}numeral.fn=Numeral.prototype={clone:function(){return numeral(this)},format:function(inputString,roundingFunction){return formatNumeral(this,inputString?inputString:defaultFormat,roundingFunction!==undefined?roundingFunction:Math.round)},unformat:function(inputString){if(Object.prototype.toString.call(inputString)==="[object Number]"){return inputString}return unformatNumeral(this,inputString?inputString:defaultFormat)},value:function(){return this._value},valueOf:function(){return this._value},set:function(value){this._value=Number(value);return this},add:function(value){var corrFactor=correctionFactor.call(null,this._value,value);function cback(accum,curr,currI,O){return accum+corrFactor*curr}this._value=[this._value,value].reduce(cback,0)/corrFactor;return this},subtract:function(value){var corrFactor=correctionFactor.call(null,this._value,value);function cback(accum,curr,currI,O){return accum-corrFactor*curr}this._value=[value].reduce(cback,this._value*corrFactor)/corrFactor;return this},multiply:function(value){function cback(accum,curr,currI,O){var corrFactor=correctionFactor(accum,curr);return accum*corrFactor*(curr*corrFactor)/(corrFactor*corrFactor)}this._value=[this._value,value].reduce(cback,1);return this},divide:function(value){function cback(accum,curr,currI,O){var corrFactor=correctionFactor(accum,curr);return accum*corrFactor/(curr*corrFactor)}this._value=[this._value,value].reduce(cback);return this},difference:function(value){return Math.abs(numeral(this._value).subtract(value).value())}};if(hasModule){module.exports=numeral}if(typeof ender==="undefined"){this["numeral"]=numeral}if(typeof define==="function"&&define.amd){define([],function(){return numeral})}}).call(this)},{}],2:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function AccountActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar("Account")});exports.init=A.init},{"../components/Activity":44}],3:[function(require,module,exports){"use strict";var ko=require("knockout"),Address=require("../models/Address"),Activity=require("../components/Activity");var A=Activity.extends(function AddressEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Freelancer;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Locations")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options&&options.route&&options.route.segments||[];var kind=params[0]||"",isService=kind===Address.kind.service,jobTitleID=isService?params[1]|0:0,addressID=isService?params[2]|0:params[1]|0,serviceType=params[2]||"";if(addressID){this.app.model.serviceAddresses.getItem(jobTitleID,addressID).then(function(address){if(address){this.viewModel.address(new Address(address));this.viewModel.header("Edit Location")}else{this.viewModel.address(null);this.viewModel.header("Unknow location or was deleted")}}.bind(this)).catch(function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.viewModel.address(new Address({jobTitleID:jobTitleID}));switch(serviceType){case"serviceArea":this.viewModel.address().isServiceArea(true);this.viewModel.address().isServiceLocation(false);this.viewModel.header("Add a service area");break;case"serviceLocation":this.viewModel.address().isServiceArea(false);this.viewModel.address().isServiceLocation(true);this.viewModel.header("Add a service location");break;default:this.viewModel.address().isServiceArea(true);this.viewModel.address().isServiceLocation(true);this.viewModel.header("Add a location");break}}};function ViewModel(app){this.header=ko.observable("Edit Location");this.address=ko.observable(new Address);this.isLoading=app.model.serviceAddresses.state.isLoading;this.isSaving=app.model.serviceAddresses.state.isSaving;this.isLocked=app.model.serviceAddresses.state.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){app.model.serviceAddresses.setItem(this.address().model.toPlainObject()).then(function(serverData){this.address().model.updateWith(serverData)}.bind(this)).catch(function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this)}},{"../components/Activity":44,"../models/Address":48,knockout:false}],4:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),ko=require("knockout");require("../components/DatePicker");var Activity=require("../components/Activity");var A=Activity.extends(function AppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Freelancer;this.menuItem="calendar";var backAction=new Activity.NavAction({link:"calendar/",icon:Activity.NavAction.goBack.icon(),isTitle:true,text:"Calendar"});this.navBar=new Activity.NavBar({title:"",leftAction:backAction,rightAction:Activity.NavAction.goHelpIndex});this.$appointmentView=this.$activity.find("#calendarAppointmentView");this.$chooseNew=$("#calendarChooseNew");this.viewModel=new ViewModel(this.app);var defBackText=backAction.text._initialValue;backAction.text=ko.computed(function(){var d=this.viewModel.currentDate();if(!d)return defBackText;var m=moment(d);var t=m.format("dddd [(]M/D[)]");return t},this);var defLink=backAction.link._initialValue;backAction.link=ko.computed(function(){var d=this.viewModel.currentDate();if(!d)return defLink;return defLink+d.toISOString()},this);this.registerHandler({target:this.viewModel.currentAppointment,handler:function(apt){if(!apt)return;var aptId=apt.id(),found=/appointment\/([^\/]+)\/(\-?\d+)/i.exec(window.location),urlId=found&&found[2]|0,urlDate=found&&found[1],curDateStr=getDateWithoutTime(this.viewModel.currentDate()).toISOString();if(!found||urlId!==aptId.toString()||urlDate!==curDateStr){if(urlId==="")this.app.shell.history.replaceState(null,null,"appointment/"+curDateStr+"/"+aptId);else this.app.shell.history.pushState(null,null,"appointment/"+curDateStr+"/"+aptId)}$(window).trigger("layoutUpdate")}.bind(this)});var previousDate=this.viewModel.currentDate();previousDate=previousDate&&previousDate.toISOString();var app=this.app;this.registerHandler({target:this.viewModel.currentDate,handler:function(date){if(!date){this.appointments([]);return}date=new Date(date.toISOString());if(date.toISOString()===previousDate){return}previousDate=date.toISOString();this.isLoading(true);app.model.appointments.getAppointmentsByDate(date).then(function(appointmentsList){if(date.toISOString()!==this.currentDate().toISOString()){return}this.currentID(0);this.appointments(appointmentsList||[]);this.isLoading(false)}.bind(this)).catch(function(err){this.appointments([]);this.isLoading(false);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this))}.bind(this.viewModel)});var ModelVersion=require("../utils/ModelVersion");this.registerHandler({target:this.viewModel.editMode,handler:function(isEdit){this.$activity.toggleClass("in-edit",isEdit);this.$appointmentView.find(".AppointmentCard").toggleClass("in-edit",isEdit);if(this.viewModel.currentID()<=0){return}var version;if(isEdit){version=new ModelVersion(this.viewModel.currentAppointment());this.viewModel.editedVersion(version);this.viewModel.editedAppointment(version.version);var vw=this.viewModel;version.on("push",function(success){if(success){vw.isSaving(true);app.model.appointments.setAppointment(version.version).then(function(savedApt){version.original.model.updateWith(savedApt)}).catch(function(err){app.modals.showError({title:"There was an error saving the data.",error:err&&err.error||err})}).then(function(){vw.isSaving(false)})}})}else{version=this.viewModel.editedVersion();if(version&&version.areDifferent()){version.push({evenIfObsolete:true})}}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var s1=options&&options.route&&options.route.segments[0],s2=options&&options.route&&options.route.segments[1],date,id;if(/^\-?\d+$/.test(s1)){date=new Date;id=s1|0}else{date=getDateWithoutTime(s1);id=s2|0}this.viewModel.currentID(id);this.viewModel.currentDate(date);if(this.requestData.appointment){this.viewModel.editMode(true);this.viewModel.editedAppointment().model.updateWith(this.requestData.appointment)}else{this.viewModel.cancel()}};var Appointment=require("../models/Appointment");function getDateWithoutTime(date){if(!date){date=new Date}else if(!(date instanceof Date)){date=new Date(date)}return new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}function findAppointmentInList(list,id){var found=null,index=-1;list.some(function(apt,i){if(apt.id()===id){found=apt;index=i;return true}});return{item:found,index:index}}var CalendarEvent=require("../models/CalendarEvent"),Booking=require("../models/Booking");function ViewModel(app){this.appointments=ko.observableArray([]);this.currentDate=ko.observable(new Date);this.currentID=ko.observable(0);this.currentIndex=ko.observable(0);this.editMode=ko.observable(false);this.isLoading=ko.observable(false);this.isSaving=ko.observable(false);this.editedVersion=ko.observable(null);this.editedAppointment=ko.observable(new Appointment);var loadingAppointment=new Appointment({id:0,summary:"Loading..."});var newEmptyDateAppointment=function newEmptyDateAppointment(){return new Appointment({id:-1,summary:"There are no appointments on this date",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this);var newFreeAppointment=function newFreeAppointment(){return new Appointment({id:-2,summary:"Free",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this);var newEventAppointment=function newEventAppointment(){return new Appointment({id:-3,summary:"New event...",sourceEvent:new CalendarEvent})};var newBookingAppointment=function newBookingAppointment(){return new Appointment({id:-4,summary:"New booking...",sourceEvent:new CalendarEvent,sourceBooking:new Booking})};this.isNew=ko.computed(function(){return this.currentID()===-3||this.currentID()===-4},this);this.currentAppointment=ko.computed(function(){var id=this.currentID(),apts=this.appointments();switch(id){case-1:return newEmptyDateAppointment();case-2:return newFreeAppointment();case-3:this.editMode(true);return newEventAppointment();case-4:this.editMode(true);return newBookingAppointment();case-5:return loadingAppointment;default:if(id>0){if(!this.isLoading()){var found=findAppointmentInList(apts,id);this.currentIndex(found.index);return found.item}return loadingAppointment}else{if(this.appointments().length===0){setTimeout(function(){this.currentID(-1)}.bind(this),0);this.currentIndex(-1);return newEmptyDateAppointment()}else{setTimeout(function(){this.currentID(this.appointments()[0].id());this.currentIndex(0)}.bind(this),0);return loadingAppointment}}}},this).extend({rateLimit:0});this.goPrevious=function goPrevious(){if(this.editMode())return;var index=this.currentIndex()-1;if(index<0){this.currentID(-5);var m=moment(this.currentDate());if(m.isValid()){this.currentDate(m.subtract(1,"days").toDate())}else{this.currentDate(getDateWithoutTime())}}else{var apt=this.appointments()[index%this.appointments().length];this.currentID(apt.id())}};this.goNext=function goNext(){if(this.editMode())return;var index=this.currentIndex()+1;if(index>=this.appointments().length){this.currentID(-5);var m=moment(this.currentDate());if(m.isValid()){this.currentDate(m.add(1,"days").toDate())}else{this.currentDate(getDateWithoutTime())}}else{var apt=this.appointments()[index%this.appointments().length];this.currentID(apt.id())}};this.edit=function edit(){this.editMode(true)}.bind(this);this.save=function save(){this.editMode(false)}.bind(this);this.cancel=function cancel(){if(this.editedVersion()){this.editedVersion().pull({evenIfNewer:true})}this.editMode(false)}.bind(this);var editFieldOn=function editFieldOn(activity,data){data.appointment=this.currentAppointment().model.toPlainObject(true);app.shell.go(activity,data)};this.pickDateTime=function pickDateTime(){editFieldOn("datetimePicker",{selectedDatetime:null})};this.pickClient=function pickClient(){editFieldOn("clients",{selectClient:true,selectedClient:null})};this.pickService=function pickService(){editFieldOn("services",{selectServices:true,selectedServices:this.currentAppointment().services()})}.bind(this);this.changePrice=function changePrice(){};this.pickLocation=function pickLocation(){editFieldOn("locations",{selectLocation:true,selectedLocation:this.currentAppointment().location()})}.bind(this);var textFieldsHeaders={preNotesToClient:"Notes to client",postNotesToClient:"Notes to client (afterwards)",preNotesToSelf:"Notes to self",postNotesToSelf:"Booking summary"};this.editTextField=function editTextField(field){editFieldOn("textEditor",{request:"textEditor",field:field,title:this.isNew()?"New booking":"Booking",header:textFieldsHeaders[field],text:this.currentAppointment()[field]()})}.bind(this)}},{"../components/Activity":44,"../components/DatePicker":45,"../models/Appointment":49,"../models/Booking":50,"../models/CalendarEvent":52,"../utils/ModelVersion":80,knockout:false,moment:false}],5:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout"),$=require("jquery");var A=Activity.extends(function BookMeButtonActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.Freelancer;this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.$activity,event:"click",selector:"textarea",handler:function(){$(this).select()}});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){if(err&&err.task==="save")return;var msg="Error loading data to build the Button.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.marketplaceProfile.sync();var jobID=state.route.segments[0]|0;this.viewModel.jobTitleID(jobID)};function ViewModel(app){var marketplaceProfile=app.model.marketplaceProfile;this.bookCode=ko.computed(function(){return marketplaceProfile.data.bookCode()});this.jobTitleID=ko.observable(0);this.type=ko.observable("medium");this.isLocked=marketplaceProfile.isLocked;var buttonTemplate="<!-- begin Loconomics book-me-button -->"+'<a style="display:inline-block"><img alt="" style="border:none" /></a>'+"<!-- end Loconomics book-me-button -->";var linkTemplate="<!-- begin Loconomics book-me-button -->"+"<a><span></span></a>"+"<!-- end Loconomics book-me-button -->";this.buttonHtmlCode=ko.pureComputed(function(){if(marketplaceProfile.isLoading()){return"loading..."}else{var type=this.type(),tpl=buttonTemplate;if(type==="link")tpl=linkTemplate;var siteUrl=$("html").attr("data-site-url"),linkUrl=siteUrl+"/book/"+this.bookCode()+"/"+this.jobTitleID()+"/",imgUrl=siteUrl+"/img/extern/book-me-button-"+type+".png";var code=generateButtonCode({tpl:tpl,label:"Click here to book me now (on loconomics.com)",linkUrl:linkUrl,imgUrl:imgUrl});return code}},this);this.copyCode=function(){};this.sendByEmail=function(){}}function generateButtonCode(options){var $btn=$($.parseHTML("<div>"+options.tpl+"</div>"));$btn.find("a").attr("href",options.linkUrl).find("span").text(options.label);$btn.find("img").attr("src",options.imgUrl).attr("alt",options.label);return $btn.html()}},{"../components/Activity":44,knockout:false}],6:[function(require,module,exports){"use strict";var ko=require("knockout");var singleton=null;exports.init=function initClients($activity,app){if(singleton===null)singleton=new BookingConfirmationActivity($activity,app);return singleton};function BookingConfirmationActivity($activity,app){this.accessLevel=app.UserType.LoggedUser;this.$activity=$activity;this.app=app;this.dataView=new ViewModel;ko.applyBindings(this.dataView,$activity.get(0))}BookingConfirmationActivity.prototype.show=function show(options){if(options&&options.booking)this.dataView.booking(options.booking)};function ViewModel(){this.booking=ko.observable(null)}},{knockout:false}],7:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),ko=require("knockout");require("../components/DatePicker");var Activity=require("../components/Activity");var A=Activity.extends(function CalendarActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Calendar");this.$datepicker=this.$activity.find("#calendarDatePicker");this.$dailyView=this.$activity.find("#calendarDailyView");this.$dateHeader=this.$activity.find("#calendarDateHeader");this.$dateTitle=this.$dateHeader.children(".CalendarDateHeader-date");this.$chooseNew=$("#calendarChooseNew");this.$datepicker.show().datepicker();this.registerHandler({target:this.viewModel.currentDate,handler:function(date){$(window).trigger("layoutUpdate");if(date){var mdate=moment(date);if(mdate.isValid()){var isoDate=mdate.toISOString();this.$datepicker.removeClass("is-visible");if(this.$datepicker.datepicker("getValue").toISOString()!==isoDate)this.$datepicker.datepicker("setValue",date,true);this.app.shell.history.pushState(null,null,"calendar/"+isoDate);return}}this.viewModel.currentDate(getDateWithoutTime())}.bind(this)});this.registerHandler({target:this.$dailyView,event:"swipeleft swiperight",handler:function(e){e.preventDefault();var dir=e.type==="swipeleft"?"next":"prev";$(document).trigger("touchend");this.$datepicker.datepicker("moveValue",dir,"date")}.bind(this)});this.registerHandler({target:this.$dateHeader,event:"tap",selector:".CalendarDateHeader-switch",handler:function(e){switch(e.currentTarget.getAttribute("href")){case"#prev":this.$datepicker.datepicker("moveValue","prev","date");break;case"#next":this.$datepicker.datepicker("moveValue","next","date");break;default:return}e.preventDefault();e.stopPropagation()}.bind(this)});this.registerHandler({target:this.$dateTitle,event:"tap",handler:function(e){this.$datepicker.toggleClass("is-visible");e.preventDefault();e.stopPropagation()}.bind(this)});this.registerHandler({target:this.$datepicker,event:"changeDate",handler:function(e){if(e.viewMode==="days"){this.viewModel.currentDate(getDateWithoutTime(e.date))}}.bind(this)});this.viewModel.currentDate(getDateWithoutTime())});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var sdate=options.route&&options.route.segments&&options.route.segments[0],date;if(sdate){var mdate=moment(sdate);date=mdate.isValid()?getDateWithoutTime(mdate.toDate()):null}if(!date)date=getDateWithoutTime();this.viewModel.currentDate(date)};function getDateWithoutTime(date){date=date||new Date;return new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}var Appointment=require("../models/Appointment"),TimeSlotViewModel=require("../viewmodels/TimeSlot");function ViewModel(app){this.currentDate=ko.observable(getDateWithoutTime());var fullDayFree=[Appointment.newFreeSlot({date:this.currentDate()})];this.slotsSource=ko.observable(fullDayFree);this.slots=ko.computed(function(){var slots=this.slotsSource();return app.model.appointments.fillWithFreeSlots(slots).map(TimeSlotViewModel.fromAppointment)},this);this.isLoading=ko.observable(false);var previousDate=this.currentDate().toISOString();this.currentDate.subscribe(function(date){date=new Date(Date.parse(date.toISOString()));if(date.toISOString()===previousDate){return}previousDate=date.toISOString();this.isLoading(true);app.model.appointments.getAppointmentsByDate(date).then(function(appointmentsList){if(date.toISOString()!==this.currentDate().toISOString()){return}if(appointmentsList&&appointmentsList.length){this.slotsSource(appointmentsList);this.isLoading(false)}else{this.slotsSource(fullDayFree);this.isLoading(false)}}.bind(this)).catch(function(err){this.slotsSource(fullDayFree);this.isLoading(false);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this))}.bind(this))}},{"../components/Activity":44,"../components/DatePicker":45,"../models/Appointment":49,"../viewmodels/TimeSlot":122,knockout:false,moment:false}],8:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),ko=require("knockout");var A=Activity.extends(function CalendarSyncingActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.Freelancer;this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.$activity.find("#calendarSync-icalExportUrl"),event:"click",handler:function(){$(this).select()}});this.registerHandler({target:this.app.model.calendarSyncing,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving calendar syncing settings.":"Error loading calendar syncing settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.calendarSyncing.sync();this.viewModel.discard()};function ViewModel(app){var calendarSyncing=app.model.calendarSyncing;var syncVersion=calendarSyncing.newVersion();syncVersion.isObsolete.subscribe(function(itIs){if(itIs){syncVersion.pull({evenIfNewer:true})}});this.sync=syncVersion.version;this.isLocked=ko.pureComputed(function(){return this.isLocked()||this.isReseting()
},calendarSyncing);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},calendarSyncing);this.resetText=ko.pureComputed(function(){return this.isReseting()?"reseting...":"Reset Private URL"},calendarSyncing);this.discard=function discard(){syncVersion.pull({evenIfNewer:true})};this.save=function save(){syncVersion.push({evenIfObsolete:true})};this.reset=function reset(){calendarSyncing.resetExportUrl()}}},{"../components/Activity":44,knockout:false}],9:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function ClientEditionActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("clients")});exports.init=A.init;var ko=require("knockout");var Client=require("../models/Client");function ViewModel(){this.client=ko.observable(new Client);this.header=ko.observable("Edit Location");this.save=function(){};this.cancel=function(){}}},{"../components/Activity":44,"../models/Client":54,knockout:false}],10:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function ClientsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Freelancer;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Clients");this.$index=this.$activity.find("#clientsIndex");this.$listView=this.$activity.find("#clientsListView");this.viewModel.clients(require("../testdata/clients").clients);this.registerHandler({target:this.viewModel.isSelectionMode,handler:function(itIs){this.viewModel.headerText(itIs?"Select a client":"")}.bind(this)});this.registerHandler({target:this.viewModel.selectedClient,handler:function(theSelectedClient){if(this.requestData&&this.requestData.selectClient===true&&theSelectedClient){this.requestData.selectedClient=theSelectedClient;this.app.shell.goBack(this.requestData);this.requestData=null}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.viewModel.isSelectionMode(state.selectClient===true)};function ViewModel(){this.headerText=ko.observable("");this.isSelectionMode=ko.observable(false);this.clients=ko.observableArray([]);this.searchText=ko.observable("");this.getFilteredList=function getFilteredList(){var s=(this.searchText()||"").toLowerCase();return this.clients().filter(function(client){var n=client&&client.fullName()||"";n=n.toLowerCase();return n.indexOf(s)>-1})};this.filteredClients=ko.computed(function(){return this.getFilteredList()},this);this.groupedClients=ko.computed(function(){var clients=this.filteredClients().sort(function(clientA,clientB){return clientA.firstName()>clientB.firstName()});var groups=[],latestGroup=null,latestLetter=null;clients.forEach(function(client){var letter=(client.firstName()[0]||"").toUpperCase();if(letter!==latestLetter){latestGroup={letter:letter,clients:[client]};groups.push(latestGroup);latestLetter=letter}else{latestGroup.clients.push(client)}});return groups},this);this.selectedClient=ko.observable(null);this.selectClient=function(selectedClient){this.selectedClient(selectedClient)}.bind(this)}},{"../components/Activity":44,"../testdata/clients":74,knockout:false}],11:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout");var A=Activity.extends(function CmsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar("Client management");var clients=ko.observableArray(require("../testdata/clients").clients);this.viewModel.clientsCount(clients().length);this.registerHandler({target:clients,handler:function(){this.viewModel.clientsCount(clients().length)}.bind(this)})});exports.init=A.init;function ViewModel(){this.clientsCount=ko.observable()}},{"../components/Activity":44,"../testdata/clients":74,knockout:false}],12:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function ContactFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us")});exports.init=A.init;var ko=require("knockout");function ViewModel(){this.message=ko.observable("");this.wasSent=ko.observable(false);var updateWasSent=function(){this.wasSent(false)}.bind(this);this.message.subscribe(updateWasSent);this.send=function send(){this.message("");this.wasSent(true)}.bind(this)}},{"../components/Activity":44,knockout:false}],13:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function ContactInfoActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Owner information");this.registerHandler({target:this.viewModel.profile.onboardingStep,handler:function(step){if(step){this.navBar.leftAction().text("");this.viewModel.headerText("How can we reach you?");this.viewModel.buttonText("Save and continue")}else{this.navBar.leftAction().text("Account");this.viewModel.headerText("Contact information");this.viewModel.buttonText("Save")}}.bind(this)});this.registerHandler({target:this.app.model.userProfile,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving contact data.":"Error loading contact data.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)});this.registerHandler({target:this.app.model.homeAddress,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving address details.":"Error loading address details.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.app.model.userProfile.sync();this.app.model.homeAddress.sync()};var ko=require("knockout");function ViewModel(app){this.headerText=ko.observable("Contact information");this.buttonText=ko.observable("Save");var userProfile=app.model.userProfile;var profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){if(itIs){profileVersion.pull({evenIfNewer:true})}});this.profile=profileVersion.version;this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var birthMonth=this.profile.birthMonth();return birthMonth?this.months()[birthMonth-1]:null},write:function(month){this.profile.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;iday<=31;iday++){this.monthDays.push(iday)}var homeAddress=app.model.homeAddress;var homeAddressVersion=homeAddress.newVersion();homeAddressVersion.isObsolete.subscribe(function(itIs){if(itIs){homeAddressVersion.pull({evenIfNewer:true})}});this.address=homeAddressVersion.version;this.isLocked=ko.computed(function(){return userProfile.isLocked()||homeAddress.isLocked()},this);this.isLoading=ko.computed(function(){return userProfile.isLoading()||homeAddress.isLoading()},this);this.isSaving=ko.computed(function(){return userProfile.isSaving()||homeAddress.isSaving()},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.discard=function discard(){profileVersion.pull({evenIfNewer:true});homeAddressVersion.pull({evenIfNewer:true})}.bind(this);this.save=function save(){profileVersion.push({evenIfObsolete:true});homeAddressVersion.push({evenIfObsolete:true})}.bind(this)}},{"../components/Activity":44,knockout:false}],14:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function ConversationActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Inbox");setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(state&&state.route&&state.route.segments){this.viewModel.conversationID(parseInt(state.route.segments[0],10)||0)}};var MailFolder=require("../models/MailFolder");var ko=require("knockout");function ViewModel(){this.inbox=new MailFolder({topNumber:20});this.conversationID=ko.observable(null);this.conversation=ko.pureComputed(function(){var conID=this.conversationID();return this.inbox.messages().filter(function(v){return v&&v.id()===conID})},this);this.subject=ko.pureComputed(function(){var m=this.conversation()[0];return m?m.subject():"Conversation w/o subject"},this)}function setSomeTestingData(viewModel){viewModel.inbox.messages(require("../testdata/messages").messages)}},{"../components/Activity":44,"../models/MailFolder":60,"../testdata/messages":75,knockout:false}],15:[function(require,module,exports){"use strict";var moment=require("moment"),ko=require("knockout"),Time=require("../utils/Time");require("../components/DatePicker");var Activity=require("../components/Activity");var A=Activity.extends(function DatetimePickerActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("");this.$datePicker=this.$activity.find("#datetimePickerDatePicker");this.$timePicker=this.$activity.find("#datetimePickerTimePicker");this.$datePicker.show().datepicker();this.registerHandler({target:this.$datePicker,event:"changeDate",handler:function(e){if(e.viewMode==="days"){this.viewModel.selectedDate(e.date)}}.bind(this)});this.registerHandler({target:this.viewModel.selectedDate,handler:function(date){this.bindDateData(date)}.bind(this)});this.registerHandler({target:this.viewModel.selectedDatetime,handler:function(datetime){if(this.requestData){this.requestData.selectedDatetime=datetime;this.app.shell.goBack(this.requestData);this.requestData=null}}.bind(this)});this.viewModel.slotsData=require("../testdata/timeSlots").timeSlots;this.bindDateData(new Date)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.headerText("Select a start time")};A.prototype.bindDateData=function bindDateData(date){var sdate=moment(date).format("YYYY-MM-DD");var slotsData=this.viewModel.slotsData;if(slotsData.hasOwnProperty(sdate)){this.viewModel.slots(slotsData[sdate])}else{this.viewModel.slots(slotsData["default"])}};function ViewModel(){this.headerText=ko.observable("Select a time");this.selectedDate=ko.observable(new Date);this.slotsData={};this.slots=ko.observableArray([]);this.groupedSlots=ko.computed(function(){var datePart=this.slots()&&this.slots()[0]||new Date;var groups=[{group:"Morning",slots:[],starts:new Time(datePart,0,0),ends:new Time(datePart,12,0)},{group:"Afternoon",slots:[],starts:new Time(datePart,12,0),ends:new Time(datePart,17,0)},{group:"Evening",slots:[],starts:new Time(datePart,17,0),ends:new Time(datePart,24,0)}];var slots=this.slots().sort();slots.forEach(function(slot){groups.forEach(function(group){if(slot>=group.starts&&slot<group.ends){group.slots.push(slot)}})});return groups},this);this.selectedDatetime=ko.observable(null);this.selectDatetime=function(selectedDatetime){this.selectedDatetime(selectedDatetime)}.bind(this)}},{"../components/Activity":44,"../components/DatePicker":45,"../testdata/timeSlots":76,"../utils/Time":83,knockout:false,moment:false}],16:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function FaqsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us");setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("")};var ko=require("knockout");function ViewModel(){this.faqs=ko.observableArray([]);this.searchText=ko.observable("");this.filteredFaqs=ko.pureComputed(function(){var s=this.searchText().toLowerCase();return this.faqs().filter(function(v){var n=v&&v.title()||"";n+=v&&v.description()||"";n=n.toLowerCase();return n.indexOf(s)>-1})},this)}var Model=require("../models/Model");function Faq(values){Model(this);this.model.defProperties({id:0,title:"",description:""},values)}function setSomeTestingData(viewModel){var testdata=[new Faq({id:1,title:"How do I set up a marketplace profile?",description:"Description about how I set up a marketplace profile"}),new Faq({id:2,title:"Another faq",description:"Another description"})];viewModel.faqs(testdata)}},{"../components/Activity":44,"../models/Model":63,knockout:false}],17:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function FeedbackActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar("Talk to us")});exports.init=A.init},{"../components/Activity":44}],18:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function FeedbackFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us")});exports.init=A.init;var ko=require("knockout");function ViewModel(){this.message=ko.observable("");this.becomeCollaborator=ko.observable(false);this.wasSent=ko.observable(false);var updateWasSent=function(){this.wasSent(false)}.bind(this);this.message.subscribe(updateWasSent);this.becomeCollaborator.subscribe(updateWasSent);this.send=function send(){this.message("");this.becomeCollaborator(false);this.wasSent(true)}.bind(this)}},{"../components/Activity":44,knockout:false}],19:[function(require,module,exports){"use strict";var ko=require("knockout");var Activity=require("../components/Activity");var A=Activity.extends(function HomeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.$nextBooking=this.$activity.find("#homeNextBooking");this.$upcomingBookings=this.$activity.find("#homeUpcomingBookings");this.$inbox=this.$activity.find("#homeInbox");this.$performance=this.$activity.find("#homePerformance");this.$getMore=this.$activity.find("#homeGetMore");setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var v=this.viewModel,appModel=this.app.model;appModel.bookings.getUpcomingBookings().then(function(upcoming){if(upcoming.nextBookingID){var previousID=v.nextBooking()&&v.nextBooking().sourceBooking().bookingID();if(upcoming.nextBookingID!==previousID){v.isLoadingNextBooking(true);appModel.appointments.getAppointment({bookingID:upcoming.nextBookingID}).then(function(apt){v.nextBooking(apt);v.isLoadingNextBooking(false)}).catch(function(){v.isLoadingNextBooking(false)})}}else{v.nextBooking(null)}v.upcomingBookings.today.quantity(upcoming.today.quantity);v.upcomingBookings.today.time(upcoming.today.time&&new Date(upcoming.today.time));v.upcomingBookings.tomorrow.quantity(upcoming.tomorrow.quantity);v.upcomingBookings.tomorrow.time(upcoming.tomorrow.time&&new Date(upcoming.tomorrow.time));v.upcomingBookings.nextWeek.quantity(upcoming.nextWeek.quantity);v.upcomingBookings.nextWeek.time(upcoming.nextWeek.time&&new Date(upcoming.nextWeek.time))})};var UpcomingBookingsSummary=require("../models/UpcomingBookingsSummary"),MailFolder=require("../models/MailFolder"),PerformanceSummary=require("../models/PerformanceSummary"),GetMore=require("../models/GetMore");function ViewModel(){this.upcomingBookings=new UpcomingBookingsSummary;this.nextBooking=ko.observable(null);this.isLoadingNextBooking=ko.observable(false);this.inbox=new MailFolder({topNumber:4});this.performance=new PerformanceSummary;this.getMore=new GetMore}function setSomeTestingData(viewModel){viewModel.inbox.messages(require("../testdata/messages").messages);viewModel.performance.earnings.currentAmount(2400);viewModel.performance.earnings.nextAmount(6200.54);viewModel.performance.timeBooked.percent(.93);viewModel.getMore.model.updateWith({availability:true,payments:true,profile:true,coop:true})}},{"../components/Activity":44,"../models/GetMore":55,"../models/MailFolder":60,"../models/PerformanceSummary":64,"../models/UpcomingBookingsSummary":71,"../testdata/messages":75,knockout:false}],20:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout");var A=Activity.extends(function InboxActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar("Inbox");setSomeTestingData(this.viewModel)});exports.init=A.init;var MailFolder=require("../models/MailFolder");function ViewModel(){this.inbox=new MailFolder({topNumber:20});this.searchText=ko.observable("")}function setSomeTestingData(dataView){dataView.inbox.messages(require("../testdata/messages").messages)}},{"../components/Activity":44,"../models/MailFolder":60,"../testdata/messages":75,knockout:false}],21:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function IndexActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(!this.app.model.user().isAnonymous()){this.app.goDashboard()}}},{"../components/Activity":44}],22:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout");var A=Activity.extends(function JobtitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.addresses(list)}.bind(this)).catch(function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this)).catch(function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.viewModel.addresses([]);this.viewModel.jobTitleName("Job Title")}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{};var jobID=params[0]|0;this.viewModel.jobTitleID(jobID)};function ViewModel(app){this.jobTitleID=ko.observable(0);this.jobTitleName=ko.observable("Job Title");this.addresses=ko.observable([]);this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()},this);this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";if(count===1)return one;else return count+more},this)}},{"../components/Activity":44,knockout:false}],23:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function LearnMoreActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);if(options&&options.route&&options.route.segments&&options.route.segments.length){this.viewModel.profile(options.route.segments[0])}};function ViewModel(){this.profile=ko.observable("customer")}},{"../components/Activity":44,knockout:false}],24:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function LoginActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Anonymous;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Log in");this.registerHandler({target:this.viewModel.isLogingIn,handler:function(v){if(v===true){var $btn=this.$activity.find('[type="submit"]');$btn.button("loading");this.viewModel.loginError("");var ended=function ended(){this.viewModel.isLogingIn(false);$btn.button("reset")}.bind(this);if(this.viewModel.username.error()||this.viewModel.password.error()){this.viewModel.loginError("Review your data");ended();return}this.app.model.login(this.viewModel.username(),this.viewModel.password()).then(function(){this.viewModel.loginError("");ended();this.viewModel.username("");this.viewModel.password("");this.app.goDashboard()}.bind(this)).catch(function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";this.viewModel.loginError(msg);ended()}.bind(this))}}.bind(this)});this.registerHandler({target:this.viewModel.loginError,handler:function(err){var input=this.$activity.find(":input").get(0);if(err)input.focus();else input.blur()}.bind(this)})});exports.init=A.init;var FormCredentials=require("../viewmodels/FormCredentials");function ViewModel(){var credentials=new FormCredentials;this.username=credentials.username;this.password=credentials.password;this.loginError=ko.observable("");this.isLogingIn=ko.observable(false);this.performLogin=function performLogin(){this.isLogingIn(true)}.bind(this)}},{"../components/Activity":44,"../viewmodels/FormCredentials":119,knockout:false}],25:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function LogoutActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.logout().then(function(){var newAnon=this.app.model.user().constructor.newAnonymous();this.app.model.user().model.updateWith(newAnon);this.app.shell.go("/")}.bind(this))}},{"../components/Activity":44}],26:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function OnboardingCompleteActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar(null)});exports.init=A.init},{"../components/Activity":44}],27:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function OnboardingHomeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSectionNavBar(null)});exports.init=A.init},{"../components/Activity":44}],28:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function OnboardingPositionsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Freelancer;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Job Titles");setSomeTestingData(this.viewModel)});exports.init=A.init;function ViewModel(){this.positions=ko.observableArray([])}var Position=require("../models/Position");function setSomeTestingData(viewModel){viewModel.positions.push(new Position({positionSingular:"Massage Therapist"}));viewModel.positions.push(new Position({positionSingular:"Housekeeper"}))}},{"../components/Activity":44,"../models/Position":65,knockout:false}],29:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var A=Activity.extends(function OwnerInfoActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Account")});exports.init=A.init},{"../components/Activity":44}],30:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout"),_=require("lodash");var A=Activity.extends(function PricingActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Frelancer;this.navBar=Activity.createSubsectionNavBar("Job title");this.viewModel=new ViewModel;this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.navBar.leftAction().text(jobTitle.singularName());return null}.bind(this)).then(function(pricing){console.log("Job Title Pricing/Services load not supported still",pricing)}).catch(function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.viewModel.pricing([]);this.navBar.leftAction().text("Job Title")}}.bind(this)});this.registerHandler({target:this.viewModel.isSelectionMode,handler:function(itIs){if(this.requestData&&this.requestData.selectPricing===true&&itIs===false){this.requestData.selectedPricing=this.viewModel.selectedPricing();this.app.shell.goBack(this.requestData);this.requestData={}}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.jobTitleID(0);var params=options&&options.route&&options.route.segments||[];this.viewModel.jobTitleID(params[0]|0);if(this.requestData.selectPricing===true){this.viewModel.isSelectionMode(true)}};function ViewModel(){this.pricing=ko.observableArray([]);this.jobTitleID=ko.observable(0);this.isLoading=ko.observable(false);this.isLocked=this.isLoading;this.isSelectionMode=ko.observable(false);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSelectionMode()?"Save and continue":"Save"},this);this.groupedPricing=ko.computed(function(){var pricing=this.pricing();var isSelection=this.isSelectionMode();var groupNamePrefix=isSelection?"Select ":"";var groups=_.groupBy(pricing,function(pricingItem){return pricingItem.pricingTypeID()});var groupsList=Object.keys(groups).map(function(key){return{group:groupNamePrefix+key,pricing:groupsList[key]}});return groupsList},this);this.selectedPricing=ko.observableArray([]);this.togglePricingSelection=function(pricing){var inIndex=-1,isSelected=this.selectedPricing().some(function(selectedPricing,index){if(selectedPricing===pricing){inIndex=index;return true}});pricing.isSelected(!isSelected);if(isSelected)this.selectedPricing.splice(inIndex,1);else this.selectedPricing.push(pricing)}.bind(this);this.endSelection=function(){this.isSelectionMode(false)}.bind(this)}},{"../components/Activity":44,knockout:false,lodash:false}],31:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout");var A=Activity.extends(function PrivacySettingsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.LoggedUser;this.navBar=Activity.createSubsectionNavBar("Account");this.registerHandler({target:this.app.model.privacySettings,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving privacy settings.":"Error loading privacy settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.privacySettings.sync();this.viewModel.discard()};function ViewModel(app){var privacySettings=app.model.privacySettings;var settingsVersion=privacySettings.newVersion();settingsVersion.isObsolete.subscribe(function(itIs){if(itIs){settingsVersion.pull({evenIfNewer:true})}});this.settings=settingsVersion.version;this.isLocked=privacySettings.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},privacySettings);this.discard=function discard(){settingsVersion.pull({evenIfNewer:true})}.bind(this);this.save=function save(){settingsVersion.push({evenIfObsolete:true})}.bind(this)}},{"../components/Activity":44,knockout:false}],32:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile");var A=Activity.extends(function SchedulingActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new UserJobProfileViewModel(this.app);this.navBar=Activity.createSectionNavBar("Scheduling")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.sync()}},{"../components/Activity":44,"../viewmodels/UserJobProfile":123}],33:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout");var moment=require("moment");var A=Activity.extends(function SchedulingPreferencesActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.Freelancer;this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.app.model.schedulingPreferences,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving scheduling preferences.":"Error loading scheduling preferences.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.schedulingPreferences.sync();this.viewModel.discard()};function ViewModel(app){var schedulingPreferences=app.model.schedulingPreferences;var prefsVersion=schedulingPreferences.newVersion();prefsVersion.isObsolete.subscribe(function(itIs){if(itIs){prefsVersion.pull({evenIfNewer:true})}});this.prefs=prefsVersion.version;this.isLocked=schedulingPreferences.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},schedulingPreferences);this.discard=function discard(){prefsVersion.pull({evenIfNewer:true})}.bind(this);this.save=function save(){prefsVersion.push({evenIfObsolete:true})}.bind(this);this.incrementsExample=ko.pureComputed(function(){var str="e.g. ",incSize=this.incrementsSizeInMinutes(),m=moment({hour:10,minute:0}),hours=[m.format("HH:mm")];for(var i=1;i<4;i++){hours.push(m.add(incSize,"minutes").format("HH:mm"))}str+=hours.join(", ");return str},this.prefs)}},{"../components/Activity":44,knockout:false,moment:false}],34:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function ServiceAddressesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Freelancer;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title");this.$listView=this.$activity.find("#addressesListView");this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.navBar.leftAction().text(jobTitle.singularName());
return this.app.model.serviceAddresses.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.addresses(list)}.bind(this)).catch(function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.viewModel.addresses([]);this.navBar.leftAction().text("Job Title")}}.bind(this)});this.registerHandler({target:this.viewModel.isSelectionMode,handler:function(itIs){this.viewModel.headerText(itIs?"Select or add a service location":"Locations");this.navBar.leftAction().text(itIs?"Booking":"Scheduling");this.navBar.title("")}.bind(this)});this.registerHandler({target:this.viewModel.isSelectionMode,handler:function(itIs){if(this.requestInfo&&this.requestInfo.selectAddress===true&&itIs===false){this.requestInfo.selectedAddress=this.viewModel.selectedAddress();this.app.shell.goBack(this.requestInfo);this.requestInfo=null}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.jobTitleID(0);if(options.selectAddress===true){this.viewModel.isSelectionMode(true);this.viewModel.selectedAddress(options.selectedAddress)}var params=options&&options.route&&options.route.segments;var jobTitleID=params[0]|0;this.viewModel.jobTitleID(jobTitleID)};function ViewModel(app){this.headerText=ko.observable("Locations");this.jobTitleID=ko.observable(0);this.addresses=ko.observableArray([]);this.isLoading=app.model.serviceAddresses.state.isLoading;this.isSelectionMode=ko.observable(false);this.selectedAddress=ko.observable(null);this.selectAddress=function(selectedAddress){if(this.isSelectionMode()===true){this.selectedAddress(selectedAddress);this.isSelectionMode(false)}else{app.shell.go("addressEditor/service/"+this.jobTitleID()+"/"+selectedAddress.addressID())}}.bind(this)}},{"../components/Activity":44,knockout:false}],35:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity");var A=Activity.extends(function SignupActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.Anonymous;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.registerHandler({target:this.viewModel.isSigningUp,handler:function(v){if(v===true){var $btn=this.$activity.find('[type="submit"]');$btn.button("loading");this.viewModel.signupError("");var ended=function ended(){this.viewModel.isSigningUp(false);$btn.button("reset")}.bind(this);if(this.viewModel.username.error()||this.viewModel.password.error()){this.viewModel.signupError("Review your data");ended();return}this.app.model.signup(this.viewModel.username(),this.viewModel.password(),this.viewModel.profile()).then(function(){this.viewModel.signupError("");ended();this.viewModel.username("");this.viewModel.password("");this.app.goDashboard()}.bind(this)).catch(function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";this.viewModel.signupError(msg);ended()}.bind(this))}}.bind(this)});this.registerHandler({target:this.viewModel.signupError,handler:function(err){var input=this.$activity.find(":input").get(0);if(err)input.focus();else input.blur()}})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);if(options&&options.route&&options.route.segments&&options.route.segments.length){this.viewModel.profile(options.route.segments[0])}};var FormCredentials=require("../viewmodels/FormCredentials");function ViewModel(){var credentials=new FormCredentials;this.username=credentials.username;this.password=credentials.password;this.signupError=ko.observable("");this.isSigningUp=ko.observable(false);this.performSignup=function performSignup(){this.isSigningUp(true)}.bind(this);this.profile=ko.observable("customer")}},{"../components/Activity":44,"../viewmodels/FormCredentials":119,knockout:false}],36:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter,Activity=require("../components/Activity");var A=Activity.extends(function TextEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.LoggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("");this.$textarea=this.$activity.find("textarea");this.textarea=this.$textarea.get(0);this.registerHandler({target:this.viewModel,event:"saved",handler:function(){if(this.requestInfo){this.requestInfo.text=this.viewModel.text()}this.app.shell.goBack(this.requestInfo)}.bind(this)});this.registerHandler({target:this.viewModel,event:"cancel",handler:function(){this.app.shell.goBack()}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.navBar.leftAction().text(options.title||"");this.viewModel.headerText(options.header);this.viewModel.text(options.text);if(options.rowsNumber)this.viewModel.rowsNumber(options.rowsNumber);this.textarea.focus();this.$textarea.click()};function ViewModel(){this.headerText=ko.observable("Text");this.text=ko.observable("");this.rowsNumber=ko.observable(2);this.cancel=function cancel(){this.emit("cancel")};this.save=function save(){this.emit("saved")}}ViewModel._inherits(EventEmitter)},{"../components/Activity":44,events:false,knockout:false}],37:[function(require,module,exports){"use strict";var Activity=require("../components/Activity");var ko=require("knockout");var A=Activity.extends(function WeeklyScheduleActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.Freelancer;this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.app.model.simplifiedWeeklySchedule,event:"error",handler:function(err){var msg=err.task==="save"?"Error saving your weekly schedule.":"Error loading your weekly schedule.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.simplifiedWeeklySchedule.sync();this.viewModel.discard()};function ViewModel(app){var simplifiedWeeklySchedule=app.model.simplifiedWeeklySchedule;var scheduleVersion=simplifiedWeeklySchedule.newVersion();scheduleVersion.isObsolete.subscribe(function(itIs){if(itIs){scheduleVersion.pull({evenIfNewer:true})}});this.schedule=scheduleVersion.version;this.isLocked=simplifiedWeeklySchedule.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},simplifiedWeeklySchedule);this.discard=function discard(){scheduleVersion.pull({evenIfNewer:true})};this.save=function save(){scheduleVersion.push({evenIfObsolete:true})}}},{"../components/Activity":44,knockout:false}],38:[function(require,module,exports){"use strict";var ko=require("knockout"),propTools=require("./utils/jsPropertiesTools"),getObservable=require("./utils/getObservable");exports.registerAll=function(){ko.components.register("app-navbar-action",{template:{element:"navbar-action-template"},viewModel:function(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}});ko.components.register("app-unlabeled-input",{template:{element:"unlabeled-input-template"},viewModel:function(params){this.value=getObservable(params.value);this.placeholder=getObservable(params.placeholder);this.disable=getObservable(params.disable);var type=getObservable(params.type);this.type=ko.computed(function(){return type()||"text"},this)}});ko.components.register("app-feedback-entry",{template:{element:"feedback-entry-template"},viewModel:function(params){this.section=getObservable(params.section||"");this.url=ko.pureComputed(function(){return"/feedback/"+this.section()},this)}});ko.components.register("app-time-slot-tile",{template:{element:"time-slot-tile-template"},viewModel:require("./viewmodels/TimeSlot")})}},{"./utils/getObservable":90,"./utils/jsPropertiesTools":93,"./viewmodels/TimeSlot":122,knockout:false}],39:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),NavBar=require("./viewmodels/NavBar"),NavAction=require("./viewmodels/NavAction");exports.extends=function(app){function adjustUserBar(){var user=app.model.user();if(user.isAnonymous()){app.navBar().rightAction(NavAction.menuOut)}}app.navBar=ko.observable(null);var refreshNav=function refreshNav(){$(".AppNav").trigger("contentChange")};var autoRefreshNav=function autoRefreshNav(action){if(action){action.text.subscribe(refreshNav);action.isTitle.subscribe(refreshNav);action.icon.subscribe(refreshNav);action.isMenu.subscribe(refreshNav)}};app.updateAppNav=function updateAppNav(activity){if("navBar"in activity){app.navBar(activity.navBar)}else{app.navBar(new NavBar)}adjustUserBar();refreshNav();autoRefreshNav(app.navBar().leftAction());autoRefreshNav(app.navBar().rightAction())};app.updateMenu=function updateMenu(name){var $menu=$(".App-menus .navbar-collapse");$menu.find("li").removeClass("active");$menu.find(".go-"+name).closest("li").addClass("active");$menu.filter(":visible").collapse("hide")}}},{"./viewmodels/NavAction":120,"./viewmodels/NavBar":121,knockout:false}],40:[function(require,module,exports){"use strict";module.exports={calendar:require("./activities/calendar"),datetimePicker:require("./activities/datetimePicker"),clients:require("./activities/clients"),pricing:require("./activities/pricing"),serviceAddresses:require("./activities/serviceAddresses"),textEditor:require("./activities/textEditor"),home:require("./activities/home"),appointment:require("./activities/appointment"),bookingConfirmation:require("./activities/bookingConfirmation"),index:require("./activities/index"),login:require("./activities/login"),logout:require("./activities/logout"),learnMore:require("./activities/learnMore"),signup:require("./activities/signup"),contactInfo:require("./activities/contactInfo"),onboardingPositions:require("./activities/onboardingPositions"),onboardingHome:require("./activities/onboardingHome"),addressEditor:require("./activities/addressEditor"),onboardingComplete:require("./activities/onboardingComplete"),account:require("./activities/account"),inbox:require("./activities/inbox"),conversation:require("./activities/conversation"),scheduling:require("./activities/scheduling"),jobtitles:require("./activities/jobtitles"),feedback:require("./activities/feedback"),faqs:require("./activities/faqs"),feedbackForm:require("./activities/feedbackForm"),contactForm:require("./activities/contactForm"),cms:require("./activities/cms"),clientEdition:require("./activities/clientEdition"),schedulingPreferences:require("./activities/schedulingPreferences"),calendarSyncing:require("./activities/calendarSyncing"),weeklySchedule:require("./activities/weeklySchedule"),bookMeButton:require("./activities/bookMeButton"),ownerInfo:require("./activities/ownerInfo"),privacySettings:require("./activities/privacySettings")}},{"./activities/account":2,"./activities/addressEditor":3,"./activities/appointment":4,"./activities/bookMeButton":5,"./activities/bookingConfirmation":6,"./activities/calendar":7,"./activities/calendarSyncing":8,"./activities/clientEdition":9,"./activities/clients":10,"./activities/cms":11,"./activities/contactForm":12,"./activities/contactInfo":13,"./activities/conversation":14,"./activities/datetimePicker":15,"./activities/faqs":16,"./activities/feedback":17,"./activities/feedbackForm":18,"./activities/home":19,"./activities/inbox":20,"./activities/index":21,"./activities/jobtitles":22,"./activities/learnMore":23,"./activities/login":24,"./activities/logout":25,"./activities/onboardingComplete":26,"./activities/onboardingHome":27,"./activities/onboardingPositions":28,"./activities/ownerInfo":29,"./activities/pricing":30,"./activities/privacySettings":31,"./activities/scheduling":32,"./activities/schedulingPreferences":33,"./activities/serviceAddresses":34,"./activities/signup":35,"./activities/textEditor":36,"./activities/weeklySchedule":37}],41:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery-mobile");require("./utils/jquery.multiline");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits");require("./utils/Function.prototype._delayed");require("es6-promise").polyfill();var layoutUpdateEvent=require("layoutUpdateEvent");var AppModel=require("./viewmodels/AppModel");require("./locales/en-US-LC");function preBootstrapWorkarounds(){function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}$(document).on("click.bs.collapse.data-api.workaround",'[data-toggle="collapse"]',function(){var $t=$(this),$target=getTargetFromTrigger($t),data=$target&&$target.data("bs.collapse");if(data){data.$trigger=$t}})}var app={shell:require("./app.shell"),model:new AppModel,activities:require("./app.activities"),modals:require("./app.modals"),goDashboard:function goDashboard(){if(goDashboard._going===true){return}else{setTimeout(function(){goDashboard._going=true;var onboarding=this.model.user().onboardingStep();if(onboarding){this.shell.go("onboardingHome/"+onboarding)}else{this.shell.go("home")}setTimeout(function(){goDashboard._going=false},1)}.bind(this),1)}}};require("./app-navbar").extends(app);require("./app-components").registerAll();app.getActivity=function getActivity(name){var activity=this.activities[name];if(activity){var $act=this.shell.items.find(name);if($act&&$act.length)return activity.init($act,this)}return null};app.getActivityControllerByRoute=function getActivityControllerByRoute(route){var actName=route.name||this.shell.indexName;return this.getActivity(actName)};app.shell.accessControl=require("./utils/accessControl")(app);app.UserType=app.model.user().constructor.UserType;var appInit=function appInit(){layoutUpdateEvent.layoutUpdateEvent+=" orientationchange";layoutUpdateEvent.on();var trigLayout=function trigLayout(){$(window).trigger("layoutUpdate")};window.addEventListener("native.keyboardshow",trigLayout);window.addEventListener("native.keyboardhide",trigLayout);if(window.StatusBar){window.StatusBar.overlaysWebView(false)}var iOsWebview=false;if(window.device&&/iOS|iPad|iPhone|iPod/i.test(window.device.platform)){iOsWebview=true}var iOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);if(iOS){var getHeight=function getHeight(){return window.innerHeight};$("html").height(getHeight()+"px");$(window).on("layoutUpdate",function(){$("html").height(getHeight()+"px")})}(function(){var $b=$("body");var fullHeight=function fullHeight(){var h=$b.height();$(".full-height").css("height","auto").css("min-height",h).css("height",function(){return $(this).outerHeight(false)})};fullHeight();$(window).on("layoutUpdate",function(){fullHeight()})})();setTimeout(function(){$(window).trigger("layoutUpdate")},200);preBootstrapWorkarounds();require("bootstrap");bootknock.plugIn(ko);require("./utils/bootstrapSwitchBinding").plugIn(ko);if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){window.cordova.plugins.Keyboard.disableScroll(true)}$(document).on("tap","[data-shell]",function(e){var cmdline=$(this).attr("data-shell")||"",args=cmdline.split(" "),cmd=args[0];if(cmd&&typeof app.shell[cmd]==="function"){app.shell[cmd].apply(app.shell,args.slice(1));e.stopImmediatePropagation();e.preventDefault()}});if(window.cordova){$(document).on("tap",'[target="_blank"], [target="_system"]',function(e){window.open(this.getAttribute("href"),this.getAttribute("target"));e.preventDefault()})}app.shell.on(app.shell.events.itemReady,function($act,state){var actName=$act.data("activity");var activity=app.getActivity(actName);activity.show(state);var menuItem=activity.menuItem||actName;app.updateMenu(menuItem);app.updateAppNav(activity)});app.shell.on(app.shell.events.closed,function($act){var actName=$act.data("activity");var activity=app.getActivity(actName);if(activity.hide)activity.hide()});app.shell.on("error",function(err){app.modals.showError({error:err})});ko.applyBindings({navBar:app.navBar},$(".AppNav").get(0));var SmartNavBar=require("./components/SmartNavBar");var navBars=SmartNavBar.getAll();navBars.forEach(function(navbar){$(navbar.el).on("contentChange",function(){navbar.refresh()})});var togglingBackdrop=false;$(document).on("show.bs.collapse hide.bs.collapse",".AppNav .navbar-collapse",function(e){if(!togglingBackdrop){togglingBackdrop=true;var enabled=e.type==="show";$("body").toggleClass("use-backdrop",enabled);$(".collapsing, .collapse.in").collapse("hide");togglingBackdrop=false}});var alertError=function(err){window.alert("There was an error loading: "+err&&err.message||err)};app.model.init().then(app.shell.run.bind(app.shell),alertError).then(function(){$("html").addClass("is-ready");if(window.navigator&&window.navigator.splashscreen){window.navigator.splashscreen.hide()}},alertError);window.app=app};if(window.cordova){$(function(){$(document).on("deviceready",appInit)})}else{$(appInit)}},{"./app-components":38,"./app-navbar":39,"./app.activities":40,"./app.modals":42,"./app.shell":43,"./components/SmartNavBar":46,"./locales/en-US-LC":47,"./utils/Function.prototype._delayed":78,"./utils/Function.prototype._inherits":79,"./utils/accessControl":84,"./utils/bootknockBindingHelpers":86,"./utils/bootstrapSwitchBinding":87,"./utils/jquery.multiline":92,"./viewmodels/AppModel":111,"es6-promise":false,knockout:false}],42:[function(require,module,exports){"use strict";var $=require("jquery");exports.getErrorMessageFrom=function getErrorMessageFrom(err,defaultText){defaultText=defaultText||"Unknow error";if(!err){return defaultText}else if(typeof err==="string"){return err||defaultText}else{err=err.responseJSON||err;var msg=err.name&&err.name+": "||"";msg+=err.errorMessage||err.message||"";if(err.errors){msg+="\n"+exports.stringifyErrorsList(err.errors)}else{try{var jserr=JSON.stringify(err);if(jserr&&jserr!=="{}")msg+="\nTechnical details: "+jserr}catch(ex){console.log("Impossible to stringify JSON error",err,ex)}}return msg||defaultText}};exports.stringifyErrorsList=function(errors){var msg="";if(Array.isArray(errors)){msg=errors.join("\n")}else{msg=Object.keys(errors).map(function(key){return errors[key].join("\n")}).join("\n")}return msg};exports.showError=function showErrorModal(options){var modal=$("#errorModal"),header=modal.find("#errorModal-label"),body=modal.find("#errorModal-body");options=options||{};var msg=body.data("default-text");msg=exports.getErrorMessageFrom(options.error||options.message,msg);body.multiline(msg);header.text(options.title||header.data("default-text"));modal.modal("show")}},{}],43:[function(require,module,exports){"use strict";var baseUrl=window.location.pathname;var History=require("./utils/shell/hashbangHistory");var shell=require("./utils/shell/index"),Shell=shell.Shell,DomItemsManager=shell.DomItemsManager;var iOS=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);var shell=new Shell({root:"body",baseUrl:baseUrl,forceHashbang:true,indexName:"index",linkEvent:iOS?"tap click":"click",loader:null,history:History,domItemsManager:new DomItemsManager({idAttributeName:"data-activity"})});module.exports=shell},{"./utils/shell/hashbangHistory":98,"./utils/shell/index":99}],44:[function(require,module,exports){"use strict";var ko=require("knockout"),NavAction=require("../viewmodels/NavAction"),NavBar=require("../viewmodels/NavBar");require("../utils/Function.prototype._inherits");function Activity($activity,app){this.$activity=$activity;this.app=app;this.accessLevel=app.UserType.None;this.viewState={};this.requestData=null;this.navBar=new NavBar({title:null,leftAction:null,rightAction:null});setTimeout(function ActivityConstructorDelayed(){ko.applyBindings(this.viewModel||{},$activity.get(0))}.bind(this),1)}module.exports=Activity;Activity.prototype.show=function show(options){options=options||{};this.requestData=options;if(this._handlers&&this._handlersAreConnected!==true){this._handlers.forEach(function(settings){if(!settings.event&&settings.target.subscribe){var subscription=settings.target.subscribe(settings.handler);settings._subscription=subscription;if(settings._latestSubscribedValue!==settings.target()){settings.handler.call(settings.target,settings.target())}}else if(settings.selector){settings.target.on(settings.event,settings.selector,settings.handler)}else{settings.target.on(settings.event,settings.handler)}});this._handlersAreConnected=true}};Activity.prototype.hide=function hide(){if(this._handlers){this._handlers.forEach(function(settings){if(settings._subscription){settings._subscription.dispose();settings._latestSubscribedValue=settings.target()}else if(settings.target.off){if(settings.selector)settings.target.off(settings.event,settings.selector,settings.handler);else settings.target.off(settings.event,settings.handler)}else{settings.target.removeListener(settings.event,settings.handler)}});this._handlersAreConnected=false}};Activity.prototype.registerHandler=function registerHandler(settings){if(!settings)throw new Error("Register require a settings object");if(!settings.target||!settings.target.on&&!settings.target.subscribe)throw new Error("Target is null or not a jQuery, EventEmmiter or Observable object");if(typeof settings.handler!=="function"){throw new Error("Handler must be a function.")}if(!settings.event&&!settings.target.subscribe){throw new Error("Event is null; it's required for non observable objects")}this._handlers=this._handlers||[];this._handlers.push(settings)};Activity.NavBar=NavBar;Activity.NavAction=NavAction;Activity.createSectionNavBar=function createSectionNavBar(title){return new NavBar({title:title,leftAction:NavAction.menuNewItem,rightAction:NavAction.menuIn})};Activity.createSubsectionNavBar=function createSubsectionNavBar(title,options){options=options||{};var goBackOptions={text:title,isTitle:true};if(options.backLink){goBackOptions.link=options.backLink;goBackOptions.isShell=false}return new NavBar({title:"",leftAction:NavAction.goBack.model.clone(goBackOptions),rightAction:options.helpId?NavAction.goHelpIndex.model.clone({link:"#"+options.helpId}):NavAction.goHelpIndex})};var createSingleton=function createSingleton(ActivityClass,$activity,app){createSingleton.instances=createSingleton.instances||{};if(createSingleton.instances[ActivityClass.name]instanceof ActivityClass){return createSingleton.instances[ActivityClass.name]}else{var s=new ActivityClass($activity,app);createSingleton.instances[ActivityClass.name]=s;return s}};Activity.extends=function extendsActivity(ClassFn){ClassFn._inherits(Activity);ClassFn.init=createSingleton.bind(null,ClassFn);return ClassFn}},{"../utils/Function.prototype._inherits":79,"../viewmodels/NavAction":120,"../viewmodels/NavBar":121,knockout:false}],45:[function(require,module,exports){var $=require("jquery");var classes={component:"DatePicker",months:"DatePicker-months",days:"DatePicker-days",monthDay:"day",month:"month",year:"year",years:"DatePicker-years"};var DatePicker=function(element,options){this.element=$(element);this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy");this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;this.isPlaceholder=this.element.is(".calendar-placeholder");this.picker=$(DPGlobal.template).appendTo(this.isPlaceholder?this.element:"body").on("click tap",$.proxy(this.click,this));this.picker.addClass(this.isPlaceholder?"container":"dropdown-menu");if(this.isPlaceholder){this.picker.show();if(this.element.data("date")=="today"){this.date=new Date;this.set()}this.element.trigger({type:"show",date:this.date})}else if(this.isInput){this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)})}else{if(this.component){this.component.on("click tap",$.proxy(this.show,this))}else{this.element.on("click tap",$.proxy(this.show,this))}}this.element.on("swipeleft",function(e){e.preventDefault();this.moveDate("next")}.bind(this)).on("swiperight",function(e){e.preventDefault();this.moveDate("prev")}.bind(this));this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=options.viewMode||this.element.data("date-viewmode")||0;if(typeof this.viewMode==="string"){switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0;break}}this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=this.weekStart===0?6:this.weekStart-1;this.onRender=options.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};DatePicker.prototype={constructor:DatePicker,show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).on("resize",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}if(!this.isInput){}var that=this;$(document).on("mousedown",function(ev){if($(ev.target).closest("."+classes.component).length===0){that.hide()}});this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();$(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){$(document).off("mousedown",this.hide)}this.element.trigger({type:"hide",date:this.date})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);if(!this.isInput){if(this.component){this.element.find("input").prop("value",formated)}this.element.data("date",formated)}else{this.element.prop("value",formated)}},setValue:function(newDate,dontNotify){if(typeof newDate==="string"){this.date=DPGlobal.parseDate(newDate,this.format)}else{this.date=new Date(newDate)}this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();if(dontNotify!==true){this.element.trigger({type:"changeDate",date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}},getValue:function(){return this.date},moveValue:function(dir,mode){if(["prev","next"].indexOf(dir&&dir.toLowerCase())==-1)return;mode=mode?DPGlobal.modesSet[mode]:DPGlobal.modes[this.viewMode];this.date["set"+mode.navFnc].call(this.date,this.date["get"+mode.navFnc].call(this.date)+mode.navStep*(dir==="prev"?-1:1));this.setValue(this.date);return this.date},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},update:function(newDate){this.date=DPGlobal.parseDate(typeof newDate==="string"?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){var dowCnt=this.weekStart;var html="<tr>";while(dowCnt<this.weekStart+7){html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>"}html+="</tr>";this.picker.find("."+classes.days+" thead").append(html)},fillMonths:function(){var html="";var i=0;while(i<12){html+='<span class="'+classes.month+'">'+DPGlobal.dates.monthsShort[i++]+"</span>"}this.picker.find("."+classes.months+" td").append(html)},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf();this.picker.find("."+classes.days+" th:eq(1)").html(DPGlobal.dates.months[month]+" "+year);var prevMonth=new Date(year,month-1,28,0,0,0,0),day=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(day);prevMonth.setDate(day-(prevMonth.getDay()-this.weekStart+7)%7);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42);nextMonth=nextMonth.valueOf();var html=[];var clsName,prevY,prevM;if(this._daysCreated!==true){while(prevMonth.valueOf()<nextMonth){if(prevMonth.getDay()===this.weekStart){html.push("<tr>")}clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();if(prevM<month&&prevY===year||prevY<year){clsName+=" old"}else if(prevM>month&&prevY===year||prevY>year){clsName+=" new"}if(prevMonth.valueOf()===currentDate){clsName+=" active"}html.push('<td class="'+classes.monthDay+" "+clsName+'">'+prevMonth.getDate()+"</td>");if(prevMonth.getDay()===this.weekEnd){html.push("</tr>")}prevMonth.setDate(prevMonth.getDate()+1)}this.picker.find("."+classes.days+" tbody").empty().append(html.join(""));this._daysCreated=true}else{var weekTr=this.picker.find("."+classes.days+" tbody tr:first-child()");var dayTd=null;while(prevMonth.valueOf()<nextMonth){var currentWeekDayIndex=prevMonth.getDay()-this.weekStart;clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();if(prevM<month&&prevY===year||prevY<year){clsName+=" old"}else if(prevM>month&&prevY===year||prevY>year){clsName+=" new"}if(prevMonth.valueOf()===currentDate){clsName+=" active"}dayTd=weekTr.find("td:eq("+currentWeekDayIndex+")");dayTd.attr("class","day "+clsName).text(prevMonth.getDate());if(prevMonth.getDay()===this.weekEnd){weekTr=weekTr.next("tr")}prevMonth.setDate(prevMonth.getDate()+1)}}var currentYear=this.date.getFullYear();var months=this.picker.find("."+classes.months).find("th:eq(1)").html(year).end().find("span").removeClass("active");if(currentYear===year){months.eq(this.date.getMonth()).addClass("active")}html="";year=parseInt(year/10,10)*10;var yearCont=this.picker.find("."+classes.years).find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;var i;if(this._yearsCreated!==true){for(i=-1;i<11;i++){html+='<span class="'+classes.year+(i===-1||i===10?" old":"")+(currentYear===year?" active":"")+'">'+year+"</span>";year+=1}yearCont.html(html);this._yearsCreated=true}else{var yearSpan=yearCont.find("span:first-child()");for(i=-1;i<11;i++){yearSpan.text(year).attr("class","year"+(i===-1||i===10?" old":"")+(currentYear===year?" active":""));year+=1;yearSpan=yearSpan.next()}}},moveDate:function(dir,mode){if(["prev","next"].indexOf(dir&&dir.toLowerCase())==-1)return;mode=mode||this.viewMode;this.viewDate["set"+DPGlobal.modes[mode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[mode].navFnc].call(this.viewDate)+DPGlobal.modes[mode].navStep*(dir==="prev"?-1:1));this.fill();this.set()},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest("span, td, th");if(target.length===1){var month,year;switch(target[0].nodeName.toLowerCase()){case"th":switch(target[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.moveDate(target[0].className);break}break;case"span":if(target.is("."+classes.month)){month=target.parent().find("span").index(target);this.viewDate.setMonth(month)}else{year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year)}if(this.viewMode!==0){this.date=new Date(this.viewDate);this.element.trigger({type:"changeDate",date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set();break;case"td":if(target.is(".day")&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;month=this.viewDate.getMonth();if(target.is(".old")){month-=1}else if(target.is(".new")){month+=1}year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0);this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}break}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(dir){if(dir){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir))
}this.picker.find(">div").hide().filter("."+classes.component+"-"+DPGlobal.modes[this.viewMode].clsName).show()}};$.fn.datepicker=function(option){var vals=Array.prototype.slice.call(arguments,1);var returned;this.each(function(){var $this=$(this),data=$this.data("datepicker"),options=typeof option==="object"&&option;if(!data){$this.data("datepicker",data=new DatePicker(this,$.extend({},$.fn.datepicker.defaults,options)))}if(typeof option==="string"){returned=data[option].apply(data,vals);if(typeof(returned!=="undefined")){return false}}});if(typeof returned!=="undefined")return returned;else return this};$.fn.datepicker.defaults={onRender:function(){return""}};$.fn.datepicker.Constructor=DatePicker;var DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10},{clsName:"day",navFnc:"Date",navStep:1}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||parts.length===0){throw new Error("Invalid date format.")}return{separator:separator,parts:parts}},parseDate:function(date,format){var parts=date.split(format.separator),val;date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(parts.length===format.parts.length){var year=date.getFullYear(),day=date.getDate(),month=date.getMonth();for(var i=0,cnt=format.parts.length;i<cnt;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case"dd":case"d":day=val;date.setDate(val);break;case"mm":case"m":month=val-1;date.setMonth(val-1);break;case"yy":year=2e3+val;date.setFullYear(2e3+val);break;case"yyyy":year=val;date.setFullYear(val);break}}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d;val.mm=(val.m<10?"0":"")+val.m;date=[];for(var i=0,cnt=format.parts.length;i<cnt;i++){date.push(val[format.parts[i]])}return date.join(format.separator)},headTemplate:"<thead>"+"<tr>"+'<th class="prev">&lsaquo;</th>'+'<th colspan="5" class="switch"></th>'+'<th class="next">&rsaquo;</th>'+"</tr>"+"</thead>",contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="'+classes.component+'">'+'<div class="'+classes.days+'">'+'<table class=" table-condensed">'+DPGlobal.headTemplate+"<tbody></tbody>"+"</table>"+"</div>"+'<div class="'+classes.months+'">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table>"+"</div>"+'<div class="'+classes.years+'">'+'<table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table>"+"</div>"+"</div>";DPGlobal.modesSet={date:DPGlobal.modes[3],month:DPGlobal.modes[0],year:DPGlobal.modes[1],decade:DPGlobal.modes[2]};exports.DatePicker=DatePicker;exports.defaults=DPGlobal;exports.utils=DPGlobal},{}],46:[function(require,module,exports){var $=require("jquery");var clearNode=function(node){while(node.firstChild){node.removeChild(node.firstChild)}};var textboxResize=function textboxResize(el){var leftbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.left")[0];var rightbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.right")[0];if(typeof leftbtn==="undefined"){leftbtn={offsetWidth:0,className:""}}if(typeof rightbtn==="undefined"){rightbtn={offsetWidth:0,className:""}}var margin=Math.max(leftbtn.offsetWidth,rightbtn.offsetWidth);el.style.marginLeft=margin+"px";el.style.marginRight=margin+"px";var tooLong=el.offsetWidth<el.scrollWidth?true:false;if(tooLong){if(leftbtn.offsetWidth<rightbtn.offsetWidth){el.style.marginLeft=leftbtn.offsetWidth+"px";el.style.textAlign="right"}else{el.style.marginRight=rightbtn.offsetWidth+"px";el.style.textAlign="left"}tooLong=el.offsetWidth<el.scrollWidth?true:false;if(tooLong){if(new RegExp("arrow").test(leftbtn.className)){clearNode(leftbtn.childNodes[1]);el.style.marginLeft="26px"}if(new RegExp("arrow").test(rightbtn.className)){clearNode(rightbtn.childNodes[1]);el.style.marginRight="26px"}}}};exports.textboxResize=textboxResize;var SmartNavBar=function SmartNavBar(el){this.el=el;this.refresh=function refresh(){var h=$(el).children("h1").get(0);if(h)textboxResize(h)};this.refresh()};exports.SmartNavBar=SmartNavBar;exports.getAll=function getAll(){var all=$(".SmartNavBar");return $.map(all,function(item){return new SmartNavBar(item)})};exports.refreshAll=function refreshAll(){$(".SmartNavBar > h1").each(function(){textboxResize(this)})}},{}],47:[function(require,module,exports){"use strict";var moment=require("moment");var current=moment.locale();moment.locale("en-US-LC",{meridiemParse:/[ap]\.?\.?/i,meridiem:function(hours,minutes,isLower){if(hours>11){return isLower?"p":"P"}else{return isLower?"a":"A"}},calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"M/D"},longDateFormat:{LT:"h:mma",LTS:"h:mm:ssa",L:"MM/DD/YYYY",l:"M/D/YYYY",LL:"MMMM Do YYYY",ll:"MMM D YYYY",LLL:"MMMM Do YYYY LT",lll:"MMM D YYYY LT",LLLL:"dddd, MMMM Do YYYY LT",llll:"ddd, MMM D YYYY LT"}});moment.locale(current)},{moment:false}],48:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Address(values){Model(this);this.model.defProperties({addressID:0,addressName:"",jobTitleID:0,userID:0,addressLine1:null,addressLine2:null,postalCode:null,city:null,stateProvinceCode:null,stateProviceName:null,countryCode:null,latitude:null,longitude:null,specialInstructions:null,isServiceArea:false,isServiceLocation:false,serviceRadius:0,createdDate:null,updatedDate:null,kind:""},values);this.singleLine=ko.computed(function(){var list=[this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()];return list.filter(function(v){return!!v}).join(", ")},this);var countries={US:"United States",ES:"Spain"};this.countryName=ko.computed(function(){return countries[this.countryCode()]||"unknow"},this);this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}module.exports=Address;Address.kind={home:"home",billing:"billing",service:"service"}},{"./Model":63,knockout:false}],49:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),Client=require("./Client"),Location=require("./Location"),Service=require("./Service"),moment=require("moment");function Appointment(values){Model(this);this.model.defProperties({id:null,startTime:null,endTime:null,summary:"New booking",description:null,subtotalPrice:0,feePrice:0,pfeePrice:0,totalPrice:0,ptotalPrice:0,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,sourceEvent:null,sourceBooking:null},values);values=values||{};this.client=ko.observable(values.client?new Client(values.client):null);this.location=ko.observable(new Location(values.location));this.locationSummary=ko.computed(function(){return this.location().singleLine()},this);this.services=ko.observableArray((values.services||[]).map(function(service){return service instanceof Service?service:new Service(service)}));this.servicesSummary=ko.computed(function(){return this.services().map(function(service){return service.name()}).join(", ")},this);this.services.subscribe(function(services){this.ptotalPrice(services.reduce(function(prev,cur){return prev+cur.price()},0))}.bind(this));this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this);this.itStarted=ko.pureComputed(function(){return this.startTime()&&new Date>=this.startTime()},this);this.itEnded=ko.pureComputed(function(){return this.endTime()&&new Date>=this.endTime()},this);this.isNew=ko.pureComputed(function(){return!this.id()},this);this.stateHeader=ko.pureComputed(function(){var text="";if(!this.isNew()){if(this.itStarted()){if(this.itEnded()){text="Completed:"}else{text="Now:"}}else{text="Upcoming:"}}return text},this)}module.exports=Appointment;Appointment.fromCalendarEvent=function fromCalendarEvent(event){var apt=new Appointment;apt.id(event.calendarEventID());apt.startTime(event.startTime());apt.endTime(event.endTime());apt.summary(event.summary());apt.sourceEvent(event);return apt};Appointment.fromBooking=function fromBooking(booking,event){var apt=Appointment.fromCalendarEvent(event);var prices=booking.bookingRequest()&&booking.bookingRequest().pricingEstimate();if(prices){apt.subtotalPrice(prices.subtotalPrice());apt.feePrice(prices.feePrice());apt.pfeePrice(prices.pFeePrice());apt.totalPrice(prices.totalPrice());apt.ptotalPrice(prices.totalPrice()-prices.pFeePrice())}apt.sourceBooking(booking);return apt};Appointment.listFromCalendarEventsBookings=function listFromCalendarEventsBookings(events,bookings){return events.map(function(event){var booking=null;bookings.some(function(searchBooking){var found=searchBooking.confirmedDateID()===event.calendarEventID();if(found){booking=searchBooking;return true}});if(booking)return Appointment.fromBooking(booking,event);else return Appointment.fromCalendarEvent(event)})};var Time=require("../utils/Time");Appointment.newFreeSlot=function newFreeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:-2,startTime:start,endTime:end,summary:options.text||"Free",description:null})}},{"../utils/Time":83,"./Client":54,"./Location":59,"./Model":63,"./Service":69,knockout:false,moment:false}],50:[function(require,module,exports){"use strict";var Model=require("./Model");function Booking(values){Model(this);this.model.defProperties({bookingID:0,bookingRequestID:0,confirmedDateID:null,totalPricePaidByCustomer:null,totalServiceFeesPaidByCustomer:null,totalPaidToFreelancer:null,totalServiceFeesPaidByFreelancer:null,bookingStatusID:null,pricingAdjustmentApplied:false,reviewedByFreelancer:false,reviewedByCustomer:false,createdDate:null,updatedDate:null,bookingRequest:null},values);this.bookingRequest(new BookingRequest(values&&values.bookingRequest||{}))}module.exports=Booking;function BookingRequest(values){Model(this);this.model.defProperties({bookingRequestID:0,bookingTypeID:0,customerUserID:0,freelancerUserID:0,jobTitleID:0,pricingEstimateID:0,bookingRequestStatusID:0,specialRequests:null,preferredDateID:null,alternativeDate1ID:null,alternativeDate2ID:null,addressID:null,cancellationPolicyID:null,instantBooking:false,createdDate:null,updatedDate:null,pricingEstimate:null},values);this.pricingEstimate(new PricingEstimate(values&&values.pricingEstimate||{}))}function PricingEstimate(values){Model(this);this.model.defProperties({pricingEstimateID:0,pricingEstimateRevision:0,serviceDurationHours:null,firstSessionDurationHours:null,subtotalPrice:null,feePrice:null,totalPrice:null,pFeePrice:null,subtotalRefunded:null,feeRefunded:null,totalRefunded:null,dateRefunded:null,createdDate:null,updatedDate:null,details:[]},values);if(values&&Array.isArray(values.details)){this.details(values.details.map(function(detail){return new PricingEstimateDetail(detail)}))}}function PricingEstimateDetail(values){Model(this);this.model.defProperties({freelancerPricingID:0,freelancerPricingDataInput:null,customerPricingDataInput:null,hourlyPrice:null,subtotalPrice:null,feePrice:null,totalPrice:null,serviceDurationHours:null,firstSessionDurationHours:null,createdDate:null,updatedDate:null},values)}},{"./Model":63}],51:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function BookingSummary(values){Model(this);this.model.defProperties({quantity:0,concept:"",time:null,timeFormat:" [@] h:mma"},values);this.phrase=ko.pureComputed(function(){var t=this.timeFormat()&&this.time()&&moment(this.time()).format(this.timeFormat())||"";return this.concept()+t},this);this.url=ko.pureComputed(function(){var url=this.time()&&"/calendar/"+this.time().toISOString();return url},this)}module.exports=BookingSummary},{"./Model":63,knockout:false,moment:false}],52:[function(require,module,exports){"use strict";function RecurrenceRule(values){Model(this);this.model.defProperties({frequencyTypeID:0,interval:1,until:null,count:null,ending:null,selectedWeekDays:[],monthlyWeekDay:false,incompatible:false,tooMany:false},values)}function RecurrenceOccurrence(values){Model(this);this.model.defProperties({startTime:null,endTime:null},values)}var ko=require("knockout"),Model=require("./Model");function CalendarEvent(values){Model(this);if(values){values.startTime=values.startTime&&new Date(Date.parse(values.startTime))||null;values.endTime=values.endTime&&new Date(Date.parse(values.endTime))||null}this.model.defProperties({calendarEventID:0,userID:0,eventTypeID:3,summary:"",availabilityTypeID:0,startTime:null,endTime:null,kind:0,isAllDay:false,timeZone:"Z",location:null,updatedDate:null,createdDate:null,description:"",readOnly:false},values);this.recurrenceRule=ko.observable(values&&values.recurrenceRule&&new RecurrenceRule(values.recurrenceRule));this.recurrenceOccurrences=ko.observableArray([]);if(values&&values.recurrenceOccurrences){values.recurrenceOccurrences.forEach(function(occurrence){this.RecurrenceOccurrences.push(new RecurrenceOccurrence(occurrence))}.bind(this))}}module.exports=CalendarEvent;CalendarEvent.RecurrenceRule=RecurrenceRule;CalendarEvent.RecurrenceOccurrence=RecurrenceOccurrence},{"./Model":63,knockout:false}],53:[function(require,module,exports){"use strict";var Model=require("./Model");function CalendarSyncing(values){Model(this);this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}module.exports=CalendarSyncing},{"./Model":63}],54:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Client(values){Model(this);this.model.defProperties({id:0,firstName:"",lastName:"",email:"",phone:null,canReceiveSms:false,birthMonthDay:null,birthMonth:null,notesAboutClient:null},values);this.fullName=ko.pureComputed(function(){return this.firstName()+" "+this.lastName()},this);this.birthDay=ko.pureComputed(function(){if(this.birthMonthDay()&&this.birthMonth()){return this.birthMonth()+"/"+this.birthMonthDay()}else{return null}},this)}module.exports=Client},{"./Model":63,knockout:false}],55:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem");function GetMore(values){Model(this);this.model.defProperties({availability:false,payments:false,profile:false,coop:true},values);var availableItems={availability:new ListViewItem({contentLine1:"Complete your availability to create a cleaner calendar",markerIcon:"glyphicon glyphicon-calendar",actionIcon:"glyphicon glyphicon-chevron-right"}),payments:new ListViewItem({contentLine1:"Start accepting payments through Loconomics",markerIcon:"glyphicon glyphicon-usd",actionIcon:"glyphicon glyphicon-chevron-right"}),profile:new ListViewItem({contentLine1:"Activate your profile in the marketplace",markerIcon:"glyphicon glyphicon-user",actionIcon:"glyphicon glyphicon-chevron-right"}),coop:new ListViewItem({contentLine1:"Learn more about our cooperative",actionIcon:"glyphicon glyphicon-chevron-right"})};this.items=ko.pureComputed(function(){var items=[];Object.keys(availableItems).forEach(function(key){if(this[key]())items.push(availableItems[key])}.bind(this));return items},this)}module.exports=GetMore},{"./ListViewItem":58,"./Model":63,knockout:false}],56:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");function JobTitle(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values);this.model.defID(["jobTitleID"]);this.pricingTypes=ko.observableArray([]);if(values&&values.pricingTypes){values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}}module.exports=JobTitle},{"./JobTitlePricingType":57,"./Model":63,knockout:false}],57:[function(require,module,exports){"use strict";var Model=require("./Model");function JobTitlePricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID","clientTypeID"])}module.exports=JobTitlePricingType},{"./Model":63}],58:[function(require,module,exports){"use strict";var Model=require("./Model");function ListViewItem(values){Model(this);this.model.defProperties({markerLine1:null,markerLine2:null,markerIcon:null,contentLine1:"",contentLine2:null,link:"#",actionIcon:null,actionText:null,classNames:""},values)}module.exports=ListViewItem},{"./Model":63}],59:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Location(values){Model(this);this.model.defProperties({locationID:0,name:"",addressLine1:null,addressLine2:null,city:null,stateProvinceCode:null,stateProviceID:null,postalCode:null,postalCodeID:null,countryID:null,latitude:null,longitude:null,specialInstructions:null,isServiceRadius:false,isServiceLocation:false,serviceRadius:0},values);this.singleLine=ko.computed(function(){var list=[this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()];return list.filter(function(v){return!!v}).join(", ")},this);this.countryName=ko.computed(function(){return this.countryID()===1?"United States":this.countryID()===2?"Spain":"unknow"},this);this.countryCodeAlpha2=ko.computed(function(){return this.countryID()===1?"US":this.countryID()===2?"ES":""},this);this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}module.exports=Location},{"./Model":63,knockout:false}],60:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),_=require("lodash");function MailFolder(values){Model(this);this.model.defProperties({messages:[],topNumber:10},values);this.top=ko.pureComputed(function top(num){if(num)this.topNumber(num);return _.first(this.messages(),this.topNumber())},this)}module.exports=MailFolder},{"./Model":63,knockout:false,lodash:false}],61:[function(require,module,exports){"use strict";var Model=require("./Model");function MarketplaceProfile(values){Model(this);this.model.defProperties({userID:0,publicBio:"",freelancerProfileUrlSlug:"",freelancerProfileUrl:"",freelancerWebsiteUrl:"",bookCode:"",createdDate:null,updatedDate:null},values)}module.exports=MarketplaceProfile},{"./Model":63}],62:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function Message(values){Model(this);this.model.defProperties({id:0,createdDate:null,updatedDate:null,subject:"",content:null,link:"#",actionIcon:null,actionText:null,classNames:""},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}module.exports=Message},{"./Model":63,knockout:false,moment:false}],63:[function(require,module,exports){"use strict";var ko=require("knockout");ko.mapping=require("knockout.mapping");var $=require("jquery");var clone=function(obj){return $.extend(true,{},obj)};function Model(modelObject){if(!(this instanceof Model)){var model=new Model(modelObject);modelObject.model=model;return model}this.modelObject=modelObject;this.propertiesList=[];this.fieldsList=[];this.mappingOptions={};this.dataTimestamp=ko.observable(new Date).extend({rateLimit:0})}module.exports=Model;Model.prototype.defProperties=function defProperties(properties,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,propertiesList=this.propertiesList,dataTimestamp=this.dataTimestamp;Object.keys(properties).forEach(function(key){var defVal=properties[key];modelObject[key]=Array.isArray(defVal)?ko.observableArray(defVal):ko.observable(defVal);modelObject[key]._defaultValue=defVal;modelObject[key]._initialValue=initialValues[key];if(typeof initialValues[key]!=="undefined"){modelObject[key](initialValues[key])}modelObject[key].subscribe(function(){dataTimestamp(new Date)});propertiesList.push(key)});dataTimestamp(new Date)};Model.prototype.defFields=function defFields(fields,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,fieldsList=this.fieldsList;Object.keys(fields).each(function(key){var defVal=fields[key];modelObject[key]=defVal;if(typeof initialValues[key]!=="undefined"){modelObject[key]=initialValues[key]}fieldsList.push(key)})};Model.prototype.defID=function defID(fieldsNames){this.idFieldsNames=fieldsNames;if(fieldsNames.length===1){var field=fieldsNames[0];this.modelObject.id=ko.pureComputed(function(){return this[field]()},this.modelObject)}else{this.modelObject.id=ko.pureComputed(function(){return fieldsNames.map(function(fieldName){return this[fieldName]()}.bind(this))},this.modelObject)}};Model.prototype.regTimestamp=function regTimestampProperty(propertyName){var prop=this.modelObject[propertyName];if(typeof prop!=="function"){throw new Error("There is no observable property with name ["+propertyName+"] to register as timestamp.")}this.dataTimestamp.subscribe(function(timestamp){prop(timestamp)})};Model.prototype.toPlainObject=function toPlainObject(deepCopy){var plain={},modelObj=this.modelObject;function setValue(property,val){if(typeof val==="object"){if(deepCopy===true){if(val instanceof Date){plain[property]=new Date(val)}else if(val&&val.model instanceof Model){plain[property]=val.model.toPlainObject(deepCopy)}else if(val===null){plain[property]=null}else{plain[property]=clone(val)}}else if(deepCopy===false){plain[property]=val}}else{plain[property]=val}}this.propertiesList.forEach(function(property){var val=modelObj[property]();setValue(property,val)});this.fieldsList.forEach(function(field){var val=modelObj[field];setValue(field,val)});return plain};Model.prototype.updateWith=function updateWith(data,deepCopy){var timestamp=null;if(data&&data.model instanceof Model){timestamp=data.model.dataTimestamp();data=data.model.toPlainObject(deepCopy)}ko.mapping.fromJS(data,this.mappingOptions,this.modelObject);if(timestamp)this.modelObject.model.dataTimestamp(timestamp)};Model.prototype.clone=function clone(data,deepCopy){var plain=this.toPlainObject(deepCopy);var cloned=new this.modelObject.constructor(plain);if(data){cloned.model.updateWith(data)}return cloned}},{knockout:false,"knockout.mapping":false}],64:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem"),moment=require("moment"),numeral=require("numeral");function PerformanceSummary(values){Model(this);values=values||{};this.earnings=new Earnings(values.earnings);var earningsLine=new ListViewItem;earningsLine.markerLine1=ko.computed(function(){var num=numeral(this.currentAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine1=ko.computed(function(){return this.currentConcept()},this.earnings);earningsLine.markerLine2=ko.computed(function(){var num=numeral(this.nextAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine2=ko.computed(function(){return this.nextConcept()},this.earnings);this.timeBooked=new TimeBooked(values.timeBooked);var timeBookedLine=new ListViewItem;timeBookedLine.markerLine1=ko.computed(function(){var num=numeral(this.percent()).format("0%");return num},this.timeBooked);timeBookedLine.contentLine1=ko.computed(function(){return this.concept()},this.timeBooked);this.items=ko.pureComputed(function(){var items=[];items.push(earningsLine);items.push(timeBookedLine);return items},this)}module.exports=PerformanceSummary;function Earnings(values){Model(this);this.model.defProperties({currentAmount:0,currentConceptTemplate:"already paid this month",nextAmount:0,nextConceptTemplate:"projected {month} earnings"},values);this.currentConcept=ko.pureComputed(function(){var month=moment().format("MMMM");return this.currentConceptTemplate().replace(/\{month\}/,month)},this);this.nextConcept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.nextConceptTemplate().replace(/\{month\}/,month)},this)}function TimeBooked(values){Model(this);this.model.defProperties({percent:0,conceptTemplate:"of available time booked in {month}"},values);this.concept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.conceptTemplate().replace(/\{month\}/,month)},this)}},{"./ListViewItem":58,"./Model":63,knockout:false,moment:false,numeral:1}],65:[function(require,module,exports){"use strict";var Model=require("./Model");function Position(values){Model(this);this.model.defProperties({positionID:0,positionSingular:"",positionPlural:"",description:"",active:true},values)}module.exports=Position},{"./Model":63}],66:[function(require,module,exports){"use strict";var Model=require("./Model");function PricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,freelancerDescription:null,priceCalculation:null,isAddon:false,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:false,includeServiceAttributes:false,includeSpecialPromotion:false,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesCustomerMessage:null,withoutServiceAttributesFreelancerMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID"])}module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":63}],67:[function(require,module,exports){"use strict";var Model=require("./Model");function PrivacySettings(values){Model(this);this.model.defProperties({userID:0,smsBookingCommunication:false,phoneBookingCommunication:false,loconomicsCommunityCommunication:false,loconomicsDbmCampaigns:false,profileSeoPermission:false,loconomicsMarketingCampaigns:false,coBrandedPartnerPermissions:false,createdDate:null,updatedDate:null},values);this.model.defID(["userID"])}module.exports=PrivacySettings},{"./Model":63}],68:[function(require,module,exports){"use strict";var Model=require("./Model");function SchedulingPreferences(values){Model(this);this.model.defProperties({advanceTime:24,betweenTime:0,incrementsSizeInMinutes:15},values)}module.exports=SchedulingPreferences},{"./Model":63}],69:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Service(values){Model(this);this.model.defProperties({name:"",price:0,duration:0,isAddon:false},values);this.durationText=ko.computed(function(){var minutes=this.duration()||0;return minutes?minutes+" minutes":""},this)}module.exports=Service},{"./Model":63,knockout:false}],70:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function WeekDaySchedule(values){Model(this);this.model.defProperties({from:0,to:0},values);this.isEnabled=ko.computed({read:function(){return typeof this.from()==="number"&&typeof this.to()==="number"&&this.from()<this.to()},write:function(val){if(val===true){this.fromHour(9);this.toHour(17)}else{this.toHour(0);this.from(0)}},owner:this}).extend({rateLimit:0});this.isAllDay=ko.computed({read:function(){return this.from()===0&&this.to()===1440},write:function(){this.from(0);this.to(1440)},owner:this}).extend({rateLimit:0});this.fromHour=ko.computed({read:function(){return Math.floor(this.from()/60)},write:function(hours){this.from(hours*60|0)},owner:this});this.toHour=ko.computed({read:function(){return Math.ceil(this.to()/60)},write:function(hours){this.to(hours*60|0)},owner:this});this.fromTime=ko.computed({read:function(){return minutesToTimeString(this.from()|0)},write:function(time){this.from(timeStringToMinutes(time))},owner:this});this.toTime=ko.computed({read:function(){return minutesToTimeString(this.to()|0)},write:function(time){this.to(timeStringToMinutes(time))},owner:this})}function SimplifiedWeeklySchedule(values){Model(this);this.model.defProperties({sunday:new WeekDaySchedule,monday:new WeekDaySchedule,tuesday:new WeekDaySchedule,wednesday:new WeekDaySchedule,thursday:new WeekDaySchedule,friday:new WeekDaySchedule,saturday:new WeekDaySchedule,isAllTime:false},values)}module.exports=SimplifiedWeeklySchedule;function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}var moment=require("moment");function timeStringToMinutes(time){return moment.duration(time).asMinutes()|0}},{"./Model":63,knockout:false,moment:false}],71:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary");function UpcomingBookingsSummary(){Model(this);this.today=new BookingSummary({concept:"more today",timeFormat:" [ending @] h:mma"});this.tomorrow=new BookingSummary({concept:"tomorrow",timeFormat:" [starting @] h:mma"});this.nextWeek=new BookingSummary({concept:"next week",timeFormat:null});this.items=ko.pureComputed(function(){var items=[];items.push(this.today);items.push(this.tomorrow);items.push(this.nextWeek);return items},this)}module.exports=UpcomingBookingsSummary},{"./BookingSummary":51,"./Model":63,knockout:false}],72:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");var UserType={None:0,Anonymous:1,Customer:2,Freelancer:4,Admin:8,LoggedUser:14,User:15,System:16};function User(values){Model(this);this.model.defProperties({userID:0,email:"",firstName:"",lastName:"",secondLastName:"",businessName:"",alternativeEmail:"",phone:"",canReceiveSms:"",birthMonthDay:null,birthMonth:null,isFreelancer:false,isCustomer:false,isMember:false,isAdmin:false,onboardingStep:null,accountStatusID:0,createdDate:null,updatedDate:null},values);
this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];if(this.lastName())nameParts.push(this.lastName());if(this.secondLastName())nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.birthDay=ko.pureComputed(function(){if(this.birthMonthDay()&&this.birthMonth()){return this.birthMonth()+"/"+this.birthMonthDay()}else{return null}},this);this.userType=ko.pureComputed({read:function(){var c=this.isCustomer(),p=this.isFreelancer(),a=this.isAdmin();var userType=0;if(this.isAnonymous())userType=userType|UserType.Anonymous;if(c)userType=userType|UserType.Customer;if(p)userType=userType|UserType.Freelancer;if(a)userType=userType|UserType.Admin;return userType},owner:this});this.isAnonymous=ko.pureComputed(function(){return this.userID()<1},this);this.isUserType=function isUserType(type){return this.userType()&type}.bind(this)}module.exports=User;User.UserType=UserType;User.newAnonymous=function newAnonymous(){return new User({userID:0,email:"",firstName:"",onboardingStep:null})}},{"./Model":63,knockout:false}],73:[function(require,module,exports){"use strict";var Model=require("./Model");function UserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:false,createdDate:null,updatedDate:null},values);this.model.defID(["userID","jobTitleID"])}module.exports=UserJobTitle},{"./Model":63}],74:[function(require,module,exports){var Client=require("../models/Client");var testData=[new Client({id:1,firstName:"Joshua",lastName:"Danielson"}),new Client({id:2,firstName:"Iago",lastName:"Lorenzo"}),new Client({id:3,firstName:"Fernando",lastName:"Gago"}),new Client({id:4,firstName:"Adam",lastName:"Finch"}),new Client({id:5,firstName:"Alan",lastName:"Ferguson"}),new Client({id:6,firstName:"Alex",lastName:"Pena"}),new Client({id:7,firstName:"Alexis",lastName:"Peaca"}),new Client({id:8,firstName:"Arthur",lastName:"Miller"})];exports.clients=testData},{"../models/Client":54}],75:[function(require,module,exports){var Message=require("../models/Message");var Time=require("../utils/Time");var today=new Date,yesterday=new Date,lastWeek=new Date,oldDate=new Date;yesterday.setDate(yesterday.getDate()-1);lastWeek.setDate(lastWeek.getDate()-2);oldDate.setDate(oldDate.getDate()-16);var testData=[new Message({id:1,createdDate:new Time(today,11,0,0),subject:"CONFIRM-Susan Dee",content:"Deep Tissue Massage",link:"/conversation/1",actionIcon:null,actionText:"$70",classNames:"ListView-item--tag-warning"}),new Message({id:3,createdDate:new Time(yesterday,13,0,0),subject:'Do you do "Exotic Massage"?',content:"Hi, I wanted to know if you perform as par of your services...",link:"/conversation/3",actionIcon:"glyphicon glyphicon-share-alt",actionText:null,classNames:null}),new Message({id:2,createdDate:new Time(lastWeek,12,0,0),subject:"Josh Danielson",content:"Deep Tissue Massage",link:"/conversation/2",actionIcon:"glyphicon glyphicon-plus",actionText:null,classNames:null}),new Message({id:4,createdDate:new Time(oldDate,15,0,0),subject:"Inquiry",content:"Another question from another client.",link:"/conversation/4",actionIcon:"glyphicon glyphicon-share-alt",classNames:null})];exports.messages=testData},{"../models/Message":62,"../utils/Time":83}],76:[function(require,module,exports){var Time=require("../utils/Time");var moment=require("moment");var today=new Date,tomorrow=new Date;tomorrow.setDate(tomorrow.getDate()+1);var stoday=moment(today).format("YYYY-MM-DD"),stomorrow=moment(tomorrow).format("YYYY-MM-DD");var testData1=[Time(today,9,15),Time(today,11,30),Time(today,12,0),Time(today,12,30),Time(today,16,15),Time(today,18,0),Time(today,18,30),Time(today,19,0),Time(today,19,30),Time(today,21,30),Time(today,22,0)];var testData2=[Time(tomorrow,8,0),Time(tomorrow,10,30),Time(tomorrow,11,0),Time(tomorrow,11,30),Time(tomorrow,12,0),Time(tomorrow,12,30),Time(tomorrow,13,0),Time(tomorrow,13,30),Time(tomorrow,14,45),Time(tomorrow,16,0),Time(tomorrow,16,30)];var testDataBusy=[];var testData={"default":testDataBusy};testData[stoday]=testData1;testData[stomorrow]=testData2;exports.timeSlots=testData},{"../utils/Time":83,moment:false}],77:[function(require,module,exports){"use strict";var moment=require("moment");function CacheControl(options){options=options||{};this.ttl=moment.duration(options.ttl).asMilliseconds();this.latest=options.latest||null;this.mustRevalidate=function mustRevalidate(){var tdiff=this.latest&&new Date-this.latest||Number.POSITIVE_INFINITY;return tdiff>this.ttl}}module.exports=CacheControl},{moment:false}],78:[function(require,module,exports){Function.prototype._delayed=function delayed(milliseconds){var fn=this;return function(){var context=this,args=arguments;setTimeout(function(){fn.apply(context,args)},milliseconds)}}},{}],79:[function(require,module,exports){Function.prototype._inherits=function _inherits(superCtor){this.prototype=Object.create(superCtor.prototype,{constructor:{value:this,enumerable:false,writable:true,configurable:true}})}},{}],80:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter;function ModelVersion(original){EventEmitter.call(this);this.original=original;this.version=original.model.clone();this.areDifferent=ko.pureComputed(function areDifferent(){return this.original.model.dataTimestamp()!==this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isNewer=ko.pureComputed(function isNewer(){return this.original.model.dataTimestamp()<this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isObsolete=ko.pureComputed(function isComputed(){return this.original.model.dataTimestamp()>this.version.model.dataTimestamp()},this).extend({rateLimit:0})}module.exports=ModelVersion;ModelVersion._inherits(EventEmitter);ModelVersion.prototype.pull=function pull(options){options=options||{};var result=false,rollback=null;if(options.evenIfNewer||!this.isNewer()){rollback=createRollbackFunction(this.version);this.version.model.updateWith(this.original,true);result=true}this.emit("pull",result,rollback);return result};ModelVersion.prototype.push=function push(options){options=options||{};var result=false,rollback=null;if(options.evenIfObsolete||!this.isObsolete()){rollback=createRollbackFunction(this.original);this.original.model.updateWith(this.version,true);result=true}this.emit("push",result,rollback);return result};ModelVersion.prototype.sync=function sync(){if(this.isNewer())return this.push();else if(this.isObsolete())return this.pull();else return false};function createRollbackFunction(modelInstance){var backedData=modelInstance.model.toPlainObject(true),backedTimestamp=modelInstance.model.dataTimestamp();return function rollback(){modelInstance.model.updateWith(backedData);modelInstance.model.dataTimestamp(backedTimestamp)}}},{events:false,knockout:false}],81:[function(require,module,exports){"use strict";var ModelVersion=require("../utils/ModelVersion"),CacheControl=require("../utils/CacheControl"),ko=require("knockout"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;function RemoteModel(options){EventEmitter.call(this);options=options||{};var firstTimeLoad=true;this.isLoading=ko.observable(false);this.isSaving=ko.observable(false);this.isSyncing=ko.observable(false);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);if(!options.data)throw new Error("RemoteModel data must be set on constructor and no changed later");this.data=options.data;this.cache=new CacheControl({ttl:options.ttl});this.localStorageName=options.localStorageName||null;this.getData=function getData(){this.load();return this.data};this.newVersion=function newVersion(){var v=new ModelVersion(this.data);this.isLoading.subscribe(function(isIt){if(!isIt){v.pull({evenIfNewer:true})}});v.on("push",function(success,rollback){if(success){this.save().then(function(){v.pull({evenIfNewer:true})}).catch(function(){rollback()})}}.bind(this));return v};this.fetch=options.fetch||function fetch(){throw new Error("Not implemented")};this.push=options.push||function push(){throw new Error("Not implementd")};var loadFromRemote=function loadFromRemote(){return this.fetch().then(function(serverData){if(serverData){this.data.model.updateWith(serverData,true);if(this.localStorageName){localforage.setItem(this.localStorageName,serverData)}}else{throw new Error('Remote model did not returned data, response must be a "Not Found"')}if(this.isLoading()){this.emit("loaded",serverData)}else{this.emit("synced",serverData)}this.isLoading(false);this.isSyncing(false);this.cache.latest=new Date;return this.data}.bind(this)).catch(function(err){var wasLoad=this.isLoading();this.isLoading(false);this.isSyncing(false);var errPkg={task:wasLoad?"load":"sync",error:err};if(EventEmitter.listenerCount(this,"error")>0){this.emit("error",errPkg)}else{console.error("RemoteModel Error",errPkg)}return err}.bind(this))}.bind(this);this.load=function load(){if(this.cache.mustRevalidate()){if(firstTimeLoad)this.isLoading(true);else this.isSyncing(true);var promise=null;if(firstTimeLoad&&this.localStorageName){promise=localforage.getItem(this.localStorageName).then(function(localData){if(localData){this.data.model.updateWith(localData,true);this.isLoading(false);this.isSyncing(false);loadFromRemote();return this.data}else{return loadFromRemote()}}.bind(this))}else{promise=loadFromRemote()}if(firstTimeLoad){firstTimeLoad=false;return promise}else{return Promise.resolve(this.data)}}else{return Promise.resolve(this.data)}};this.save=function save(){this.isSaving(true);var ts=this.data.model.dataTimestamp();return this.push().then(function(serverData){this.data.model.updateWith(serverData,true);this.data.model.dataTimestamp(ts);if(this.localStorageName){localforage.setItem(this.localStorageName,serverData)}this.emit("saved",serverData);this.isSaving(false);this.cache.latest=new Date;return this.data}.bind(this)).catch(function(err){this.isSaving(false);var errPkg={task:"save",error:err};if(EventEmitter.listenerCount(this,"error")>0){this.emit("error",errPkg)}else{console.error("RemoteModel Error",errPkg)}return err}.bind(this))};this.sync=function sync(){this.load().catch(function(){})}}module.exports=RemoteModel;RemoteModel._inherits(EventEmitter)},{"../utils/CacheControl":77,"../utils/ModelVersion":80,events:false,knockout:false,localforage:false}],82:[function(require,module,exports){"use strict";var $=require("jquery");function lowerFirstLetter(n){return n&&n[0]&&n[0].toLowerCase&&n[0].toLowerCase()+n.slice(1)||n}function lowerCamelizeObject(obj){if(!obj||typeof obj!=="object")return obj;var ret=Array.isArray(obj)?[]:{};for(var k in obj){if(obj.hasOwnProperty(k)){var newk=lowerFirstLetter(k);ret[newk]=typeof obj[k]==="object"?lowerCamelizeObject(obj[k]):obj[k]}}return ret}function Rest(optionsOrUrl){var url=typeof optionsOrUrl==="string"?optionsOrUrl:optionsOrUrl&&optionsOrUrl.url;this.baseUrl=url;this.extraHeaders=null}Rest.prototype.get=function get(apiUrl,data){return this.request(apiUrl,"get",data)};Rest.prototype.put=function get(apiUrl,data){return this.request(apiUrl,"put",data)};Rest.prototype.post=function get(apiUrl,data){return this.request(apiUrl,"post",data)};Rest.prototype.delete=function get(apiUrl,data){return this.request(apiUrl,"delete",data)};Rest.prototype.putFile=function putFile(apiUrl,data){return this.request(apiUrl,"delete",data,"multipart/form-data")};Rest.prototype.request=function request(apiUrl,httpMethod,data,contentType){var thisRest=this;var url=this.baseUrl+apiUrl;return Promise.resolve($.ajax({url:url,cache:false,dataType:"json",method:httpMethod,headers:this.extraHeaders,data:data&&JSON.parse(JSON.stringify(data)),contentType:contentType||"application/x-www-form-urlencoded"})).then(lowerCamelizeObject).catch(function(err){if(err.status===401){var retry=request.bind(this,apiUrl,httpMethod,data,contentType);var retryPromise=thisRest.onAuthorizationRequired(retry);if(retryPromise){return Promise.resolve(retryPromise).catch(function(){return err})}}return err})};Rest.prototype.onAuthorizationRequired=function onAuthorizationRequired(){return};module.exports=Rest},{}],83:[function(require,module,exports){function Time(date,hour,minute,second){if(!(date instanceof Date)){second=minute;minute=hour;hour=date;date=new Date}return new Date(date.getFullYear(),date.getMonth(),date.getDate(),hour||0,minute||0,second||0)}module.exports=Time},{}],84:[function(require,module,exports){"use strict";module.exports=function createAccessControl(app){return function accessControl(route){var activity=app.getActivityControllerByRoute(route);var user=app.model.user();var currentType=user&&user.userType();if(activity&&activity.accessLevel){var can=activity.accessLevel&currentType;if(!can){return{requiredLevel:activity.accessLevel,currentType:currentType}}}return null}}},{}],85:[function(require,module,exports){"use strict";var unwrap=function unwrap(value){return typeof value==="function"?value():value};exports.defineCrudApiForRest=function defineCrudApiForRest(settings){var extendedObject=settings.extendedObject,Model=settings.Model,modelName=settings.modelName,modelListName=settings.modelListName,modelUrl=settings.modelUrl,idPropertyName=settings.idPropertyName;extendedObject["get"+modelListName]=function getList(filters){return this.rest.get(modelUrl,filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Model(rawItem)})})};extendedObject["get"+modelName]=function getItem(itemID){return this.rest.get(modelUrl+"/"+itemID).then(function(rawItem){return rawItem&&new Model(rawItem)})};extendedObject["post"+modelName]=function postItem(anItem){return this.rest.post(modelUrl,anItem).then(function(serverItem){return new Model(serverItem)})};extendedObject["put"+modelName]=function putItem(anItem){return this.rest.put(modelUrl+"/"+unwrap(anItem[idPropertyName]),anItem).then(function(serverItem){return new Model(serverItem)})};extendedObject["set"+modelName]=function setItem(anItem){var id=unwrap(anItem[idPropertyName]);if(id)return this["put"+modelName](anItem);else return this["post"+modelName](anItem)};extendedObject["del"+modelName]=function delItem(anItem){var id=anItem&&unwrap(anItem[idPropertyName])||anItem;if(id)return this.rest.delete(modelUrl+"/"+id,anItem).then(function(deletedItem){return deletedItem&&new Model(deletedItem)});else throw new Error("Need an ID or an object with the ID property to delete")}}},{}],86:[function(require,module,exports){"use strict";var $=require("jquery");exports.i18n=null;function createHelpers(ko){var helpers={};helpers.popover={update:function(element,valueAccessor){var srcOptions=ko.unwrap(valueAccessor());var options=$.extend(true,{},srcOptions);options.content=ko.unwrap(srcOptions.content);if(options.content){options.content=exports.i18n&&exports.i18n.t(options.content)||options.content;$(element).popover("destroy").popover(options);if($(element).is(":focus"))$(element).popover("show")}else{$(element).popover("destroy")}}};return helpers}function plugIn(ko,prefix){var name,helpers=createHelpers(ko);for(var h in helpers){if(helpers.hasOwnProperty&&!helpers.hasOwnProperty(h))continue;name=prefix?prefix+h[0].toUpperCase()+h.slice(1):h;ko.bindingHandlers[name]=helpers[h]}}exports.plugIn=plugIn;exports.createBindingHelpers=createHelpers},{}],87:[function(require,module,exports){"use strict";var $=require("jquery");require("bootstrap");require("bootstrap-switch");exports.plugIn=function plugIn(ko,prefix){ko.bindingHandlers[prefix?prefix+"switch":"switch"]={init:function(element,valueAccessor){$(element).bootstrapSwitch();$(element).on("switchChange.bootstrapSwitch",function(e,state){var v=valueAccessor()||{};var oldState=!!ko.unwrap(v.state),newState=!!state;if(oldState!==newState){if(ko.isObservable(v.state)){if(ko.isWriteableObservable(v.state)){v.state(newState)}}else{v.state=newState}}})},update:function(element,valueAccessor){var srcOptions=valueAccessor();var options=srcOptions||{};options=ko.toJS(options);var $el=$(element);Object.keys(options).forEach(function(key){$el.bootstrapSwitch(key,options[key])})}}}},{}],88:[function(require,module,exports){"use strict";var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp("["+specials.join("\\")+"]","g");var escapeRegExp=function(str){return str.replace(regex,"\\$&")};module.exports=escapeRegExp},{}],89:[function(require,module,exports){"use strict";var specials=["#","&","~","=",">","'",":",'"',"!",";",","];var regexSpecials=[".","*","+","|","[","]","(",")","/","^","$"];var sRE=new RegExp("("+specials.join("|")+"|\\"+regexSpecials.join("|\\")+")","g");module.exports=function(selector){return selector.replace(sRE,"\\$1")}},{}],90:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function getObservable(obsOrValue){if(typeof obsOrValue==="function")return obsOrValue;else return ko.observable(obsOrValue)}},{knockout:false}],91:[function(require,module,exports){"user strict";module.exports=function getUrlQuery(url){url=url||window.location.href;var vars=[],hash,queryIndex=url.indexOf("?");if(queryIndex>-1){var hashes=url.slice(queryIndex+1).split("&");for(var i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}}return vars}},{}],92:[function(require,module,exports){"use strict";var $=require("jquery");$.fn.multiline=function(text){this.text(text);this.html(this.html().replace(/\n/g,"<br/>"));return this}},{}],93:[function(require,module,exports){"use strict";function accessorDescriptor(field,fun){var desc={enumerable:true,configurable:true};desc[field]=fun;return desc}function defineGetter(obj,prop,get){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("get",get));if(Object.prototype.__defineGetter__)return obj.__defineGetter__(prop,get);throw new Error("browser does not support getters")}function defineSetter(obj,prop,set){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("set",set));if(Object.prototype.__defineSetter__)return obj.__defineSetter__(prop,set);throw new Error("browser does not support setters")}module.exports={defineGetter:defineGetter,defineSetter:defineSetter}},{}],94:[function(require,module,exports){"use strict";var $=require("jquery");var escapeSelector=require("../escapeSelector");function DomItemsManager(settings){this.idAttributeName=settings.idAttributeName||"id";this.allowDuplicates=!!settings.allowDuplicates||false;this.$root=null;$(function(){this.$root=$(settings.root||"body")}.bind(this))}module.exports=DomItemsManager;DomItemsManager.prototype.find=function find(containerName,root){var $root=$(root||this.$root);return $root.find("["+this.idAttributeName+'="'+escapeSelector(containerName)+'"]')};DomItemsManager.prototype.getActive=function getActive(){return this.$root.find("["+this.idAttributeName+"]:visible")};DomItemsManager.prototype.inject=function inject(name,html){html=html.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"");var $html=$("<div/>",{html:html}),$c=this.find(name,$html);if($c.length===0){$c=$html.attr(this.idAttributeName,name)}if(!this.allowDuplicates){var $prev=this.find(name);if($prev.length>0){$prev.replaceWith($c);$c=$prev}}$c.appendTo(this.$root)};DomItemsManager.prototype.switch=function switchActiveItem($from,$to,shell,notification){if(!$to.is(":visible")){shell.emit(shell.events.willOpen,$to,notification);$to.show();shell.emit(shell.events.itemReady,$to,notification);shell.emit(shell.events.opened,$to,notification)}else{shell.emit(shell.events.itemReady,$to,notification)}if($from.is(":visible")){shell.emit(shell.events.willClose,$from,notification);$from.find(":focus").blur();$from.hide();shell.emit(shell.events.closed,$from,notification)}};DomItemsManager.prototype.init=function init(){this.getActive().hide()}},{"../escapeSelector":89}],95:[function(require,module,exports){"use strict";var deps=require("./dependencies");function Shell(settings){deps.EventEmitter.call(this);this.$=settings.jquery||deps.jquery;this.$root=this.$(settings.root);this.baseUrl=settings.baseUrl||"";this.forceHashbang=settings.forceHashbang||false;this.linkEvent=settings.linkEvent||"click";this.parseUrl=(settings.parseUrl||deps.parseUrl).bind(this,this.baseUrl);this.absolutizeUrl=(settings.absolutizeUrl||deps.absolutizeUrl).bind(this,this.baseUrl);this.history=settings.history||window.history;this.indexName=settings.indexName||"index";this.items=settings.domItemsManager;this.loader=typeof settings.loader==="undefined"?deps.loader:settings.loader;if(this.loader)this.loader.baseUrl=this.baseUrl;this.events={willOpen:"shell-will-open",willClose:"shell-will-close",itemReady:"shell-item-ready",closed:"shell-closed",opened:"shell-opened"};this.accessControl=settings.accessControl||deps.accessControl;this.nonAccessName=settings.nonAccessName||"index"}Shell.prototype=Object.create(deps.EventEmitter.prototype,{constructor:{value:Shell,enumerable:false,writable:true,configurable:true}});module.exports=Shell;Shell.prototype.go=function go(url,state){if(this.forceHashbang){if(!/^#!/.test(url)){url="#!"+url}}else{url=this.absolutizeUrl(url)}this.history.pushState(state,undefined,url);return this.replace(state)};Shell.prototype.goBack=function goBack(state,steps){steps=0-(steps||1);if(steps<0&&Math.abs(steps)>=this.history.length){this.go(this.indexName)}else{this._pendingStateUpdate=state;this.history.go(steps)}};Shell.prototype.getUpdatedState=function getUpdatedState(state){state=this._pendingStateUpdate||state||this.history.state||{};this._pendingStateUpdate=null;var isHashBang=/#!/.test(location.href)||this.forceHashbang;var link=(isHashBang?location.hash:location.pathname)+(location.search||"");state.route=this.parseUrl(link);return state};Shell.prototype.replace=function replace(state){state=this.getUpdatedState(state);if(state.route.root===true){state.route=this.parseUrl(this.indexName)}var accessError=this.accessControl(state.route);if(accessError){return this.go(this.nonAccessName,accessError)}var $cont=this.items.find(state.route.name);var shell=this;var promise=null;if($cont&&$cont.length){promise=new Promise(function(resolve,reject){try{var $oldCont=shell.items.getActive();$oldCont=$oldCont.not($cont);shell.items.switch($oldCont,$cont,shell,state);resolve()}catch(ex){reject(ex)}})}else{if(this.loader){promise=this.loader.load(state.route).then(function(html){shell.items.inject(state.route.name,html);if(shell.items.find(state.route.name).length)return shell.replace(state)})}else{var err=new Error("Page not found ("+state.route.name+")");console.warn("Shell Page not found, state:",state);promise=Promise.reject(err);setTimeout(function(){this.goBack()}.bind(this),1)}}var thisShell=this;promise.catch(function(err){if(!(err instanceof Error))err=new Error(err);console.error("Shell, unexpected error.",err);thisShell.emit("error",err);return err});return promise};Shell.prototype.run=function run(){var shell=this;this.$(window).on(this.history.popstateEvent||"popstate",function(event){var state=event.state||event.originalEvent&&event.originalEvent.state||shell.history.state;shell.replace(state)});var linkWorking=null,linkWorkingDelay=340;this.$(document).on(this.linkEvent,"[href], [data-href]",function(e){if(linkWorking)return false;linkWorking=setTimeout(function(){linkWorking=null},linkWorkingDelay);var $t=shell.$(this),href=$t.attr("href")||$t.data("href");if(/^[a-z]+:/i.test(href)){return}else if(shell.forceHashbang&&/^#([^!]|$)/.test(href)){e.preventDefault();return}e.preventDefault();setTimeout(function(){shell.go(href)},1)});this.items.init();this.replace()}},{"./dependencies":97}],96:[function(require,module,exports){"use strict";var sanitizeUrl=require("./sanitizeUrl"),escapeRegExp=require("../escapeRegExp");function absolutizeUrl(baseUrl,url){url=sanitizeUrl(url);var matchBase=new RegExp("^"+escapeRegExp(baseUrl),"i");if(matchBase.test(url)){return url}return sanitizeUrl(baseUrl+url)}module.exports=absolutizeUrl},{"../escapeRegExp":88,"./sanitizeUrl":102}],97:[function(require,module,exports){"use strict";module.exports={parseUrl:null,absolutizeUrl:null,jquery:null,loader:null,accessControl:function allowAll(){return null},EventEmitter:null}},{}],98:[function(require,module,exports){"use strict";var $=require("jquery"),sanitizeUrl=require("./sanitizeUrl"),getUrlQuery=require("../getUrlQuery");var session=sessionStorage.getItem("hashbangHistory.store");if(!session){session={states:[]}}else{session=JSON.parse(session)}function getSuid(hash){var suid=+getUrlQuery(hash)._suid;if(isNaN(suid))return null;else return suid}function setSuid(hash,suid){var qs=getUrlQuery(hash);qs.push("_suid");qs._suid=suid;var query=[];for(var i=0;i<qs.length;i++){query.push(qs[i]+"="+encodeURIComponent(qs[qs[i]]))}query=query.join("&");if(query){var index=hash.indexOf("?");if(index>-1)hash=hash.substr(0,index);hash+="?"+query}return hash}function persist(){setTimeout(function(){sessionStorage.setItem("hashbangHistory.store",JSON.stringify(session))},1500)}function checkState(state){if(state){if(Object.keys(state).length>0){return state}return null}return state}function cannonicalUrl(url){url=sanitizeUrl(url||"");var ihash=url.indexOf("#");if(ihash>-1){url=url.substr(ihash+1)}url=url.replace(/^!/,"");return url}var latestPushedReplacedUrl=null;var hashbangHistory={pushState:function pushState(state,title,url){url=cannonicalUrl(url);state=checkState(state)||null;if(state!==null){session.states.push(state);var suid=session.states.length-1;url=setSuid(url,suid);persist()}latestPushedReplacedUrl=url;location.hash="#!"+url},replaceState:function replaceState(state,title,url){url=cannonicalUrl(url);var suid=getSuid(url),hasOldState=suid!==null;state=checkState(state)||null;if(state!==null||hasOldState){if(hasOldState){session.states[suid]=state}else{session.states.push(state);suid=session.states.length-1;url=setSuid(url,suid)}persist()}latestPushedReplacedUrl=url;location.hash="#!"+url},get state(){var suid=getSuid(location.hash);return suid!==null?session.states[suid]:null},get length(){return window.history.length},go:function go(offset){window.history.go(offset)},back:function back(){window.history.back()},forward:function forward(){window.history.forward()}};var $w=$(window);$w.on("hashchange",function(e){var url=e.originalEvent.newURL;url=cannonicalUrl(url);if(url===latestPushedReplacedUrl)return;var suid=getSuid(url),state=null;if(suid!==null)state=session.states[suid];$w.trigger(new $.Event("popstate",{state:state}),"hashbangHistory")});$w.on("popstate",function(e,source){if(source==="hashbangHistory")return;e.preventDefault();e.stopImmediatePropagation()});module.exports=hashbangHistory},{"../getUrlQuery":91,"./sanitizeUrl":102}],99:[function(require,module,exports){"use strict";var deps=require("./dependencies"),DomItemsManager=require("./DomItemsManager"),parseUrl=require("./parseUrl"),absolutizeUrl=require("./absolutizeUrl"),$=require("jquery"),loader=require("./loader"),EventEmitter=require("events").EventEmitter;$.extend(deps,{parseUrl:parseUrl,absolutizeUrl:absolutizeUrl,jquery:$,loader:loader,EventEmitter:EventEmitter});var Shell=require("./Shell");exports.Shell=Shell;exports.DomItemsManager=DomItemsManager},{"./DomItemsManager":94,"./Shell":95,"./absolutizeUrl":96,"./dependencies":97,"./loader":100,"./parseUrl":101,events:false}],100:[function(require,module,exports){"use strict";var $=require("jquery");module.exports={baseUrl:"/",load:function load(route){return new Promise(function(resolve,reject){console.log("Shell loading on demand",route.name,route);$.ajax({url:module.exports.baseUrl+route.name+".html",cache:false}).then(resolve,reject)})}}},{}],101:[function(require,module,exports){"use strict";var getUrlQuery=require("../getUrlQuery"),escapeRegExp=require("../escapeRegExp");function parseUrl(baseUrl,link){link=link||"";var rawUrl=link;link=link.replace(/^#!/,"").replace(/^#/,"");link=link.replace(/^\/|^\.\//,"");var query=getUrlQuery(link||"?");link=link.replace(/\?.*$/,"");var path=link.replace(new RegExp("^"+escapeRegExp(baseUrl),"i"),"");var match=/^\/?([^\/\.]+)[^\/]*(\/.*)*$/.exec(path);var parsed={root:true,name:null,segments:null,path:null,url:rawUrl,query:query};if(match){parsed.root=false;if(match[1]){parsed.name=match[1];if(match[2]){parsed.path=match[2];parsed.segments=match[2].replace(/^\//,"").split("/")}else{parsed.path="/";parsed.segments=[]}}}return parsed}module.exports=parseUrl},{"../escapeRegExp":88,"../getUrlQuery":91}],102:[function(require,module,exports){"use strict";function sanitizeUrl(url){return url.replace(/\.{2,}/g,"").replace(/\/{2,}/g,"/")}module.exports=sanitizeUrl},{}],103:[function(require,module,exports){"use strict";var localforage=require("localforage");exports.plugIn=function(AppModel){AppModel.prototype.tryLogin=function tryLogin(){return localforage.getItem("credentials").then(function(credentials){if(credentials){return this.login(credentials.username,credentials.password)}else{throw new Error("No saved credentials")}}.bind(this))};AppModel.prototype.login=function login(username,password){this.rest.extraHeaders=null;return this.rest.post("login",{username:username,password:password,returnProfile:true}).then(performLocalLogin(this,username,password))};AppModel.prototype.logout=function logout(){this.rest.extraHeaders=null;localforage.removeItem("credentials");localforage.removeItem("profile");this.rest.post("logout");return Promise.resolve()};AppModel.prototype.signup=function signup(username,password,profileType){this.rest.extraHeadres=null;return this.rest.post("signup?utm_source=app",{username:username,password:password,profileType:profileType,returnProfile:true}).then(performLocalLogin(this,username,password))}};function performLocalLogin(thisAppModel,username,password){return function(logged){thisAppModel.rest.extraHeaders={alu:logged.userID,alk:logged.authKey};localforage.setItem("credentials",{userID:logged.userID,username:username,password:password,authKey:logged.authKey});localforage.setItem("profile",logged.profile);thisAppModel.user().model.updateWith(logged.profile);return logged}}},{localforage:false}],104:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),apiHelper=require("../utils/apiHelper");exports.plugIn=function(AppModel){apiHelper.defineCrudApiForRest({extendedObject:AppModel.prototype,Model:CalendarEvent,modelName:"CalendarEvent",modelListName:"CalendarEvents",modelUrl:"events",idPropertyName:"calendarEventID"})}},{"../models/CalendarEvent":52,"../utils/apiHelper":85}],105:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),moment=require("moment");exports.create=function create(appModel){var api={};var cache={aptsByDate:{}};api.getAppointment=function getAppointment(ids){if(ids.calendarEventID){return appModel.calendarEvents.getEvent(ids.calendarEventID).then(Appointment.fromCalendarEvent)}else if(ids.bookingID){return appModel.bookings.getBooking(ids.bookingID).then(function(booking){return appModel.calendarEvents.getEvent(booking.confirmedDateID()).then(function(event){return Appointment.fromBooking(booking,event)})})}else{return Promise.reject("Unrecognized ID")}};api.getAppointmentsByDate=function getAppointmentsByDate(date){var dateKey=moment(date).format("YYYYMMDD");if(cache.aptsByDate.hasOwnProperty(dateKey)){return Promise.resolve(cache.aptsByDate[dateKey].data)}else{return Promise.all([appModel.bookings.getBookingsByDate(date),appModel.calendarEvents.getEventsByDate(date)]).then(function(group){var events=group[1],bookings=group[0],apts=[];if(events&&events().length){apts=Appointment.listFromCalendarEventsBookings(events(),bookings())}cache.aptsByDate[dateKey]={data:apts};return apts})}};api.fillWithFreeSlots=function fillWithFreeSlots(appointmentsList){var slots=appointmentsList.sort(function(a,b){return a.startTime()>b.startTime()
});var filledSlots=[],zeroTime="00:00:00",last=zeroTime,lastDateTime=null,timeFormat="HH:mm:ss";slots.forEach(function(slot){var start=slot.startTime(),s=moment(start),end=slot.endTime(),e=moment(end);if(s.format(timeFormat)>last){if(lastDateTime===null){lastDateTime=new Date(start.getFullYear(),start.getMonth(),start.getDate(),0,0,0)}filledSlots.push(Appointment.newFreeSlot({start:lastDateTime,end:start}))}filledSlots.push(slot);lastDateTime=end;last=e.format(timeFormat)});var lastEnd=lastDateTime&&moment(lastDateTime).format(timeFormat);if(lastEnd!==zeroTime){var nextMidnight=new Date(lastDateTime.getFullYear(),lastDateTime.getMonth(),lastDateTime.getDate()+1,0,0,0);filledSlots.push(Appointment.newFreeSlot({start:lastDateTime,end:nextMidnight}))}return filledSlots};return api}},{"../models/Appointment":49,moment:false}],106:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getBookings:function(filters){return appModel.rest.get("bookings",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Booking(rawItem)})})}}};var cacheByDate={};api.getBookingsByDate=function getBookingsByDate(date){var dateKey=moment(date).format("YYYYMMDD");if(cacheByDate.hasOwnProperty(dateKey)){return Promise.resolve(cacheByDate[dateKey])}else{return api.remote.getBookings({start:date,end:moment(date).add(1,"days").toDate()}).then(function(bookings){var arr=ko.observableArray(bookings);cacheByDate[dateKey]=arr;return arr})}};api.getUpcomingBookings=function getUpcomingBookings(){return appModel.rest.get("upcoming-bookings")};api.getBooking=function getBooking(id){if(!id)return Promise.reject("The bookingID is required to get a booking");return appModel.rest.get("bookings/"+id).then(function(booking){return new Booking(booking)})};return api}},{"../models/Booking":50,knockout:false,moment:false}],107:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getCalendarEvents:function(filters){return appModel.rest.get("events",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new CalendarEvent(rawItem)})})}}};var cache={eventsByDate:{}};api.getEventsByDate=function getEventsByDate(date){var dateKey=moment(date).format("YYYYMMDD");if(cache.eventsByDate.hasOwnProperty(dateKey)){return Promise.resolve(cache.eventsByDate[dateKey].data)}else{return api.remote.getCalendarEvents({start:date,end:moment(date).add(1,"days").toDate()}).then(function(events){var arr=ko.observableArray(events);cache.eventsByDate[dateKey]={data:arr};return arr})}};api.getEvent=function getEvent(id){if(!id)return Promise.reject("The calendarEventID is required to get an event");return appModel.rest.get("events/"+id).then(function(event){return new CalendarEvent(event)})};return api}},{"../models/CalendarEvent":52,knockout:false,moment:false}],108:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return appModel.rest.get("calendar-syncing")},push:function push(){return appModel.rest.put("calendar-syncing",this.data.model.toPlainObject())}});rem.isReseting=ko.observable(false);rem.resetExportUrl=function resetExportUrl(){rem.isReseting(true);return appModel.rest.post("calendar-syncing/reset-export-url").then(function(updatedSyncSettings){rem.data.model.updateWith(updatedSyncSettings);rem.isReseting(false);return updatedSyncSettings})};return rem}},{"../models/CalendarSyncing":53,"../utils/RemoteModel":81,knockout:false}],109:[function(require,module,exports){"use strict";var Address=require("../models/Address");var RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){return new RemoteModel({data:new Address,ttl:{minutes:1},localStorageName:"homeAddress",fetch:function fetch(){return appModel.rest.get("addresses/home")},push:function push(){return appModel.rest.put("addresses/home",this.data.model.toPlainObject())}})}},{"../models/Address":48,"../utils/RemoteModel":81}],110:[function(require,module,exports){"use strict";var localforage=require("localforage"),PricingType=require("../models/PricingType"),JobTitle=require("../models/JobTitle");exports.create=function create(appModel){var api={},cache={jobTitles:{},pricingTypes:null};function mapToPricingTypes(rawItems){cache.pricingTypes={};if(rawItems){rawItems.forEach(function(rawItem){cache.pricingTypes[rawItem.pricingTypeID]=new PricingType(rawItem)})}return cache.pricingTypes}api.getPricingTypes=function getPricingTypes(){if(cache.pricingTypes){return Promise.resolve(cache.pricingTypes)}else{return localforage.getItem("pricingTypes").then(function(pricingTypes){if(pricingTypes){return mapToPricingTypes(pricingTypes)}else{return appModel.rest.get("pricing-types").then(function(raw){localforage.setItem("pricingTypes",raw);return mapToPricingTypes(raw)})}})}};api.getPricingType=function getPricingType(id){return api.getPricingTypes().then(function(allByID){return allByID[id]||null})};api.getJobTitle=function getJobTitle(id){if(!id)return Promise.reject("Needs an ID to get a Job Title");if(cache.jobTitles[id]){return Promise.resolve(cache.jobTitles[id])}else{return localforage.getItem("jobTitles/"+id).then(function(jobTitle){if(jobTitle){cache.jobTitles[id]=new JobTitle(jobTitle);return cache.jobTitles[id]}else{return appModel.rest.get("job-titles/"+id).then(function(raw){localforage.setItem("jobTitles/"+id,raw);cache.jobTitles[id]=new JobTitle(raw);return cache.jobTitles[id]})}})}};return api}},{"../models/JobTitle":56,"../models/PricingType":66,localforage:false}],111:[function(require,module,exports){var ko=require("knockout"),$=require("jquery"),Model=require("../models/Model"),Rest=require("../utils/Rest"),localforage=require("localforage");function AppModel(){Model(this);this.userProfile=require("./AppModel.userProfile").create(this);this.user=ko.computed(function(){return this.userProfile.data},this);this.schedulingPreferences=require("./AppModel.schedulingPreferences").create(this);this.calendarSyncing=require("./AppModel.calendarSyncing").create(this);this.simplifiedWeeklySchedule=require("./AppModel.simplifiedWeeklySchedule").create(this);this.marketplaceProfile=require("./AppModel.marketplaceProfile").create(this);this.homeAddress=require("./AppModel.homeAddress").create(this);this.privacySettings=require("./AppModel.privacySettings").create(this);this.bookings=require("./AppModel.bookings").create(this);this.calendarEvents=require("./AppModel.calendarEvents").create(this);this.jobTitles=require("./AppModel.jobTitles").create(this);this.userJobProfile=require("./AppModel.userJobProfile").create(this);this.appointments=require("./AppModel.appointments").create(this);this.serviceAddresses=require("./AppModel.serviceAddresses").create(this)}require("./AppModel-account").plugIn(AppModel);AppModel.prototype.loadLocalCredentials=function loadLocalCredentials(){return new Promise(function(resolve){var resolveAnyway=function(doesnMatter){console.warning("App Model Init err",doesnMatter);resolve()};localforage.getItem("credentials").then(function(credentials){if(credentials&&credentials.userID&&credentials.username&&credentials.authKey){this.rest.extraHeaders={alu:credentials.userID,alk:credentials.authKey};this.userProfile.load().then(function(profile){if(profile){resolve()}else{this.tryLogin().then(resolve,resolveAnyway)}}.bind(this),resolveAnyway)}else{resolve()}}.bind(this),resolveAnyway)}.bind(this))};AppModel.prototype.init=function init(){localforage.config({name:"LoconomicsApp",version:.1,size:4980736,storeName:"keyvaluepairs",description:"Loconomics App",driver:localforage.LOCALSTORAGE});return localforage.getItem("config").then(function(config){config=config||{};if(config.siteUrl){$("html").attr("data-site-url",config.siteUrl)}else{config.siteUrl=$("html").attr("data-site-url")}this.rest=new Rest(config.siteUrl+"/api/v1/en-US/");this.rest.onAuthorizationRequired=function(retry){this.tryLogin().then(function(){retry()})}.bind(this);return this.loadLocalCredentials()}.bind(this))};module.exports=AppModel;require("./AppModel-events").plugIn(AppModel)},{"../models/Model":63,"../utils/Rest":82,"./AppModel-account":103,"./AppModel-events":104,"./AppModel.appointments":105,"./AppModel.bookings":106,"./AppModel.calendarEvents":107,"./AppModel.calendarSyncing":108,"./AppModel.homeAddress":109,"./AppModel.jobTitles":110,"./AppModel.marketplaceProfile":112,"./AppModel.privacySettings":113,"./AppModel.schedulingPreferences":114,"./AppModel.serviceAddresses":115,"./AppModel.simplifiedWeeklySchedule":116,"./AppModel.userJobProfile":117,"./AppModel.userProfile":118,knockout:false,localforage:false}],112:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile");var RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){return new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return appModel.rest.get("marketplace-profile")},push:function push(){return appModel.rest.put("marketplace-profile",this.data.model.toPlainObject())}})}},{"../models/MarketplaceProfile":61,"../utils/RemoteModel":81}],113:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings");var RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){return new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return appModel.rest.get("privacy-settings")},push:function push(){return appModel.rest.put("privacy-settings",this.data.model.toPlainObject())}})}},{"../models/PrivacySettings":67,"../utils/RemoteModel":81}],114:[function(require,module,exports){"use strict";var SchedulingPreferences=require("../models/SchedulingPreferences");var RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){return new RemoteModel({data:new SchedulingPreferences,ttl:{minutes:1},localStorageName:"schedulingPreferences",fetch:function fetch(){return appModel.rest.get("scheduling-preferences")},push:function push(){return appModel.rest.put("scheduling-preferences",this.data.model.toPlainObject())}})}},{"../models/SchedulingPreferences":68,"../utils/RemoteModel":81}],115:[function(require,module,exports){"use strict";var Address=require("../models/Address"),ko=require("knockout"),localforage=require("localforage"),CacheControl=require("../utils/CacheControl");function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[item[byField]]=itemIndex});return index}exports.create=function create(appModel){var api={state:{isLoading:ko.observable(false),isSyncing:ko.observable(false),isSaving:ko.observable(false)}};var cache={};api.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},api.state);function newCacheEntry(list){return{control:new CacheControl({ttl:{minutes:1}}),list:list||null,index:list&&createIndex(list,"addressID")||{}}}function setJobTitleCache(jobTitleID,list){var cacheEntry=cache[jobTitleID];if(cacheEntry){cacheEntry.list=list||[];cacheEntry.index=createIndex(list||[],"addressID")}else{cacheEntry=cache[jobTitleID]=newCacheEntry(list)}cacheEntry.control.latest=new Date}function getJobTitleCache(jobTitleID){var cacheEntry=cache[jobTitleID];return cacheEntry||newCacheEntry()}function getItemFromCache(groupID,itemID){var cacheEntry=cache[groupID];if(cacheEntry){return cacheEntry.list[cacheEntry.index[itemID]]||null}else{return null}}function setItemCache(groupID,itemID,item){var cacheEntry=cache[groupID]||newCacheEntry([]),itemIndex=-1;var exists=cacheEntry.index[itemID]>=0;if(exists){itemIndex=cacheEntry.index[itemID];cacheEntry.list[itemIndex]=item}else{itemIndex=cacheEntry.list.push(item)-1;cacheEntry.index[itemID]=itemIndex}}function delItemCache(groupID,itemID){var cacheEntry=cache[groupID]||null;if(cacheEntry){var itemIndex=cacheEntry.index[itemID];cacheEntry.splice(itemIndex,1);delete cacheEntry.index[itemID];Object.keys(cacheEntry.index).forEach(function(key){if(cacheEntry.index[key]>itemIndex)cacheEntry.index[key]--})}}function fetchFromLocal(jobTitleID){return localforage.getItem("addresses/service/"+jobTitleID)}function fetchFromRemote(jobTitleID){return appModel.rest.get("addresses/service/"+jobTitleID)}api.getList=function getList(jobTitleID){var cacheEntry=getJobTitleCache(jobTitleID);if(cacheEntry.control.mustRevalidate()){if(!cacheEntry.list){api.state.isLoading(true);return fetchFromLocal(jobTitleID).then(function(data){var remotePromise=fetchFromRemote(jobTitleID);return data?data:remotePromise}).then(function(data){setJobTitleCache(jobTitleID,data);pushToLocal(jobTitleID,data);api.state.isLoading(false);api.state.isSyncing(false);return data}).catch(function(err){api.state.isLoading(false);api.state.isSyncing(false);return err})}else{api.state.isSyncing(true);return fetchFromRemote(jobTitleID).then(function(data){setJobTitleCache(jobTitleID,data);pushToLocal(jobTitleID,data);api.state.isLoading(false);api.state.isSyncing(false);return data}).catch(function(err){api.state.isLoading(false);api.state.isSyncing(false);return err})}}else{return Promise.resolve(cacheEntry.list)}};api.getItem=function getItem(jobTitleID,addressID){return api.getList(jobTitleID).then(function(){var cacheItem=getItemFromCache(jobTitleID,addressID);if(!cacheItem)throw new Error("Not Found");return cacheItem})};function pushToLocal(jobTitleID,data){return localforage.setItem("addresses/service/"+jobTitleID,data)}function pushToRemote(data){var method=data.addressID?"put":"post";var url="addresses/service/"+data.jobTitleID+(data.addressID?"/"+data.addressID:"");return appModel.rest[method](url,data)}api.setItem=function setItem(data){api.state.isSaving(true);return pushToRemote(data).then(function(serverData){if(serverData){setItemCache(serverData.jobTitleID,serverData.addressID,serverData);pushToLocal(serverData.jobTitleID,getJobTitleCache(serverData.jobTitleID).list)}api.state.isSaving(false);return serverData}).catch(function(err){api.state.isSaving(false);return err})};function removeFromRemote(jobTitleID,addressID){return appModel.rest.delete("addresses/service/"+jobTitleID+"/"+addressID)}api.delItem=function delItem(jobTitleID,addressID){return removeFromRemote(jobTitleID,addressID).then(function(){delItemCache(jobTitleID,addressID);pushToLocal(jobTitleID,getJobTitleCache(jobTitleID).list)})};api.asModel=function asModel(object){if(Array.isArray(object)){return object.map(function(item){return new Address(item)})}else{return new Address(object)}};return api}},{"../models/Address":48,"../utils/CacheControl":77,knockout:false,localforage:false}],116:[function(require,module,exports){"use strict";var SimplifiedWeeklySchedule=require("../models/SimplifiedWeeklySchedule"),RemoteModel=require("../utils/RemoteModel"),moment=require("moment");var defaultSlotSize=15;var weekDayProperties=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];exports.create=function create(appModel){return new RemoteModel({data:new SimplifiedWeeklySchedule,ttl:{minutes:1},localStorageName:"weeklySchedule",fetch:function fetch(){return appModel.rest.get("availability/weekly-schedule").then(fromWeeklySchedule)},push:function push(){var plainData={"all-time":false,"json-data":{}};if(this.data.isAllTime()===true){plainData["all-time"]=true}else{plainData["json-data"]=JSON.stringify(toWeeklySchedule(this.data.model.toPlainObject(true)))}return appModel.rest.put("availability/weekly-schedule",plainData).then(fromWeeklySchedule)}})};function fromWeeklySchedule(weeklySchedule){var simpleWS={};if(weeklySchedule.defaultStatus!=="unavailable"||weeklySchedule.status!=="available"){throw{name:"input-format",message:"Weekly schedule, given statuses not supported, status: "+weeklySchedule.status+", defaultStatus: "+weeklySchedule.defaultStatus}}var slotSize=(weeklySchedule.slotSize||defaultSlotSize)|0;Object.keys(weeklySchedule.slots).forEach(function(weekday){if(weekDayProperties.indexOf(weekday)===-1){return}var dayslots=weeklySchedule.slots[weekday];var from=null,to=null,previous=null;dayslots.some(function(slot){var minutes=moment.duration(slot).asMinutes()|0;if(from===null){from=minutes;previous=minutes}else{if(previous+slotSize===minutes){to=minutes;previous=minutes}else{return true}}});if(from!==null){var simpleDay={from:from,to:0};simpleWS[weekday]=simpleDay;if(to!==null){simpleDay.to=to+slotSize}else{simpleDay.to=from+slotSize}}});return simpleWS}function toWeeklySchedule(simplifiedWeeklySchedule){var slotSize=defaultSlotSize;var weeklySchedule={status:"available",defaultAvailability:"unavailable",slots:{},slotSize:slotSize};Object.keys(simplifiedWeeklySchedule).forEach(function(weekday){if(weekDayProperties.indexOf(weekday)===-1){return}var simpleDay=simplifiedWeeklySchedule[weekday];var from=simpleDay.from|0,to=simpleDay.to|0;weeklySchedule.slots[weekday]=[];if(to>from){var previous=from;while(previous<to){weeklySchedule.slots[weekday].push(minutesToTimeString(previous));previous+=slotSize}}});return weeklySchedule}function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}},{"../models/SimplifiedWeeklySchedule":70,"../utils/RemoteModel":81,moment:false}],117:[function(require,module,exports){"use strict";var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage");exports.create=function create(appModel){var api={},defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};function mapToUserJobProfile(rawItems){cache.userJobProfile.list=[];cache.userJobTitles={};if(rawItems){rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);cache.userJobProfile.list.push(m);setGetUserJobTitleToCache(rawItem)})}cache.userJobProfile.cache.latest=new Date;return cache.userJobProfile.list}function getUserJobProfileFromLocal(){return localforage.getItem("userJobProfile").then(function(userJobProfile){if(userJobProfile){return mapToUserJobProfile(userJobProfile)}return null})}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};if(c.model){c.model.model.updateWith(rawItem)}else{c.model=new UserJobTitle(rawItem)}if(c.cache){c.cache.latest=new Date}else{c.cache=new CacheControl({ttl:defaultTtl})}return c.model}var fetchUserJobProfile=function(){return appModel.rest.get("user-job-profile").then(function(raw){localforage.setItem("userJobProfile",raw);return mapToUserJobProfile(raw)})};api.getUserJobProfile=function(){if(cache.userJobProfile.cache.mustRevalidate()){if(!cache.userJobProfile.list){return getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data?data:remotePromise})}else{return fetchUserJobProfile()}}else{return Promise.resolve(cache.userJobProfile.list)}};var fetchUserJobTitle=function(jobTitleID){return appModel.rest.get("user-job-profile/"+jobTitleID).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.getUserJobTitle=function(jobTitleID){if(!jobTitleID)return Promise.reject("Job Title ID required");if(!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()){return fetchUserJobTitle(jobTitleID)}else{if(cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model){return Promise.resolve(cache.userJobTitles[jobTitleID].model)}else{return getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model}).catch(fetchUserJobTitle.bind(null,jobTitleID))}}};api.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return api.getUserJobTitle(jobTitleID).then(function(userJobTitle){if(!userJobTitle){throw{name:"Not Found",message:"You have not this job title in your profile. "+"Maybe was deleted from your profile recently."}}return Promise.all([userJobTitle,appModel.jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle){throw{name:"Not Found",message:"The job title does not exist."}}return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})};return api}},{"../models/UserJobTitle":73,"../utils/CacheControl":77,localforage:false}],118:[function(require,module,exports){"use strict";var User=require("../models/User");var RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){return new RemoteModel({data:User.newAnonymous(),ttl:{minutes:1},localStorageName:"profile",fetch:function fetch(){return appModel.rest.get("profile")},push:function push(){return appModel.rest.put("profile",this.data.model.toPlainObject())}})}},{"../models/User":72,"../utils/RemoteModel":81}],119:[function(require,module,exports){"use strict";var ko=require("knockout");function FormCredentials(){this.username=ko.observable("");this.password=ko.observable("");var emailRegexp=/^[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+@[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+$/;this.username.error=ko.observable("");this.username.subscribe(function(v){if(v){if(emailRegexp.test(v)){this.username.error("")}else{this.username.error("Is not a valid email")}}else{this.username.error("Required")}}.bind(this));this.password.error=ko.observable("");this.password.subscribe(function(v){var err="";if(!v)err="Required";this.password.error(err)}.bind(this))}module.exports=FormCredentials},{knockout:false}],120:[function(require,module,exports){var Model=require("../models/Model");function NavAction(values){Model(this);this.model.defProperties({link:"",icon:"",text:"",isTitle:false,isModal:false,isShell:false,isMenu:false},values)}module.exports=NavAction;NavAction.prototype.getHref=function getHref(){return this.isMenu()||this.isModal()||this.isShell()?"#":this.link()};NavAction.prototype.getModalTarget=function getModalTarget(){return this.isMenu()||!this.isModal()||this.isShell()?"":this.link()};NavAction.prototype.getShellCommand=function getShellCommand(){return this.isMenu()||!this.isShell()?"":this.link()};NavAction.prototype.getMenuID=function getMenuID(){return!this.isMenu()?"":this.link()};NavAction.prototype.getMenuLink=function getMenuLink(){return!this.isMenu()?"":"#"+this.link()};NavAction.goHome=new NavAction({link:"/",icon:"glyphicon glyphicon-home"});NavAction.goBack=new NavAction({link:"goBack",icon:"glyphicon glyphicon-arrow-left",isShell:true});NavAction.newItem=new NavAction({link:"#newItem",icon:"glyphicon glyphicon-plus",isModal:true});NavAction.menuIn=new NavAction({link:"menuIn",icon:"menu",isMenu:true});NavAction.menuOut=new NavAction({link:"menuOut",icon:"menu",isMenu:true});NavAction.menuNewItem=new NavAction({link:"menuNewItem",icon:"glyphicon glyphicon-plus",isMenu:true});NavAction.goHelpIndex=new NavAction({link:"#helpIndex",text:"help",isModal:true});NavAction.goLogin=new NavAction({link:"/login",text:"log-in"});NavAction.goLogout=new NavAction({link:"/logout",text:"log-out"});NavAction.goSignup=new NavAction({link:"/signup",text:"sign-up"})},{"../models/Model":63}],121:[function(require,module,exports){var Model=require("../models/Model");function NavBar(values){Model(this);this.model.defProperties({title:"",leftAction:null,rightAction:null},values)}module.exports=NavBar},{"../models/Model":63}],122:[function(require,module,exports){"use strict";var getObservable=require("../utils/getObservable");function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null);this.endTime=getObservable(params.endTime||null);this.subject=getObservable(params.subject||null);this.description=getObservable(params.description||null);this.link=getObservable(params.link||null);this.actionIcon=getObservable(params.actionIcon||null);this.actionText=getObservable(params.actionText||null);this.classNames=getObservable(params.classNames||null)}module.exports=TimeSlotViewModel;var numeral=require("numeral");TimeSlotViewModel.fromAppointment=function fromAppointment(apt){return new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,subject:apt.summary,description:apt.description,link:"#!appointment/"+apt.startTime().toISOString()+"/"+apt.id(),actionIcon:apt.sourceBooking()?null:apt.sourceEvent()?"glyphicon glyphicon-chevron-right":!apt.id()?"glyphicon glyphicon-plus":null,actionText:apt.sourceBooking()&&apt.sourceBooking().bookingRequest()&&apt.sourceBooking().bookingRequest().pricingEstimate()?numeral(apt.sourceBooking().bookingRequest().pricingEstimate().totalPrice()||0).format("$0.00"):null,classNames:apt.id()?null:"ListView-item--tag-success"})}},{"../utils/getObservable":90,numeral:1}],123:[function(require,module,exports){"use strict";var ko=require("knockout");function UserJobProfileViewModel(app){this.userJobProfile=ko.observableArray([]);this.isFirstTime=ko.observable(true);this.isLoading=ko.observable(false);this.isSyncing=ko.observable(false);this.thereIsError=ko.observable(false);var jobTitlesIndex={};function syncJobTitle(jobTitleID){return app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){jobTitlesIndex[jobTitleID]=jobTitle})}function attachJobTitle(userJobTitle){userJobTitle.jobTitle=ko.computed(function(){return jobTitlesIndex[this.jobTitleID()]},userJobTitle)}var showLoadingError=function showLoadingError(err){app.modals.showError({title:"An error happening when loading your job profile.",error:err&&err.error||err});this.isLoading(false);this.isSyncing(false);this.thereIsError(true)}.bind(this);this.sync=function sync(){var firstTime=this.isFirstTime();this.isFirstTime(false);if(firstTime){this.isLoading(true)}else{this.isSyncing(true)}app.model.userJobProfile.getUserJobProfile().then(function(userJobProfile){Promise.all(userJobProfile.map(function(userJobTitle){return syncJobTitle(userJobTitle.jobTitleID())})).then(function(){userJobProfile.forEach(attachJobTitle);this.userJobProfile(userJobProfile);this.isLoading(false);this.isSyncing(false);this.thereIsError(false)}.bind(this)).catch(showLoadingError)}.bind(this)).catch(showLoadingError)}.bind(this)}module.exports=UserJobProfileViewModel},{knockout:false}]},{},[41]);