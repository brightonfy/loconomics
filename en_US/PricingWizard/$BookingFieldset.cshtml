@using WebMatrix.Data;
@{
    var p = PageData["providerrow"] ?? (PageData["providerrow"] = DashboardFunctions.GetUserRow(Request["providerid"].AsInt()));
    var c = PageData["customerrow"] ?? (PageData["customerrow"] = DashboardFunctions.GetUserRow());
    var pos = PageData["positionrow"] ?? (PageData["positionrow"] = DashboardFunctions.GetUserPos(Request["providerid"].AsInt(),
        Request["positionid"].AsInt()));
    //var customerid = c.UserID;
    
    if (p == null || c == null || pos == null){
        var inputdataerrormessage = "No enought input data to show results";
        if (IsPost){
            CommonHelpers.ReturnJsonError(-1, inputdataerrormessage);
        }else{
            throw new Exception(inputdataerrormessage);
        }
    }

    string pageToLoad = "";
    
    using (var db = Database.Open("sqlloco")){
        
        // TODO: Get Customer Type Id   
        var clienttypeid = PageData["ClientTypeID"] = 1;     
        
        // Get our Pricing Type ID:
        int pricingtypeid = (int)db.QueryValue(@"
            SELECT  pricingtypeid
            FROM    positionpricingtype
            WHERE   countryid=@0 AND clienttypeid=@1 AND positionid=@2
        ", 1, clienttypeid, pos.PositionID);
        
        switch (pricingtypeid) {
            case 1: // Hours
                pageToLoad = "_CustomerHoursType.cshtml";
                break;
            case 2: // Custom
                pageToLoad = "_CustomerCustomType.cshtml";
                break;
            case 3: // Packages
                pageToLoad = "_CustomerPackagesType.cshtml";
                break;
            case 4: // Invoice
                pageToLoad = "_CustomerInvoiceType.cshtml";
                break;
        }
    }
}
    <fieldset class="pricing-wizard ajax ajax-box" data-ajax-fieldset-action="@(UrlUtil.LangPath)PricingWizard/$BookingFieldset/Calculate/?providerid=@(p.UserID)&amp;positionid=@(pos.PositionID)">
        <legend>Pricing estimate:</legend>
        @RenderPage(pageToLoad)
    </fieldset>