@{     
    Layout = "../_SiteLayout.cshtml";
   
    int providerid = PageData["providerid"] = Request["ProviderID"].AsInt();
    int positionid = PageData["positionid"] = Request["PositionID"].AsInt();
    
    if (providerid == 0 || positionid == 0) {
        Response.Redirect(UrlUtil.LangPath);
    }
    
    // var Service, string ServiceType, string position
    
    var providerrow = PageData["providerrow"] = ProfileFunctions.GetProviderProfileRow(providerid);
    //var posrows = PageData["posrows"] = ProfileFunctions.GetPositionRow(providerid, positionid);
    var posrows = PageData["posrows"] = DashboardFunctions.GetUserPos(providerid);
    
    if (providerrow == null || posrows == null || posrows.Count == 0) {
        Response.Redirect(UrlUtil.LangPath);
    }
    
    // Check if the positionid requested exists for current user:
    var posexists = false;
    foreach(var c in posrows){
        if (c.PositionID == positionid) {
            posexists = true;
        }
    }
    if (!posexists) {
        Response.Redirect(UrlUtil.LangPath);
    }
    
    // Number of maximum positions displayed:
    var maxPositions = 5;
    
    Page.Title = PageData["providerrow"].FirstName;
    Scripts.Add(UrlUtil.AppPath + "Scripts/Profile.js");
}
@helper printFriend(string name, string photo){
    if (String.IsNullOrEmpty(photo)){ photo = "generic-friend-avatar.png";}
    /* Between LI and A elements must not have white spaces */
    <li><a href="@Href(UrlUtil.LangPath + "Profile/?user=" + name)"><img alt="@name" src="@Href(UrlUtil.AppPath + "img/" + photo)"/></a></li>
}
@helper oldPrintMailbox(){
    // TODO Review old code: (is a section removed from the current design)
    /*
         <div id="inbox_grid" class="tab-body">
         <h1>
             <title>Inbox</title>
         </h1>
            @RenderPage(UrlUtil.LangPath + "MailBoxGrid/")
        </div>
    */
}
@helper printName(dynamic p){
    string l = (string)p["LastName"];
    if (l.Length > 1) { l = l.Substring(0, 1); }
    @(p["FirstName"] + " " + @l + ".")
}

<div id="container" class="profile clearfix">
    <div id="main" class="tabbed folders">

	    <div id="profileHeader" class="clearfix">
            <img id="avatar" class="profile-pic" src="@Href(UrlUtil.LangPath + "Profile/Photo/?UserID=" + providerrow["UserID"])" alt="User Photo" />
            <h1 class="profile-name">@printName(providerrow)</h1>
		    
		    <p class="profile-desc">
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lorem turpis, volutpat id adipiscing placerat, convallis sit amet orci. Donec quis enim nunc. Etiam iaculis porttitor sodales. Ut vel nisl vel augue cursus viverra vitae sed lectus. Nunc varius vehicula felis, in tincidunt lorem venenatis mattis. Praesent vehicula justo quis justo laoreet et fringilla nibh iaculis. 
            </p>
            <ul id="verifications">
                <li class="license">Professional license</li>
                <li class="verification">Customer-reviewed</li>
                <li class="verification">Background checked</li>
                <li class="verification">Address verified</li>
                <li class="verification">SSN verified</li>
            </ul>
            <ul class="social-networking">
                <li class="facebook">
                    <script src="https://connect.facebook.net/en_US/all.js#xfbml=1"></script>
                    <fb:like href="@Request.Url.PathAndQuery" send="true" layout="button_count" width="100" show_faces="true" font=""></fb:like>
                </li><!-- facebook -->
                <li class="linkedin">
                    <script src="https://platform.linkedin.com/in.js" type="text/javascript"></script>
                    <script type="IN/Share" data-url="@Request.Url.PathAndQuery" data-counter="right"></script>
                </li><!-- linkedin -->
                <li>
                    <script type="text/javascript" src="https://apis.google.com/js/plusone.js">
                        { lang: 'en' }
                    </script>
                    <g:plusone size="medium" href="@Request.Url.PathAndQuery"></g:plusone>
                </li><!-- google -->
                <li>
                    <iframe scrolling="no" frameborder="0" allowtransparency="true" src="//platform.twitter.com/widgets/tweet_button.html" class="twitter-share-button twitter-count-horizontal" style="width: 110px; height: 20px;" title="Twitter For Websites: Tweet Button"></iframe>
                </li><!-- twitter -->
            </ul>
            <div class="social-connections">
                <ul>
                    @printFriend("Fernando", null)
                    @printFriend("Joshua", null)
                    @printFriend("Fernando", null)
                    @printFriend("Joshua", null)
                    @printFriend("Fernando", null)
                </ul>
                <span class="friends"><span class="quantity">14</span> of your friends have used this provider's services</span>
            </div>
	    </div><!-- #profileHeader -->
        
		<ul class="tabs">
            @{
                var n = 0;
                foreach(var c in PageData["posrows"]){
                    n++;
                    if (n > maxPositions) { break; }
                    var cls = (c.PositionID == positionid ? "current" : "");
                    <li class="@cls"><a class="@cls" href="@("#position"+n)">@c.PositionSingular</a></li>
                }
            }
		</ul><!-- .tabs -->
        
        @{
            n = 0;
            foreach(var position in PageData["posrows"]){
                n++;
                if (n > maxPositions) { break; }
                var cls = (position.PositionID == positionid ? "current" : "");
                PageData["position"] = position;
                PageData["npos"] = n;
        <div id="@("position"+n)" class="tab-body fancy tabbed buttons @cls position-tab">
            
            @RenderPage("_PositionSummary.cshtml")
            
            <ul class="tabs">
                <li class="current"><a class="button profile fanciful" href="@("#position"+n)-overview">Overview</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-reviews">Reviews</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-mywork">My Work</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-map">Map</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-availability">Availability</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-verifications">Verifications</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-message">Message</a></li>
            </ul>
            
            <div id="@("position"+n)-overview" class="tab-body current overview">
                @RenderPage("_Overview.cshtml")
            </div><!-- #@("position"+n)-overview -->
            <div id="@("position"+n)-reviews" class="tab-body reviews">
                @RenderPage("_Reviews.cshtml")
            </div><!-- #@("position"+n)-reviews -->
            <div id="@("position"+n)-mywork" class="tab-body mywork">
                @RenderPage("_MyWork.cshtml")
            </div><!-- #@("position"+n)-mywork -->
            <div id="@("position"+n)-map" class="tab-body map">
                @RenderPage("_Map.cshtml")
            </div><!-- #@("position"+n)-map -->
            <div id="@("position"+n)-availability" class="tab-body availability">
                @RenderPage("_Availability.cshtml")
            </div><!-- #@("position"+n)-availability -->
            <div id="@("position"+n)-verifications" class="tab-body verifications">
                @RenderPage("_Verifications.cshtml")
            </div><!-- #@("position"+n)-verifications -->
            <div id="@("position"+n)-message" class="tab-body message">
                @RenderPage("$Message.cshtml")
            </div><!-- #@("position"+n)-message -->
            
            <!-- TODO Remove this element, without break the position-summary -->
            <div class="clearfix"></div>
            
        </div><!-- #position@n -->
            }
        }
        
    </div>
    
    @{ /*   "Taking out search box in profile" 
            @RenderPage("Profile/_SearchInProfile.cshtml") */   }
    
</div>