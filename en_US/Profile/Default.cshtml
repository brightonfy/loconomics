@{     
    Layout = UrlUtil.LangPath + "_SiteLayout.cshtml";
   
    int userid = Request["userid"].AsInt();
    if (userid == 0) {
        userid = UrlData[0].AsInt();
    }
    // Preserve compability with providerid url param still:    
    if (userid == 0) {
        userid = Request["ProviderID"].AsInt();
    }
    int positionid = Request["PositionID"].AsInt();

    if (userid == 0) {
        Response.Redirect(UrlUtil.LangPath);
    }
        
    var u = DashboardFunctions.GetRequestedUserRow(userid);
    if (u == null) {
        Response.Redirect(UrlUtil.LangPath);
    }
    userid = u.UserID;
    
    dynamic posrows = null;
    if (u.IsProvider) {
        posrows = DashboardFunctions.GetUserPos(userid);
        
        // Check if the positionid requested exists for current user:
        var posexists = false;
        foreach(var c in posrows){
            if (c.PositionID == positionid) {
                posexists = true;
            }
        }
        if (!posexists) {
            Response.Redirect(UrlUtil.LangPath);
        }
    }
    
    // Number of maximum positions displayed:
    var maxPositions = 5;
    
    Page.Title = u.FirstName;
    Scripts.Add(UrlUtil.AppPath + "Scripts/Profile.js");
}
@helper printFriend(string name, string photo){
    if (String.IsNullOrEmpty(photo)){ photo = "generic-friend-avatar.png";}
    /* Between LI and A elements must not have white spaces */
    <li><a href="@Href(UrlUtil.LangPath + "Profile/?user=" + name)"><img alt="@name" src="@Href(UrlUtil.AppPath + "img/" + photo)"/></a></li>
}
@helper oldPrintMailbox(){
    // TODO Review old code: (is a section removed from the current design)
    /*
         <div id="inbox_grid" class="tab-body">
         <h1>
             <title>Inbox</title>
         </h1>
            @RenderPage(UrlUtil.LangPath + "MailBoxGrid/")
        </div>
    */
}
@helper printName(dynamic p){
    string l = (string)p["LastName"];
    if (l.Length > 1) { l = l.Substring(0, 1); }
    @(p["FirstName"] + " " + @l + ".")
}

<div id="container" class="profile clearfix">
    <div id="main" class="tabbed folders">

	    <div id="profileHeader" class="clearfix">
            <img id="avatar" class="profile-pic" src="@Href(UrlUtil.LangPath + "Profile/Photo/?UserID=" + u["UserID"])" alt="User Photo" />
            <h1 class="profile-name">@printName(u)</h1>
		    
		    <p class="profile-desc">
                @if (!String.IsNullOrWhiteSpace(u["PublicBio"])) {
                    @u["PublicBio"]
                } else {
                    <text>User doesn't provide information about itself.</text>
                    <br />
                    <text>It's strongly recommended for all users to write a public bio.</text>
                    @*Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lorem turpis, volutpat id adipiscing placerat, convallis sit amet orci. Donec quis enim nunc. Etiam iaculis porttitor sodales. Ut vel nisl vel augue cursus viverra vitae sed lectus. Nunc varius vehicula felis, in tincidunt lorem venenatis*@
                }
            </p>
            <ul id="verifications">
                <li class="license">Professional license</li>
                <li class="verification">Customer-reviewed</li>
                <li class="verification">Background checked</li>
                <li class="verification">Address verified</li>
                <li class="verification">SSN verified</li>
            </ul>
            @RenderPage(UrlUtil.LangPath + "Social/_SocialNetworkingWidget.cshtml")
            <div class="social-connections">
                <ul>
                    @printFriend("Fernando", null)
                    @printFriend("Joshua", null)
                    @printFriend("Fernando", null)
                    @printFriend("Joshua", null)
                    @printFriend("Fernando", null)
                </ul>
                <span class="friends"><span class="quantity">14</span> of your friends have used this provider's services</span>
            </div>
	    </div><!-- #profileHeader -->
        
		<ul class="tabs">
            @{
                var n = 0;
                foreach(var c in posrows){
                    n++;
                    if (n > maxPositions) { break; }
                    var cls = (c.PositionID == positionid ? "current" : "");
                    <li class="@cls"><a class="@cls" href="@("#position"+n)">@c.PositionSingular</a></li>
                }
            }
		</ul><!-- .tabs -->
        
        @{
            n = 0;
            foreach(var position in posrows){
                n++;
                if (n > maxPositions) { break; }
                var cls = (position.PositionID == positionid ? "current" : "");
                PageData["position"] = position;
        <div id="@("position"+n)" class="tab-body fancy tabbed buttons @cls position-tab">
            
            @RenderPage("_PositionSummary.cshtml")
            
            <ul class="tabs">
                <li class="current"><a class="button profile fanciful" href="@("#position"+n)-overview">Overview</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-reviews">Reviews</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-mywork">My Work</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-map">Map</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-availability">Availability</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-verifications">Verifications</a></li>
                <li><a class="button profile fanciful" href="@("#position"+n)-message">Message</a></li>
            </ul>
            
            <div id="@("position"+n)-overview" class="tab-body current overview">
                @RenderPage("_ProviderOverview.cshtml")
            </div><!-- #@("position"+n)-overview -->
            <div id="@("position"+n)-reviews" class="tab-body reviews">
                @RenderPage("_Reviews.cshtml")
            </div><!-- #@("position"+n)-reviews -->
            <div id="@("position"+n)-mywork" class="tab-body mywork">
                @RenderPage("_MyWork.cshtml")
            </div><!-- #@("position"+n)-mywork -->
            <div id="@("position"+n)-map" class="tab-body map">
                @RenderPage("_Map.cshtml")
            </div><!-- #@("position"+n)-map -->
            <div id="@("position"+n)-availability" class="tab-body availability">
                @RenderPage("_Availability.cshtml")
            </div><!-- #@("position"+n)-availability -->
            <div id="@("position"+n)-verifications" class="tab-body verifications">
                @RenderPage("_Verifications.cshtml")
            </div><!-- #@("position"+n)-verifications -->
            <div id="@("position"+n)-message" class="tab-body message">
                @RenderPage("$Message.cshtml")
            </div><!-- #@("position"+n)-message -->
            
            <!-- TODO Remove this element, without break the position-summary -->
            <div class="clearfix"></div>
            
        </div><!-- #position@n -->
            }
        }
        
    </div>
    
    @{ /*   "Taking out search box in profile" 
            @RenderPage("Profile/_SearchInProfile.cshtml") */   }
    
</div>