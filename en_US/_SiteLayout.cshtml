@using WebMatrix.Data;
@using WebMatrix.WebData;
@{
    Response.ContentEncoding = System.Text.Encoding.UTF8;
    var u = LcData.UserInfo.GetUserRow();
    var isHomePage = PageData["IsHomePage"] ?? false;
}
@helper howItWorksLi(){
                        <li>
                            <dl class="how-it-works">
                                <dt><a id="launchHowItWorks" href="@(UrlUtil.LangPath)HelpCenter/HowItWorks/">How it works &#x25BC;</a></dt>
                                <dd>
                                    <ul>
                                        <li><a href="@(UrlUtil.LangPath)HelpCenter/HowItWorks/#howitworks-customers">Customers</a></li>
                                        <li><a href="@(UrlUtil.LangPath)HelpCenter/HowItWorks/#howitworks-providers">Service providers</a></li>
                                    </ul>
                                </dd>
                            </dl>
                        </li>
}
<!doctype html>
    <!--[if lt IE 7]> <html class="no-js ie ie6 oldie" lang="@UrlUtil.LangId"> <![endif]-->
    <!--[if IE 7]>    <html class="no-js ie ie7 oldie" lang="@UrlUtil.LangId"> <![endif]-->
    <!--[if IE 8]>    <html class="no-js ie ie8 oldie" lang="@UrlUtil.LangId"> <![endif]-->
    <!--[if gt IE 8]> <html class="no-js ie" lang="@UrlUtil.LangId"> <![endif]-->
    <!--[if !IE]><!--> <html class="no-js" lang="@UrlUtil.LangId"> <!--<![endif]-->
     <head>
          <meta charset="utf-8"/>
          <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
          <title>Loconomics - @Page.Title</title>
          <meta name="description" content="Find service providers to do the job right. At your service!"/>
          <meta name="author" content="Loconomics Inc."/>
          @* Mobile viewport optimization is need only if there is a well optimized css counter-part, disabled until that: <meta name="viewport" content="width=device-width,initial-scale=1"/>*@
          <link rel="shortcut icon" href="@Href(UrlUtil.AppPath + "favicon.ico")" type="image/x-icon" />
          <link rel="stylesheet" href="@Href(UrlUtil.AppPath + "Styles/smoothness/jquery-ui-1.8.21.custom.css")"/>
           @* Our styles *@
           <link rel="stylesheet" href="@Href(UrlUtil.AppPath + "Styles/style.css?v=20120815")"/>
           @Styles.GetStylesTags()
           <script src="@Href(UrlUtil.AppPath + "Scripts/modernizr.custom.2.6.1.js")" type="text/javascript"></script>
            @* Our UrlUtil class *@
            <script type="text/javascript">
                @Html.Raw(UrlUtil.ToJsVar())
            </script>
    </head>
    <body class="@PageData["BodyClass"]">
        @RenderBody()
        <header>
		    <div class="wrap">
			    <a id="logo" class="replace" href="@Href(UrlUtil.LangPath)">Loconomics, at your service.</a>
                @if (!WebSecurity.IsAuthenticated) {
                <ul class="anonymous-tools">
                        @howItWorksLi()
                        <li><a class="register" href="@(UrlUtil.LangPath)Account/Register/">Sign Up</a></li>
                        <li><a class="login" href="@(UrlUtil.LangPath)Account/Login/">Login</a></li>
                </ul>
                }
			    <ul class="user-tools">
                    @if (WebSecurity.IsAuthenticated) {
			            <li>
					        <dl class="user-nav">
                                @{
                                    var usermenuGreeting = "Welcome, {0}!";
                                    if (N.W(u.FirstName) == null) {
                                        usermenuGreeting = "Welcome!";
                                    } else {
                                        usermenuGreeting = String.Format(usermenuGreeting, u.FirstName);
                                    }
						        <dt>@(usermenuGreeting) &#x25BC;</dt>
                                }
						        <dd>
                                    <ul>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Alerts/")">Alerts</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Mailbox/")">Inbox</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Bookings/")">Bookings</a></li>
                                        @if (u.IsProvider)
                                        {
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Calendar/")">Calendar</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Positions/")">Positions</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Tools/")">Tools</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/My Clients/")">My Clients</a></li>
                                        }
                                        @if (u.IsCustomer)
                                        {
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/My Providers/")">My Providers</a></li>
                                        }
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Preferences/")">Preferences</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Dashboard/Account/")">Account</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Profile/?UserID=" + WebSecurity.CurrentUserId)">Public Profile</a></li>
                                        <li><a href="@Href(UrlUtil.LangPath + "Account/Logout/")">Logout</a></li>
                                    </ul>
						        </dd>
					        </dl>
				        </li>
                        @howItWorksLi()
                    }
				    <li>
					    <dl class="lang-country">
						    <dt class="current-lang-country @UrlUtil.LangId">English (US) &#x25BC;</dt>
						    <dd>
                                <ul>
							        <li class="current"><a href="@Href(UrlUtil.AppPath)en_US/">English (US)</a></li>
							        <li><a href="@Href(UrlUtil.AppPath)es_US/">Español (US)</a></li>
							        <li><a href="@Href(UrlUtil.AppPath)en_ES/">English (ES)</a></li>
							        <li><a href="@Href(UrlUtil.AppPath)es_ES/">Español (ES)</a></li>
                                </ul>
						    </dd>
					    </dl>
				    </li>
                    @if (!WebSecurity.IsAuthenticated || !u.IsProvider)
                    {
			            <li class="actions"><a class="main-action" href="@(UrlUtil.LangPath)ProviderSignUp/">Become a provider</a></li>
                    }
			    </ul>
		    </div>
        </header>
        <footer>
            <div class="truste-seal">@RenderPage(UrlUtil.LangPath + "HelpCenter/_TrusteSealWidget.cshtml")</div>
            <div class="social-links"><a class="replace icon facebook" target="_blank" href="#">Facebook</a><a class="replace icon twitter" target="_blank" href="#">Twitter</a></div>
            <div class="site-links"><a href="@(UrlUtil.LangPath)About/">About</a>|<a href="@(UrlUtil.LangPath)About/TermsOfUse/">Terms of Use</a>|<a href="@(UrlUtil.LangPath)About/PrivacyPolicy/">Privacy Policy</a>|<a href="@Href(UrlUtil.LangPath + "HelpCenter/")">Help</a>|<a href="/Blog/">Blog</a></div>
        </footer>
        <div class="scripts">           
            @if (isHomePage)
            {
                @* Loading blockUI jquery-plugin and our script in a delayed way only on Home Page, to be faster loading *@
                <script type="text/javascript">
                    Modernizr.load({ load: [
                        UrlUtil.AppPath + "Scripts/jquery-1.7.2.min.js",
                        UrlUtil.AppPath + "Scripts/jquery-ui-1.8.21.custom.min.js",
                        @if (LcData.GetCurrentLanguageID() == 2)
                        {
                        <text>UrlUtil.AppPath + "Scripts/jquery.ui.datepicker-es.js"</text>
                        }
                    ], complete: function () {
                        $.datepicker.setDefaults($.datepicker.regional[$('html').attr('lang')]);
                        $('.date-pick', document).datepicker({
                            showAnim: 'blind'
                        });
                        // Location js-dropdown
                        var s = $('#search-location');
                        s.prop('readonly', true);
                        s.autocomplete({
                            source: LC.searchLocations
                            , autoFocus: true
                            , minLength: 0
                            , select: function () {
                                return false;
                            }
                        });
                        s.on('focus click', function () { s.autocomplete('search', '') });

                        // More to load:
                        Modernizr.load([
                            UrlUtil.AppPath + "Scripts/jQuery.blockuUI.js",
                            UrlUtil.AppPath + "Scripts/script.js?v=20120727"
                        ]);
                    }
                    });
                </script>
            } else {
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery-ui-1.8.21.custom.min.js")" type="text/javascript"></script>
                if (LcData.GetCurrentLanguageID() == 2)
                {
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery.ui.datepicker-es.js")" type="text/javascript"></script>
                }
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery.ba-hashchange.min.js")" type="text/javascript"></script>
                @* IagoSRL: Disable to investigate if really are being used this scripts from old code:
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery.selectboxes.pack.js")" type="text/javascript"></script>
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery.backgroundPosition.js")" type="text/javascript"></script>*@
                @*
                IagoSRL: The author recommends replace the autocomplete plugin by the autocomplete widget included in jQuery.UI
                Original author migration guide: http://www.learningjquery.com/2010/06/autocomplete-migration-guide
                <script src="@Href(UrlUtil.AppPath + "Scripts/jquery.autocomplete.js")" type="text/javascript"></script>
                *@
		        <script src="@Href(UrlUtil.AppPath + "Scripts/jQuery.blockuUI.js")" type="text/javascript"></script>
                @* Our scripts *@
                <script src="@Href(UrlUtil.AppPath + "Scripts/script.js?v=20120815")" type="text/javascript"></script>
                @* removed dependency from home page, check if needed aroud the site: <script src="@Href(UrlUtil.AppPath + "Scripts/date.js")" type="text/javascript"></script>*@
            }
            @* Javascript linked from asp.net *@
            @Scripts.GetScriptTags()
            @if (PageData["InlineScript"] != null)
            {
                <script type="text/javascript">@Html.Raw(PageData["InlineScript"])</script>
            }
            @* Really this is needed? *@@*
           <!-- TODO Change UA-XXXXX-X to Loconomics ID-->
            <script type="text/javascript">
                window._gaq = [['_setAccount', 'UAXXXXXXXX1'], ['_trackPageview'], ['_trackPageLoadTime']];
                Modernizr.load({
                    load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
                });
            </script>*@
        </div>
        <div class="lc-ressources">
            <span id="lcres-quit-without-save">@LcRessources.GetText("quit-without-save")</span>
        </div>
    </body>
</html>
