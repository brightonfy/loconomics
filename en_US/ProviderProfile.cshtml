@{
    Layout = "~/en_US/_SiteLayout.cshtml";
    var serviceType = Request["ServiceType"];
    var service = Request["Service"];          
    var ProviderID= "0";
    ProviderID =  Request.QueryString["ProviderID"];
    var PositionID= "0";
    PositionID =  Request.QueryString["PositionID"];
    var Position= " ";
    Position =  Request.QueryString["Position"];
    var UserID = Convert.ToString(WebSecurity.CurrentUserId);
    String[] reviewsdata={ProviderID,PositionID};

    var rating1 = "0";
    var rating2 = "0";
    var rating3 = "0";
    var rating4 = "0";
    
    var db = Database.Open("sqlloco");
    var profilesql = @"SELECT FirstName + ' ' + LastName AS Name,PostalCode,Photo,PreferredLanguageID,PreferredCountryID,ADD_Details,Email,rs.Rating1,rs.Rating2,rs.Rating3,rs.Rating4 
                    FROM users a 
                    JOIN dbo.userprofilepositionadditional b ON (a.userid = b.userid)
                    JOIN dbo.userprofile e ON  (a.userid = e.userid)
                    LEFT JOIN dbo.ReviewScores rs ON (a.userid = rs.ProviderID)                     
                    WHERE a.userid = @0";
    var posrow = db.QuerySingle(profilesql,ProviderID);
    try{
        rating1 = Convert.ToString(posrow.Rating1);
        rating2 = Convert.ToString(posrow.Rating2);
        rating3 = Convert.ToString(posrow.Rating3);
        rating4 = Convert.ToString(posrow.Rating4);
    }catch{
        //TODO
    }
    String[] rating1data = { "ProviderProfileRating1", rating1, "true" };
    String[] rating2data = { "ProviderProfileRating2", rating2, "true" };
    String[] rating3data = { "ProviderProfileRating3", rating3, "true" };
    String[] rating4data = { "ProviderProfileRating4", rating4, "true" };    

    var positionsql ="select distinct  d.ServiceAttributeCategoryID,d.ServiceAttributeCategory from dbo.userprofilepositions a join dbo.userprofileserviceattributes b on a.UserID = b.UserID and a.PositionID = b.PositionID join dbo.servicecategoryattributemapping c on b.SCAMID = c.SCAMID join dbo.serviceattributecategory d on c.ServiceAttributeCategoryID = d.ServiceAttributeCategoryID where a.UserID = @0 and b.PositionID = @1 ";
    var positionrow =db.Query(positionsql,ProviderID,PositionID);
    
    var positionattributesql ="select distinct d.ServiceAttributeCategoryID,d.ServiceAttributeCategory,e.ServiceAttributeID,e.Name from dbo.userprofilepositions a join dbo.userprofileserviceattributes b on a.UserID = b.UserID and a.PositionID = b.PositionID join dbo.servicecategoryattributemapping c on b.SCAMID = c.SCAMID join dbo.serviceattributecategory d on c.ServiceAttributeCategoryID = d.ServiceAttributeCategoryID join dbo.serviceattribute e on c.ServiceAttributeID = e.ServiceAttributeID where a.UserID = @0 and b.PositionID = @1 and d.ServiceAttributeCategoryID = @2 and d.LanguageID = 1 and d.CountryID = 1";

    db.Close();
} 

<script type="text/javascript">
    $(document).ready(function () {
        $("#customerName").hide();
        $("#PositionID").hide();
        $("#ProviderID").hide();
        $("#PositionSingular").hide();
    });
</script>
<script type="text/javascript">
    var geocoder;
    var map;
    var query = "Carrer de Pau Claris 184, 08037,Barcelona";
    function initialize() {
        geocoder = new google.maps.Geocoder();
        var myOptions = {
            zoom: 16,
            mapTypeId: google.maps.MapTypeId.HYBRID
        }
        map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
        codeAddress();
    }

    function codeAddress() {
        var address = query;
        geocoder.geocode({ 'address': address }, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                map.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    title: "Loconomics Labs Inc.",
                    position: results[0].geometry.location
                });
                var infoWindow = new google.maps.InfoWindow({
                    content: "Loconomics Labs Inc. "
                           + "<br>Where Magic happens",
                    width: 60,
                    heigth:20,
                    position: results[0].geometry.location
                });
                infoWindow.open(map);
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
        });
    }
</script>


<div class="provider profile">
   
    <div id="container" class="clearfix">

        <div id="main" class="tabbed folders">
	
		    <div id="profileHeader" class="clearfix">

			    <img alt="provider photo" class="profile-pic" src="../@posrow.Photo"/>
			    <div class="wrap">
	
				    <h1 class="profile-name">@posrow.Name</h1>
				    <h2 class="job-titles">@Position</h2>
			
				    <p>@posrow.ADD_Details<a href="#">more...</a> </p>
				
				    <div class="buttons">
					    <a class="button message fanciful" href="#">Contact</a>
					    <a class="button profile current fanciful" href="#">Book</a>
				    </div><!-- .buttons -->
				
			    </div><!-- .wrap -->
			
		    </div><!-- #profileHeader -->

		    <ul class="tabs">
		    <li><a class="current" href="#gardener">@Position</a></li>
	
		    </ul>

		    <div id="cleaner" class="tab-body fancy">
		
		    </div><!-- #cleaner -->
		
		    <div id="gardener" class="current tab-body fancy">
			    <div class="tabbed buttons" id="tabs">
				    <ul class="tabs" >
					    <li><a class="button profile fanciful current" href="#gardener-overview">Overview</a></li>
					    <li><a class="button profile fanciful" href="#gardener-reviews">Reviews</a></li>
					    <li><a class="button profile fanciful" href="#gardener-calendar">Calendar</a></li>
					    <li><a class="button profile fanciful" href="#gardener-map" onclick="initialize()">Map</a></li>
           			    <li><a class="button profile fanciful" href="#gardener-message">Send me a message</a></li> 
                        <li><a class="button profile fanciful" href="#inbox_grid">Inbox</a></li>
				    </ul>
				    <div id="gardener-overview" class="current tab-body">
					    <div class="rate">
						    <p class="rate fancy">25 â‚¬/hr</p>
						    <a href="PricingWizardPage.cshtml?ProviderID=@ProviderID&PositionID=@PositionID">calculate your needs</a>
						    <table>
							    <tr><th>Experience level:</th></tr>
							    <tr><td>< 5 years</td></tr>
							    <tr><td>Minimum hours:</td></tr>
							    <tr><td>2 hours</td></tr>
						    </table>
					    </div><!-- .rate -->
					    <div class="work">
						    <div class="
						    review fancy">
							    <img src="../img/eg-profile-pic.jpg" alt="" />
							    <blockquote>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua...<a href="#">more</a></blockquote>
							    <a class="button fanciful" id="reviews-link" href="">see more reviews &raquo;</a>
						    </div><!-- .feature -->

                            @Html.Label("rating1")
                            @RenderPage("~/en_US/StarRating.cshtml",@rating1data)
                            @Html.Label("rating2")
                            @RenderPage("~/en_US/StarRating.cshtml",@rating2data)
                            @Html.Label("rating3")
                            @RenderPage("~/en_US/StarRating.cshtml",@rating3data)
                          <!--JOSH EDIT: 18Feb. "Taking out 4th star rating"  @Html.Label("rating4")
                            @RenderPage("~/en_US/StarRating.cshtml",@rating4data) -->
                        
                            </div>
					
                  	    <ul class="services"> 
                                @foreach(var c in positionrow){       
							    <li>
								    <dl>
									    <dt>@c.ServiceAttributeCategory:</dt>
									    <dd>
										    <ul>
                                                  @foreach(var s in db.Query(positionattributesql,ProviderID,PositionID,c.ServiceAttributeCategoryID)){     
											    <li>@s.Name</li>
										        }
										    </ul>
									    </dd>
								    </dl>
							    </li>
                                }
							
						    </ul>
                        <!--JOSH: 18Feb.  Adding 2nd column for Attribute Category -->
                        <ul class="services-two"> 
                                @foreach(var c in positionrow){       
							    <li>
								    <dl>
									    <dt>@c.ServiceAttributeCategory:</dt>
									    <dd>
										    <ul>
                                                  @foreach(var s in db.Query(positionattributesql,ProviderID,PositionID,c.ServiceAttributeCategoryID)){     
											    <li>@s.Name</li>
										        }
										    </ul>
									    </dd>
								    </dl>
							    </li>
                                }
							
						    </ul>    
					    </div><!-- .work -->
				    </div><!-- #gardener-services-->

				    <div id="gardener-reviews" class="tab-body">
                        @RenderPage("~/en_US/ReviewsGrid.cshtml", reviewsdata)
                    </div><!-- #gardener-reviews -->
				
                    <div id="gardener-calendar" class="tab-body"> </div><!-- #gardener-calendar -->
				
                    <div id="gardener-map" class="tab-body"> 
                        <div id="mapp_address"  style="width:400px; background-color: #E0E0E0; height: 290px; border: 1px solid black">
                            <div id="map_canvas" style="width:100%; height:100%"></div>
                        </div>
                    </div><!-- #gardener-map -->
   				
                    <div id="gardener-message" class="tab-body"> 
                        <h2>Submit Email Request for Assistance</h2>
                        <form method="post" action="ProcessRequest.cshtml">
                            <div>
                                <input id="customerName" name="customerName" value="@posrow.Name"/>
                                <input id="ProviderID" name="ProviderID" value="@ProviderID"/>
                                <input id="PositionID" name="PositionID" value="@PositionID"/>
                                <input id="PositionSingular" name="PositionSingular" value="@Position"/>
                            </div>
                    
                            <div>
                                Details about your problem: <br />
                                <textarea name="customerRequest" cols="45" rows="4"></textarea>
                            </div>
                            <div>
                                <input type="submit" value="Submit" />
                            </div>
                        </form>
                      
                    </div><!-- #gardener-message -->
                     <div id="inbox_grid" class="tab-body">
                     <h1>
                         <title>Inbox</title>
                     </h1>
                        @RenderPage("~/en_US/MailBoxGrid.cshtml")
                    </div> 
                
			    </div>
          
                <!--social links-->
                <div class="section-d sd-c" style="padding: 0px 0px 0px; overflow:visible; height:30px;">
                    <!-- facebook -->
                    <div style="width:140px;padding: 5px 20px 0px; float:left">
                    <div id="fb-root"></div><script src="https://connect.facebook.net/en_US/all.js#xfbml=1"></script>
                    <fb:like href="http://www.poorrichardsworkshop.com/loconomicsjb/en_ES/ProviderProfile.cshtml?ProviderID=@ProviderID&PositionId=@PositionID&Position=@Position" send="true" layout="button_count" width="100" show_faces="true" font=""></fb:like>
                    </div>
                    <!-- linkedin -->
                    <div style="width:100px;padding: 5px 20px 0px; float:left">
                    <script src="https://platform.linkedin.com/in.js" type="text/javascript"></script>
                    <script type="IN/Share" data-url="http://www.poorrichardsworkshop.com/loconomicsjb/en_ES/ProviderProfile.cshtml?ProviderID=@ProviderID&PositionId=@PositionID&Position=@Position" data-counter="right"></script></div>
                    <!-- google -->
                    <div style="width:100px;padding: 5px 20px 0px; float:left">
                    <script type="text/javascript" src="https://apis.google.com/js/plusone.js">
                        { lang: 'en' }
                    </script>
                    <!-- Place this tag where you want the +1 button to render -->
                    <g:plusone size="medium" href="http://loconomics.com/es_ES/"></g:plusone></div>
                    <!-- twitter -->
                    <div style="width:100px;padding: 5px 20px 0px; float:left">
                        <iframe scrolling="no" frameborder="0" allowtransparency="true" src="http://platform0.twitter.com/widgets/tweet_button.html" class="twitter-share-button twitter-count-horizontal" style="width: 110px; height: 20px;" title="Twitter For Websites: Tweet Button"></iframe>
                    </div>
                </div><!-- .section-d -->
                <!-- #social links-->

		    </div><!-- #gardner -->
		
		    <div id="massage" class="tab-body fancy">
		
		    </div><!-- #massage -->
		
		    <div id="tutor" class="tab-body fancy">

		    </div><!-- #tutor -->
			
        </div><!-- #main -->

	    <!--JOSH EDIT: 18Feb.  "Taking out search box in profile" <div id="secondary">
		
		    <a href="Search?serviceType=@serviceType&Service=@service">&laquo; back to search results</a>
		
		    <form id="searchAgain" name="searchAgain" class="fancy">
			    <legend>Search Again</legend>
			    <fieldset class="search-params">
				    <fieldset>
					    <label for="location">You're searching for services near:</label>
					    <select id="location">
						    <option>Home</option>
						    <option>Office</option>
					    </select>
				    </fieldset>
				    <fieldset>
					    <label for="date">Preferred Date</label>
					    <input type="text" id="date" class="date-pick" value="06/07/2011" />
				    </fieldset>
			    </fieldset>
			    <fieldset>
				    <label for="serviceDetails">Service Details:</label>
				    <fieldset class="checklist" id="serviceDetails">
					    <fieldset><input type="checkbox" value="lorem" id="hk1" /> <label for="hk1">Lorem ipsum dolor</label></fieldset>
					    <fieldset><input type="checkbox" value="ipsum" id="hk2" /> <label for="hk2">Consectitur</label></fieldset>
					    <fieldset><input type="checkbox" value="dolor" id="hk3" /> <label for="hk3">Nullam sed ante leo</label></fieldset>
					    <fieldset><input type="checkbox" value="sit" id="hk4" /> <label for="hk4">Etiam sodales </label></fieldset>
					    <fieldset><input type="checkbox" value="amet" id="hk5" /> <label for="hk5">Sit amet</label></fieldset>
				    </fieldset>
			    </fieldset>
			    <fieldset>
				    <label for="education">Education:</label>
				    <fieldset class="checklist" id="serviceDetails">
					    <fieldset><input type="checkbox" value="lorem" id="hk1" /> <label for="hk1">Lorem ipsum dolor</label></fieldset>
					    <fieldset><input type="checkbox" value="ipsum" id="hk2" /> <label for="hk2">Consectitur</label></fieldset>
					    <fieldset><input type="checkbox" value="dolor" id="hk3" /> <label for="hk3">Nullam sed ante leo</label></fieldset>
					    <fieldset><input type="checkbox" value="sit" id="hk4" /> <label for="hk4">Etiam sodales </label></fieldset>
					    <fieldset><input type="checkbox" value="amet" id="hk5" /> <label for="hk5">Sit amet</label></fieldset>
				    </fieldset>
			    </fieldset>
			    <button class="search-again fanciful" type="submit">Search</button>
		    </form>
		
	    </div><!-- #secondary --> -->

    </div><!-- #container -->
</div>
