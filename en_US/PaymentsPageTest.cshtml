@using Braintree
@{
    //if (WebSecurity.IsAuthenticated)
    //{
        var UserID = WebSecurity.CurrentUserId;
    /*}
    else
    {
        Response.Redirect("~/en_US/Account/Login");
    }*/

    var gateway = new BraintreeGateway
    {
        Environment = Braintree.Environment.SANDBOX,
        MerchantId = "fn9phnknypvkgcfx",
        PublicKey = "yhqvg4cz74jwxtw5",
        PrivateKey = "q7vdftc9npxgkxpy"
    };
    var errors = "";
    var firstName = "";
  
    var Amount = 1;//This amount should come in the request from the pricing wizzard.
    var TransparentRedirectURLForCreate = gateway.TransparentRedirect.Url;
    var TrData = gateway.Transaction.SaleTrData(new TransactionRequest { Amount = Amount}, // key information about the transaction
                                                "http://poorrichardsworkshop.com/loconomicsjb/en_US/PaymentsConfirmationTest");  // the redirect destination, in this case, the Confirm action below
}
    
     <h3>Payment: @Amount $</h3>

    @* If at least one validation error exists, notify the user *@
    @Html.ValidationSummary(errors)
    <form id="NewPaymentForm" action="@TransparentRedirectURLForCreate" method="post" autocomplete="off">
    <div>
        <fieldset>
            <legend><b>Customer</b></legend>
            <div><label for="transaction[customer][first_name]">First Name</label></div>
            <div>
                @Html.TextBox("transaction[customer][first_name]",@firstName)
                @Html.ValidationMessage("transaction[customer][first_name]")
            </div>
            <div><label for="transaction[customer][last_name]">Last Name</label></div>
            <div>
                @Html.TextBox("transaction[customer][last_name]")
                @Html.ValidationMessage("transaction[customer][last_name]")
            </div>
        </fieldset>
        <fieldset>
            <legend><b>Credit Card</b></legend>
            <div><label for="transaction[credit_card][number]">Number</label></div>
            <div>
              @Html.TextBox("transaction[credit_card][number]")
              @Html.ValidationMessage("transaction[credit_card][number]")
            </div>
            <div><label for="transaction[credit_card][expiration_date]">Expiration Date (MM/YY)</label></div>
            <div>
              @Html.TextBox("transaction[credit_card][expiration_date]")
              @Html.ValidationMessage("transaction[credit_card][expiration_date]")
            </div>
        </fieldset>
        <input id="tr_data" name="tr_data" type="hidden" value="@TrData" />
        <input id="transaction_submit" name="commit" type="submit" value="Submit" />
    </div>
    </form>

