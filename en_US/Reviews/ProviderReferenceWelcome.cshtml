@using WebMatrix.WebData;
@{
    Layout = UrlUtil.LangPath + "_SiteLayout.cshtml";
    Page.Title = "Welcome! Please provide a reference";
    
    Styles.Add(UrlUtil.AppPath + "Styles/ProviderReview.css");
    
    var providerID = Request["ProviderUserID"].AsInt();
    var provider = LcData.UserInfo.GetUserRow(providerID);
    var position = LcData.UserInfo.GetUserPos(providerID, Request["PositionID"].AsInt());
}
<div id="container" class="provider-review clearfix">
    <div id="main" class="provider-reference-welcome">
        @if (provider == null || position == null) {
            <h1>Ups! There is a problem</h1>
            <div>We're sorry, there is a problem with your request and cannot be processed. If you did click on an email link, try to copy and paste that link instead of clicking on it.
                Contact <a href="mailto:support@@loconomics.com">support@@loconomics.com</a> for more help.
            </div>
        } else {
            <h1>Welcome! Help @provider.FirstName build his reputation</h1>
            <p><strong>You are here because @provider.FirstName ask you to write a reference about it.</strong> It's quick and easy!</p>
            
            if (WebSecurity.IsAuthenticated)
            {
                <a href="@(UrlUtil.LangPath)Reviews/ProviderReferenceForm/?ProviderUserID=@(providerID)&PositionID=@(position.PositionID)">Go! (to the review form)</a>
            }
            else
            {
                <p>But first you need Log-in or create an account (it's free!)</p>
            
                @RenderPage(UrlUtil.LangPath + "Account/$Login.cshtml", new
                   {
                       ShowHeader = false,
                       ShowTools = true,
                       Redirect = UrlUtil.LangPath + "Reviews/ProviderReferenceForm/?ProviderUserID=" + providerID + "&PositionID=" + position.PositionID
                       ,
                       RegisterWaitConfirmation = false
                   })
            }
        }
    </div>
</div>