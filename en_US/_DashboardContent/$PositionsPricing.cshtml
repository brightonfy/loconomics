@using WebMatrix.Data;
@{
    LcHelpers.ProviderPage();
    // Current provider data record:
    var p = LcData.UserInfo.GetUserRow();
    // Current position data record:
    var pos = LcData.UserInfo.GetUserCurrentPos();
    var n = pos.PositionID;
    
    if (p == null || pos == null){
        var inputdataerrormessage = "Please correct any errors and click save";
        if (IsPost){
            LcHelpers.ReturnJsonError(-1, inputdataerrormessage);
        }else{
            throw new Exception(inputdataerrormessage);
        }
    }
    
    string pageToLoad = "";

    using (var db = Database.Open("sqlloco")){
        
        // TODO: Get Customer Type Id   
        var clienttypeid = PageData["ClientTypeID"] = 1;
        
        // Get our Pricing Type ID:
        int pricingtypeid = LcData.GetPositionPricingTypeID(pos.PositionID, clienttypeid);

        switch (pricingtypeid) {
            case 1: // Hours
                pageToLoad = "_ProviderHoursType.cshtml";
                break;
            case 2: // Custom
                pageToLoad = "_ProviderCustomType.cshtml";
                break;
            case 3: // Packages
                pageToLoad = "$ProviderPackagesType.cshtml";
                break;
            case 4: // Invoice
                pageToLoad = "_ProviderInvoiceType.cshtml";
                break;
        }
    }
    
    var idprefix = PageData["idprefix"] = "position#" + n + "-pricing";
}
<p class="setting-instructions">
Transparent pricing is the key to a successful job.  We’re here to help you and your clients determine an accurate price and time estimate.  Please <a href="mailto:providerhelp@loconomics.com">e-mail us</a> if you need help or have feedback.  
</p>

@*
<script type="text/javascript">
    if (!pricingWizardProviderSetupLoaded) var pricingWizardProviderSetupLoaded;
    if (!pricingWizardProviderSetupLoaded)
        Modernizr.load(UrlUtil.AppPath + 'Scripts/PricingWizard.ProviderSetup.js');
    else
        if (InitPricingWizardProviderSetup)
            InitPricingWizardProviderSetup();
</script>*@
<div>
    @RenderPage(UrlUtil.LangPath + "PricingWizard/" + pageToLoad, new { PricingWizardClasses = "positionpricing" })
</div>
