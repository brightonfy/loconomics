@{
    var aboutMe = "";
    var stringPosted = "Nothing";
    var UserID = WebSecurity.CurrentUserId;
    var db = Database.Open("sqlloco");
    
    var theDate = DateTime.Now.ToString("yyyy-MM-dd");

    var sqluser = "exec GetUserDetails @0";
    var sqlpositions = "select a.PositionID, case when a.Active = 0 then 'not active' else 'active' end as active, PositionSingular, a.UpdatedDate  from dbo.userprofilepositions a join  positions c on a.PositionID = c.PositionID where a.UserID = @0 and c.LanguageID = 1 and c.CountryID = 1";                    
    var sqlupdatephoto ="update users set Photo = @0 where UserID = @1";
    var sqlupdateabout ="update dbo.userprofilepositionadditional set ADD_Details = @0  where UserID = @1";
    var userrow = db.QuerySingle(sqluser,UserID);
    var posrow = db.Query(sqlpositions,UserID);

    WebImage photo = null;
    var newFileName = "";
    var imagePath = "";
    var imageThumbPath  = "";

    if (WebSecurity.IsAuthenticated) {     
        if(IsPost){
            aboutMe = Request.Form["aboutMeText"];
            photo = WebImage.GetImageFromRequest();
            db.Query(sqlupdateabout,aboutMe,UserID);
            if(photo != null){
                newFileName = Guid.NewGuid().ToString() + "_" +
                Path.GetFileName(photo.FileName);
                imagePath = @"img\" + newFileName;
                photo.Save(@"~\" + imagePath);
                imageThumbPath = @"img\thumbs\" + newFileName;
                photo.Resize(width: 180, height: 180, preserveAspectRatio: true,
                preventEnlarge: true);
                photo.Save(@"~\" + imageThumbPath);
                db.Query(sqlupdatephoto,imageThumbPath,UserID);
            }
        }
    }else{
        Response.Redirect("~/en_US/Account/Login?Redirect=~/en_US/provider-dashboard-profile");
    }
    PageData["userrow"] = userrow;
}
