@{
    /* Page to be redirected from Facebook Login, with next syntax if OK:
        YOUR_REDIRECT_URI?
            state=YOUR_STATE_VALUE
           &code=CODE_GENERATED_BY_FACEBOOK
     * or next if FAILS (user don't grant the application)
        YOUR_REDIRECT_URI?
            error_reason=user_denied
           &error=access_denied
           &error_description=The+user+denied+your+request.
           &state=YOUR_STATE_VALUE
     */
    /*
    // First at all, validate the state value to verify the authenticity of the request.
    if (Request["state"] != Session["facebookState"]){
        // BAD request, return to home silently and stop request:
        Response.Redirect(UrlUtil.LangPath, true);
    }
    
    // Check request result
    var ok = false;
    if (Request["error"] != null){
        // ERROR:
        ok = false;
    } else {
        ok = true;
        
        // Do a server request to Facebook to get the user information
        WebClient browser = new WebClient();
        var response = browser.DownloadString(
            String.Format("https://graph.facebook.com/oauth/access_token?client_id={0}&redirect_uri={1}&client_secret{2}&code{3}",
                Facebook.AppId,     // YOUR_APP_ID
                UrlUtil.LangPath,   // YOUR_REDIRECT_URI
                Facebook.AppSecret, // YOUR_APP_SECRET
                Request["code"]));  // CODE_GENERATED_BY_FACEBOOK
        if (browser.ResponseHeaders["Status"] == "200"){
        }else{}
        //TODO: parse response
    }
    
    // Redirect to the index page:
    Response.Redirect(UrlUtil.LangPath);*/
    
    // FACEBOOK LOGIN
    if (!Facebook.IsFacebookUserAuthenticated) {
        Response.Redirect("~/");
    }
    
    if (Facebook.MembershipLogin()) {
        Context.RedirectLocal(Request["returnUrl"]);
    } else {
        Context.RedirectLocal(Request["registerUrl"]);
    }
}