<script type="text/html" id="client-appointment-card-template">
    <div class="Card AppointmentCard" data-bind="if: booking, css: { 'in-edit': isEditMode, 'is-locked': isLocked, 'is-readonly': !isEditMode() }">

        <div class="Card-title">
            <div data-bind="template: { name: 'service-professional-info-template', data: serviceProfessionalInfo() }"></div>
        </div>
        
        <div class="booking-steps">
            <div class="booking-step" data-bind="attr: { hidden: !isAtServices() }">

                <div data-bind="template: { name: 'service-professional-service-template', data: serviceProfessionalServices }"></div>

                <div data-bind="visible: supportsGratuity() && booking().paymentEnabled()">
                    <h2 class="SectionTitle">Add gratuity</h2>
                    <div class="center-block Box-sm PaddedBox-xs" style="text-align: center">
                        <div class="btn-group ut-noRadioCheck">
                            <!-- ko template: { name: 'booking-gratuity-radioButton', data: { value: presetGratuity, itemValue: 10, disabled: isLocked, labelText: '10%' } } --><!-- /ko -->
                            <!-- ko template: { name: 'booking-gratuity-radioButton', data: { value: presetGratuity, itemValue: 15, disabled: isLocked, labelText:  '15%' } } --><!-- /ko -->
                            <!-- ko template: { name: 'booking-gratuity-radioButton', data: { value: presetGratuity, itemValue: 20, disabled: isLocked, labelText: '20%' } } --><!-- /ko -->
                            <!-- ko template: { name: 'booking-gratuity-radioButton', data: { value: presetGratuity, itemValue: 'custom', disabled: isLocked, labelText: 'Custom' } } --><!-- /ko -->
                        </div>
                        <div class="isolated inset" data-bind="visible: presetGratuity() === 'custom'">
                            <span>$</span>
                            <input type="number" name="custom-gratuity" data-bind="textInput: gratuityAmount" class="form-control NumberField NumberField--xs NumberField--center">
                        </div>
                        <p class="isolated"><small>You’ll have until 1 hour after your app’t ends to adjust</small></p>
                    </div>
                </div>

                <h2 class="SectionTitle">Summary</h2>
                <div class="PricingSummary Box-sm PaddedBox-xs">
                    <table>
                        <tbody data-bind="foreach: booking().pricingSummary().items">
                            <tr><td class="PricingSummary-concept" data-bind="text: serviceName"></td><td class="PricingSummary-price" data-bind="text: price, format: { type: 'number', format: '$#,##0.00' }"></td></tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <th class="PricingSummary-concept">Total</th>
                                <th class="PricingSummary-price"><span data-bind="text: booking().pricingSummary().totalPrice, format: { type: 'number', format: '$#,##0.00' }"></span>*</th>
                            </tr>
                            <tr data-bind="visible: booking().pricingSummary().clientServiceFeePrice() > 0">
                                <td class="PricingSummary-fees" colspan="2">
                                    <span data-bind="text: booking().pricingSummary().feesMessage"></span>
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                    <div class="PricingSummary-time isolated inset">
                        <span class="fa fa-lg ion ion-ios-clock-outline" aria-hidden="true"></span>
                        <span data-bind="text: booking().pricingSummary().firstSessionDurationDisplay"></span>
                    </div>
                </div>

                <div class="PaddedBox-xs-only isolated-sm">
                    <div>
                        <button type="submit" class="btn btn-primary btn-block" data-bind="disable: isLocked() || !hasServicesSelected(), click: nextStep">Save and continue</button>
                    </div>
                </div>
            </div>
            
            <div class="booking-step" data-bind="attr: { hidden: !(isAtSelectTimes() || isAtSelectTime()) }">
                <h1 class="SectionTitle">
                    <span data-bind="visible: isAtSelectTimes">Select up to 3 appointment times</span>
                    <span data-bind="visible: isAtSelectTime">Select a start day and time</span>
                    &nbsp;
                </h1>

                <div data-bind="visible: !timeFieldToBeSelected()" class="Box-sm">
                    <ul class="TilesList">
                        <li data-bind="visible: booking().serviceDate() && booking().serviceDate().startTime()">
                            <button class="ItemAddonTile ItemAddonTile--largerContent" type="button" data-bind="click: pickServiceDate">
                            <i class="Tile-marker fa ion ion-ios-clock-outline" aria-hidden="true"></i>
                            <div class="Tile-content">
                                <div><strong>First choice:</strong></div>
                                <div data-bind="text: booking().serviceDate() && booking().serviceDate().startTime(), format: { type: 'datetime', format: 'dddd, MMMM Do YYYY' }"></div>
                                <div data-bind="text: booking().serviceDate() && booking().serviceDate().displayedTimeRange()"></div>
                            </div>
                            <div class="Tile-addon"><span class="fa fa-lg ion ion-edit" aria-hidden="true"></span></div>
                        </button></li>
                        <li data-bind="visible: !(booking().serviceDate() && booking().serviceDate().startTime())">
                            <button class="ItemAddonTile" type="button" data-bind="click: pickServiceDate">
                                <div class="Tile-marker"></div>
                                <div class="Tile-content">
                                    <p class="text-muted">Select a first choice</p>
                                </div>
                                <div class="Tile-addon"><span class="fa fa-2x ion ion-ios-plus-outline" aria-hidden="true"></span></div>
                            </button>
                        </li>

                        <li data-bind="visible: booking().alternativeDate1() && booking().alternativeDate1().startTime()">
                            <button class="ItemAddonTile ItemAddonTile--largerContent" type="button" data-bind="click: pickAlternativeDate1">
                            <i class="Tile-marker fa ion ion-ios-clock-outline" aria-hidden="true"></i>
                            <div class="Tile-content">
                                <div><strong>Second choice:</strong></div>
                                <div data-bind="text: booking().alternativeDate1() && booking().alternativeDate1().startTime(), format: { type: 'datetime', format: 'dddd, MMMM Do YYYY' }"></div>
                                <div data-bind="text: booking().alternativeDate1() && booking().alternativeDate1().displayedTimeRange()"></div>
                            </div>
                            <div class="Tile-addon"><span class="fa fa-lg ion ion-edit" aria-hidden="true"></span></div>
                        </button></li>
                        <li data-bind="visible: !(booking().alternativeDate1() && booking().alternativeDate1().startTime())">
                            <button class="ItemAddonTile" type="button" data-bind="click: pickAlternativeDate1">
                                <div class="Tile-marker"></div>
                                <div class="Tile-content">
                                    <p class="text-muted">Select a second choice</p>
                                </div>
                                <div class="Tile-addon"><span class="fa fa-2x ion ion-ios-plus-outline" aria-hidden="true"></span></div>
                            </button>
                        </li>

                        <li data-bind="visible: booking().alternativeDate2() && booking().alternativeDate2().startTime()">
                            <button class="ItemAddonTile ItemAddonTile--largerContent" type="button" data-bind="click: pickAlternativeDate2">
                            <i class="Tile-marker fa ion ion-ios-clock-outline" aria-hidden="true"></i>
                            <div class="Tile-content">
                                <div><strong>Third choice:</strong></div>
                                <div data-bind="text: booking().alternativeDate2() && booking().alternativeDate2().startTime(), format: { type: 'datetime', format: 'dddd, MMMM Do YYYY' }"></div>
                                <div data-bind="text: booking().alternativeDate2() && booking().alternativeDate2().displayedTimeRange()"></div>
                            </div>
                            <div class="Tile-addon"><span class="fa fa-lg ion ion-edit" aria-hidden="true"></span></div>
                        </button></li>
                        <li data-bind="visible: !(booking().alternativeDate2() && booking().alternativeDate2().startTime())">
                            <button class="ItemAddonTile" type="button" data-bind="click: pickAlternativeDate2">
                                <div class="Tile-marker"></div>
                                <div class="Tile-content">
                                    <p class="text-muted">Select a third choice</p>
                                </div>
                                <div class="Tile-addon"><span class="fa fa-2x ion ion-ios-plus-outline" aria-hidden="true"></span></div>
                            </button>
                        </li>
                    </ul>
                </div>

                <div data-bind="visible: timeFieldToBeSelected">
                    <app-datetime-picker params="api: serviceStartDatePickerView"></app-datetime-picker>
                </div>

                <div class="PaddedBox-xs-only PaddedBox-sm-only isolated-md">
                    <div class="isolated bottom-only" data-bind="visible: isAtSelectTimes">
                        <div>
                            <button type="submit" class="btn btn-primary btn-block" data-bind="disable: isLocked, click: nextStep">Save and continue</button>
                        </div>
                    </div>

                    <div class="well" data-bind="visible: !timeFieldToBeSelected()">
                        <h5><strong>Why am I choosing three times?</strong></h5>
                        <p>This allows us to figure out a good appointment time on both ends.
                        Your service professional has 18 hours to confirm your appointment.</p>
                    </div>
                </div>
            </div>
        
            <div class="booking-step" data-bind="attr: { hidden: !isAtConfirm() }">
                <ul class="TilesList TilesList--opendEnd">
                    <li>
                        <button type="button" class="InfoTile" data-bind="click: isEditMode() && pickDateTime">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-ios-clock-outline"></span>
                            </div>
                            <div class="Tile-content" data-bind="visible: !booking().instantBooking()">
                                <div data-bind="visible: booking().serviceDate() && booking().serviceDate().startTime()">
                                    <strong>1st choice: </strong>
                                        <span data-bind="text: booking().serviceDate() && booking().serviceDate().startTime(), format: { type: 'datetime', format: 'MMM Do' }"></span>, <span data-bind="visible: booking().serviceDate() && booking().serviceDate().startTime(), text: booking().serviceDate() && booking().serviceDate().displayedTimeRange()"></span>
                                </div>
                                <div data-bind="visible: booking().alternativeDate1() && booking().alternativeDate1().startTime()">
                                    <strong>2nd choice: </strong>
                                        <span data-bind="text: booking().alternativeDate1() && booking().alternativeDate1().startTime(), format: { type: 'datetime', format: 'MMM Do' }"></span>, <span data-bind="text: booking().alternativeDate1() && booking().alternativeDate1().displayedTimeRange()"></span>
                                </div>
                                <div data-bind="visible: booking().alternativeDate2() && booking().alternativeDate2().startTime()">
                                    <strong>3rd choice: </strong>
                                        <span data-bind="text: booking().alternativeDate2() && booking().alternativeDate2().startTime(), format: { type: 'datetime', format: 'MMM Do' }"></span>, <span data-bind="text: booking().alternativeDate2() && booking().alternativeDate2().displayedTimeRange()"></span>
                                </div>
                                <p data-bind="visible: !hasSomeDateSelected()" class="text-muted">Select preferred times</p>
                            </div>
                            <div class="Tile-content" data-bind="visible: booking().instantBooking">
                                <div data-bind="visible: booking().serviceDate() && booking().serviceDate().startTime(), text: booking().serviceDate() && booking().serviceDate().startTime(), format: { type: 'datetime', format: 'MMM Do' }"></div>
                                <div data-bind="visible: booking().serviceDate() && booking().serviceDate().startTime(), text: booking().serviceDate() && booking().serviceDate().displayedTimeRange()"></div>
                                <p data-bind="visible: !(booking().serviceDate() && booking().serviceDate().startTime())" class="text-muted">Select date/time</p>
                            </div>
                        </button>
                    </li>
                    <li data-bind="if: !isPhoneServiceOnly()">
                        <button type="button" class="InfoTile" data-bind="click: isEditMode() && pickLocation">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-ios-location-outline"></span>
                            </div>
                            <div class="Tile-content">
                                <p data-bind="visible: booking().serviceAddress(), text: booking().serviceAddress() && booking().serviceAddress().singleLine()"></p>
                                <p data-bind="visible: canEditLocation() && isEditMode() && !(booking().serviceAddress() && booking().serviceAddress().singleLine())" class="text-muted">Select/Add location</p>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button type="button" class="InfoTile" data-bind="click: canChangePricing() && isEditMode() && pickServices">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-ios-pricetags-outline"></span>
                            </div>
                            <div class="Tile-content">
                                <p data-bind="visible: booking().pricingSummary() && booking().pricingSummary().servicesSummary(), text: booking().pricingSummary() && booking().pricingSummary().servicesSummary()"></p>
                                <p data-bind="visible: canChangePricing() && isEditMode() && !(booking().pricingSummary() && booking().pricingSummary().servicesSummary())" class="text-muted">Select/Add service(s)</p>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button type="button" class="InfoTile">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-social-usd"></span>
                            </div>
                            <div class="Tile-content">
                                <p data-bind="text: booking().pricingSummary() && booking().pricingSummary().totalPrice() || 0, format: { type: 'number', format: '$0,0.00' }, css: { 'text-muted': !(booking().pricingSummary() && booking().pricingSummary().totalPrice())}"></p>
                            </div>
                        </button>
                    </li>
                    <li data-bind="if: supportsGratuity() && booking().paymentEnabled()">
                        <button type="button" class="InfoTile" data-bind="click: isEditMode() && pickService">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-cash"></span>
                            </div>
                            <div class="Tile-content">
                                <p><span data-bind="text: summary.gratuity() || 0, format: { type: 'number', format: '$0,0.00' }, css: { 'text-muted': !(summary.gratuity())}"></span> <span>gratuity</span></p>
                            </div>
                        </button>
                    </li>
                    <li>
                        <button type="button" class="InfoTile" data-bind="click: isEditMode() && pickSpecialRequests">
                            <div class="Tile-icon" aria-hidden="true">
                                <span class="fa ion ion-edit"></span>
                            </div>
                            <div class="Tile-content">
                                <p data-bind="visible: booking().specialRequests(), text: booking().specialRequests()"></p>
                                <p data-bind="visible: isEditMode() && !booking().specialRequests(), text: specialRequestsPlaceholder" class="text-muted"></p>
                            </div>
                        </button>
                    </li>
                </ul>

                <div class="AppointmentCard-actions" data-bind="visible: isEditMode()">
                    <button type="button" class="btn btn-primary btn-block" data-bind="event: { click: save }, text: submitText, disable: isLocked">Save changes</button>
                    <!--<button type="button" class="btn btn-default btn-block" data-bind="click: confirmCancel, disable: isLocked">Don't save changes</button>-->
                    <button type="button" class="btn btn-danger btn-block" data-bind="visible: booking().canBeCancelledByClient(), click: confirmCancelBookingByClient, disable: isLocked">Cancel booking</button>
                </div>
            </div>
        </div>
    </div>
</script>
