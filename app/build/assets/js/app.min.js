!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var jQuery=require("jquery");require("./core");require("./widget");require("./position");require("./menu");!function($,undefined){$.widget("ui.autocomplete",{version:"1.10.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput,nodeName=this.element[0].nodeName.toLowerCase(),isTextarea="textarea"===nodeName,isInput="input"===nodeName;this.isMultiLine=isTextarea?!0:isInput?!1:this.element.prop("isContentEditable");this.valueMethod=this.element[isTextarea||isInput?"val":"text"];this.isNewMenu=!0;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly")){suppressKeyPress=!0;suppressInput=!0;suppressKeyPressRepeat=!0}else{suppressKeyPress=!1;suppressInput=!1;suppressKeyPressRepeat=!1;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=!0;this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=!0;this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=!0;this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=!0;this._keyEvent("next",event);break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:if(this.menu.active){suppressKeyPress=!0;event.preventDefault();this.menu.select(event)}break;case keyCode.TAB:this.menu.active&&this.menu.select(event);break;case keyCode.ESCAPE:if(this.menu.element.is(":visible")){this._value(this.term);this.close(event);event.preventDefault()}break;default:suppressKeyPressRepeat=!0;this._searchTimeout(event)}}},keypress:function(event){if(suppressKeyPress){suppressKeyPress=!1;(!this.isMultiLine||this.menu.element.is(":visible"))&&event.preventDefault()}else if(!suppressKeyPressRepeat){var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event)}}},input:function(event){if(suppressInput){suppressInput=!1;event.preventDefault()}else this._searchTimeout(event)},focus:function(){this.selectedItem=null;this.previous=this._value()},blur:function(event){if(this.cancelBlur)delete this.cancelBlur;else{clearTimeout(this.searching);this.close(event);this._change(event)}}});this._initSource();this.menu=$("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu");this._on(this.menu.element,{mousedown:function(event){event.preventDefault();this.cancelBlur=!0;this._delay(function(){delete this.cancelBlur});var menuElement=this.menu.element[0];$(event.target).closest(".ui-menu-item").length||this._delay(function(){var that=this;this.document.one("mousedown",function(event){event.target===that.element[0]||event.target===menuElement||$.contains(menuElement,event.target)||that.close()})})},menufocus:function(event,ui){if(this.isNewMenu){this.isNewMenu=!1;if(event.originalEvent&&/^mouse/.test(event.originalEvent.type)){this.menu.blur();this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent)});return}}var item=ui.item.data("ui-autocomplete-item");!1!==this._trigger("focus",event,{item:item})?event.originalEvent&&/^key/.test(event.originalEvent.type)&&this._value(item.value):this.liveRegion.text(item.value)},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item"),previous=this.previous;if(this.element[0]!==this.document[0].activeElement){this.element.focus();this.previous=previous;this._delay(function(){this.previous=previous;this.selectedItem=item})}!1!==this._trigger("select",event,{item:item})&&this._value(item.value);this.term=this._value();this.close(event);this.selectedItem=item}});this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element);this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove()},_setOption:function(key,value){this._super(key,value);"source"===key&&this._initSource();"appendTo"===key&&this.menu.element.appendTo(this._appendTo());"disabled"===key&&value&&this.xhr&&this.xhr.abort()},_appendTo:function(){var element=this.options.appendTo;element&&(element=element.jquery||element.nodeType?$(element):this.document.find(element).eq(0));element||(element=this.element.closest(".ui-front"));element.length||(element=this.document[0].body);return element},_initSource:function(){var array,url,that=this;if($.isArray(this.options.source)){array=this.options.source;this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term))}}else if("string"==typeof this.options.source){url=this.options.source;this.source=function(request,response){that.xhr&&that.xhr.abort();that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data)},error:function(){response([])}})}}else this.source=this.options.source},_searchTimeout:function(event){clearTimeout(this.searching);this.searching=this._delay(function(){if(this.term!==this._value()){this.selectedItem=null;this.search(null,event)}},this.options.delay)},search:function(value,event){value=null!=value?value:this._value();this.term=this._value();return value.length<this.options.minLength?this.close(event):this._trigger("search",event)!==!1?this._search(value):void 0},_search:function(value){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=!1;this.source({term:value},this._response())},_response:function(){var index=++this.requestIndex;return $.proxy(function(content){index===this.requestIndex&&this.__response(content);this.pending--;this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(content){content&&(content=this._normalize(content));this._trigger("response",null,{content:content});if(!this.options.disabled&&content&&content.length&&!this.cancelSearch){this._suggest(content);this._trigger("open")}else this._close()},close:function(event){this.cancelSearch=!0;this._close(event)},_close:function(event){if(this.menu.element.is(":visible")){this.menu.element.hide();this.menu.blur();this.isNewMenu=!0;this._trigger("close",event)}},_change:function(event){this.previous!==this._value()&&this._trigger("change",event,{item:this.selectedItem})},_normalize:function(items){return items.length&&items[0].label&&items[0].value?items:$.map(items,function(item){return"string"==typeof item?{label:item,value:item}:$.extend({label:item.label||item.value,value:item.value||item.label},item)})},_suggest:function(items){var ul=this.menu.element.empty();this._renderMenu(ul,items);this.isNewMenu=!0;this.menu.refresh();ul.show();this._resizeMenu();ul.position($.extend({of:this.element},this.options.position));this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item)})},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item)},_renderItem:function(ul,item){return $("<li>").append($("<a>").text(item.label)).appendTo(ul)},_move:function(direction,event){if(this.menu.element.is(":visible"))if(this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)){this._value(this.term);this.menu.blur()}else this.menu[direction](event);else this.search(null,event)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(keyEvent,event){if(!this.isMultiLine||this.menu.element.is(":visible")){this._move(keyEvent,event);event.preventDefault()}}});$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value)})}});$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(content){var message;this._superApply(arguments);if(!this.options.disabled&&!this.cancelSearch){message=content&&content.length?this.options.messages.results(content.length):this.options.messages.noResults;this.liveRegion.text(message)}}})}(jQuery)},{"./core":2,"./menu":3,"./position":4,"./widget":5}],2:[function(require,module,exports){var jQuery=require("jquery");!function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:function(orig){return function(delay,fn){return"number"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();fn&&fn.call(elem)},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;scrollParent=$.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0);return/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length)for(var elem=$(this[0]),position,value;elem.length&&elem[0]!==document;){position=elem.css("position");if("absolute"===position||"relative"===position||"fixed"===position){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&0!==value)return value}elem=elem.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})},removeUniqueId:function(){return this.each(function(){runiqueId.test(this.id)&&$(this).removeAttr("id")})}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||"map"!==map.nodeName.toLowerCase())return!1;img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img)}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}});$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0);margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)});return size}$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})};$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}});$.fn.addBack||($.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))});$("<a>").data("a-b","a").removeData("a-b").data("a-b")&&($.fn.removeData=function(removeData){return function(key){return arguments.length?removeData.call(this,$.camelCase(key)):removeData.call(this)}}($.fn.removeData));$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]])}},call:function(instance,name,args){var i,set=instance.plugins[name];if(set&&instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType)for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},hasScroll:function(el,a){if("hidden"===$(el).css("overflow"))return!1;var scroll=a&&"left"===a?"scrollLeft":"scrollTop",has=!1;if(el[scroll]>0)return!0;el[scroll]=1;has=el[scroll]>0;el[scroll]=0;return has}})}(jQuery)},{}],3:[function(require,module,exports){var jQuery=require("jquery");require("./core");require("./widget");require("./position");!function($,undefined){$.widget("ui.menu",{version:"1.10.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.mouseHandled=!1;this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,$.proxy(function(event){this.options.disabled&&event.preventDefault()},this));this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true");this._on({"mousedown .ui-menu-item > a":function(event){event.preventDefault()},"click .ui-state-disabled > a":function(event){event.preventDefault()},"click .ui-menu-item:has(a)":function(event){var target=$(event.target).closest(".ui-menu-item");if(!this.mouseHandled&&target.not(".ui-state-disabled").length){this.select(event);event.isPropagationStopped()||(this.mouseHandled=!0);if(target.has(".ui-menu").length)this.expand(event);else if(!this.element.is(":focus")&&$(this.document[0].activeElement).closest(".ui-menu").length){this.element.trigger("focus",[!0]);this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)}}},"mouseenter .ui-menu-item":function(event){var target=$(event.currentTarget);target.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(event,target)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.children(".ui-menu-item").eq(0);keepActiveItem||this.focus(event,item)},blur:function(event){this._delay(function(){$.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(event)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(event){$(event.target).closest(".ui-menu").length||this.collapseAll(event);this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var elem=$(this);elem.data("ui-menu-submenu-carat")&&elem.remove()});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(event){var match,prev,character,skip,regex,preventDefault=!0;function escape(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(event);break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=!1;prev=this.previousFilter||"";character=String.fromCharCode(event.keyCode);skip=!1;clearTimeout(this.filterTimer);character===prev?skip=!0:character=prev+character;regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text())});match=skip&&-1!==match.index(this.active.next())?this.active.nextAll(".ui-menu-item"):match;if(!match.length){character=String.fromCharCode(event.keyCode);regex=new RegExp("^"+escape(character),"i");match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text())})}if(match.length){this.focus(event,match);if(match.length>1){this.previousFilter=character;this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)}else delete this.previousFilter}else delete this.previousFilter}preventDefault&&event.preventDefault()},_activate:function(event){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(event):this.select(event))},refresh:function(){var menus,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length);submenus.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var menu=$(this),item=menu.prev("a"),submenuCarat=$("<span>").addClass("ui-menu-icon ui-icon "+icon).data("ui-menu-submenu-carat",!0);item.attr("aria-haspopup","true").prepend(submenuCarat);menu.attr("aria-labelledby",item.attr("id"))});menus=submenus.add(this.element);menus.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()});menus.children(":not(.ui-menu-item)").each(function(){var item=$(this);/[^\-\u2014\u2013\s]/.test(item.text())||item.addClass("ui-widget-content ui-menu-divider")});menus.children(".ui-state-disabled").attr("aria-disabled","true");this.active&&!$.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(key,value){"icons"===key&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(value.submenu);this._super(key,value)},focus:function(event,item){var nested,focused;this.blur(event,event&&"focus"===event.type);this._scrollIntoView(item);this.active=item.first();focused=this.active.children("a").addClass("ui-state-focus");this.options.role&&this.element.attr("aria-activedescendant",focused.attr("id"));this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");event&&"keydown"===event.type?this._close():this.timer=this._delay(function(){this._close()},this.delay);nested=item.children(".ui-menu");nested.length&&event&&/^mouse/.test(event.type)&&this._startOpening(nested);this.activeMenu=item.parent();this._trigger("focus",event,{item:item})},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;if(this._hasScroll()){borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0;paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0;offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop;scroll=this.activeMenu.scrollTop();elementHeight=this.activeMenu.height();itemHeight=item.height();0>offset?this.activeMenu.scrollTop(scroll+offset):offset+itemHeight>elementHeight&&this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight)}},blur:function(event,fromFocus){fromFocus||clearTimeout(this.timer);if(this.active){this.active.children("a").removeClass("ui-state-focus");this.active=null;this._trigger("blur",event,{item:this.active})}},_startOpening:function(submenu){clearTimeout(this.timer);"true"===submenu.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close();this._open(submenu)},this.delay))},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true");submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position)},collapseAll:function(event,all){clearTimeout(this.timer);this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));currentMenu.length||(currentMenu=this.element);this._close(currentMenu);this.blur(event);this.activeMenu=currentMenu},this.delay)},_close:function(startMenu){startMenu||(startMenu=this.active?this.active.parent():this.element);startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(newItem&&newItem.length){this._close();this.focus(event,newItem)}},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();if(newItem&&newItem.length){this._open(newItem.parent());this._delay(function(){this.focus(event,newItem)})}},next:function(event){this._move("next","first",event)},previous:function(event){this._move("prev","last",event)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(direction,filter,event){var next;this.active&&(next="first"===direction||"last"===direction?this.active["first"===direction?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[direction+"All"](".ui-menu-item").eq(0));next&&next.length&&this.active||(next=this.activeMenu.children(".ui-menu-item")[filter]());this.focus(event,next)},nextPage:function(event){var item,base,height;if(this.active){if(!this.isLastItem())if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.nextAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base-height<0});this.focus(event,item)}else this.focus(event,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())}else this.next(event)},previousPage:function(event){var item,base,height;if(this.active){if(!this.isFirstItem())if(this._hasScroll()){base=this.active.offset().top;height=this.element.height();this.active.prevAll(".ui-menu-item").each(function(){item=$(this);return item.offset().top-base+height>0});this.focus(event,item)}else this.focus(event,this.activeMenu.children(".ui-menu-item").first())}else this.next(event)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(event,!0);this._trigger("select",event,ui)}})}(jQuery)},{"./core":2,"./position":4,"./widget":5}],4:[function(require,module,exports){var jQuery=require("jquery");!function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];return 9===raw.nodeType?{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}:$.isWindow(raw)?{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}:raw.preventDefault?{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}:{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined)return cachedScrollbarWidth;var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;w1===w2&&(w2=div[0].clientWidth);div.remove();return cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX="scroll"===overflowX||"auto"===overflowX&&within.width<within.element[0].scrollWidth,hasOverflowY="scroll"===overflowY||"auto"===overflowY&&within.height<within.element[0].scrollHeight;return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&9===withinElement[0].nodeType;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()}}};$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);target[0].preventDefault&&(options.at="left top");targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;1===pos.length&&(pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]);pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]});1===collision.length&&(collision[1]=collision[0]);"right"===options.at[0]?basePosition.left+=targetWidth:"center"===options.at[0]&&(basePosition.left+=targetWidth/2);"bottom"===options.at[1]?basePosition.top+=targetHeight:"center"===options.at[1]&&(basePosition.top+=targetHeight/2);atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());"right"===options.my[0]?position.left-=elemWidth:"center"===options.my[0]&&(position.left-=elemWidth/2);"bottom"===options.my[1]?position.top-=elemHeight:"center"===options.my[1]&&(position.top-=elemHeight/2);position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top)}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})});options.using&&(using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:0>right?"left":left>0?"right":"center",vertical:0>bottom?"top":top>0?"bottom":"middle"};elemWidth>targetWidth&&abs(left+right)<targetWidth&&(feedback.horizontal="center");elemHeight>targetHeight&&abs(top+bottom)<targetHeight&&(feedback.vertical="middle");max(abs(left),abs(right))>max(abs(top),abs(bottom))?feedback.important="horizontal":feedback.important="vertical";options.using.call(this,props,feedback)});elem.offset($.extend(position,{using:using}))})};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;
if(data.collisionWidth>outerWidth)if(overLeft>0&&0>=overRight){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight}else overRight>0&&0>=overLeft?position.left=withinOffset:overLeft>overRight?position.left=withinOffset+outerWidth-data.collisionWidth:position.left=withinOffset;else overLeft>0?position.left+=overLeft:overRight>0?position.left-=overRight:position.left=max(position.left-collisionPosLeft,position.left)},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight)if(overTop>0&&0>=overBottom){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom}else overBottom>0&&0>=overTop?position.top=withinOffset:overTop>overBottom?position.top=withinOffset+outerHeight-data.collisionHeight:position.top=withinOffset;else overTop>0?position.top+=overTop:overBottom>0?position.top-=overBottom:position.top=max(position.top-collisionPosTop,position.top)}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset="left"===data.my[0]?-data.elemWidth:"right"===data.my[0]?data.elemWidth:0,atOffset="left"===data.at[0]?data.targetWidth:"right"===data.at[0]?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(0>overLeft){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;(0>newOverRight||newOverRight<abs(overLeft))&&(position.left+=myOffset+atOffset+offset)}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;(newOverLeft>0||abs(newOverLeft)<overRight)&&(position.left+=myOffset+atOffset+offset)}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top="top"===data.my[1],myOffset=top?-data.elemHeight:"bottom"===data.my[1]?data.elemHeight:0,atOffset="top"===data.at[1]?data.targetHeight:"bottom"===data.at[1]?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(0>overTop){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;position.top+myOffset+atOffset+offset>overTop&&(0>newOverBottom||newOverBottom<abs(overTop))&&(position.top+=myOffset+atOffset+offset)}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;position.top+myOffset+atOffset+offset>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)&&(position.top+=myOffset+atOffset+offset)}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments)}}};!function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};body&&$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});for(i in testElementStyle)testElement.style[i]=testElementStyle[i];testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&11>offsetLeft;testElement.innerHTML="";testElementParent.removeChild(testElement)}()}(jQuery)},{}],5:[function(require,module,exports){var jQuery=require("jquery");!function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler("remove")}catch(e){}_cleanData(elems)};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element);return void 0};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base;basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){$.isFunction(value)?proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue}}():proxiedPrototype[prop]=value});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)});delete existingConstructor._childConstructors}else base._childConstructors.push(constructor);$.widget.bridge(name,constructor)};$.widget.extend=function(target){for(var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex]){value=input[inputIndex][key];input[inputIndex].hasOwnProperty(key)&&value!==undefined&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value)}return target};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;isMethodCall?this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance)return $.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'");if(!$.isFunction(instance[options])||"_"===options.charAt(0))return $.error("no such method '"+options+"' for "+name+" widget instance");methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return!1}}):this.each(function(){var instance=$.data(this,fullName);instance?instance.option(options||{})._init():$.data(this,fullName,new object(options,this))});return returnValue}};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow)}this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]]}key=parts.pop();if(1===arguments.length)return curOption[key]===undefined?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return this.options[key]===undefined?null:this.options[key];options[key]=value}}this._setOptions(options);return this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){this.options[key]=value;if("disabled"===key){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if("boolean"!=typeof suppressDisabledCheck){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=!1}if(handlers){element=delegateElement=$(element);this.bindings=this.bindings.add(element)}else{handlers=element;element=this.element;delegateElement=this.widget()}$.each(handlers,function(event,handler){function handlerProxy(){return suppressDisabledCheck||instance.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof handler?instance[handler]:handler).apply(instance,arguments):void 0}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig)for(prop in orig)prop in event||(event[prop]=orig[prop]);this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{};"number"==typeof options&&(options={duration:options});hasOptions=!$.isEmptyObject(options);options.complete=callback;options.delay&&element.delay(options.delay);hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method]();callback&&callback.call(element[0]);next()})}})}(jQuery)},{}],6:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function AccountActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=this.app.model.userProfile.data;this.navBar=Activity.createSectionNavBar("Account")});exports.init=A.init},{"../components/Activity":96}],7:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),A=Activity["extends"](function AddJobTitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduling");var ac=this.$activity.find("#addJobTitles-search"),vw=this.viewModel;ac.autocomplete({source:function(request,response){vw.searchBy(request.term).then(function(results){response(results)})},autoFocus:!1,minLength:0,select:function(event,ui){if(ui&&ui.item&&ui.item.value){vw.addItem(ui.item);return!1}},focus:function(event,ui){!ui||!ui.item||!ui.item.positionSingular;$(this).val(ui.item.positionSingular);return!1}})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/scheduling";var link=this.requestData.cancelLink||referrer;this.app.model.onboarding.updateNavBar(this.navBar)||this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.searchText("");this.viewModel.jobTitles.removeAll();this.updateNavBarState()};var ko=require("knockout");function ViewModel(app){this.isSearching=ko.observable(!1);this.isSaving=ko.observable(!1);this.isLocked=this.isSaving;this.searchText=ko.observable("");this.jobTitles=ko.observableArray([]);this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isSaving()?"saving...":"Save"},this);this.unsavedChanges=ko.pureComputed(function(){return!!this.jobTitles().length},this);this.searchBy=function searchBy(text){return app.model.rest.get("job-titles/autocomplete",{search:text})["catch"](function(err){app.modals.showError({error:err})})}.bind(this);this.search=function search(){this.searchBy(this.searchText())}.bind(this);this.addItem=function addItem(item){var foundIndex=this.findItem(item);-1===foundIndex&&this.jobTitles.push(item)}.bind(this);this.add=function add(){var s=this.searchText();if(s){this.addItem({value:0,label:s});this.searchText("")}}.bind(this);this.findItem=function findItem(jobTitle){var foundIndex=-1;this.jobTitles().some(function(item,index){if(0!==jobTitle.value&&item.value===jobTitle.value||item.label===jobTitle.label){foundIndex=index;return!0}});return foundIndex};this.remove=function remove(jobTitle){var removeIndex=this.findItem(jobTitle);removeIndex>-1&&this.jobTitles.splice(removeIndex,1)}.bind(this);this.save=function save(){this.isSaving(!0);Promise.all(this.jobTitles().map(function(jobTitle){return app.model.userJobProfile.createUserJobTitle({jobTitleID:jobTitle.value,jobTitleName:jobTitle.label})})).then(function(){this.searchText("");this.isSaving(!1);this.jobTitles.removeAll();app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()}.bind(this))["catch"](function(error){this.searchText("");this.isSaving(!1);app.modals.showError({title:"Impossible to add one or more job titles",error:error})}.bind(this))}.bind(this)}},{"../components/Activity":96,knockout:!1}],8:[function(require,module,exports){"use strict";var ko=require("knockout"),Address=require("../models/Address"),Activity=require("../components/Activity"),A=Activity["extends"](function AddressEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Locations");var app=this.app,viewModel=this.viewModel;this.registerHandler({target:this.viewModel.address,handler:function(address){if(address&&!address.postalCode._hasLookup){address.postalCode._hasLookup=!0;ko.computed(function(){var postalCode=this.postalCode();postalCode&&!/^\s*$/.test(postalCode)&&app.model.postalCodes.getItem(postalCode).then(function(info){if(info){address.city(info.city);address.stateProvinceCode(info.stateProvinceCode);address.stateProvinceName(info.stateProvinceName);viewModel.errorMessages.postalCode("")}})["catch"](function(err){address.city("");address.stateProvinceCode("");address.stateProvinceName("");var msg="string"==typeof err?err:null;msg||err&&err.responseJSON&&err.responseJSON.errorMessage?viewModel.errorMessages.postalCode(msg||err.responseJSON.errorMessage):console.error("Server error validating Zip Code",err)})},address).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}})}}});this.viewModel.onSave=function(addressID){if(this.requestData.returnNewAsSelected===!0){this.requestData.addressID=addressID;this.app.shell.goBack(this.requestData)}else this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceAddresses/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);var params=options&&options.route&&options.route.segments||[],kind=params[0]||"",isService=kind===Address.kind.service,jobTitleID=isService?0|params[1]:0,addressID=isService?0|params[2]:0|params[1],serviceType=params[2]||"";this.viewModel.jobTitleID(jobTitleID);this.viewModel.addressID(addressID);this.updateNavBarState();if(addressID)this.app.model.serviceAddresses.getItemVersion(jobTitleID,addressID).then(function(addressVersion){if(addressVersion){this.viewModel.addressVersion(addressVersion);this.viewModel.header("Edit Location")}else{this.viewModel.addressVersion(null);this.viewModel.header("Unknow location or was deleted")}}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.addressVersion(this.app.model.serviceAddresses.newItemVersion({jobTitleID:jobTitleID}));switch(serviceType){case"serviceArea":this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!1);this.viewModel.header("Add a service area");break;case"serviceLocation":this.viewModel.address().isServiceArea(!1);this.viewModel.address().isServiceLocation(!0);this.viewModel.header("Add a service location");break;default:this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!0);this.viewModel.header("Add a location")}}};function ViewModel(app){this.header=ko.observable("Edit Location");this.errorMessages={postalCode:ko.observable("")};this.jobTitleID=ko.observable(0);this.addressID=ko.observable(0);this.addressVersion=ko.observable(null);this.address=ko.pureComputed(function(){var v=this.addressVersion();return v?v.version:null},this);this.isLoading=app.model.serviceAddresses.state.isLoading;this.isSaving=app.model.serviceAddresses.state.isSaving;this.isDeleting=app.model.serviceAddresses.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.serviceAddresses.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var add=this.address();return!add||!add.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.addressVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.addressVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.serviceAddresses.setItem(this.address().model.toPlainObject()).then(function(serverData){this.address().model.updateWith(serverData);this.addressVersion().push({evenIfObsolete:!0});this.onSave(serverData.addressID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete location",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.serviceAddresses.delItem(this.jobTitleID(),this.addressID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.serviceRadiusOptions=ko.observableArray([{value:.5,label:"0.5 miles"},{value:1,label:"1 mile"},{value:2,label:"2 miles"},{value:3,label:"3 miles"},{value:4,label:"4 miles"},{value:5,label:"5 miles"},{value:10,label:"10 miles"},{value:25,label:"25 miles"},{value:50,label:"50 miles"}])}},{"../components/Activity":96,"../models/Address":102,knockout:!1}],9:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),Appointment=require("../models/Appointment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var Activity=require("../components/Activity"),A=Activity["extends"](function AppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.menuItem="calendar";this.$appointmentView=this.$activity.find("#calendarAppointmentView");this.$chooseNew=$("#calendarChooseNew");this.viewModel=new ViewModel(this.app);var backActionSettings={link:"calendar/",icon:Activity.NavAction.goBack.icon(),isTitle:!0,text:"Calendar"};this.navBar=new Activity.NavBar({title:"",leftAction:new Activity.NavAction(backActionSettings),rightAction:Activity.NavAction.goHelpIndex});ko.computed(function(){var editMode=this.viewModel.editMode(),isNew=this.viewModel.appointmentCardView()&&this.viewModel.appointmentCardView().isNew(),date=this.viewModel.currentDate();if(editMode)if(isNew){var cancelLink=this.viewModel.appointmentCardView();cancelLink=cancelLink&&cancelLink.progress&&cancelLink.progress.cancelLink;this.convertToCancelAction(this.navBar.leftAction(),cancelLink||this.requestData.cancelLink)}else this.navBar.leftAction().model.updateWith({link:null,text:"cancel",handler:this.viewModel.appointmentCardView().confirmCancel.bind(this)});else{var defLink=backActionSettings.link,defBackText=backActionSettings.text,link=date?defLink+date.toISOString():defLink,text=date?moment(date).format("dddd [(]M/D[)]"):defBackText;this.navBar.leftAction().model.updateWith($.extend({},backActionSettings,{link:link,text:text,handler:null}))}},this);this.registerHandler({target:this.viewModel.currentAppointment,handler:function(apt){if(apt&&(apt.id()===Appointment.specialIds.newBooking||apt.id()===Appointment.specialIds.newEvent)&&!apt.__idDateHandlersAttached){apt.__idDateHandlersAttached=!0;var prevID=apt.id();apt.id.subscribe(function relocateList(){var id=apt.id();if(!(prevID>0||0>=id)){prevID=id;this.viewModel.setCurrent(null,id).then(function(){this.viewModel.updateUrl()}.bind(this))}}.bind(this))}}.bind(this)._delayed(10)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);if(!this.requestData.cancelLink){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url;var reg=/\/?appointment\/([^\/]*)\/((\-3)|(\-4))/i;referrer&&reg.test(referrer)&&referrer.replace(reg,"/appointment/$1/");this.requestData.cancelLink=referrer}var s1=options&&options.route&&options.route.segments[0],s2=options&&options.route&&options.route.segments[1],s3=options&&options.route&&options.route.segments[2],date,datetime,id,type,isNumber=/^\-?\d+$/;if(isNumber.test(s1)){id=0|s1;type=s2}else{date=getDateWithoutTime(s1);datetime=s1&&new Date(s1)||date;id=0|s2;type=s3}var setupCard=function(){var cardApi=this.viewModel.appointmentCardView();if(cardApi){this.viewModel.appointmentCardView().currentID()<=0&&this.viewModel.appointmentCardView().item().startTime(datetime);cardApi.passIn(this.requestData)}else setTimeout(setupCard,80)}.bind(this);this.viewModel.setCurrent(date,id,type).then(setupCard)};var Appointment=require("../models/Appointment");function findAppointmentInList(list,id){var found=null,index=-1;list.some(function(apt,i){if(apt.id()===id){found=apt;index=i;return!0}});return{item:found,index:index}}var CalendarEvent=require("../models/CalendarEvent"),Booking=require("../models/Booking");function ViewModel(app){this.app=app;this.currentDate=ko.observable(new Date);this.currentID=ko.observable(0);this.currentIndex=ko.observable(0);this.editMode=ko.observable(!1);this.isLoading=ko.observable(!1);this.dateAvailability=ko.observable();this.appointments=ko.pureComputed(function(){var dateAvail=this.dateAvailability();return dateAvail&&dateAvail.appointmentsList()||[]},this);this.appointmentCardView=ko.observable(null);var loadingAppointment=new Appointment({id:Appointment.specialIds.loading,summary:"Loading..."}),newEmptyDateAppointment=function newEmptyDateAppointment(){return new Appointment({id:Appointment.specialIds.emptyDate,summary:"You have nothing scheduled",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newUnavailableAppointment=function newUnavailableAppointment(){return new Appointment({id:Appointment.specialIds.unavailable,summary:"You`re unavailable all day",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newFreeAppointment=function newFreeAppointment(){return new Appointment({id:Appointment.specialIds.free,summary:"Free",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newEventAppointment=function newEventAppointment(){return new Appointment({id:Appointment.specialIds.newEvent,summary:"New event...",sourceEvent:new CalendarEvent})},newBookingAppointment=function newBookingAppointment(){return new Appointment({id:Appointment.specialIds.newBooking,summary:"New booking...",sourceEvent:new CalendarEvent,sourceBooking:new Booking})};this.currentAppointment=ko.observable(loadingAppointment);this.updateUrl=function updateUrl(){var apt=this.currentAppointment(),aptId=apt.id(),found=/appointment\/([^\/]+)\/(\-?\d+)/i.exec(window.location),urlId=found&&0|found[2],urlDate=found&&found[1],curDateStr=getDateWithoutTime(apt.startTime()).toISOString();if(!found||urlId!==aptId.toString()||urlDate!==curDateStr){var url="appointment/"+curDateStr+"/"+aptId;""===urlId?this.app.shell.replaceState(null,null,url):this.app.shell.pushState(null,null,url)}};this.goPrevious=function goPrevious(){if(!this.editMode()){var index=this.currentIndex()-1;if(0>index){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var prevDate=m.subtract(1,"days").toDate();this.setCurrent(prevDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.goNext=function goNext(){if(!this.editMode()){var index=this.currentIndex()+1;if(index>=this.appointments().length){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var nextDate=m.add(1,"days").toDate();this.setCurrent(nextDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.getSpecialItem=function(id){switch(id){default:return newEmptyDateAppointment();case Appointment.specialIds.free:return newFreeAppointment();case Appointment.specialIds.newEvent:return newEventAppointment();case Appointment.specialIds.newBooking:return newBookingAppointment();case Appointment.specialIds.loading:return loadingAppointment;case Appointment.specialIds.unavailable:return newUnavailableAppointment()}};this.setItemFromCurrentList=function(id){var list=this.appointments(),index,item;if(-1>id){item=this.getSpecialItem(id);index=-1}else if(0===list.length){index=-1;item=0===this.dateAvailability().workDayMinutes()?newUnavailableAppointment():newEmptyDateAppointment()}else{item=list[0];index=0;if(id)if(id>0){var found=findAppointmentInList(list,id);if(found.item){item=found.item;index=found.index}}else{item=this.getSpecialItem(id);index=-1}}this.currentID(item.id());this.currentIndex(index);this.currentAppointment(item)};var _setCurrent=function setCurrent(date,id,type){date=date&&getDateWithoutTime(date)||null;date&&this.currentDate(date);if(date){this.isLoading(!0);return app.model.calendar.getDateAvailability(date).then(function(dateAvail){this.isLoading(!1);this.dateAvailability(dateAvail);this.setItemFromCurrentList(id)}.bind(this))["catch"](function(err){this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this))}if(id>0){this.isLoading(!0);var notFound=function notFound(){this.isLoading(!1);return _setCurrent(new Date)}.bind(this),ids={};"booking"===type?ids.bookingID=id:ids.calendarEventID=id;return app.model.calendar.getAppointment(ids).then(function(item){if(item){var itDate=getDateWithoutTime(item.startTime());this.isLoading(!1);return _setCurrent(itDate,item.id())}return notFound()}.bind(this))["catch"](notFound)}return 0>id?_setCurrent(new Date,id):_setCurrent(new Date)}.bind(this),promiseSetCurrent=Promise.resolve();this.setCurrent=function setCurrent(date,id,type){promiseSetCurrent=promiseSetCurrent.then(function(){return _setCurrent(date,id,type)});return promiseSetCurrent}}},{"../components/Activity":96,"../components/DatePicker":97,"../models/Appointment":103,"../models/Booking":104,"../models/CalendarEvent":106,"../utils/getDateWithoutTime":175,knockout:!1,moment:!1}],10:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function BackgroundCheckActivity(){
Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"/marketplaceProfile"})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options)};function ViewModel(){this.isSyncing=ko.observable(!1);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.list=ko.observableArray(testdata())}var Verification=function(){};Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};function testdata(){var verA=new BackgroundCheck({name:"Database Search"}),verB=new BackgroundCheck({name:"Basic Criminal"}),verC=new BackgroundCheck({name:"Risk Adverse"}),verD=new BackgroundCheck({name:"Healthcare Check"});return[new UserBackgroundCheck({statusID:Verification.status.confirmed,lastVerifiedDate:new Date(2015,1,12,10,23,32),backgroundCheck:verA}),new UserBackgroundCheck({statusID:Verification.status.revoked,lastVerifiedDate:new Date(2015,5,20,16,4,0),backgroundCheck:verB}),new UserBackgroundCheck({statusID:Verification.status.pending,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verC}),new UserBackgroundCheck({statusID:Verification.status.obsolete,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verD})]}var Model=require("../models/Model");function UserBackgroundCheck(values){Model(this);this.model.defProperties({statusID:0,lastVerifiedDate:null,backgroundCheck:{Model:BackgroundCheck}},values);this.statusText=ko.pureComputed(function(){var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"},statusCode=enumGetName(this.statusID(),Verification.status);return statusTextsenUS["verification.status."+statusCode]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}function BackgroundCheck(values){Model(this);this.model.defProperties({name:""},values)}function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}},{"../components/Activity":96,"../models/Model":123,knockout:!1}],11:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),$=require("jquery"),A=Activity["extends"](function BookMeButtonActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Scheduling");this.registerHandler({target:this.$activity,event:"click",selector:"textarea",handler:function(){$(this).select()}});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){if(!err||"save"!==err.task){var msg="Error loading data to build the Button.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}}.bind(this)});var $code=this.$activity.find("textarea");this.viewModel.copyCode=function(){var errMsg;try{$code.select();document.execCommand("copy")||(errMsg="Impossible to copy text.")}catch(err){errMsg="Impossible to copy text."}errMsg&&this.app.modals.showError({error:errMsg})}.bind(this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.marketplaceProfile.sync();var jobID=0|state.route.segments[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){var marketplaceProfile=app.model.marketplaceProfile;this.bookCode=ko.computed(function(){return marketplaceProfile.data.bookCode()});this.jobTitleID=ko.observable(0);this.type=ko.observable("icon");this.isLocked=marketplaceProfile.isLocked;var buttonTemplate='<!-- begin Loconomics book-me-button --><a style="display:inline-block"><img alt="" style="border:none" width="200" height="50" /></a><!-- end Loconomics book-me-button -->',linkTemplate="<!-- begin Loconomics book-me-button --><a><span></span></a><!-- end Loconomics book-me-button -->";this.buttonHtmlCode=ko.pureComputed(function(){if(marketplaceProfile.isLoading())return"loading...";var type=this.type(),tpl=buttonTemplate;"link"===type&&(tpl=linkTemplate);var siteUrl=$("html").attr("data-site-url"),linkUrl=siteUrl+"/book/"+this.bookCode()+"/"+this.jobTitleID()+"/",imgUrl=siteUrl+"/img/extern/book-me-now-button.svg",code=generateButtonCode({tpl:tpl,label:"Click here to book me now (on loconomics.com)",linkUrl:linkUrl,imgUrl:imgUrl});return code},this);this.sendByEmailURL=ko.pureComputed(function(){return"mailto:&body="+encodeURIComponent("Loconomics Book Me Now Button HTML code: "+this.buttonHtmlCode())},this)}function generateButtonCode(options){var $btn=$($.parseHTML("<div>"+options.tpl+"</div>"));$btn.find("a").attr("href",options.linkUrl).find("span").text(options.label);$btn.find("img").attr("src",options.imgUrl).attr("alt",options.label);return $btn.html()}},{"../components/Activity":96,knockout:!1}],12:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),SignupVM=require("../viewmodels/Signup"),A=Activity["extends"](function BookingActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Booking");this.viewModel.presetGratuity.subscribe(function(preset){"custom"===preset&&setTimeout(function(){this.$activity.find("[name=custom-gratuity]").focus()}.bind(this),50)}.bind(this));this.registerHandler({target:this.viewModel.progress.step,handler:function(){var load=this[this.viewModel.progress.currentStep()+"Load"];load&&load.call(this)}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var params=state&&state.route&&state.route.segments,bookCode=state&&state.route&&state.route.query.bookCode;this.viewModel.initBooking(0|params[0],0|params[1],bookCode)};var stepsLabels={services:"Services",selectLocation:"Select a location",selectTimes:"Select preferred times",selectTime:"Select the time",payment:"Payment",confirm:"Confirm"};A.prototype.servicesLoad=function(){this.viewModel.supportsGratuity(!0)};A.prototype.selectLocationLoad=function(){this.viewModel.serviceAddresses.sourceAddresses([]);this.viewModel.isLoadingServiceAddresses(!0);this.app.model.users.getServiceAddresses(this.viewModel.booking.serviceProfessionalUserID(),this.viewModel.booking.jobTitleID()).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.serviceAddresses.sourceAddresses(list);this.viewModel.isLoadingServiceAddresses(!1)}.bind(this))["catch"](function(err){this.viewModel.isLoadingServiceAddresses(!1);this.app.modals.showError({error:err})})};A.prototype.selectTimesLoad=function(){var picker=this.viewModel.serviceStartDatePickerView();this.viewModel.timeFieldToBeSelected("");picker.selectedDatetime(null);picker.userID(this.viewModel.booking.serviceProfessionalUserID());picker.selectedDate(new Date)};A.prototype.selectTimeLoad=function(){this.viewModel.timeFieldToBeSelected("serviceDate");var picker=this.viewModel.serviceStartDatePickerView();picker.selectedDatetime(null);picker.userID(this.viewModel.booking.serviceProfessionalUserID());picker.selectedDate(new Date)};A.prototype.paymentLoad=function(){};A.prototype.confirmLoad=function(){};var Model=require("../models/Model"),numeral=require("numeral"),PricingSummaryDetail=require("../models/PricingSummaryDetail"),PricingSummary=require("../models/PricingSummary"),ServiceProfessionalServiceVM=require("../viewmodels/ServiceProfessionalService"),BookingProgress=require("../viewmodels/BookingProgress"),Booking=require("../models/Booking"),ServiceAddresses=require("../viewmodels/ServiceAddresses"),InputPaymentMethod=require("../models/InputPaymentMethod"),Address=require("../models/Address"),EventDates=require("../models/EventDates"),PublicUser=require("../models/PublicUser");function ViewModel(app){this.booking=new Booking;this.newDataReady=ko.observable(!1);this.summary=new PricingSummaryVM;this.bookCode=ko.observable(null);this.serviceProfessionalServices=new ServiceProfessionalServiceVM(app);this.serviceProfessionalServices.isSelectionMode(!0);this.serviceProfessionalServices.preSelectedServices([]);this.makeRepeatBooking=ko.observable(!1);this.promotionalCode=ko.observable("");this.paymentMethod=ko.observable(null);this.isAnonymous=ko.pureComputed(function(){var u=app.model.user();return u&&u.isAnonymous()});this.confirmBtnText=ko.pureComputed(function(){return this.isAnonymous()?"Sign up and confirm":"Confirm"},this);this.paymentMethodDisplay=ko.pureComputed(function(){var n=this.booking.paymentLastFourCardNumberDigits();return n?"Card ending in "+n:""},this);ko.computed(function(){var pm=this.paymentMethod(),number=pm&&pm.cardNumber();if(number){var last=number.slice(-4);this.booking.paymentLastFourCardNumberDigits(last)}},this);this.signupVM=new SignupVM(app);this.serviceAddresses=new ServiceAddresses;this.isLoadingServiceAddresses=ko.observable(!1);this.serviceAddresses.selectedAddress.subscribe(this.booking.serviceAddress,this);this.supportsGratuity=ko.observable(!1);this.customGratuity=ko.observable(0);this.presetGratuity=ko.observable(0);this.gratuityAmount=ko.observable(0);this.gratuityPercentage=ko.pureComputed(function(){var preset=this.presetGratuity();return"custom"===preset?0:preset},this);this.booking.jobTitleID.subscribe(this.serviceProfessionalServices.jobTitleID);this.booking.serviceProfessionalUserID.subscribe(this.serviceProfessionalServices.serviceProfessionalID);this.gratuityPercentage.subscribe(this.summary.gratuityPercentage);this.gratuityAmount.subscribe(this.summary.gratuityAmount);ko.computed(function(){var services=this.serviceProfessionalServices.selectedServices();this.summary.details(services.map(function(service){return PricingSummaryDetail.fromServiceProfessionalService(service)}))},this);ko.computed(function(){this.booking.pricingSummary(this.summary.toPricingSummary())},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.serviceProfessionalInfo=ko.observable(new PublicUser);this.isLoadingServiceProfessionalInfo=ko.observable(!1);this.booking.serviceProfessionalUserID.subscribe(function(userID){if(userID){this.isLoadingServiceProfessionalInfo(!0);app.model.users.getUser(userID).then(function(info){info.selectedJobTitleID=this.booking.jobTitleID();this.serviceProfessionalInfo().model.updateWith(info,!0);this.isLoadingServiceProfessionalInfo(!1)}.bind(this))["catch"](function(err){this.isLoadingServiceProfessionalInfo(!1);app.modals.showError({error:err})}.bind(this))}else this.serviceProfessionalInfo().model.reset()},this);this.serviceStartDatePickerView=ko.observable(null);this.timeFieldToBeSelected=ko.observable("");ko.computed(function triggerSelectedDatetime(){var v=this.serviceStartDatePickerView(),dt=v&&v.selectedDatetime(),current=this.booking.serviceDate(),field=this.timeFieldToBeSelected.peek();if(dt&&field&&dt.toString()!==(current&&current.startTime().toString())){this.booking[field](new EventDates({startTime:dt}));this.booking[field]().duration({minutes:this.summary.firstSessionDurationMinutes()});this.booking.instantBooking()?this.progress.next():this.timeFieldToBeSelected("")}},this);this.summary.firstSessionDurationMinutes.subscribe(function(minutes){this.serviceStartDatePickerView()&&this.serviceStartDatePickerView().requiredDurationMinutes(minutes)},this);this.pickServiceDate=function(){this.timeFieldToBeSelected("serviceDate")}.bind(this);this.pickAlternativeDate1=function(){this.timeFieldToBeSelected("alternativeDate1")}.bind(this);this.pickAlternativeDate2=function(){this.timeFieldToBeSelected("alternativeDate2")}.bind(this);this.progress=new BookingProgress({step:-1});this.nextStep=function(){this.progress.next()};this.goStep=function(stepName){var i=this.progress.stepsList().indexOf(stepName);this.progress.step(i>-1?i:0)};this.getStepLabel=function(stepName){return stepsLabels[stepName]||stepName};this.isAtSelectTimes=this.progress.observeStep("selectTimes");this.isAtSelectTime=this.progress.observeStep("selectTime");this.reset=function reset(){this.newDataReady(!1);this.booking.model.reset();this.serviceProfessionalServices.preSelectedServices([]);this.customGratuity(0);this.presetGratuity(0);this.gratuityAmount(0);this.promotionalCode("");this.makeRepeatBooking(!1);this.paymentMethod(null)}.bind(this);this.isPhoneServiceOnly=ko.pureComputed(function(){return this.serviceProfessionalServices.selectedServices().every(function(service){return service.isPhone()})},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var list=["services"];if(this.newDataReady()){this.isPhoneServiceOnly()||list.push("selectLocation");list.push(this.booking.instantBooking()?"selectTime":"selectTimes");this.booking.paymentEnabled()&&list.push("payment");list.push("confirm")}this.progress.stepsList(list)},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.isLoadingNewBooking=ko.observable(!1);this.initBooking=function(serviceProfessionalID,jobTitleID,bookCode){this.reset();this.bookCode(bookCode);this.isLoadingNewBooking(!0);app.model.bookings.getNewClientBooking({serviceProfessionalUserID:serviceProfessionalID,jobTitleID:jobTitleID,bookCode:bookCode}).then(function(bookingData){this.booking.model.updateWith(bookingData);if(this.booking.paymentEnabled()){var ipm=new InputPaymentMethod;ipm.billingAddress(new Address);this.paymentMethod(ipm)}this.isLoadingNewBooking(!1);this.newDataReady(!0);this.progress.step(-1);this.nextStep()}.bind(this))["catch"](function(err){this.isLoadingNewBooking(!1);app.modals.showError({error:err})}.bind(this))}.bind(this);this.bookingHeader=ko.pureComputed(function(){var v=this.booking.instantBooking();return v===!0?"Your instant booking":v===!1?"Your booking request":""},this);this.isLoading=ko.pureComputed(function(){return this.isLoadingNewBooking()||this.isLoadingServiceProfessionalInfo()||this.serviceProfessionalServices.isLoading()},this);this.isSaving=ko.observable();this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.save=function(){this.isSaving(!0);var saveIt=function(){var requestOptions={promotionalCode:this.promotionalCode(),bookCode:this.bookCode()};return app.model.bookings.requestClientBooking(this.booking,requestOptions,this.paymentMethod())}.bind(this),success=function(serverBooking){this.isSaving(!1);this.booking.model.updateWith(serverBooking);app.modals.showNotification({title:"Done!",message:"Your booking was created!"}).then(function(){app.shell.go("/")})}.bind(this),onerror=function(err){this.isSaving(!1);app.modals.showError({error:err})}.bind(this);this.isAnonymous()?this.signupVM.performSignup().then(saveIt).then(success)["catch"](onerror):saveIt().then(success)["catch"](onerror)}.bind(this);this.specialRequestsPlaceholder=ko.pureComputed(function(){var sp=this.serviceProfessionalInfo();sp=sp.profile()&&sp.profile().firstName();return sp?"Add notes to "+sp:"Add notes"},this);this.pickSpecialRequests=function(){app.modals.showTextEditor({title:this.specialRequestsPlaceholder(),text:this.booking.specialRequests()}).then(function(text){this.booking.specialRequests(text)}.bind(this))["catch"](function(err){err&&app.modals.showError({error:err})})}.bind(this);this.urlTos=ko.observable("https://loconomics.com/en-US/About/TermsOfUse/");this.urlPp=ko.observable("https://loconomics.com/en-US/About/PrivacyPolicy/");this.urlBcp=ko.observable("https://loconomics.com/en-US/About/BackgroundCheckPolicy/");this.urlCp=ko.observable("https://loconomics.com/en-US/About/CancellationPolicy/");this.goLogin=function(d,e){app.shell.go("/login",{redirectUrl:app.shell.currentRoute.url});if(e){e.preventDefault();e.stopImmediatePropagation()}}}function PricingSummaryVM(values){Model(this);this.model.defProperties({details:{isArray:!0,Model:PricingSummaryDetail},gratuityPercentage:0,gratuityAmount:0,feesPercentage:10},values);this.subtotalPrice=ko.pureComputed(function(){return this.details().reduce(function(total,item){total+=item.price();return total},0)},this);this.fees=ko.pureComputed(function(){var t=this.subtotalPrice(),f=this.feesPercentage();return t*(f/100)},this);this.gratuity=ko.pureComputed(function(){var percentage=0|this.gratuityPercentage(),amount=0|this.gratuityAmount();return percentage>0?this.subtotalPrice()*(percentage/100):0>amount?0:amount},this);this.totalPrice=ko.pureComputed(function(){return this.subtotalPrice()+this.fees()+this.gratuity()},this);this.feesMessage=ko.pureComputed(function(){var f=numeral(this.fees()).format("$#,##0.00");return"*includes a __fees__ first-time booking fee".replace(/__fees__/g,f)},this);this.items=ko.pureComputed(function(){var items=this.details().slice(),gratuity=this.gratuity();if(gratuity>0){var gratuityLabel=this.gratuityPercentage()?"Gratuity (__gratuity__%)".replace(/__gratuity__/g,0|this.gratuityPercentage()):"Gratuity";items.push(new PricingSummaryDetail({serviceName:gratuityLabel,price:this.gratuity()}))}return items},this);this.serviceDurationMinutes=ko.pureComputed(function(){return this.details().reduce(function(total,item){total+=item.serviceDurationMinutes();return total},0)},this);this.firstSessionDurationMinutes=ko.pureComputed(function(){return this.details().reduce(function(total,item){total+=item.firstSessionDurationMinutes();return total},0)},this);var duration2Language=require("../utils/duration2Language");this.serviceDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.serviceDurationMinutes()})},this);this.firstSessionDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.firstSessionDurationMinutes()})},this);this.toPricingSummary=function(){var plain=this.model.toPlainObject(!0);plain.subtotalPrice=this.subtotalPrice();plain.feePrice=this.fees();plain.totalPrice=this.totalPrice();plain.serviceDurationMinutes=this.serviceDurationMinutes();plain.firstSessionDurationMinutes=this.firstSessionDurationMinutes();return new PricingSummary(plain)}}},{"../components/Activity":96,"../models/Address":102,"../models/Booking":104,"../models/EventDates":110,"../models/InputPaymentMethod":113,"../models/Model":123,"../models/PricingSummary":125,"../models/PricingSummaryDetail":126,"../models/PublicUser":129,"../utils/duration2Language":171,"../viewmodels/BookingProgress":196,"../viewmodels/ServiceAddresses":202,"../viewmodels/ServiceProfessionalService":203,"../viewmodels/Signup":204,knockout:!1,numeral:!1}],13:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),Activity=require("../components/Activity"),A=Activity["extends"](function CalendarActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Calendar");this.$datepicker=this.$activity.find("#calendarDatePicker");this.$dailyView=this.$activity.find("#calendarDailyView");this.$dateTitle=this.$activity.find(".CalendarDateHeader > .btn");this.$chooseNew=$("#calendarChooseNew");this.$datepicker.show().datepicker({extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(this.app,this.$datepicker,this.viewModel.isLoading);this.registerHandler({target:this.viewModel.currentDate,handler:function(date){if(date){var mdate=moment(date);if(mdate.isValid()){var isoDate=mdate.toISOString();this.$datepicker.removeClass("is-visible");this.$datepicker.datepicker("getValue").toISOString()!==isoDate&&this.$datepicker.datepicker("setValue",date,!0);this.app.shell.pushState(null,null,"calendar/"+isoDate);return}}this.viewModel.currentDate(getDateWithoutTime())}.bind(this)});this.registerHandler({target:this.$dailyView,event:"swipeleft swiperight",handler:function(e){e.preventDefault();var dir="swipeleft"===e.type?"next":"prev";$(document).trigger("touchend");this.$datepicker.datepicker("moveValue",dir,"date")}.bind(this)});this.registerHandler({target:this.$dateTitle,event:"click",handler:function(e){this.$datepicker.toggleClass("is-visible");e.preventDefault();e.stopPropagation()}.bind(this)});this.registerHandler({target:this.$datepicker,event:"dateChanged",handler:function(e){"days"===e.viewMode&&this.viewModel.currentDate(getDateWithoutTime(e.date))}.bind(this)});this.viewModel.currentDate(getDateWithoutTime())});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var sdate=options.route&&options.route.segments&&options.route.segments[0],date;if(sdate){var mdate=moment(sdate);date=mdate.isValid()?getDateWithoutTime(mdate.toDate()):null}date||(date=getDateWithoutTime());this.viewModel.previousDate=null;this.viewModel.currentDate(date);this.tagAvailability(date,this.app.model.userProfile.data.userID(),!0)};var Appointment=require("../models/Appointment"),TimeSlotViewModel=require("../viewmodels/TimeSlot");function ViewModel(app){this.currentDate=ko.observable(getDateWithoutTime());var fullDayFree=[Appointment.newFreeSlot({date:this.currentDate()})];this.currentDate.subscribe(function(date){if(date){fullDayFree[0].startTime(date);fullDayFree[0].endTime(date)}},this);this.slotsSource=ko.observable(fullDayFree);this.slots=ko.computed(function(){var slots=this.slotsSource();slots.length>1&&(slots=slots.filter(function(slot){return slot.id()!==Appointment.specialIds.unavailable}));return slots.map(TimeSlotViewModel.fromAppointment)},this);this.isLoading=ko.observable(!1);this.previousDate=this.currentDate().toISOString();this.currentDate.subscribe(function(date){date=new Date(Date.parse(date.toISOString()));if(date.toISOString()!==this.previousDate){this.previousDate=date.toISOString();this.isLoading(!0);app.model.calendar.getDateAvailability(date).then(function(dateAvail){if(date.toISOString()===this.currentDate().toISOString()){this.slotsSource(dateAvail.list());this.isLoading(!1)}}.bind(this))["catch"](function(err){this.slotsSource(fullDayFree);this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this))}}.bind(this))}},{"../components/Activity":96,"../components/DatePicker":97,"../models/Appointment":103,"../utils/datepickerAvailability":170,"../utils/getDateWithoutTime":175,"../viewmodels/TimeSlot":205,knockout:!1,moment:!1}],14:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),ko=require("knockout"),A=Activity["extends"](function CalendarSyncingActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"});this.registerHandler({target:this.$activity.find("#calendarSync-icalExportUrl"),event:"click",handler:function(){$(this).select()}});this.registerHandler({target:this.app.model.calendarSyncing,event:"error",handler:function(err){var msg="save"===err.task?"Error saving calendar syncing settings.":"Error loading calendar syncing settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.calendarSyncing.sync();this.viewModel.discard()};function ViewModel(app){var calendarSyncing=app.model.calendarSyncing,syncVersion=calendarSyncing.newVersion();syncVersion.isObsolete.subscribe(function(itIs){itIs&&syncVersion.pull({evenIfNewer:!0})});this.sync=syncVersion.version;this.isLocked=ko.pureComputed(function(){return this.isLocked()||this.isReseting()},calendarSyncing);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},calendarSyncing);this.resetText=ko.pureComputed(function(){return this.isReseting()?"reseting...":"Reset Private URL"},calendarSyncing);this.discard=function discard(){syncVersion.pull({evenIfNewer:!0})};this.save=function save(){syncVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})};this.reset=function reset(){calendarSyncing.resetExportUrl()}}},{"../components/Activity":96,knockout:!1}],15:[function(require,module,exports){"use strict";var ko=require("knockout"),moment=require("moment"),Activity=require("../components/Activity"),A=Activity["extends"](function CancellationPolicyActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title");this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.viewModel.isLoading(!0);this.app.model.userJobProfile.getUserJobTitle(jobTitleID).then(function(userJobTitle){this.viewModel.userJobTitle(userJobTitle);this.viewModel.selectedCancellationPolicyID(userJobTitle.cancellationPolicyID())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this))}else{this.viewModel.userJobTitle(null);this.viewModel.selectedCancellationPolicyID(null)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.selectedCancellationPolicyID(null);Activity.prototype.show.call(this,state);var params=state&&state.route&&state.route.segments;this.viewModel.jobTitleID(0|params[0])};function ViewModel(app){this.jobTitleID=ko.observable(0);this.userJobTitle=ko.observable(null);this.selectedCancellationPolicyID=ko.observable(null);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.cancellationPolicyID=this.selectedCancellationPolicyID();app.model.userJobProfile.setUserJobTitle(plain).then(function(){this.isSaving(!1);app.successSave()}.bind(this))["catch"](function(err){this.isSaving(!1);app.modals.showError({title:"Error saving Cancellation Policy preference",error:err})}.bind(this))}}.bind(this);this.policies=ko.observableArray([new CancellationPolicy({cancellationPolicyID:1,name:"Strict",description:"50% refund up to 5 days before booking, except fees",hoursRequired:120,refundIfCancelledBefore:.5}),new CancellationPolicy({cancellationPolicyID:2,name:"Moderate",description:"100% refund up to 24 hours before booking, except fees.  No refund for under 24 hours and no-shows.",hoursRequired:24,refundIfCancelledBefore:1}),new CancellationPolicy({cancellationPolicyID:3,name:"Flexible",description:"100% refund up to 24 hours before booking, except fees.  50% refund for under 24 hours and no-shows.",hoursRequired:24,refundIfCancelledBefore:1})])}var Model=require("../models/Model"),observableTime=ko.observable(new Date);setInterval(function(){observableTime(new Date)},6e4);function CancellationPolicy(values){Model(this);this.model.defProperties({cancellationPolicyID:0,name:"",description:"",hoursRequired:0,refundIfCancelledBefore:0},values);this.refundIfCancelledBeforeDisplay=ko.pureComputed(function(){return Math.floor(100*this.refundIfCancelledBefore())+"%"},this);this.refundLimitDate=ko.computed(function(){var d=moment(observableTime()).clone();d.add(7,"days").subtract(this.hoursRequired(),"hours");return d.toDate()},this)}},{"../components/Activity":96,"../models/Model":123,knockout:!1,moment:!1}],16:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),is=require("is_js"),A=Activity["extends"](function ClientEditionActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("clients",{backLink:"clients"});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){if(clientID){var found=/clientEditor\/(\-?\d+)/i.exec(window.location),urlID=found&&0|found[1];found&&urlID===clientID||this.app.shell.replaceState(null,null,"clientEditor/"+clientID)}}.bind(this)});this.viewModel.onSave=function(clientID){if(this.requestData.returnNewAsSelected===!0){this.requestData.clientID=clientID;this.app.shell.goBack(this.requestData)}else this.app.successSave()}.bind(this)});exports.init=A.init;var ko=require("knockout");A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/clients";var link=this.requestData.cancelLink||referrer;this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.clientID(0);this.updateNavBarState();var params=state&&state.route&&state.route.segments||[],clientID=0|params[0];if(clientID){this.viewModel.clientID(clientID);this.app.model.clients.createItemVersion(clientID).then(function(clientVersion){if(clientVersion){this.viewModel.clientVersion(clientVersion);this.viewModel.header("Edit Client")}else{this.viewModel.clientVersion(null);this.viewModel.header("Unknow client or was deleted")}}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading client data",error:err})}.bind(this))}else{var presetData=this.requestData.presetData||{};presetData.editable!==!1&&(presetData.editable=!0);this.viewModel.clientVersion(this.app.model.clients.newItem(presetData));this.viewModel.header("Add a Client");this.requestData.newForSearchText&&clientDataFromSearchText(this.requestData.newForSearchText||"",this.viewModel.client())}};function seemsAPhoneNumber(str){return/\d{3,}/.test(str||"")}function clientDataFromSearchText(txt,client){if(is.email(txt))client.email(txt);else if(seemsAPhoneNumber(txt))client.phone(txt);else{var nameParts=txt.split(" ",2);client.firstName(nameParts[0]);nameParts.length>1&&client.lastName(nameParts[1])}}function ViewModel(app){this.clientID=ko.observable(0);this.clientVersion=ko.observable(null);this.client=ko.pureComputed(function(){var v=this.clientVersion();return v?v.version:null},this);this.header=ko.observable("");this.isLoading=app.model.clients.state.isLoading;this.isSyncing=app.model.clients.state.isSyncing;this.isSaving=app.model.clients.state.isSaving;this.isLocked=ko.pureComputed(function(){return app.model.clients.state.isLocked()||this.isDeleting()},this);this.isReadOnly=ko.pureComputed(function(){var c=this.client();return c&&!c.editable()},this);this.isDeleting=app.model.clients.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isNew=ko.pureComputed(function(){var c=this.client();return!c||!c.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.clientVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":this.isNew()?"Add client":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.clientVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.clients.setItem(this.client().model.toPlainObject()).then(function(serverData){this.client().model.updateWith(serverData);this.clientVersion().push({evenIfObsolete:!0});this.onSave(serverData.clientUserID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err
})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete client",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.clients.delItem(this.clientID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var c=this.client();if(c){var birthMonth=c.birthMonth();return birthMonth?this.months()[birthMonth-1]:null}return null},write:function(month){var c=this.client();c&&c.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);this.validEmail=ko.pureComputed(function(){var c=this.client();if(c){var e=c.email();return is.email(e)?e:""}return""},this);this.validPhone=ko.pureComputed(function(){var c=this.client();if(c){var e=c.phone();return seemsAPhoneNumber(e)?e:""}return""},this);var foundPublicUser=function foundPublicUser(user){var c=this.client();if(c&&c.clientUserID()!==user.clientUserID&&(c.email()===user.email||c.phone()===user.phone)){var msg="We`ve found an existing record for {0}. Would you like to add him to your clients?".replace(/\{0\}/g,user.firstName);app.modals.confirm({title:"client found at loconomics.com",message:msg}).then(function(){var notes=c.notesAboutClient();c.model.updateWith(user);c.notesAboutClient(notes);this.clientID(user.clientUserID)}.bind(this))["catch"](function(){})}}.bind(this);ko.computed(function(){var c=this.client();if(c){var email=c.email(),phone=c.phone();(email||phone)&&app.model.clients.publicSearch({email:email,phone:phone}).then(function(r){r&&r[0]&&foundPublicUser(r[0])}.bind(this))["catch"](function(){})}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}})}},{"../components/Activity":96,is_js:!1,knockout:!1}],17:[function(require,module,exports){"use strict";var $=require("jquery"),ko=require("knockout"),Activity=require("../components/Activity"),textSearch=require("../utils/textSearch"),A=Activity["extends"](function ClientsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"cms"});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();this.$index=this.$activity.find("#clientsIndex");this.$listView=this.$activity.find("#clientsListView");this.registerHandler({target:this.viewModel.selectedClient,handler:function(theSelectedClient){if(this.requestData&&this.requestData.selectClient===!0&&theSelectedClient){this.requestData.selectedClientID=theSelectedClient.clientUserID();this.app.shell.goBack(this.requestData);this.requestData=null}}.bind(this)});this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();this.viewModel.headerText(itIs?"Select a client":"");this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):itIs||this.navBar.leftAction().handler(null)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.viewModel.selectedClient(null);this.viewModel.requestData=this.requestData;if(state.returnNewAsSelected===!0&&state.clientID)setTimeout(function(){delete state.returnNewAsSelected;this.requestData.selectedClientID=state.clientID;this.app.shell.goBack(this.requestData)}.bind(this),1);else{this.viewModel.isSelectionMode(state.selectClient===!0);this.updateNavBarState();this.app.model.clients.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this))}};function ViewModel(app){this.headerText=ko.observable("");this.isSelectionMode=ko.observable(!1);this.clients=app.model.clients.list;this.isLoading=app.model.clients.state.isLoading;this.isSyncing=app.model.clients.state.isSyncing;this.searchText=ko.observable("");this.getFilteredList=function getFilteredList(){var s=(this.searchText()||"").toLowerCase();return this.clients().filter(function(client){if(!client)return!1;var found=textSearch(s,client.fullName());if(found)return!0;found=textSearch(s,client.email());if(found)return!0;found=textSearch(s,client.phone());return found})};this.filteredClients=ko.computed(function(){return this.getFilteredList()},this);this.groupedClients=ko.computed(function(){var clients=this.filteredClients().sort(function(clientA,clientB){var a=clientA.firstName().toLowerCase(),b=clientB.firstName().toLowerCase();return a===b?0:a>b?1:-1}),groups=[],latestGroup=null,latestLetter=null;clients.forEach(function(client){var letter=(client.firstName()[0]||"").toUpperCase();if(letter!==latestLetter){latestGroup={letter:letter,clients:[client]};groups.push(latestGroup);latestLetter=letter}else latestGroup.clients.push(client)});return groups},this);this.publicSearchResults=ko.observableArray([]);this.publicSearchRunning=ko.observable(null);ko.computed(function(){var filtered=this.filteredClients(),searchText=this.searchText(),request=null;if(0===filtered.length&&searchText){this.publicSearchResults([]);request=app.model.clients.publicSearch({fullName:searchText,email:searchText,phone:searchText});this.publicSearchRunning(request);request.then(function(r){this.publicSearchResults(r)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error when on remote clients search",error:err})}).then(function(){this.publicSearchRunning()===request&&this.publicSearchRunning(null)}.bind(this))}else{this.publicSearchResults([]);request=this.publicSearchRunning();if(request&&request.xhr&&request.xhr.abort){request.xhr.abort();this.publicSearchRunning(null)}}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}});this.addRemoteClient=function(client,event){var data=client.model&&client.model.toPlainObject()||client,request=$.extend({},this.requestData,{presetData:data,returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addNew=function(data,event){event.preventDefault();event.stopImmediatePropagation();var request=$.extend({},this.requestData,{newForSearchText:this.searchText(),returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request)}.bind(this);this.selectedClient=ko.observable(null);this.selectClient=function(selectedClient,event){event.preventDefault();event.stopImmediatePropagation();this.selectedClient(selectedClient)}.bind(this)}},{"../components/Activity":96,"../utils/textSearch":193,knockout:!1}],18:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function CmsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("Client management")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.clients.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this))};var numeral=require("numeral");function ViewModel(app){this.clients=app.model.clients.list;this.clientsCount=ko.pureComputed(function(){var cs=this.clients();return 0>=cs?"0 clients":1===cs?"1 client":numeral(0|cs.length).format("0,0")+" clients"},this)}},{"../components/Activity":96,knockout:!1,numeral:!1}],19:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity["extends"](function ContactFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us");this.navBar.rightAction(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Support: given a bad VOC Element name:",elementName):console.log("Feedback Support: Accessing without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout");function ViewModel(app){this.message=ko.observable("");this.wasSent=ko.observable(!1);this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);var updateWasSent=function(){this.wasSent(!1)}.bind(this);this.message.subscribe(updateWasSent);this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":this.wasSent()?"Sent":"Send"},this);this.send=function send(){this.isSending(!0);app.model.feedback.postSupport({message:this.message(),vocElementID:this.vocElementID()}).then(function(){this.message("");this.wasSent(!0)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}.bind(this)}},{"../components/Activity":96,"../models/VocElementEnum":149,knockout:!1}],20:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function ContactInfoActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Owner information",{backLink:"ownerInfo"});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Account",{backLink:"account"});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.registerHandler({target:this.app.model.userProfile,event:"error",handler:function(err){var msg="save"===err.task?"Error saving contact data.":"Error loading contact data.";this.app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)});this.registerHandler({target:this.app.model.homeAddress,event:"error",handler:function(err){var msg="save"===err.task?"Error saving address details.":"Error loading address details.";this.app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)});var app=this.app,viewModel=this.viewModel;ko.computed(function(){var postalCode=this.postalCode(),address=this;postalCode&&!/^\s*$/.test(postalCode)&&app.model.postalCodes.getItem(postalCode).then(function(info){if(info){address.city(info.city);address.stateProvinceCode(info.stateProvinceCode);address.stateProvinceName(info.stateProvinceName);viewModel.errorMessages.postalCode("")}})["catch"](function(err){address.city("");address.stateProvinceCode("");address.stateProvinceName("");var msg="string"==typeof err?err:null;msg||err&&err.responseJSON&&err.responseJSON.errorMessage?viewModel.errorMessages.postalCode(msg||err.responseJSON.errorMessage):console.error("Server error validating Zip Code",err)})},this.viewModel.address).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.updateNavBarState();this.app.model.userProfile.sync();this.app.model.homeAddress.sync()};function ViewModel(app){this.user=app.model.userProfile.data;this.headerText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"How can we reach you?":"Contact information"});this.errorMessages={postalCode:ko.observable("")};var userProfile=app.model.userProfile,profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var birthMonth=this.profile.birthMonth();return birthMonth?this.months()[birthMonth-1]:null},write:function(month){this.profile.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);var homeAddress=app.model.homeAddress,homeAddressVersion=homeAddress.newVersion();homeAddressVersion.isObsolete.subscribe(function(itIs){itIs&&homeAddressVersion.pull({evenIfNewer:!0})});this.address=homeAddressVersion.version;this.isLocked=ko.computed(function(){return userProfile.isLocked()||homeAddress.isLocked()},this);this.isLoading=ko.computed(function(){return userProfile.isLoading()||homeAddress.isLoading()},this);this.isSaving=ko.computed(function(){return userProfile.isSaving()||homeAddress.isSaving()},this);this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.discard=function discard(){profileVersion.pull({evenIfNewer:!0});homeAddressVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){Promise.all([profileVersion.pushSave(),homeAddressVersion.pushSave()]).then(function(){app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})}.bind(this)}},{"../components/Activity":96,knockout:!1}],21:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function ConversationActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Inbox",{backLink:"inbox"})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.threadID(0);this.viewModel.thread(null);var params=state&&state.route&&state.route.segments||[],threadID=0|params[0];this.viewModel.threadID(threadID);threadID?this.viewModel.thread.sync(threadID)["catch"](function(err){this.app.modals.showError({title:"Error loading conversation",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):this.app.modals.showError({title:"Conversation Not Found"}).then(function(){this.app.shell.goBack()}.bind(this))};var ko=require("knockout");function ViewModel(app){this.isLoading=app.model.messaging.state.isLoading;this.isSyncing=app.model.messaging.state.isSyncing;this.isSaving=app.model.messaging.state.isSaving;this.threadID=ko.observable(null);this.thread=app.model.messaging.createWildcardItem();this.subject=ko.pureComputed(function(){var m=this.thread();return this.isLoading()?"Loading...":m&&(m.subject()||"").replace(/^\s+|\s+$/g,"")||"Conversation without subject"},this);this.bookingID=ko.pureComputed(function(){var msg=this.thread()&&this.thread().messages()[0];return msg&&"booking"===(msg.auxT()||"").toLowerCase()&&msg.auxID()?msg.auxID():null},this)}},{"../components/Activity":96,knockout:!1}],22:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),AppointmentView=require("../viewmodels/AppointmentView"),UserJobTitle=require("../models/UserJobTitle"),A=Activity["extends"](function DashboardActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.$nextBooking=this.$activity.find("#dashboardNextBooking");this.$upcomingBookings=this.$activity.find("#dashboardUpcomingBookings");this.$inbox=this.$activity.find("#dashboardInbox");this.$performance=this.$activity.find("#dashboardPerformance");this.$getMore=this.$activity.find("#dashboardGetMore");setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var v=this.viewModel,app=this.app,appModel=this.app.model;if(this.requestData.completedOnboarding)switch(this.requestData.completedOnboarding){case"welcome":this.app.modals.showNotification({title:"Nice work!",message:"You'll now be taken to your dashboard.Please try the following: 1. Activate your marketplace profile 2. Add a fake client using +3. Add a fake booking using +",buttonText:"Got it"})}var preapareShowErrorFor=function preapareShowErrorFor(title){return function(err){this.app.modals.showError({title:title,error:err})}.bind(this)}.bind(this);v.upcomingBookings.items().length?v.upcomingBookings.isSyncing(!0):v.upcomingBookings.isLoading(!0);appModel.bookings.getUpcomingBookings().then(function(upcoming){if(upcoming.nextBookingID){var previousID=v.nextBooking()&&v.nextBooking().sourceBooking().bookingID();if(upcoming.nextBookingID!==previousID){v.nextBooking()?v.nextBooking.isSyncing(!0):v.nextBooking.isLoading(!0);appModel.calendar.getAppointment({bookingID:upcoming.nextBookingID}).then(function(apt){v.nextBooking(new AppointmentView(apt,app))})["catch"](preapareShowErrorFor("Error loading next booking")).then(function(){v.nextBooking.isLoading(!1);v.nextBooking.isSyncing(!1)})}}else v.nextBooking(null);v.upcomingBookings.today.quantity(upcoming.today.quantity);v.upcomingBookings.today.time(upcoming.today.time&&new Date(upcoming.today.time));v.upcomingBookings.tomorrow.quantity(upcoming.tomorrow.quantity);v.upcomingBookings.tomorrow.time(upcoming.tomorrow.time&&new Date(upcoming.tomorrow.time));v.upcomingBookings.nextWeek.quantity(upcoming.nextWeek.quantity);v.upcomingBookings.nextWeek.time(upcoming.nextWeek.time&&new Date(upcoming.nextWeek.time))})["catch"](preapareShowErrorFor("Error loading upcoming bookings")).then(function(){v.upcomingBookings.isLoading(!1);v.upcomingBookings.isSyncing(!1)});var MessageView=require("../models/MessageView");v.inbox.messages().length?v.inbox.isSyncing(!0):v.inbox.isLoading(!0);appModel.messaging.getList().then(function(threads){v.inbox.messages(threads().map(MessageView.fromThread.bind(null,app)))})["catch"](preapareShowErrorFor("Error loading latest messages")).then(function(){v.inbox.isLoading(!1);v.inbox.isSyncing(!1)});this.syncGetMore()};A.prototype.syncGetMore=function syncGetMore(){this.app.model.userJobProfile.syncList().then(function(list){var yep=list.some(function(job){return job.statusID()!==UserJobTitle.status.on?!0:void 0});this.viewModel.getMore.profile(!!yep)}.bind(this))};var UpcomingBookingsSummary=require("../models/UpcomingBookingsSummary"),MailFolder=require("../models/MailFolder"),PerformanceSummary=require("../models/PerformanceSummary"),GetMore=require("../models/GetMore");function ViewModel(app){this.upcomingBookings=new UpcomingBookingsSummary;this.upcomingBookings.isLoading=ko.observable(!1);this.upcomingBookings.isSyncing=ko.observable(!1);this.nextBooking=ko.observable(null);this.nextBooking.isLoading=ko.observable(!1);this.nextBooking.isSyncing=ko.observable(!1);this.inbox=new MailFolder({topNumber:4});this.inbox.isLoading=ko.observable(!1);this.inbox.isSyncing=ko.observable(!1);this.performance=new PerformanceSummary;this.getMore=new GetMore;this.user=app.model.userProfile.data}function setSomeTestingData(viewModel){var moreData={};moreData=viewModel.user.isServiceProfessional()?{availability:!1,payments:!1,profile:!1,coop:!1}:{availability:!1,payments:!1,profile:!1,coop:!0};viewModel.getMore.model.updateWith(moreData)}},{"../components/Activity":96,"../models/GetMore":112,"../models/MailFolder":119,"../models/MessageView":122,"../models/PerformanceSummary":124,"../models/UpcomingBookingsSummary":141,"../models/UserJobTitle":144,"../viewmodels/AppointmentView":195,knockout:!1}],23:[function(require,module,exports){"use strict";var ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),Activity=require("../components/Activity"),A=Activity["extends"](function DatetimePickerActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("",{helpId:"datetimePickerHelp"});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();ko.computed(function(){var datetime=this.viewModel.component()&&this.viewModel.component().selectedDatetime();if(datetime){this.requestData.selectedDatetime=datetime;this.requestData.allowBookUnavailableTime=this.viewModel.component().allowBookUnavailableTime();this.app.shell.goBack(this.requestData)}},this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var header=this.requestData.headerText;this.viewModel.headerText(header||"Select date and time");if(this.requestData.title)this.navBar.title(this.requestData.title);else{this.navBar.title("");this.navBar.leftAction().text(this.requestData.navTitle||"")}if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);this.navBar.leftAction().handler(this.returnRequest)}};A.prototype.show=function show(state){this.viewModel.component()&&this.viewModel.component().reset();Activity.prototype.show.call(this,state);this.viewModel.component().requiredDurationMinutes(0|this.requestData.requiredDuration);this.viewModel.component().userID(this.app.model.user().userID());var selDate=getDateWithoutTime(this.requestData.selectedDatetime);this.viewModel.component().selectedDate(selDate);this.updateNavBarState()};function ViewModel(){this.headerText=ko.observable("Select a time");this.component=ko.observable(null)}},{"../components/Activity":96,"../utils/getDateWithoutTime":175,knockout:!1}],24:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function EducationActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"/marketplaceProfile"})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.education.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading education information",error:err})}.bind(this))};function ViewModel(app){this.isLoading=app.model.education.state.isLoading;this.isSyncing=app.model.education.state.isSyncing;this.list=app.model.education.list}},{"../components/Activity":96}],25:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function EducationFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Education")});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/education/";this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[];this.viewModel.educationID(0|params[0]);this.updateNavBarState();0===this.viewModel.educationID()?this.viewModel.version(this.app.model.education.newItem()):this.app.model.education.createItemVersion(this.viewModel.educationID()).then(function(educationVersion){if(!educationVersion)throw new Error("No data");this.viewModel.version(educationVersion)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this))};function ViewModel(app){this.educationID=ko.observable(0);this.isLoading=app.model.education.state.isLoading;this.isSaving=app.model.education.state.isSaving;this.isSyncing=app.model.education.state.isSyncing;this.isDeleting=app.model.education.state.isDeleting;this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.education.state.isLocked()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.isNew=ko.pureComputed(function(){var p=this.item();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.version();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.education.setItem(this.item().model.toPlainObject()).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.education.delItem(this.educationID()).then(function(){app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.yearsOptions=ko.computed(function(){for(var l=[],i=(new Date).getFullYear();i>1900;i--)l.push(i);return l})}},{"../components/Activity":96,knockout:!1}],26:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function FaqsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us");this.currentLabels="";this.loadArticles=function(){var url="https://loconomics.zendesk.com/api/v2/help_center/articles.json?label_names="+encodeURIComponent(this.currentLabels);this.viewModel.isLoading(!0);var $=require("jquery");Promise.resolve($.get(url)).then(function(res){res?this.viewModel.faqs(res.articles.map(function(art){return new Faq({id:art.id,title:art.title,description:art.body})})):this.viewModel.faqs([]);this.viewModel.isLoading(!1)}.bind(this))["catch"](function(){this.viewModel.isLoading(!1)}.bind(this))}.bind(this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.loadArticles()};var ko=require("knockout");function ViewModel(){this.faqs=ko.observableArray([]);this.searchText=ko.observable("");this.isLoading=ko.observable(!1);this.filteredFaqs=ko.pureComputed(function(){var s=this.searchText().toLowerCase();return this.faqs().filter(function(v){var n=v&&v.title()||"";n+=v&&v.description()||"";n=n.toLowerCase();return n.indexOf(s)>-1})},this)}var Model=require("../models/Model");function Faq(values){Model(this);this.model.defProperties({id:0,title:"",description:""},values)}},{"../components/Activity":96,"../models/Model":123,knockout:!1}],27:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function FeedbackActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("Talk to us")});exports.init=A.init},{"../components/Activity":96}],28:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity["extends"](function FeedbackFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Talk to us")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Ideas: given a bad VOC Element name:",elementName):console.log("Feedback Ideas: Accessing feedback without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout");function ViewModel(app){this.message=ko.observable("");this.becomeCollaborator=ko.observable(!1);this.wasSent=ko.observable(!1);this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);var updateWasSent=function(){this.wasSent(!1)}.bind(this);this.message.subscribe(updateWasSent);this.becomeCollaborator.subscribe(updateWasSent);this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":this.wasSent()?"Sent":"Send"},this);this.send=function send(){this.isSending(!0);app.model.feedback.postIdea({message:this.message(),becomeCollaborator:this.becomeCollaborator(),vocElementID:this.vocElementID()}).then(function(){this.message("");this.becomeCollaborator(!1);this.wasSent(!0)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}.bind(this)}},{"../components/Activity":96,"../models/VocElementEnum":149,knockout:!1}],29:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),snapPoints=require("../utils/snapPoints"),A=Activity["extends"](function HomeActivity(){Activity.apply(this,arguments);this.navBar=null;this.accessLevel=null;this.viewModel={isAnonymous:this.app.model.user().isAnonymous};var $header=this.$header=this.$activity.find("header");this.registerHandler({target:this.$activity,event:"scroll-fixed-header",handler:function(e,what){"after"===what?$header.addClass("is-fixed"):$header.removeClass("is-fixed")}});this.registerHandler({target:this.$activity,event:"scroll-search",handler:function(e,what){"after"===what?$header.addClass("is-search"):$header.removeClass("is-search")}})});exports.init=A.init;A.prototype._registerSnapPoints=function(){var $searchBox=this.$activity.find("#homeSearch"),searchPoint=Math.max(1,$searchBox.offset().top+this.$activity.scrollTop()+$searchBox.outerHeight()-this.$header.outerHeight()|0),pointsEvents={0:"scroll-fixed-header"};pointsEvents[searchPoint]="scroll-search";snapPoints(this.$activity,pointsEvents);
};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(!this._notFirstShow){this._registerSnapPoints();this._notFirstShow=!0}}},{"../components/Activity":96,"../utils/snapPoints":192}],30:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),MessageView=require("../models/MessageView"),textSearch=require("../utils/textSearch"),A=Activity["extends"](function InboxActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("Inbox")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.messaging.getList().then(function(threads){this.viewModel.sourceThreads(threads())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading messages",error:err})}.bind(this))};function ViewModel(app){this.isLoading=app.model.messaging.state.isLoading;this.isSyncing=app.model.messaging.state.isSyncing;this.sourceThreads=ko.observableArray([]);this.searchText=ko.observable("");this.threads=ko.pureComputed(function(){var t=this.sourceThreads(),s=this.searchText();return t?s?t.filter(function(thread){var found=!1;found=textSearch(s,thread.subject());found||thread.messages().some(function(msg){found=textSearch(s,msg.bodyText());return found});return found}).map(MessageView.fromThread.bind(null,app)):t.map(MessageView.fromThread.bind(null,app)):[]},this)}},{"../components/Activity":96,"../models/MessageView":122,"../utils/textSearch":193,knockout:!1}],31:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function IndexActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.user().isAnonymous()||this.app.goDashboard()}},{"../components/Activity":96}],32:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function JobtitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"/scheduling"});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.addresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading addresses.",error:err})}.bind(this));this.app.model.serviceProfessionalServices.getList(jobTitleID).then(function(list){list=this.app.model.serviceProfessionalServices.asModel(list);this.viewModel.pricing(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading services.",error:err})}.bind(this));this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading the job title.",error:err})}.bind(this))}else{this.viewModel.addresses([]);this.viewModel.pricing([]);this.viewModel.jobTitleName("Job Title")}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{},jobID=0|params[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){this.jobTitleID=ko.observable(0);this.jobTitleName=ko.observable("Job Title");this.getJobUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.jobTitleID()+"?mustReturn=jobtitles/"+this.jobTitleID()+"&returnText="+this.jobTitleName()},this)};this.addresses=ko.observable([]);this.pricing=ko.observable([]);this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.serviceProfessionalServices.state.isLoading()},this);this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";return 1===count?one:count+more},this);this.pricingCount=ko.pureComputed(function(){var count=this.pricing().length,one="1 service",more=" services";return 1===count?one:count+more},this)}},{"../components/Activity":96,knockout:!1}],33:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function LearnMoreActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);options&&options.route&&options.route.segments&&options.route.segments.length&&this.viewModel.profile(options.route.segments[0])};function ViewModel(){this.profile=ko.observable("client")}},{"../components/Activity":96,knockout:!1}],34:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function LicensesCertificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title");this.viewModel.list(testdata())});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options&&options.route&&options.route.segments;this.viewModel.jobTitleID(0|params[0])};function ViewModel(app){this.jobTitleID=ko.observable(0);this.list=ko.observableArray([]);this.isSyncing=app.model.licensesCertifications.state.isSyncing();this.isLoading=app.model.licensesCertifications.state.isLoading();this.addNew=function(){var url="#!licensesCertificationsForm/"+this.jobTitleID(),cancelUrl=app.shell.currentRoute.url,request=$.extend({},this.requestData,{cancelLink:cancelUrl});app.shell.go(url,request)}.bind(this);this.selectItem=function(item){var url="/licensesCertificationsForm/"+this.jobTitleID()+"/"+item.licenseCertificationID()+"?mustReturn="+encodeURIComponent(app.shell.currentRoute.url)+"&returnText="+encodeURIComponent("Certifications/Licenses");app.shell.go(url,this.requestData)}.bind(this)}var Model=require("../models/Model");function Verification(values){Model(this);this.model.defProperties({name:""},values)}Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}var UserLicenseCertification=require("../models/UserLicenseCertification"),LicenseCertification=require("../models/LicenseCertification");function testdata(){var base={17:new LicenseCertification({licenseCertificationID:17,name:"Certified Massage Therapist (CMT)",stateProvinceID:1,countryID:1,description:"Required to complete at least 500 hours of massage education and training at an approved massage therapy school.  CMTs also must undergo background checks, including fingerprinting and other identification verification procedures.",authority:"The California Massage Therapy Council (CAMTC)",verificationWebsiteUrl:"https://www.camtc.org/VerifyCertification.aspx",howToGetLicensedUrl:"https://www.camtc.org/FormDownloads/CAMTCApplicationChecklist.pdf",optionGroup:"Certified Massage",createdDate:new Date,updatedDate:new Date}),18:new LicenseCertification({licenseCertificationID:18,name:"Certified Massage Practitioner (CMP)",stateProvinceID:1,countryID:1,description:"Generally must complete at least 250 hours of education and training.  CMPs also must undergo background checks, including fingerprinting and other identification verification procedures.",authority:"The California Massage Therapy Council (CAMTC)",verificationWebsiteUrl:"https://www.camtc.org/VerifyCertification.aspx",howToGetLicensedUrl:"https://www.camtc.org/FormDownloads/CAMTCApplicationChecklist.pdf",optionGroup:"Certified Massage",createdDate:new Date,updatedDate:new Date})};function augment(m){m.licenseCertification=ko.computed(function(){return base[this.licenseCertificationID()]||null},m);m.statusText=ko.pureComputed(function(){var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"},statusCode=enumGetName(this.statusID(),Verification.status);return statusTextsenUS["verification.status."+statusCode]},m);m.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(m);return m}return[augment(new UserLicenseCertification({userID:141,jobTitleID:106,statusID:2,licenseCertificationID:18,licenseCertificationNumber:21341234,stateProvinceID:1,countryID:1,expirationDate:new Date(2016,1,20),lastVerifiedDate:new Date(2015,3,20),createdDate:new Date,updatedDate:new Date})),augment(new UserLicenseCertification({userID:141,jobTitleID:106,statusID:1,licenseCertificationID:17,licenseCertificationNumber:987654321,stateProvinceID:1,countryID:1,expirationDate:new Date(2016,1,20),lastVerifiedDate:new Date(2015,3,20),createdDate:new Date,updatedDate:new Date}))]}},{"../components/Activity":96,"../models/LicenseCertification":117,"../models/Model":123,"../models/UserLicenseCertification":146,knockout:!1}],35:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function LicensesCertificationsFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Certifications/Licenses");this.defaultNavBarSettings=this.navBar.model.toPlainObject(!0)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/licensesCertifications/";this.viewModel.isNew()?this.convertToCancelAction(this.navBar.leftAction(),link):this.navBar.model.updateWith(this.defaultNavBarSettings,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[];this.viewModel.jobTitleID(0|params[0]);this.viewModel.licenseCertificationID(0|params[1]);this.updateNavBarState();var ModelVersion=require("../utils/ModelVersion"),UserLicenseCertification=require("../models/UserLicenseCertification");this.viewModel.isNew()?this.viewModel.version(new ModelVersion(new UserLicenseCertification)):this.viewModel.version(new ModelVersion(new UserLicenseCertification({userID:141,jobTitleID:106,statusID:2,licenseCertificationID:18,licenseCertificationNumber:21341234,stateProvinceID:1,countryID:1,expirationDate:new Date(2016,1,20),lastVerifiedDate:new Date(2015,3,20),createdDate:new Date,updatedDate:new Date})));0===this.viewModel.licenseCertificationID()};function ViewModel(app){this.licenseCertificationID=ko.observable(0);this.jobTitleID=ko.observable(0);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isSyncing=ko.observable(!1);this.isDeleting=ko.observable(!1);this.isLocked=ko.observable(!1);this.isNew=ko.pureComputed(function(){return 0===this.licenseCertificationID()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.stateProvinceID=ko.observable(0);this.file=ko.observable("");this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.licensesCertifications.setItem(this.item().model.toPlainObject()).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.licensesCertifications.delItem(this.jobTitleID(),this.licenseCertificationID()).then(function(){app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.statesProvinces=ko.computed(function(){return[{stateProvinceID:"23",name:"Alabama"},{stateProvinceID:"49",name:"Alaska"},{stateProvinceID:"52",name:"American Samoa"},{stateProvinceID:"48",name:"Arizona"},{stateProvinceID:"26",name:"Arkansas"},{stateProvinceID:"60",name:"Armed Forces Americas (except Canada)"},{stateProvinceID:"61",name:"Armed Forces Canada, Europe, Middle East, and Africa"},{stateProvinceID:"62",name:"Armed Forces Pacific"},{stateProvinceID:"1",name:"California"},{stateProvinceID:"38",name:"Colorado"},{stateProvinceID:"6",name:"Connecticut"},{stateProvinceID:"2",name:"Delaware"},{stateProvinceID:"51",name:"District of Columbia"},{stateProvinceID:"57",name:"Federated States of Micronesia"},{stateProvinceID:"28",name:"Florida"},{stateProvinceID:"5",name:"Georgia"},{stateProvinceID:"53",name:"Guam"},{stateProvinceID:"50",name:"Hawaii"},{stateProvinceID:"43",name:"Idaho"},{stateProvinceID:"22",name:"Illinois"},{stateProvinceID:"20",name:"Indiana"},{stateProvinceID:"30",name:"Iowa"},{stateProvinceID:"34",name:"Kansas"},{stateProvinceID:"16",name:"Kentucky"},{stateProvinceID:"19",name:"Louisiana"},{stateProvinceID:"24",name:"Maine"},{stateProvinceID:"58",name:"Marshall Islands"},{stateProvinceID:"8",name:"Maryland"},{stateProvinceID:"7",name:"Massachusetts"},{stateProvinceID:"27",name:"Michigan"},{stateProvinceID:"32",name:"Minnesota"},{stateProvinceID:"21",name:"Mississippi"},{stateProvinceID:"25",name:"Missouri"},{stateProvinceID:"41",name:"Montana"},{stateProvinceID:"37",name:"Nebraska"},{stateProvinceID:"36",name:"Nevada"},{stateProvinceID:"10",name:"New Hampshire"},{stateProvinceID:"4",name:"New Jersey"},{stateProvinceID:"47",name:"New Mexico"},{stateProvinceID:"12",name:"New York"},{stateProvinceID:"13",name:"North Carolina"},{stateProvinceID:"39",name:"North Dakota"},{stateProvinceID:"54",name:"Northern Mariana Islands"},{stateProvinceID:"18",name:"Ohio"},{stateProvinceID:"46",name:"Oklahoma"},{stateProvinceID:"33",name:"Oregon"},{stateProvinceID:"59",name:"Palau"},{stateProvinceID:"3",name:"Pennsylvania"},{stateProvinceID:"55",name:"Puerto Rico"},{stateProvinceID:"14",name:"Rhode Island"},{stateProvinceID:"9",name:"South Carolina"},{stateProvinceID:"40",name:"South Dakota"},{stateProvinceID:"17",name:"Tennessee"},{stateProvinceID:"29",name:"Texas"},{stateProvinceID:"56",name:"U.S. Virgin Islands"},{stateProvinceID:"45",name:"Utah"},{stateProvinceID:"15",name:"Vermont"},{stateProvinceID:"11",name:"Virginia"},{stateProvinceID:"42",name:"Washington"},{stateProvinceID:"35",name:"West Virginia"},{stateProvinceID:"31",name:"Wisconsin"},{stateProvinceID:"44",name:"Wyoming"}]})}},{"../components/Activity":96,"../models/UserLicenseCertification":146,"../utils/ModelVersion":161,knockout:!1}],36:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function LoginActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.anonymous;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Log in");this.navBar.rightAction(null);this.registerHandler({target:this.viewModel.isLogingIn,handler:function(v){if(v===!0){var $btn=this.$activity.find('[type="submit"]');$btn.button("loading");this.viewModel.loginError("");var ended=function ended(){this.viewModel.isLogingIn(!1);$btn.button("reset")}.bind(this);if(this.viewModel.username.error()||this.viewModel.password.error()){this.viewModel.loginError("Review your data");ended();return}this.app.model.login(this.viewModel.username(),this.viewModel.password()).then(function(){this.viewModel.loginError("");ended();this.viewModel.username("");this.viewModel.password("");this.requestData&&this.requestData.redirectUrl?this.app.shell.go(this.requestData.redirectUrl):this.app.goDashboard()}.bind(this))["catch"](function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";this.viewModel.loginError(msg);ended()}.bind(this))}}.bind(this)});this.registerHandler({target:this.viewModel.loginError,handler:function(err){var input=this.$activity.find(":input").get(0);err?input.focus():input.blur()}.bind(this)});this.viewModel.facebook=function(){var fb=require("../utils/facebookUtils"),$btn=this.$activity.find('[type="submit"]');$btn.button("loading");this.viewModel.loginError("");var ended=function ended(){this.viewModel.isLogingIn(!1);$btn.button("reset")}.bind(this);fb.login({scope:"email"}).then(function(result){return this.app.model.facebookLogin(result.auth.accessToken).then(function(){this.viewModel.loginError("");ended();this.viewModel.username("");this.viewModel.password("");this.requestData&&this.requestData.redirectUrl?this.app.shell.go(this.requestData.redirectUrl):this.app.goDashboard()}.bind(this))})["catch"](function(err){var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid login";this.viewModel.loginError(msg);ended()}.bind(this))}.bind(this)});exports.init=A.init;var FormCredentials=require("../viewmodels/FormCredentials");function ViewModel(){var credentials=new FormCredentials;this.username=credentials.username;this.password=credentials.password;this.loginError=ko.observable("");this.isLogingIn=ko.observable(!1);this.performLogin=function performLogin(){this.isLogingIn(!0)}.bind(this)}},{"../components/Activity":96,"../utils/facebookUtils":174,"../viewmodels/FormCredentials":198,knockout:!1}],37:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function LogoutActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.logout().then(function(){var newAnon=this.app.model.user().constructor.newAnonymous();this.app.model.user().model.updateWith(newAnon);this.app.shell.go("/")}.bind(this))}},{"../components/Activity":96}],38:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function MarketplaceJobtitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace profile",{backLink:"/marketplaceProfile"});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.addresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading addresses.",error:err})}.bind(this));this.app.model.serviceProfessionalServices.getList(jobTitleID).then(function(list){list=this.app.model.serviceProfessionalServices.asModel(list);this.viewModel.pricing(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading services.",error:err})}.bind(this));this.app.model.userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.jobTitle(job.jobTitle);this.viewModel.userJobTitle(job.userJobTitle)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading your job title.",error:err})}.bind(this))}else{this.viewModel.addresses([]);this.viewModel.pricing([])}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{},jobID=0|params[0];this.viewModel.jobTitleID(jobID)};function ViewModel(app){this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.pureComputed(function(){var j=this.jobTitle();return j&&j.singularName()||"Job Title"},this);this.getJobUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.jobTitleID()+"?mustReturn=marketplaceJobtitles/"+this.jobTitleID()+"&returnText="+encodeURIComponent(this.jobTitleName())},this)};this.isActiveStatus=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&1===j.statusID()||!1},write:function(v){var status=this.userJobTitle()&&this.userJobTitle().statusID();if(v===!0&&3===status){this.userJobTitle().statusID(1);app.model.userJobProfile.reactivateUserJobTitle(this.jobTitleID())["catch"](function(err){app.modals.showError({title:"Error enabling a Job Title",error:err})})}else if(v===!1&&1===status){this.userJobTitle().statusID(3);app.model.userJobProfile.deactivateUserJobTitle(this.jobTitleID())["catch"](function(err){app.modals.showError({title:"Error disabling a Job Title",error:err})})}},owner:this});this.statusLabel=ko.pureComputed(function(){return this.isActiveStatus()?"ON":"OFF"},this);this.cancellationPolicyLabel=ko.pureComputed(function(){var pid=this.userJobTitle()&&this.userJobTitle().cancellationPolicyID();return 3===pid?"Flexible":2===pid?"Moderate":"Strict"},this);this.instantBooking=ko.pureComputed(function(){return this.userJobTitle()&&this.userJobTitle().instantBooking()},this);this.instantBookingLabel=ko.pureComputed(function(){return this.instantBooking()?"ON":"OFF"},this);this.toggleInstantBooking=function(){var current=this.instantBooking();if(this.userJobTitle()){this.userJobTitle().instantBooking(!current);var plain=this.userJobTitle().model.toPlainObject();plain.instantBooking=!current;app.model.userJobProfile.setUserJobTitle(plain)["catch"](function(err){app.modals.showError({title:"Error saving Instant Booking preference",error:err});this.userJobTitle().instantBooking(current)}.bind(this))}};this.addresses=ko.observable([]);this.pricing=ko.observable([]);this.licenseCertifications=ko.observable([]);this.workPhotos=ko.observable([]);this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.serviceProfessionalServices.state.isLoading()},this);this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";return 1===count?one:count+more},this);this.pricingCount=ko.pureComputed(function(){var count=this.pricing().length,one="1 service",more=" services";return 1===count?one:count+more},this);this.licensesCertificationsSummary=ko.pureComputed(function(){var lc=this.licenseCertifications();if(lc&&lc.length){var verified=0,pending=0;lc.forEach(function(l){l&&1===l.statusID()?verified++:l&&2===l.statusID()&&pending++});return verified+" verified, "+pending+" pending"}return"There are not verifications"},this);this.workPhotosSummary=ko.pureComputed(function(){var wp=this.workPhotos();return wp&&wp.length>1?wp.length+" images":wp&&1===wp.length?"1 image":"No images"},this)}},{"../components/Activity":96,knockout:!1}],39:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),ko=require("knockout"),moment=require("moment"),A=Activity["extends"](function MarketplaceProfileActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Marketplace Profile");this.viewModel.showMarketplaceInfo(!0);this.viewModel.baseUrl("/marketplaceJobtitles")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.user.isServiceProfessional()&&this.viewModel.sync()};function ViewModel(app){var jobVm=new UserJobProfileViewModel(app);jobVm.verificationsCount=ko.observable(3);jobVm.displayedVerificationsNumber=ko.computed(function(){var verificationsCount=this.verificationsCount();return"("+verificationsCount+")"},jobVm);jobVm.verificationsSecondaryText=ko.computed(function(){var verificationsLimit=10,count=this.verificationsCount(),remaining=verificationsLimit-count;return remaining>0?"You can add up to "+remaining+" more":"You cannot add more"},jobVm);jobVm.displayedLastBackgroundCheck=ko.computed(function(){var lastDate=new Date(2014,10,14);return moment(lastDate).format("L")},jobVm);jobVm.user=app.model.userProfile.data;return jobVm}},{"../components/Activity":96,"../viewmodels/UserJobProfile":206,knockout:!1,moment:!1}],40:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function OwnerInfoActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"account"})});exports.init=A.init},{"../components/Activity":96}],41:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function PaymentsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Payments")});module.exports=A},{"../components/Activity":96}],42:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function PerformanceActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Performance")});module.exports=A},{"../components/Activity":96}],43:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function PrivacySettingsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"account"});this.registerHandler({target:this.app.model.privacySettings,event:"error",handler:function(err){var msg="save"===err.task?"Error saving privacy settings.":"Error loading privacy settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.privacySettings.sync();this.viewModel.discard()};function ViewModel(app){this.user=app.model.userProfile.data;var privacySettings=app.model.privacySettings,settingsVersion=privacySettings.newVersion();settingsVersion.isObsolete.subscribe(function(itIs){itIs&&settingsVersion.pull({evenIfNewer:!0})});this.settings=settingsVersion.version;this.isLocked=privacySettings.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},privacySettings);this.discard=function discard(){settingsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){settingsVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this)}},{"../components/Activity":96,knockout:!1}],44:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function ProfileActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options.route&&options.route.segments;this.viewModel.requestedUserID(0|params[0])};function ViewModel(app){this.requestedUserID=ko.observable(0);this.isLoading=ko.observable(!1);this.isSyncing=ko.observable(!1);this.profile=ko.pureComputed(function(){return 0===this.requestedUserID()?app.model.user():void 0},this)}},{"../components/Activity":96,knockout:!1}],45:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function ProfilePictureBioActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Marketplace profile",{backLink:"marketplaceProfile"});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){var msg="save"===err.task?"Error saving your data.":"Error loading your data.";this.app.modals.showError({title:msg,error:err&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.app.model.marketplaceProfile.sync()};function ViewModel(app){var marketplaceProfile=app.model.marketplaceProfile,profileVersion=marketplaceProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.isLocked=marketplaceProfile.isLocked;this.isLoading=marketplaceProfile.isLoading;this.isSaving=marketplaceProfile.isSaving;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.discard=function discard(){profileVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){profileVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this)}},{"../components/Activity":96,knockout:!1}],46:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),A=Activity["extends"](function SchedulingActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new UserJobProfileViewModel(this.app);this.navBar=Activity.createSectionNavBar("Scheduling")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.sync()}},{"../components/Activity":96,"../viewmodels/UserJobProfile":206}],47:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),moment=require("moment"),A=Activity["extends"](function SchedulingPreferencesActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"});this.registerHandler({target:this.app.model.schedulingPreferences,event:"error",handler:function(err){var msg="save"===err.task?"Error saving scheduling preferences.":"Error loading scheduling preferences.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.schedulingPreferences.sync();this.viewModel.discard()};function ViewModel(app){var schedulingPreferences=app.model.schedulingPreferences,prefsVersion=schedulingPreferences.newVersion();prefsVersion.isObsolete.subscribe(function(itIs){itIs&&prefsVersion.pull({evenIfNewer:!0})});this.prefs=prefsVersion.version;this.isLocked=schedulingPreferences.isLocked;
this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},schedulingPreferences);this.discard=function discard(){prefsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){prefsVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this);this.incrementsExample=ko.pureComputed(function(){for(var str="e.g. ",incSize=this.incrementsSizeInMinutes(),m=moment({hour:10,minute:0}),hours=[m.format("HH:mm")],i=1;4>i;i++)hours.push(m.add(incSize,"minutes").format("HH:mm"));str+=hours.join(", ");return str},this.prefs)}},{"../components/Activity":96,knockout:!1,moment:!1}],48:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function ServiceAddressesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling"});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID)this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitle(jobTitle);this.updateNavBarState();return this.app.model.serviceAddresses.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.serviceAddresses.sourceAddresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.serviceAddresses.sourceAddresses([]);this.viewModel.jobTitle(null);this.updateNavBarState()}}.bind(this)});this.viewModel.returnSelected=function(addressID,jobTitleID){this.requestData.selectedAddressID=addressID;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){var itIs=this.viewModel.serviceAddresses.isSelectionMode();this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduling",url=this.mustReturnTo||jid&&"/jobtitles/"+jid||"/scheduling";this.navBar.leftAction().link(url);this.navBar.leftAction().text(jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)};A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.serviceAddresses.isSelectionMode();this.viewModel.headerText(itIs?"Select or add a service location":"Locations");this.app.model.onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.jobTitleID(0);this.viewModel.requestData=this.requestData;this.viewModel.serviceAddresses.isSelectionMode(options.selectAddress===!0);this.viewModel.clientID(options.clientID||null);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];if(options.returnNewAsSelected===!0&&options.addressID)setTimeout(function(){delete options.returnNewAsSelected;this.viewModel.returnSelected(options.addressID,jobTitleID)}.bind(this),1);else{this.viewModel.jobTitleID(jobTitleID);this.updateNavBarState();0===jobTitleID&&this.viewModel.jobTitles.sync()}};var UserJobProfile=require("../viewmodels/UserJobProfile"),ServiceAddresses=require("../viewmodels/ServiceAddresses");function ViewModel(app){this.serviceAddresses=new ServiceAddresses;this.headerText=ko.observable("Locations");this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.clientID=ko.observable(null);this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceAddress");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.isSyncing=app.model.serviceAddresses.state.isSyncing();this.isLoading=ko.computed(function(){var add=app.model.serviceAddresses.state.isLoading(),jobs=this.jobTitles.isLoading();return add||jobs},this);this.goNext=function(){app.model.onboarding.inProgress()&&app.model.onboarding.goNext()};this.serviceAddresses.selectAddress=function(selectedAddress,event){this.serviceAddresses.isSelectionMode()===!0?this.returnSelected(selectedAddress.addressID(),selectedAddress.jobTitleID()):app.shell.go("addressEditor/service/"+this.jobTitleID()+"/"+selectedAddress.addressID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addServiceLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceLocation",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addServiceArea=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceArea",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addClientLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/clientLocation/"+this.clientID(),request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasItems=this.serviceAddresses.sourceAddresses().length>0;return isin&&hasItems},this)}},{"../components/Activity":96,"../viewmodels/ServiceAddresses":202,"../viewmodels/UserJobProfile":206,knockout:!1}],49:[function(require,module,exports){"use strict";var ko=require("knockout"),_=require("lodash"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function ServiceProfessionalServiceActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling"});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitle,handler:function(){this.updateNavBarState()}.bind(this)});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID)Promise.all([this.app.model.jobTitles.getJobTitle(jobTitleID),this.app.model.pricingTypes.getList()]).then(function(data){var jobTitle=data[0];this.viewModel.jobTitle(jobTitle);return this.app.model.serviceProfessionalServices.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.serviceProfessionalServices.asModel(list);var preset=this.requestData.selectedServices||[],selection=this.viewModel.selectedServices;list.forEach(function(item){var preSelected=preset.some(function(pr){return pr.serviceProfessionalServiceID===item.serviceProfessionalServiceID()?!0:void 0})||!1;item.isSelected=ko.observable(preSelected);preSelected&&selection.push(item)});this.viewModel.list(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.list([]);this.viewModel.jobTitle(null)}}.bind(this)});this.viewModel.returnSelected=function(pricing,jobTitleID){this.requestData.selectedServices=pricing;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){var itIs=this.viewModel.isSelectionMode();this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduling",url=this.mustReturnTo||jid&&"/jobtitles/"+jid||"/scheduling";this.navBar.leftAction().link(url);this.navBar.leftAction().text(jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)};A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();this.viewModel.headerText(itIs?"Select services":"Services");this.app.model.onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.jobTitleID(0);this.viewModel.selectedServices.removeAll();this.viewModel.requestData=this.requestData;this.viewModel.isSelectionMode(this.requestData.selectPricing===!0);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];0===jobTitleID&&options.selectedJobTitleID>0&&(jobTitleID=0|options.selectedJobTitleID);var isAdditionMode="new"===params[0]||"new"===params[1];if(isAdditionMode){var ref=this.app.shell.referrerRoute;ref=ref&&ref.url||"/";this.requestData.cancelLink=ref;this.viewModel.cancelLink(ref)}else this.viewModel.cancelLink("/serviceProfessionalService/"+this.viewModel.jobTitleID());this.viewModel.isAdditionMode(isAdditionMode);this.updateNavBarState();this.viewModel.jobTitleID(jobTitleID);0===jobTitleID&&this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile");function ViewModel(app){this.headerText=ko.observable("Services");this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.isAdditionMode=ko.observable(!1);this.cancelLink=ko.observable(null);this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceProfessionalService");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());var url="serviceProfessionalService/"+jobTitle.jobTitleID();this.isAdditionMode()&&(url+="/new");return!1}.bind(this);this.list=ko.observableArray([]);this.isLoading=ko.computed(function(){return app.model.serviceProfessionalServices.state.isLoading()||app.model.pricingTypes.state.isLoading()||app.model.jobTitles.state.isLoading()});this.isLocked=this.isLoading;this.isSelectionMode=ko.observable(!1);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":"Save and continue"},this);this.groupedServices=ko.computed(function(){var list=this.list(),isSelection=this.isSelectionMode(),groupNamePrefix=isSelection?"Select ":"",groups=[],groupsList=[];if(!this.isAdditionMode()){groups=_.groupBy(list,function(pricingItem){return pricingItem.pricingTypeID()});groupsList=Object.keys(groups).map(function(key){var gr={pricing:groups[key],type:app.model.pricingTypes.getObservableItem(key)};gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr);return gr})}var pricingTypes=this.jobTitle()&&this.jobTitle().pricingTypes();pricingTypes&&pricingTypes.length&&pricingTypes.forEach(function(jobType){var typeID=jobType.pricingTypeID();if(!groups.hasOwnProperty(typeID)){var gr={pricing:[],type:app.model.pricingTypes.getObservableItem(typeID)};gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr);groupsList.push(gr)}});return groupsList},this);this.selectedServices=ko.observableArray([]);this.toggleServiceSelection=function(pricing){var inIndex=-1,isSelected=this.selectedServices().some(function(selectedServices,index){if(selectedServices===pricing){inIndex=index;return!0}});pricing.isSelected(!isSelected);isSelected?this.selectedServices.splice(inIndex,1):this.selectedServices.push(pricing)}.bind(this);this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasPricing=this.list().length>0;return isin&&hasPricing},this);this.endSelection=function(data,event){app.model.onboarding.inProgress()?app.model.onboarding.goNext():this.returnSelected(this.selectedServices().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.price)}}),this.jobTitleID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.editService=function(pricing){app.shell.go("serviceProfessionalServiceEditor/"+this.jobTitleID()+"/"+pricing.serviceProfessionalServiceID())}.bind(this);this.tapService=function(pricing,event){this.isSelectionMode()?this.toggleServiceSelection(pricing):this.editService(pricing);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.tapNewService=function(group,event){var url="#!serviceProfessionalServiceEditor/"+this.jobTitleID()+"/new/"+(group.type()&&group.type().pricingTypeID()),request=$.extend({},this.requestData,{selectedJobTitleID:this.jobTitleID()});request.cancelLink||$.extend(request,{cancelLink:this.cancelLink()});this.isSelectionMode()&&(request.selectedServices=this.selectedServices().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.totalPrice)}}));app.shell.go(url,request);event.preventDefault();event.stopImmediatePropagation()}.bind(this)}},{"../components/Activity":96,"../viewmodels/UserJobProfile":206,knockout:!1,lodash:!1}],50:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),PricingType=require("../models/PricingType"),A=Activity["extends"](function ServiceProfessionalServiceEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Services");this.viewModel.onSave=function(pricing){if(this.requestData.selectedServices){this.requestData.selectedServices.push({serviceProfessionalServiceID:pricing.serviceProfessionalServiceID,totalPrice:pricing.totalPrice});this.app.shell.goBack(this.requestData)}else this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceProfessionalService/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);this.viewModel.serviceProfessionalServiceVersion(null);this.viewModel.pricingType(null);var params=options&&options.route&&options.route.segments||[],jobTitleID=0|params[0],pricingTypeID="new"===params[1]?0|params[2]:0,serviceProfessionalServiceID=0|params[1];this.viewModel.jobTitleID(jobTitleID);this.viewModel.serviceProfessionalServiceID(serviceProfessionalServiceID);this.updateNavBarState();var pricingSetup=function pricingSetup(){var c=this.viewModel.current();if(c){c.pricing.name(c.type.fixedName()||c.pricing.name()||c.type.suggestedName());c.pricing.refreshNoPriceRate()}this.viewModel.isLoading(!1)}.bind(this),showInvalidRequestError=function(){this.viewModel.isLoading(!1);this.app.modals.showError({title:"Invalid request",error:{jobTitleID:jobTitleID,pricingTypeID:pricingTypeID,serviceProfessionalServiceID:serviceProfessionalServiceID}}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this);this.viewModel.isLoading(!0);pricingTypeID?this.app.model.pricingTypes.getItem(pricingTypeID).then(function(type){if(type){this.viewModel.pricingType(type);this.viewModel.serviceProfessionalServiceVersion(this.app.model.serviceProfessionalServices.newItemVersion({jobTitleID:jobTitleID,pricingTypeID:pricingTypeID}));pricingSetup()}else showInvalidRequestError()}.bind(this)):serviceProfessionalServiceID?this.app.model.serviceProfessionalServices.getItemVersion(jobTitleID,serviceProfessionalServiceID).then(function(serviceProfessionalServiceVersion){if(serviceProfessionalServiceVersion)return this.app.model.pricingTypes.getItem(serviceProfessionalServiceVersion.version.pricingTypeID()).then(function(type){if(type){this.viewModel.pricingType(type);this.viewModel.serviceProfessionalServiceVersion(serviceProfessionalServiceVersion);pricingSetup()}else showInvalidRequestError()}.bind(this));showInvalidRequestError();return void 0}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):showInvalidRequestError()};function ViewModel(app){this.isLoading=ko.observable(!1);this.isSaving=app.model.serviceProfessionalServices.state.isSaving;this.isSyncing=app.model.serviceProfessionalServices.state.isSyncing;this.isDeleting=app.model.serviceProfessionalServices.state.isDeleting;this.jobTitleID=ko.observable(0);this.serviceProfessionalServiceID=ko.observable(0);this.moneySymbol=ko.observable("$");this.pricingType=ko.observable(new PricingType);this.serviceProfessionalServiceVersion=ko.observable(null);this.serviceProfessionalService=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v?v.version:null},this);this.header=ko.pureComputed(function(){if(this.isLoading())return"Loading...";if(this.serviceProfessionalServiceVersion()){var t=this.pricingType();return t&&t.singularName()||"Service"}return"Unknow service or was deleted"},this);this.current=ko.pureComputed(function(){var t=this.pricingType(),p=this.serviceProfessionalService();return t&&p?{type:t,pricing:p}:null},this);this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.serviceProfessionalServices.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var p=this.serviceProfessionalService();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.serviceProfessionalServices.setItem(this.serviceProfessionalService().model.toPlainObject()).then(function(serverData){this.serviceProfessionalService().model.updateWith(serverData);this.serviceProfessionalServiceVersion().push({evenIfObsolete:!0});this.onSave(serverData)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){var p=this.pricingType();app.modals.confirm({title:"Delete "+(p&&p.singularName()),message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.serviceProfessionalServices.delItem(this.jobTitleID(),this.serviceProfessionalServiceID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this)}},{"../components/Activity":96,"../models/PricingType":127,knockout:!1}],51:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function ServiceProfessionalWebsiteActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"marketplaceProfile"});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){var msg="save"===err.task?"Error saving your website.":"Error loading your website.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.marketplaceProfile.sync();this.viewModel.discard()};function ViewModel(app){var marketplaceProfile=app.model.marketplaceProfile,profileVersion=marketplaceProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.isLocked=marketplaceProfile.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},marketplaceProfile);this.discard=function discard(){profileVersion.pull({evenIfNewer:!0})};this.save=function save(){profileVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}}},{"../components/Activity":96,knockout:!1}],52:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function ServicesOverviewActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Job Title")});exports.init=A.init;A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.intro(null);this.viewModel.serviceAttributes.proposedServiceAttributes({});Activity.prototype.show.call(this,state);var params=state&&state.route&&state.route.segments,jid=0|params[0];this.viewModel.jobTitleID(jid);if(jid){this.viewModel.isLoadingUserJobTitle(!0);Promise.all([this.app.model.userJobProfile.getUserJobTitle(jid),this.viewModel.serviceAttributesControl.load(jid),this.viewModel.jobTitleServiceAttributesControl.load(jid)]).then(function(datas){var userJobTitle=datas&&datas[0];this.viewModel.userJobTitle(userJobTitle);this.viewModel.intro(userJobTitle.intro());this.viewModel.isLoadingUserJobTitle(!1)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err});this.viewModel.isLoadingUserJobTitle(!1)}.bind(this))}else{this.viewModel.serviceAttributesControl.reset();this.viewModel.jobTitleServiceAttributesControl.reset()}};function ViewModel(app){this.jobTitleID=ko.observable(0);this.isLoadingUserJobTitle=ko.observable(!1);this.userJobTitle=ko.observable(null);this.intro=ko.observable(null);this.serviceAttributesControl=app.model.serviceAttributes.newItemVersion();this.serviceAttributes=this.serviceAttributesControl.version;this.jobTitleServiceAttributesControl=app.model.jobTitleServiceAttributes.newItemVersion();this.jobTitleServiceAttributes=this.jobTitleServiceAttributesControl.original;this.isLoading=ko.pureComputed(function(){return this.isLoadingUserJobTitle()||this.serviceAttributesControl.state.isLoading()||this.jobTitleServiceAttributesControl.state.isLoading()},this);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.categoriesView=ko.pureComputed(function(){var userAtts=this.serviceAttributes;return this.jobTitleServiceAttributes.serviceAttributes().map(function(cat){return new AttributesCategoryVM(cat,userAtts)})},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.intro=this.intro();Promise.all([this.serviceAttributesControl.save(),app.model.userJobProfile.setUserJobTitle(plain)]).then(function(){this.isSaving(!1);var props=this.serviceAttributes.proposedServiceAttributes(),propCats=props&&Object.keys(props);if(propCats&&propCats.length){var thereAreNews=propCats.reduce(function(sum,k){var cat=props[k];return sum+(cat&&cat.length||0)},0)>0;thereAreNews&&this.jobTitleServiceAttributesControl.load(void 0,!0)}this.serviceAttributes.proposedServiceAttributes({});app.successSave()}.bind(this))["catch"](function(err){this.isSaving(!1);app.modals.showError({title:"Error saving your Services Overview",error:err})}.bind(this))}}.bind(this)}var ServiceAttribute=require("../models/ServiceAttribute");function AttributesCategoryVM(cat,userAtts){var catID=cat.serviceAttributeCategoryID(),selectedAttsIds=userAtts.serviceAttributes.getServiceCategoryAttributes(catID);this.category=ko.observable(cat);this.proposedServiceAttributes=ko.pureComputed(function(){var props=userAtts.proposedServiceAttributes();return props&&props[catID]&&props[catID].length?props[catID].map(function(name){return new ServiceAttribute({name:name})}):[]},this);this.selectedAttributes=ko.pureComputed(function(){var atts=cat.serviceAttributes().filter(function(att){return selectedAttsIds().indexOf(att.serviceAttributeID())>-1});return atts.concat.apply(atts,this.proposedServiceAttributes())},this);this.availableAttributes=ko.computed(function(){var props=this.proposedServiceAttributes(),atts=selectedAttsIds();return cat.serviceAttributes().filter(function(att){var toInclude=-1===atts.indexOf(att.serviceAttributeID());return toInclude===!1?!1:props.every(function(propAtt){return att.name()!==propAtt.name()})})},this);this.attributeSearch=ko.observable("");var foundAttItem=function(att,item){return item.name()===att.name};this.addAttribute=function(){var newOne=this.attributeSearch()||"",isEmpty=/^\s*$/.test(newOne),wasFound=this.selectedAttributes().some(foundAttItem.bind(null,{name:newOne}));isEmpty||wasFound||userAtts.proposedServiceAttributes.push(catID,newOne);this.attributeSearch("")};this.selectAttribute=function(att){userAtts.serviceAttributes.push(catID,att.serviceAttributeID())};this.removeAttribute=function(att){var id=att.serviceAttributeID();id?userAtts.serviceAttributes.remove(catID,id):userAtts.proposedServiceAttributes.remove(catID,att.name())}.bind(this);var textSearch=require("../utils/textSearch");this.autocompleteAttributes=ko.computed(function(){var s=this.attributeSearch(),a=this.availableAttributes();return a.filter(function(att){return textSearch(s,att.name())})},this)}},{"../components/Activity":96,"../models/ServiceAttribute":136,"../utils/textSearch":193,knockout:!1}],53:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),A=Activity["extends"](function SignupActivity(){Activity.apply(this,arguments);this.viewModel=new SignupVM(this.app);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.registerHandler({target:this.viewModel,event:"signedup",handler:function(){this.app.goDashboard?this.app.goDashboard():this.app.shell.go("#!splashThanks/"+this.profile())}.bind(this)});this.registerHandler({target:this.viewModel,event:"signuperror",handler:function(err){if(err){var $el=this.$activity.find(".form-group.has-error:first").find("input");setTimeout(function(){$el.focus()},100)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){this.viewModel.reset();Activity.prototype.show.call(this,options);var p=options&&options.route&&options.route.segments&&options.route.segments[0]||"";this.viewModel.profile(p)}},{"../components/Activity":96,"../viewmodels/Signup":204}],54:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),A=Activity["extends"](function TermsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.$activity.find("#terms-index a").click(function(e){e.preventDefault();e.stopImmediatePropagation();$(this).tab("show")})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var tabName=state&&state.route.segments&&state.route.segments[0],tab=this.$activity.find('[href="#terms-'+tabName+'"]');tab.length&&tab.tab("show")}},{"../components/Activity":96}],55:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter,Activity=require("../components/Activity"),A=Activity["extends"](function TextEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("");this.navBar.leftAction().handler(function(){this.emit("cancel")}.bind(this.viewModel));this.$textarea=this.$activity.find("textarea");this.textarea=this.$textarea.get(0);this.registerHandler({target:this.viewModel,event:"saved",handler:function(){this.requestData.text=this.viewModel.text();this.app.shell.goBack(this.requestData)}.bind(this)});this.registerHandler({target:this.viewModel,event:"cancel",handler:function(){this.app.shell.goBack(this.requestData)}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.navBar.leftAction().text(this.requestData.navTitle||"");this.viewModel.headerText(this.requestData.header);this.viewModel.text(this.requestData.text);this.textarea.focus();this.$textarea.click();window.scrollTo(0,0)};function ViewModel(){this.headerText=ko.observable("Text");this.text=ko.observable("");this.cancel=function cancel(){this.emit("cancel")};this.save=function save(){this.emit("saved")}}ViewModel._inherits(EventEmitter)},{"../components/Activity":96,events:!1,knockout:!1}],56:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function UserFeesActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSubsectionNavBar("Owner information",{backLink:"ownerInfo"})});module.exports=A},{"../components/Activity":96}],57:[function(require,module,exports){"use strict";var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity["extends"](function VerificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"/marketplaceProfile"});this.registerHandler({target:this.$activity,event:"click",selector:'[href="#resendEmailConfirmation"]',handler:function(){this.app.modals.showNotification({message:"TO-DO: resend email confirmation"})}.bind(this)});this.registerHandler({target:this.$activity,event:"click",selector:'[href="#connectWithFacebook"]',handler:function(){this.app.modals.showNotification({message:"TO-DO: ask for connect with Facebook API"})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.userVerifications.getList().then(function(list){this.viewModel.userVerifications(list())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading your verifications",error:err})}.bind(this))};function ViewModel(app){this.isSyncing=app.model.userVerifications.state.isSyncing;this.isLoading=app.model.userVerifications.state.isLoading;this.isSaving=app.model.userVerifications.state.isSaving;this.userVerifications=ko.observableArray();this.emailInfo=ko.observable('Please click on "Verify my account" in the e-mail we sent you to verify your address. <a class="btn btn-link btn-block"  href="#resendEmailConfirmation">Click here to resend.</a>');
this.facebookInfo=ko.pureComputed(function(){var tpl='Letting potential __kind__ know you have a trusted online presence helps them know you\'re real. <a class="btn btn-link btn-block" href="#connectWithFacebook">Click here to connect your account.</a>';return tpl.replace(/__kind__/,app.model.user().isServiceProfessional()?"clients":"service professionals")})}},{"../components/Activity":96,knockout:!1}],58:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity["extends"](function WeeklyScheduleActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Scheduling",{backLink:"scheduling"});this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.app.model.simplifiedWeeklySchedule,event:"error",handler:function(err){var msg="save"===err.task?"Error saving your weekly schedule.":"Error loading your weekly schedule.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();this.app.model.simplifiedWeeklySchedule.sync();this.viewModel.discard()};function ViewModel(app){var simplifiedWeeklySchedule=app.model.simplifiedWeeklySchedule,scheduleVersion=simplifiedWeeklySchedule.newVersion();scheduleVersion.isObsolete.subscribe(function(itIs){itIs&&scheduleVersion.pull({evenIfNewer:!0})});this.schedule=scheduleVersion.version;this.isLocked=simplifiedWeeklySchedule.isLocked;this.isSaving=simplifiedWeeklySchedule.isSaving;this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},simplifiedWeeklySchedule);this.discard=function discard(){scheduleVersion.pull({evenIfNewer:!0})};this.save=function save(){scheduleVersion.pushSave().then(function(){app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})}}},{"../components/Activity":96,knockout:!1}],59:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity["extends"](function WelcomeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;var app=this.app;this.viewModel={startOnboarding:function startOnboarding(){app.model.onboarding.goNext()}};this.navBar=new Activity.NavBar({title:null,leftAction:Activity.NavAction.goLogout,rightAction:null})});exports.init=A.init},{"../components/Activity":96}],60:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity["extends"](function WorkPhotosActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title");this.viewModel.list(testdata());this.registerHandler({target:this.$activity,selector:".WorkPhotos-imgBtn",event:"click",handler:function(event){$(event.target).closest("li").toggleClass("is-selected")}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options&&options.route&&options.route.segments;this.viewModel.jobTitleID(0|params[0])};function ViewModel(app){this.jobTitleID=ko.observable(0);this.list=ko.observableArray([]);this.isSyncing=app.model.licensesCertifications.state.isSyncing();this.isLoading=app.model.licensesCertifications.state.isLoading();this.addNew=function(){this.openPhotoPicker().then(function(img){var newItem=new WorkPhoto({url:img,title:""});this.list.push(newItem)}.bind(this))["catch"](function(err){app.modals.showError({error:err,title:"Error getting photo."})})}.bind(this);this.removeImg=function(item){this.list.remove(item)}.bind(this);this.openPhotoPicker=function(){return new Promise(function(resolve,reject){navigator.camera&&navigator.camera.getPicture?navigator.camera.getPicture(function(img){resolve(img)},function(err){setTimeout(function(){reject(err)},0)},{destinationType:Camera.DestinationType.FILE_URI,targetWidth:446,targetHeight:332,saveToPhotoAlbum:!0,mediaType:Camera.MediaType.PICTURE,correctOrientation:!0}):setTimeout(function(){reject({error:"Unsupported",message:"Impossible to get photo from device"})},0)})};this.updateSort=function(){}}var Model=require("../models/Model");function WorkPhoto(values){Model(this);this.model.defProperties({url:"",title:""},values)}function testdata(){return[new WorkPhoto({url:"https://loconomics.com/img/userphotos/u296/0c95dbccafd14953a94bde86eff4d34a-442x332.jpg",title:"Testing photo 1"}),new WorkPhoto({url:"https://loconomics.com/img/userphotos/u296/3eb14073cb6a45138b6fd96b459bf3a1-442x332.jpg",title:"Testing photo 2"}),new WorkPhoto({url:"https://loconomics.com/img/userphotos/u296/0c95dbccafd14953a94bde86eff4d34a-442x332.jpg",title:"Testing photo 3"}),new WorkPhoto({url:"https://loconomics.com/img/userphotos/u296/3eb14073cb6a45138b6fd96b459bf3a1-442x332.jpg",title:"Testing photo 4"})]}},{"../components/Activity":96,"../models/Model":123,knockout:!1}],61:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),propTools=require("./utils/jsPropertiesTools"),getObservable=require("./utils/getObservable");exports.registerAll=function(app){ko.components.register("app-navbar-action",{template:{element:"navbar-action-template"},viewModel:function(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}});ko.components.register("app-unlabeled-input",{template:{element:"unlabeled-input-template"},viewModel:function(params){this.value=getObservable(params.value);this.placeholder=getObservable(params.placeholder);this.disable=getObservable(params.disable);var userAttr=getObservable(params.attr);this.attr=ko.pureComputed(function(){var attr=userAttr()||{};return $.extend({},attr,{"aria-label":this.placeholder(),placeholder:this.placeholder(),type:this.type()})},this);var type=getObservable(params.type);this.type=ko.computed(function(){return type()||"text"},this)}});ko.components.register("app-feedback-entry",{template:{element:"feedback-entry-template"},viewModel:function(params){this.section=getObservable(params.section||"");this.url=ko.pureComputed(function(){return"/feedbackForm/"+this.section()},this)}});ko.components.register("app-time-slot-tile",{template:{element:"time-slot-tile-template"},viewModel:require("./viewmodels/TimeSlot")});ko.components.register("app-loading-spinner",{template:{element:"loading-spinner-template"},viewModel:function(params){var base="loadingSpinner";this.mod=getObservable(params.mod||"");this.cssClass=ko.pureComputed(function(){var c=base,mods=(this.mod()||"").split(" ");mods.length&&(c+=" "+base+"--"+mods.join(" "+base+"--"));return c},this)}});ko.components.register("app-appointment-card",{template:{element:"appointment-card-template"},viewModel:require("./viewmodels/AppointmentCard")});ko.components.register("app-job-titles-list",{template:{element:"job-titles-list-template"},viewModel:function(params){this.jobTitles=getObservable(params.jobTitles||[]);this.selectJobTitle=params.selectJobTitle||function(){};this.showMarketplaceInfo=getObservable(params.showMarketplaceInfo||!1)}});ko.components.register("app-stars-rating",{template:{element:"stars-rating-template"},viewModel:function(params){this.rating=getObservable(params.rating||2.5);this.total=getObservable(params.total||0);this.stars=ko.pureComputed(function(){for(var r=this.rating(),list=[],i=1;5>=i;i++)list.push(r>=i?1:0);return list},this);this.totalText=ko.pureComputed(function(){return"("+this.total()+")"},this)}});var PublicUser=require("./models/PublicUser");ko.components.register("app-service-professional-info",{synchronous:!0,template:{element:"service-professional-info-template"},viewModel:{createViewModel:function(params){var view=new PublicUser;params&&params.api&&params.api(view);return view}}});var DateTimePickerVM=require("./viewmodels/DatetimePicker");ko.components.register("app-datetime-picker",{synchronous:!0,template:{element:"datetime-picker-template"},viewModel:{createViewModel:function(params,componentInfo){var view=new DateTimePickerVM(app,componentInfo.element);params&&params.api&&params.api(view);params&&Object.keys(params).forEach(function(key){if(ko.isObservable(view[key])){view[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&view[key].subscribe(params[key])}});return view}}})}},{"./models/PublicUser":129,"./utils/getObservable":176,"./utils/jsPropertiesTools":179,"./viewmodels/AppointmentCard":194,"./viewmodels/DatetimePicker":197,"./viewmodels/TimeSlot":205,knockout:!1}],62:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),NavBar=require("./viewmodels/NavBar"),NavAction=require("./viewmodels/NavAction");exports["extends"]=function(app){function adjustUserBar(){var user=app.model.user();if(user.isAnonymous()){var prev=app.navBar().leftAction();if(prev!==NavAction.menuOut){app.navBar().leftAction(NavAction.menuOut);app.navBar().prevLeftAction=prev}}else if(app.navBar().prevLeftAction){app.navBar().leftAction(app.navBar().prevLeftAction);app.navBar().prevLeftAction=null}}app.navBar=ko.observable(null);var refreshNav=function refreshNav(){$(".AppNav").trigger("contentChange")},autoRefreshNav=function autoRefreshNav(action){if(action){action.text.subscribe(refreshNav);action.isTitle.subscribe(refreshNav);action.icon.subscribe(refreshNav);action.isMenu.subscribe(refreshNav)}};app.updateAppNav=function updateAppNav(activity,state){"navBar"in activity?null===activity.navBar?app.navBar(new NavBar({hidden:!0})):app.navBar(activity.navBar):app.navBar(new NavBar);app.applyNavbarMustReturn(state);adjustUserBar();refreshNav();autoRefreshNav(app.navBar().leftAction());autoRefreshNav(app.navBar().rightAction())};app.applyNavbarMustReturn=function(state){if(state&&state.route&&state.route.query&&state.route.query.mustReturn){var returnLink=decodeURIComponent(state.route.query.mustReturn),returnText=decodeURIComponent(state.route.query.returnText||"");"1"===returnLink||"true"===returnLink?app.navBar().leftAction(NavAction.goBack.model.clone({text:returnText,isShell:!0,isTitle:!0})):app.navBar().leftAction(NavAction.goBack.model.clone({link:returnLink,text:returnText,isShell:!1,isTitle:!0}));return!0}return!1};app.updateMenu=function updateMenu(name){var $menu=$(".App-menus .navbar-collapse");$menu.find("li").removeClass("active");$menu.find(".go-"+name).closest("li").addClass("active");$menu.filter(":visible").collapse("hide")};app.setupNavBarBinding=function setupNavBarBinding(){app.navBarBinding={navBar:app.navBar,photoUrl:ko.observable("about:blank"),userName:ko.observable("Me"),isServiceProfessional:ko.observable(!1),isClient:ko.observable(!1)};ko.applyBindings(app.navBarBinding,$(".AppNav").get(0))};app.performsNavBarBack=function performsNavBarBack(options){var nav=this.navBar(),left=nav&&nav.leftAction(),$btn=$(".SmartNavBar-edge.left > a.SmartNavBar-btn");if(left&&!left.isMenu()){var event=$.Event("click");event.options=options||{};$btn.trigger(event)}else this.shell&&this.shell.goBack()};var lastNotificationTimer=null;app.showNavBarNotification=function showNavBarNotification(settings){var msg=settings&&settings.message||"Hello World!",duration=settings&&settings.duration||2e3,transitionDuration=settings&&settings.transitionDuration||400,$el=$(".AppNav .SmartNavBar-notification");$el.text(msg);$el.fadeIn(transitionDuration).queue(function(){$el.off("click.manualHide").on("click.manualHide",function(){$el.fadeOut(transitionDuration)});clearTimeout(lastNotificationTimer);lastNotificationTimer=setTimeout(function(){$el.fadeOut(transitionDuration)},duration);$(this).dequeue()})}}},{"./viewmodels/NavAction":199,"./viewmodels/NavBar":200,knockout:!1}],63:[function(require,module,exports){"use strict";var Activity=require("./components/Activity"),EmptyActivity=Activity["extends"](function EmptyActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar()});module.exports={_test:EmptyActivity,calendar:require("./activities/calendar"),datetimePicker:require("./activities/datetimePicker"),clients:require("./activities/clients"),serviceProfessionalService:require("./activities/serviceProfessionalService"),serviceAddresses:require("./activities/serviceAddresses"),textEditor:require("./activities/textEditor"),dashboard:require("./activities/dashboard"),appointment:require("./activities/appointment"),index:require("./activities/index"),login:require("./activities/login"),logout:require("./activities/logout"),learnMore:require("./activities/learnMore"),signup:require("./activities/signup"),contactInfo:require("./activities/contactInfo"),welcome:require("./activities/welcome"),addressEditor:require("./activities/addressEditor"),account:require("./activities/account"),inbox:require("./activities/inbox"),conversation:require("./activities/conversation"),scheduling:require("./activities/scheduling"),jobtitles:require("./activities/jobtitles"),feedback:require("./activities/feedback"),faqs:require("./activities/faqs"),feedbackForm:require("./activities/feedbackForm"),contactForm:require("./activities/contactForm"),cms:require("./activities/cms"),clientEditor:require("./activities/clientEditor"),schedulingPreferences:require("./activities/schedulingPreferences"),calendarSyncing:require("./activities/calendarSyncing"),weeklySchedule:require("./activities/weeklySchedule"),bookMeButton:require("./activities/bookMeButton"),ownerInfo:require("./activities/ownerInfo"),privacySettings:require("./activities/privacySettings"),addJobTitles:require("./activities/addJobTitles"),serviceProfessionalServiceEditor:require("./activities/serviceProfessionalServiceEditor"),marketplaceProfile:require("./activities/marketplaceProfile"),marketplaceJobtitles:require("./activities/marketplaceJobtitles"),profilePictureBio:require("./activities/profilePictureBio"),servicesOverview:require("./activities/servicesOverview"),verifications:require("./activities/verifications"),education:require("./activities/education"),serviceProfessionalWebsite:require("./activities/serviceProfessionalWebsite"),backgroundCheck:require("./activities/backgroundCheck"),educationForm:require("./activities/educationForm"),cancellationPolicy:require("./activities/cancellationPolicy"),licensesCertifications:require("./activities/licensesCertifications"),licensesCertificationsForm:require("./activities/licensesCertificationsForm"),workPhotos:require("./activities/workPhotos"),profile:require("./activities/profile"),home:require("./activities/home"),booking:require("./activities/booking"),terms:require("./activities/terms"),payments:require("./activities/payments"),userFees:require("./activities/userFees"),performance:require("./activities/performance")}},{"./activities/account":6,"./activities/addJobTitles":7,"./activities/addressEditor":8,"./activities/appointment":9,"./activities/backgroundCheck":10,"./activities/bookMeButton":11,"./activities/booking":12,"./activities/calendar":13,"./activities/calendarSyncing":14,"./activities/cancellationPolicy":15,"./activities/clientEditor":16,"./activities/clients":17,"./activities/cms":18,"./activities/contactForm":19,"./activities/contactInfo":20,"./activities/conversation":21,"./activities/dashboard":22,"./activities/datetimePicker":23,"./activities/education":24,"./activities/educationForm":25,"./activities/faqs":26,"./activities/feedback":27,"./activities/feedbackForm":28,"./activities/home":29,"./activities/inbox":30,"./activities/index":31,"./activities/jobtitles":32,"./activities/learnMore":33,"./activities/licensesCertifications":34,"./activities/licensesCertificationsForm":35,"./activities/login":36,"./activities/logout":37,"./activities/marketplaceJobtitles":38,"./activities/marketplaceProfile":39,"./activities/ownerInfo":40,"./activities/payments":41,"./activities/performance":42,"./activities/privacySettings":43,"./activities/profile":44,"./activities/profilePictureBio":45,"./activities/scheduling":46,"./activities/schedulingPreferences":47,"./activities/serviceAddresses":48,"./activities/serviceProfessionalService":49,"./activities/serviceProfessionalServiceEditor":50,"./activities/serviceProfessionalWebsite":51,"./activities/servicesOverview":52,"./activities/signup":53,"./activities/terms":54,"./activities/textEditor":55,"./activities/userFees":56,"./activities/verifications":57,"./activities/weeklySchedule":58,"./activities/welcome":59,"./activities/workPhotos":60,"./components/Activity":96}],64:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery-mobile");require("./utils/jquery.multiline");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits");require("./utils/Function.prototype._delayed");require("./utils/Function.prototype.name-polyfill");require("es6-promise").polyfill();var layoutUpdateEvent=require("layoutUpdateEvent"),AppModel=require("./appmodel/AppModel");require("./locales/en-US-LC");var attachFastClick=require("fastclick").attach;function preBootstrapWorkarounds(){function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}$(document).on("click.bs.collapse.data-api.workaround",'[data-toggle="collapse"]',function(){var $t=$(this),$target=getTargetFromTrigger($t),data=$target&&$target.data("bs.collapse");data&&(data.$trigger=$t)})}var app={shell:require("./app.shell"),model:new AppModel,activities:require("./app.activities"),modals:require("./app.modals"),goDashboard:function goDashboard(){goDashboard._going!==!0&&setTimeout(function(){goDashboard._going=!0;var onboarding=this.model.onboarding.stepUrl();onboarding?this.shell.go(onboarding):this.shell.go("/dashboard");setTimeout(function(){goDashboard._going=!1},1)}.bind(this),1)}};require("./app-navbar")["extends"](app);require("./app-components").registerAll(app);app.getActivity=function getActivity(name){var activity=this.activities[name];if(activity){var $act=this.shell.items.find(name);if($act&&$act.length)return activity.init($act,this)}return null};app.getActivityControllerByRoute=function getActivityControllerByRoute(route){var actName=route.name||this.shell.indexName;return this.getActivity(actName)};app.shell.accessControl=require("./utils/accessControl")(app);app.UserType=require("./models/User").UserType;app.successSave=function successSave(settings){settings=$.extend({message:"Your changes have been saved",link:null},settings);this.showNavBarNotification(settings);settings.link?this.shell.go(settings.link):this.performsNavBarBack({silentMode:!0})};var appInit=function appInit(){attachFastClick(document.body);require("jquery-ui/autocomplete");require("knockout-sortable");require("jquery.ui.touch-punch");layoutUpdateEvent.layoutUpdateEvent+=" orientationchange";layoutUpdateEvent.on();var trigLayout=function trigLayout(){$(window).trigger("layoutUpdate")};window.addEventListener("native.keyboardshow",trigLayout);window.addEventListener("native.keyboardhide",trigLayout);window.StatusBar&&window.StatusBar.overlaysWebView(!1);setTimeout(function(){$(window).trigger("layoutUpdate")},200);preBootstrapWorkarounds();require("bootstrap");bootknock.plugIn(ko);require("./utils/bootstrapSwitchBinding").plugIn(ko);window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&window.cordova.plugins.Keyboard.disableScroll(!1);$(document).on("click","[data-shell]",function(e){var cmdline=$(this).attr("data-shell")||"",args=cmdline.split(" "),cmd=args[0];if(cmd&&"function"==typeof app.shell[cmd]){app.shell[cmd].apply(app.shell,args.slice(1));e.stopImmediatePropagation();e.preventDefault()}});window.cordova&&$(document).on("click",'[target="_blank"], [target="_system"]',function(e){window.open(this.getAttribute("href"),this.getAttribute("target"));e.preventDefault()});app.shell.on(app.shell.events.itemReady,function($act,state){var routeName=app.shell.currentRoute.name,actName=$act.data("activity");if(routeName===actName){var activity=app.getActivity(actName);activity.show(state);routeName=app.shell.currentRoute.name;if(routeName===actName){var menuItem=activity.menuItem||actName;app.updateMenu(menuItem);app.updateAppNav(activity,state)}}});app.shell.on(app.shell.events.closed,function($act){var actName=$act.data("activity"),activity=app.getActivity(actName);activity.hide&&activity.hide()});app.shell.on("error",function(err){app.modals.showError({error:err})});var scrollToElement=require("./utils/scrollToElement");app.shell.on("fragmentNavigation",function(href){if("#"===href)console.warn('Navigation to an empty fragment, this may be not wanted. For root links, use "/"; on script handled links, call event.preventDefault; A touch event was listened on a link, but not the click event.');else{var target=$(href);target.length&&scrollToElement(target,{animation:{duration:300}})}});app.setupNavBarBinding();var SmartNavBar=require("./components/SmartNavBar"),navBars=SmartNavBar.getAll();navBars.forEach(function(navbar){$(navbar.el).on("contentChange",function(){navbar.refresh()})});var togglingBackdrop=!1;$(document).on("show.bs.collapse hide.bs.collapse",".AppNav .navbar-collapse",function(e){if(!togglingBackdrop){togglingBackdrop=!0;var enabled="show"===e.type;$("body").toggleClass("use-backdrop",enabled);$("body").toggleClass("has-appNav-open",enabled);$(".collapsing, .collapse.in").collapse("hide");togglingBackdrop=!1}});app.model.on("error",function(err){app.modals.showError({error:err})});$(document).on("focus",'[data-autoselect="true"]',function(){$(this).select()});var alertError=function(err){app.modals.showError({title:"There was an error loading",error:err})};app.model.init().then(app.shell.run.bind(app.shell),alertError).then(function(){$("html").addClass("is-ready");window.navigator&&window.navigator.splashscreen&&window.navigator.splashscreen.hide();ko.computed(function(){var u=app.model.userProfile.data,n=u.firstName();app.navBarBinding.userName(n||"Me");app.navBarBinding.isServiceProfessional(u.isServiceProfessional());app.navBarBinding.isClient(u.isClient())});ko.computed(function(){var n=app.model.marketplaceProfile.data.photoUrl();app.navBarBinding.photoUrl(n||"about:blank")});app.model.onboarding.init(app);var step=app.model.user().onboardingStep();if(step&&app.model.onboarding.setStep(step)){var url=app.model.onboarding.stepUrl();app.shell.go(url)}},alertError);window.app=app};$(window.cordova?function(){$(document).on("deviceready",appInit)}:appInit)},{"./app-components":61,"./app-navbar":62,"./app.activities":63,"./app.modals":65,"./app.shell":66,"./appmodel/AppModel":79,"./components/SmartNavBar":98,"./locales/en-US-LC":99,"./models/User":142,"./utils/Function.prototype._delayed":153,"./utils/Function.prototype._inherits":154,"./utils/Function.prototype.name-polyfill":155,"./utils/accessControl":165,"./utils/bootknockBindingHelpers":167,"./utils/bootstrapSwitchBinding":168,"./utils/jquery.multiline":178,"./utils/scrollToElement":182,"es6-promise":!1,"jquery-ui/autocomplete":1,knockout:!1,"knockout-sortable":!1}],65:[function(require,module,exports){"use strict";var $=require("jquery");exports.getErrorMessageFrom=function getErrorMessageFrom(err,defaultText){defaultText=defaultText||"Unknow error";if(err){if("string"==typeof err)return err||defaultText;err=err.responseJSON||err;var msg=err.name&&err.name+": "||"";msg+=err.errorMessage||err.message||"";if(err.errors)msg+="\n"+exports.stringifyErrorsList(err.errors);else try{var jserr=JSON.stringify(err),hasMoreInfo=jserr&&"{}"!==jserr;if(hasMoreInfo){hasMoreInfo=!1;var messagePropertiesList=["name","errorMessage","message","errors"];Object.keys(err).forEach(function(key){-1===messagePropertiesList.indexOf(key)&&(hasMoreInfo=!0)})}hasMoreInfo&&(msg+="\n\nTechnical details: "+jserr)}catch(ex){console.log("Impossible to stringify JSON error",err,ex)}return msg||defaultText}return defaultText};exports.stringifyErrorsList=function(errors){var msg="";msg=Array.isArray(errors)?errors.join("\n"):Object.keys(errors).map(function(key){return errors[key].join("\n")}).join("\n");return msg};exports.showError=function showErrorModal(options){var modal=$("#errorModal"),header=modal.find("#errorModal-label"),body=modal.find("#errorModal-body");options=options||{};var msg=body.data("default-text");msg=exports.getErrorMessageFrom(options.error||options.message,msg);body.multiline(msg);header.text(options.title||header.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.confirm=function confirm(options){var modal=$("#confirmModal"),header=modal.find("#confirmModal-label"),body=modal.find("#confirmModal-body"),yesBtn=modal.find("#confirmModal-yesBtn"),noBtn=modal.find("#confirmModal-noBtn");options=options||{};var title=header.data("default-text"),msg=body.data("default-text"),yes=yesBtn.data("default-text"),no=noBtn.data("default-text");body.multiline(options.message||msg);header.text(options.title||title);yesBtn.text(options.yes||yes);noBtn.text(options.no||no);return new Promise(function(resolve,reject){modal.modal("show");yesBtn.on("click",function(){resolve()});noBtn.on("click",function(){reject()});modal.on("hide.bs.modal",function(){reject()})})};exports.showNotification=function showNotification(options){var modal=$("#notificationModal"),header=modal.find("#notificationModal-label"),button=modal.find("#notificationModal-button"),body=modal.find("#notificationModal-body");options=options||{};var msg=options.message||body.data("default-text");body.multiline(msg);header.text(options.title||header.data("default-text"));button.text(options.buttonText||button.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.showTimePicker=require("./modals/timePicker").show;exports.showTextEditor=require("./modals/textEditor").show},{"./modals/textEditor":100,"./modals/timePicker":101}],66:[function(require,module,exports){"use strict";var baseUrl=window.location.pathname,History=require("./utils/shell/hashbangHistory"),shell=require("./utils/shell/index"),Shell=shell.Shell,DomItemsManager=shell.DomItemsManager,shell=new Shell({root:"App-activities",baseUrl:baseUrl,forceHashbang:!0,indexName:"index",linkEvent:"click",loader:null,history:History,domItemsManager:new DomItemsManager({idAttributeName:"data-activity",root:".App-activities"})});module.exports=shell},{"./utils/shell/hashbangHistory":187,"./utils/shell/index":188}],67:[function(require,module,exports){"use strict";var localforage=require("localforage");exports.plugIn=function(AppModel){AppModel.prototype.tryLogin=function tryLogin(){return localforage.getItem("credentials").then(function(credentials){if(credentials)return this.login(credentials.username,credentials.password);throw new Error("No saved credentials")}.bind(this))};AppModel.prototype.login=function login(username,password){this.rest.extraHeaders=null;return this.rest.post("login",{username:username,password:password,returnProfile:!0}).then(performLocalLogin(this,username,password))};AppModel.prototype.facebookLogin=function facebookLogin(accessToken){this.rest.extraHeaders=null;return this.rest.post("login/facebook",{accessToken:accessToken,returnProfile:!0}).then(function(logged){return performLocalLogin(this,logged.email,null)}.bind(this))};AppModel.prototype.logout=function logout(){this.rest.extraHeaders=null;localforage.removeItem("credentials");localforage.removeItem("profile");this.clearLocalData();this.rest.post("logout");return Promise.resolve()};AppModel.prototype.signup=function signup(data){this.rest.extraHeadres=null;data.returnProfile=!0;return this.rest.post("signup?utm_source=app",data).then(performLocalLogin(this,data.email,data.password))}};function performLocalLogin(thisAppModel,username,password){return function(logged){return thisAppModel.clearLocalData().then(function(){thisAppModel.rest.extraHeaders={Authorization:"LC alu="+logged.userID+",alk="+logged.authKey};localforage.setItem("credentials",{userID:logged.userID,username:username,password:password,authKey:logged.authKey});localforage.setItem("profile",logged.profile);thisAppModel.user().model.updateWith(logged.profile);return logged})}}},{localforage:!1}],68:[function(require,module,exports){"use strict";var CacheControl=require("../utils/CacheControl"),moment=require("moment"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}Api._inherits(EventEmitter);var api=new Api,cache={times:{}};api.clearCache=function clearCache(){cache.times={};this.emit("clearCache")};appModel.on("clearLocalData",function(){api.clearCache()});var createTimeSlots=require("../utils/createTimeSlots");function saveTimesInCache(queryKey,data){var c=cache.times[queryKey];if(c){c.times=data.times;c.incrementsSizeInMinutes=data.incrementsSizeInMinutes;c.control.touch()}else c=cache.times[queryKey]={times:data.times,incrementsSizeInMinutes:data.incrementsSizeInMinutes,control:new CacheControl({ttl:{minutes:1}}),getFreeTimeSlots:function(duration,slotSizeMinutes){var size=slotSizeMinutes||this.incrementsSizeInMinutes;return createTimeSlots.forList(this.times,size,duration)}};return c}api.times=function times(userID,start,end){end||(end=moment(start).add(1,"day").toDate());var queryKey=userID+"-"+start.toISOString()+"-"+end.toISOString();return cache.times.hasOwnProperty(queryKey)&&!cache.times[queryKey].control.mustRevalidate()?Promise.resolve(cache.times[queryKey]):appModel.rest.get("users/"+userID+"/availability/times",{start:start,end:end}).then(function(data){data.times=createTimeSlots.filterListBy(data.times,start,end);return saveTimesInCache(queryKey,data)})};return api}},{"../utils/CacheControl":151,"../utils/createTimeSlots":169,events:!1,moment:!1}],69:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getBookings:function(filters){return appModel.rest.get("me/bookings",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Booking(rawItem)})})}}};api.getBookingsByDates=function getBookingsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getBookings({start:date,end:end}).then(function(bookings){var arr=ko.observableArray(bookings);return arr})};api.getUpcomingBookings=function getUpcomingBookings(){return appModel.rest.get("me/upcoming-bookings")};api.getBooking=function getBooking(id){return id?appModel.rest.get("me/bookings/"+id).then(function(booking){return new Booking(booking)}):Promise.reject("The bookingID is required to get a booking")};api.appointmentToSimplifiedBooking=function(apt){return{bookingID:apt.sourceBooking().bookingID(),jobTitleID:apt.jobTitleID(),clientUserID:apt.clientUserID(),addressID:apt.addressID(),startTime:apt.startTime(),pricing:apt.pricing().map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:apt.preNotesToClient(),preNotesToSelf:apt.preNotesToSelf(),postNotesToClient:apt.postNotesToClient(),postNotesToSelf:apt.postNotesToSelf()}};api.bookingToSimplifiedBooking=function(booking){
console.log("DEBUG to simplified booking",booking.pricingSummary());return{bookingID:booking().bookingID(),clientUserID:booking.clientUserID(),addressID:booking.addressID(),startTime:booking.startTime(),pricing:booking.pricingSummary()&&booking.pricingSummary().details().pricing.map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:booking.preNotesToClient(),preNotesToSelf:booking.preNotesToSelf(),postNotesToClient:booking.postNotesToClient(),postNotesToSelf:booking.postNotesToSelf()}};api.setServiceProfessionalBooking=function setServiceProfessionalBooking(booking,allowBookUnavailableTime){booking=booking.bookingID?api.bookingToSimplifiedBooking(booking):booking.sourceBooking?api.appointmentToSimplifiedBooking(booking):booking;var id=booking.bookingID||"",method=id?"put":"post";booking.allowBookUnavailableTime=allowBookUnavailableTime||!1;return appModel.rest[method]("me/service-professional-booking/"+id,booking).then(function(serverBooking){return new Booking(serverBooking)})};var createClientBookingRequest=function(booking,requestOptions,paymentMethod){var billingAddress=paymentMethod&&paymentMethod.billingAddress();paymentMethod=paymentMethod&&paymentMethod.model.toPlainObject();if(billingAddress){billingAddress=billingAddress.model.toPlainObject();delete paymentMethod.billingAddress}return{serviceProfessionalUserID:booking.serviceProfessionalUserID(),jobTitleID:booking.jobTitleID(),serviceStartTime:booking.serviceDate()&&booking.serviceDate().startTime(),alternative1StartTime:booking.alternativeDate1()&&booking.alternativeDate1().startTime(),alternative2StartTime:booking.alternativeDate2()&&booking.alternativeDate2().startTime(),serviceAddress:booking.serviceAddress()&&booking.serviceAddress().model.toPlainObject(),services:booking.pricingSummary()&&booking.pricingSummary().details().map(function(pricing){return pricing.serviceProfessionalServiceID()}),bookCode:ko.unwrap(requestOptions.bookCode),promotionalCode:ko.unwrap(requestOptions.promotionalCode),billingAddress:billingAddress&&{addressLine1:billingAddress.addressLine1,addressLine2:billingAddress.addressLine2,postalCode:billingAddress.postalCode},paymentMethod:paymentMethod}};api.requestClientBooking=function requetsClientBooking(booking,requestOptions,billingAddress,paymentMethod){var data=createClientBookingRequest(booking,requestOptions,billingAddress,paymentMethod);return appModel.rest.post("me/client-booking",data)};api.getNewClientBooking=function getNewClientBooking(options){return appModel.rest.get("me/client-booking",options)};return api}},{"../models/Booking":104,knockout:!1,moment:!1}],70:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),DateAvailability=require("../models/DateAvailability"),DateCache=require("../utils/DateCache"),moment=require("moment"),_=require("lodash"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}Api._inherits(EventEmitter);var api=new Api,cache=new DateCache({Model:DateAvailability,ttl:{minutes:10}});api.clearCache=function clearCache(){cache.clear();this.emit("clearCache")};appModel.on("clearLocalData",function(){api.clearCache()});api.getAppointment=function getAppointment(ids){return ids.calendarEventID?appModel.calendarEvents.getEvent(ids.calendarEventID).then(Appointment.fromCalendarEvent):ids.bookingID?appModel.bookings.getBooking(ids.bookingID).then(function(booking){return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):Promise.reject("Unrecognized ID")};api.setAppointment=function setAppointment(apt,allowBookUnavailableTime){return apt.sourceBooking()?appModel.bookings.setServiceProfessionalBooking(apt,allowBookUnavailableTime).then(function(booking){api.clearCache();return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):apt.sourceEvent()?appModel.calendarEvents.setEvent(apt).then(function(event){return Appointment.fromCalendarEvent(event)}):Promise.reject(new Error("Unrecognized appointment object"))};var getRemoteAppointmentsByDate=function getRemoteAppointmentsByDate(date){return Promise.all([appModel.bookings.getBookingsByDates(date),appModel.calendarEvents.getEventsByDates(date)]).then(function(group){var events=group[1],bookings=group[0],apts=[];events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings()));return apts})},getRemoteDateAvailability=function getRemoteDateAvailability(date){return Promise.all([getRemoteAppointmentsByDate(date),appModel.simplifiedWeeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var apts=result[0],settings=result[1],weekDaySchedule=settings.weekDays[date.getDay()](),prefs=result[2],dateInfo={date:date,appointmentsList:apts||[],weekDaySchedule:weekDaySchedule,schedulingPreferences:prefs};return dateInfo})};api.getDateAvailability=function getDateAvailability(date){var cached=cache.getSingle(date);return cached?Promise.resolve(cached):getRemoteDateAvailability(date).then(function(dateInfo){return cache.set(date,dateInfo).data})};var getRemoteAppointmentsByDates=function getRemoteAppointmentsByDates(start,end){return Promise.all([appModel.bookings.getBookingsByDates(start,end),appModel.calendarEvents.getEventsByDates(start,end)]).then(function(group){var events=group[1],bookings=group[0],apts=[];events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings()));for(var grouped=_.groupBy(apts,function(apt){return moment(apt.startTime()).format("YYYY-MM-DD")}),date=new Date(start);end>=date;){var key=moment(date).format("YYYY-MM-DD");grouped.hasOwnProperty(key)||(grouped[key]=[]);date.setDate(date.getDate()+1)}return grouped})},getRemoteDatesAvailability=function getRemoteDatesAvailability(start,end){return Promise.all([getRemoteAppointmentsByDates(start,end),appModel.simplifiedWeeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var aptsDates=result[0],settings=result[1],results={},prefs=result[2];Object.keys(aptsDates).forEach(function(dateKey){var date=moment(dateKey,"YYYY-MM-DD").toDate(),weekDaySchedule=settings.weekDays[date.getDay()](),dateInfo={date:date,appointmentsList:aptsDates[dateKey]||[],weekDaySchedule:weekDaySchedule,schedulingPreferences:prefs};results[dateKey]=dateInfo});return results})};api.getDatesAvailability=function getDatesAvailability(start,end){var cacheResults=cache.get(start,end);return null===cacheResults.minHole?Promise.resolve(cacheResults.byDate):getRemoteDatesAvailability(cacheResults.minHole,cacheResults.maxHole).then(function(results){Object.keys(results).forEach(function(dateKey){cacheResults.byDate[dateKey]=cache.set(dateKey,results[dateKey]).data});return cacheResults.byDate})};return api}},{"../models/Appointment":103,"../models/DateAvailability":109,"../utils/DateCache":152,events:!1,lodash:!1,moment:!1}],71:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getCalendarEvents:function(filters){return appModel.rest.get("me/events",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new CalendarEvent(rawItem)})})}}};api.getEventsByDates=function getEventsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getCalendarEvents({start:date,end:end}).then(function(events){var arr=ko.observableArray(events);return arr})};api.getEvent=function getEvent(id){return id?appModel.rest.get("me/events/"+id).then(function(event){return new CalendarEvent(event)}):Promise.reject("The calendarEventID is required to get an event")};api.appointmentToSimplifiedEvent=function(apt){var rrule=apt.sourceEvent().recurrenceRule();rrule&&(rrule=apt.sourceEvent().recurrenceRule().model.toPlainObject());var occs=apt.sourceEvent().recurrenceOccurrences();occs&&(occs=occs.map(function(occ){return occ&&occ.model.toPlainObject()||null}).filter(function(occ){return null!==occ}));return{calendarEventID:apt.id()<0?0:apt.id(),eventTypeID:apt.sourceEvent().eventTypeID(),summary:apt.summary(),description:apt.description(),availabilityTypeID:apt.sourceEvent().availabilityTypeID(),location:apt.addressSummary(),startTime:apt.startTime(),endTime:apt.endTime(),isAllDay:apt.sourceEvent().isAllDay(),recurrenceRule:rrule,recurrenceOccurrences:occs}};api.setEvent=function setEvent(event){event=event.calendarEventID?event.model.toPlainObject():event.sourceEvent?api.appointmentToSimplifiedEvent(event):event;var id=event.calendarEventID||"",method=id?"put":"post";return appModel.rest[method]("me/events"+(id?"/":"")+id,event).then(function(serverEvent){return new CalendarEvent(serverEvent)})};return api}},{"../models/CalendarEvent":106,knockout:!1,moment:!1}],72:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return appModel.rest.get("me/calendar-syncing")},push:function push(){return appModel.rest.put("me/calendar-syncing",this.data.model.toPlainObject())}});rem.isReseting=ko.observable(!1);rem.resetExportUrl=function resetExportUrl(){rem.isReseting(!0);return appModel.rest.post("me/calendar-syncing/reset-export-url").then(function(updatedSyncSettings){rem.data.model.updateWith(updatedSyncSettings);rem.isReseting(!1);return updatedSyncSettings})};appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/CalendarSyncing":107,"../utils/RemoteModel":162,knockout:!1}],73:[function(require,module,exports){"use strict";var Client=require("../models/Client"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"clientUserID",Model:Client});api.addLocalforageSupport("clients");api.addRestSupport(appModel.rest,"me/clients");appModel.on("clearLocalData",function(){api.clearCache()});var publicSearchRequest=null;api.publicSearch=function publicSearch(search){if(publicSearchRequest&&publicSearchRequest.abort)try{publicSearchRequest.abort()}catch(abortErr){console.error("Error aborting request",abortErr)}var request=appModel.rest.get("me/clients/public-search",search);publicSearchRequest=request.xhr;request=request["catch"](function(err){return err&&"abort"===err.statusText?[]:err});request.xhr=publicSearchRequest;return request};return api}},{"../models/Client":108,"../utils/ListRemoteModel":160}],74:[function(require,module,exports){"use strict";var UserEducation=require("../models/UserEducation"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"educationID",Model:UserEducation});api.addLocalforageSupport("education");api.addRestSupport(appModel.rest,"me/education");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserEducation":143,"../utils/ListRemoteModel":160}],75:[function(require,module,exports){"use strict";exports.create=function create(appModel){var getUserDeviceInfo=function getUserDeviceInfo(){var dev=window.device||{platform:"web",model:"unknow",cordova:"",version:""};return{userAgent:navigator.userAgent,platform:dev.platform,version:dev.version,model:dev.model,cordova:dev.cordova}};return{postIdea:function postIdea(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/ideas",values)},postSupport:function postSupport(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/support",values)}}}},{}],76:[function(require,module,exports){"use strict";var Address=require("../models/Address"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new Address,ttl:{minutes:1},localStorageName:"homeAddress",fetch:function fetch(){return appModel.rest.get("me/addresses/home")},push:function push(){return appModel.rest.put("me/addresses/home",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/Address":102,"../utils/RemoteModel":162}],77:[function(require,module,exports){"use strict";var JobTitleServiceAttributes=require("../models/JobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{hours:1},itemIdField:"jobTitleID",Model:JobTitleServiceAttributes});api.addLocalforageSupport("job-title-service-attributes/");api.addRestSupport(appModel.rest,"job-title-service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/JobTitleServiceAttributes":116,"../utils/GroupRemoteModel":157}],78:[function(require,module,exports){"use strict";var localforage=require("localforage"),JobTitle=require("../models/JobTitle"),ko=require("knockout");exports.create=function create(appModel){var api={state:{isLoading:ko.observable(!1)}},cache={jobTitles:{}};api.clearCache=function clearCache(){cache.jobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});api.getJobTitle=function getJobTitle(id){if(!id)return Promise.reject("Needs an ID to get a Job Title");if(cache.jobTitles[id])return Promise.resolve(cache.jobTitles[id]);api.state.isLoading(!0);return localforage.getItem("jobTitles/"+id).then(function(jobTitle){if(jobTitle){cache.jobTitles[id]=new JobTitle(jobTitle);api.state.isLoading(!1);return cache.jobTitles[id]}return appModel.rest.get("job-titles/"+id).then(function(raw){localforage.setItem("jobTitles/"+id,raw);cache.jobTitles[id]=new JobTitle(raw);api.state.isLoading(!1);return cache.jobTitles[id]})})["catch"](function(err){api.state.isLoading(!1);return err})};return api}},{"../models/JobTitle":114,knockout:!1,localforage:!1}],79:[function(require,module,exports){var ko=require("knockout"),$=require("jquery"),Rest=require("../utils/Rest"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;function AppModel(){EventEmitter.call(this);this.setMaxListeners(30)}AppModel._inherits(EventEmitter);module.exports=AppModel;require("./AppModel-account").plugIn(AppModel);AppModel.prototype.loadLocalCredentials=function loadLocalCredentials(){return new Promise(function(resolve){var resolveAnyway=function(doesnMatter){console.warning("App Model Init err",doesnMatter);resolve()};localforage.getItem("credentials").then(function(credentials){if(credentials&&credentials.userID&&credentials.username&&credentials.authKey){this.rest.extraHeaders={Authorization:"LC alu="+credentials.userID+",alk="+credentials.authKey};this.userProfile.once("error",function(err){this.emit("error",{message:"Impossible to load your data. Please check your Internet connection",error:err})}.bind(this));this.userProfile.load().then(function(profile){profile?resolve():this.tryLogin().then(resolve,resolveAnyway)}.bind(this),resolveAnyway)["catch"](function(){})}else resolve()}.bind(this),resolveAnyway)}.bind(this))};AppModel.prototype.init=function init(){localforage.config({name:"LoconomicsApp",version:.1,size:4980736,storeName:"keyvaluepairs",description:"Loconomics App",driver:localforage.LOCALSTORAGE});return localforage.getItem("config").then(function(config){config=config||{};config.siteUrl?$("html").attr("data-site-url",config.siteUrl):config.siteUrl=$("html").attr("data-site-url");this.config=config;this.rest=new Rest(config.siteUrl+"/api/v1/en-US/");this.rest.onAuthorizationRequired=function(retry){this.tryLogin().then(function(){retry()})}.bind(this);this.loadModules();return this.loadLocalCredentials()}.bind(this))};AppModel.prototype.loadModules=function loadModules(){this.userProfile=require("./AppModel.userProfile").create(this);this.user=ko.computed(function(){return this.userProfile.data},this);this.onboarding=require("./AppModel.onboarding").create(this);this.schedulingPreferences=require("./AppModel.schedulingPreferences").create(this);this.calendarSyncing=require("./AppModel.calendarSyncing").create(this);this.simplifiedWeeklySchedule=require("./AppModel.simplifiedWeeklySchedule").create(this);this.marketplaceProfile=require("./AppModel.marketplaceProfile").create(this);this.homeAddress=require("./AppModel.homeAddress").create(this);this.privacySettings=require("./AppModel.privacySettings").create(this);this.bookings=require("./AppModel.bookings").create(this);this.calendarEvents=require("./AppModel.calendarEvents").create(this);this.jobTitles=require("./AppModel.jobTitles").create(this);this.userJobProfile=require("./AppModel.userJobProfile").create(this);this.calendar=require("./AppModel.calendar").create(this);this.serviceAddresses=require("./AppModel.serviceAddresses").create(this);this.serviceProfessionalServices=require("./AppModel.serviceProfessionalServices").create(this);this.pricingTypes=require("./AppModel.pricingTypes").create(this);this.messaging=require("./AppModel.messaging").create(this);this.clients=require("./AppModel.clients").create(this);this.postalCodes=require("./AppModel.postalCodes").create(this);this.feedback=require("./AppModel.feedback").create(this);this.education=require("./AppModel.education").create(this);this.licensesCertifications=require("./AppModel.licensesCertifications").create(this);this.users=require("./AppModel.users").create(this);this.availability=require("./AppModel.availability").create(this);this.serviceAttributes=require("./AppModel.serviceAttributes").create(this);this.jobTitleServiceAttributes=require("./AppModel.jobTitleServiceAttributes").create(this);this.userVerifications=require("./AppModel.userVerifications").create(this)};AppModel.prototype.clearLocalData=function clearLocalData(){return localforage.getItem("config").then(function(config){localforage.clear();config&&localforage.setItem("config",config);this.emit("clearLocalData")}.bind(this))}},{"../utils/Rest":163,"./AppModel-account":67,"./AppModel.availability":68,"./AppModel.bookings":69,"./AppModel.calendar":70,"./AppModel.calendarEvents":71,"./AppModel.calendarSyncing":72,"./AppModel.clients":73,"./AppModel.education":74,"./AppModel.feedback":75,"./AppModel.homeAddress":76,"./AppModel.jobTitleServiceAttributes":77,"./AppModel.jobTitles":78,"./AppModel.licensesCertifications":80,"./AppModel.marketplaceProfile":81,"./AppModel.messaging":82,"./AppModel.onboarding":83,"./AppModel.postalCodes":84,"./AppModel.pricingTypes":85,"./AppModel.privacySettings":86,"./AppModel.schedulingPreferences":87,"./AppModel.serviceAddresses":88,"./AppModel.serviceAttributes":89,"./AppModel.serviceProfessionalServices":90,"./AppModel.simplifiedWeeklySchedule":91,"./AppModel.userJobProfile":92,"./AppModel.userProfile":93,"./AppModel.userVerifications":94,"./AppModel.users":95,events:!1,knockout:!1,localforage:!1}],80:[function(require,module,exports){"use strict";var UserLicenseCertification=require("../models/UserLicenseCertification"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"licenseCertificationID",Model:UserLicenseCertification});api.addLocalforageSupport("userLicenseCertifications");api.addRestSupport(appModel.rest,"me/user-license-certifications/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserLicenseCertification":146,"../utils/GroupListRemoteModel":156}],81:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return appModel.rest.get("me/marketplace-profile")},push:function push(){return appModel.rest.put("me/marketplace-profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/MarketplaceProfile":120,"../utils/RemoteModel":162}],82:[function(require,module,exports){"use strict";var Thread=require("../models/Thread"),CacheControl=require("../utils/CacheControl"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"threadID",Model:Thread});api.addLocalforageSupport("messaging");api.addRestSupport(appModel.rest,"me/messaging");appModel.on("clearLocalData",function(){api.clearCache()});var fullThreadsCache={},fetchThreadRemote=function(threadID){return appModel.rest.get("me/messaging/"+threadID,{limit:1e3}).then(function(thread){if(thread){thread=new Thread(thread);var cached=fullThreadsCache[threadID];if(cached){cached.control.latest=new Date;cached.thread=thread}else{fullThreadsCache[threadID]={control:new CacheControl({ttl:{minutes:1}}),thread:thread};fullThreadsCache[threadID].control.latest=new Date}return thread}throw new Error("Not Found")})},markAsEndedAndFollowUp=function(any){api.state.isSyncing(!1);api.state.isLoading(!1);return any};api.getItem=function getItem(threadID){var cached=fullThreadsCache[threadID];if(cached&&cached.thread){if(cached.control.mustRevalidate()){api.state.isSyncing(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)}return Promise.resolve(cached.thread)}api.state.isLoading(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)};return api}},{"../models/Thread":140,"../utils/CacheControl":151,"../utils/ListRemoteModel":160}],83:[function(require,module,exports){"use strict";var OnboardingProgress=require("../viewmodels/OnboardingProgress"),NavAction=require("../viewmodels/NavAction");exports.create=function create(appModel){var api=new OnboardingProgress;api.init=function init(app){api.app=app};api.setStep=function(stepReference){if(stepReference){var stepItems=stepReference.split(":",2),group=stepItems[0],step=stepItems[1]||group;if(this.setStepByName(step))return!0;var groupSteps=OnboardingProgress.predefinedStepGroups[group];if(groupSteps){this.steps(groupSteps);this.group(group);if(this.setStepByName(step))return!0}}this.model.reset();return!1};api.updateNavBar=function(navBar){var yep=this.inProgress();if(yep){navBar.leftAction(NavAction.goLogout);navBar.title(this.progressText())}return yep};api.goNext=function goNext(){var current=this.stepNumber();current++;if(current>this.totalSteps()){this.stepNumber(-1);appModel.userProfile.saveOnboardingStep(null);this.app.shell.go("/",{completedOnboarding:api.group()})}else{this.stepNumber(current);appModel.userProfile.saveOnboardingStep(this.stepReference());this.app.shell.go(this.stepUrl())}};api.goPrevious=function goPrevious(){var current=this.stepNumber();current--;current>=0&&current<=this.totalSteps()?this.stepNumber(current):this.stepNumber(0);appModel.userProfile.saveOnboardingStep(this.stepReference());this.app.shell.go(this.stepUrl())};return api}},{"../viewmodels/NavAction":199,"../viewmodels/OnboardingProgress":201}],84:[function(require,module,exports){"use strict";exports.create=function create(appModel){var api={},cache={};api.getItem=function getItem(postalCode){postalCode=postalCode||"";return/^\s*$/.test(postalCode)?Promise.reject("Postal Code Not Valid"):cache.hasOwnProperty(postalCode)?Promise.resolve(cache[postalCode]):appModel.rest.get("postal-codes/"+postalCode).then(function(info){info&&(cache[postalCode]=info);return info})};appModel.on("clearLocalData",function(){cache={}});return api}},{}],85:[function(require,module,exports){"use strict";var PricingType=require("../models/PricingType"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"pricingTypeID",Model:PricingType});api.addLocalforageSupport("pricing-types");api.addRestSupport(appModel.rest,"pricing-types");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/PricingType":127,"../utils/ListRemoteModel":160}],86:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return appModel.rest.get("me/privacy-settings")},push:function push(){return appModel.rest.put("me/privacy-settings",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/PrivacySettings":128,"../utils/RemoteModel":162}],87:[function(require,module,exports){"use strict";var SchedulingPreferences=require("../models/SchedulingPreferences"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new SchedulingPreferences,ttl:{minutes:1},localStorageName:"schedulingPreferences",fetch:function fetch(){return appModel.rest.get("me/scheduling-preferences")},push:function push(){return appModel.rest.put("me/scheduling-preferences",this.data.model.toPlainObject()).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/SchedulingPreferences":135,"../utils/RemoteModel":162}],88:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"addressID",Model:Address});api.addLocalforageSupport("addresses/service/");api.addRestSupport(appModel.rest,"me/addresses/service/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Address":102,"../utils/GroupListRemoteModel":156}],89:[function(require,module,exports){"use strict";var UserJobTitleServiceAttributes=require("../models/UserJobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:UserJobTitleServiceAttributes});api.addLocalforageSupport("service-attributes/");api.addRestSupport(appModel.rest,"me/service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserJobTitleServiceAttributes":145,"../utils/GroupRemoteModel":157}],90:[function(require,module,exports){"use strict";var ServiceProfessionalService=require("../models/ServiceProfessionalService"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"serviceProfessionalServiceID",Model:ServiceProfessionalService});api.addLocalforageSupport("service-professional-services/");api.addRestSupport(appModel.rest,"me/service-professional-services/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/ServiceProfessionalService":138,"../utils/GroupListRemoteModel":156}],91:[function(require,module,exports){"use strict";var SimplifiedWeeklySchedule=require("../models/SimplifiedWeeklySchedule"),RemoteModel=require("../utils/RemoteModel"),moment=require("moment"),weekDayProperties=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];exports.create=function create(appModel){var rem=new RemoteModel({data:new SimplifiedWeeklySchedule,ttl:{minutes:1},localStorageName:"weeklySchedule",fetch:function fetch(){return appModel.rest.get("me/weekly-schedule").then(fromWeeklySchedule)},push:function push(){var plainData=toWeeklySchedule(this.data.model.toPlainObject(!0));return appModel.rest.put("me/weekly-schedule",plainData).then(fromWeeklySchedule).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem};function fromWeeklySchedule(weeklySchedule){var simpleWS={timeZone:weeklySchedule.timeZone||"",isAllTime:weeklySchedule.isAllTime};Object.keys(weeklySchedule).forEach(function(weekday){if(-1!==weekDayProperties.indexOf(weekday)){var timeRanges=weeklySchedule[weekday];timeRanges&&timeRanges[0]&&(simpleWS[weekday]={from:0|moment.duration(timeRanges[0].start).asMinutes(),to:0|moment.duration(timeRanges[0].end).asMinutes()})}});return simpleWS}function toWeeklySchedule(simplifiedWeeklySchedule){var weeklySchedule={timeZone:simplifiedWeeklySchedule.timeZone,isAllTime:simplifiedWeeklySchedule.isAllTime};weeklySchedule.isAllTime||Object.keys(simplifiedWeeklySchedule).forEach(function(weekday){if(-1!==weekDayProperties.indexOf(weekday)){var simpleDay=simplifiedWeeklySchedule[weekday];weeklySchedule[weekday]=[{start:minutesToTimeString(0|simpleDay.from),end:minutesToTimeString(0|simpleDay.to)}]}});return weeklySchedule}function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}},{"../models/SimplifiedWeeklySchedule":139,"../utils/RemoteModel":162,moment:!1}],92:[function(require,module,exports){"use strict";var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),ko=require("knockout"),$=require("jquery");exports.create=function create(appModel){var api={},defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};api.list=ko.observableArray([]);api.syncList=function syncList(){return api.getUserJobProfile().then(function(list){api.list(list);return list})};api.clearCache=function clearCache(){cache.userJobProfile.cache.latest=null;cache.userJobProfile.list=[];cache.userJobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});function mapToUserJobProfile(rawItems){cache.userJobProfile.list=[];cache.userJobTitles={};rawItems&&rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);cache.userJobProfile.list.push(m);setGetUserJobTitleToCache(rawItem)});api.list(cache.userJobProfile.list);cache.userJobProfile.cache.latest=new Date;return cache.userJobProfile.list}function getUserJobProfileFromLocal(){return localforage.getItem("userJobProfile").then(function(userJobProfile){return userJobProfile?mapToUserJobProfile(userJobProfile):null})}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};c.model?c.model.model.updateWith(rawItem):c.model=new UserJobTitle(rawItem);c.cache?c.cache.latest=new Date:c.cache=new CacheControl({ttl:defaultTtl});var fullList=cache.userJobProfile.list;if(fullList){var found=null;fullList.some(function(it){if(it.jobTitleID()===rawItem.jobTitleID){found=it;return!0}});found?found.model.updateWith(rawItem):fullList.push(c.model)}return c.model}var fetchUserJobProfile=function(){return appModel.rest.get("me/user-job-profile").then(function(raw){localforage.setItem("userJobProfile",raw);return mapToUserJobProfile(raw)})};api.getUserJobProfile=function(){return cache.userJobProfile.cache.mustRevalidate()?cache.userJobProfile.list?fetchUserJobProfile():getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data?data:remotePromise}):Promise.resolve(cache.userJobProfile.list);
};var fetchUserJobTitle=function(jobTitleID){return appModel.rest.get("me/user-job-profile/"+jobTitleID).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})},pushNewUserJobTitle=function(values){return appModel.rest.post("me/user-job-profile",$.extend({jobTitleID:0,jobTitleName:"",intro:"",cancellationPolicyID:null,instantBooking:!1},values)).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.getUserJobTitle=function(jobTitleID){return jobTitleID?!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()?fetchUserJobTitle(jobTitleID):cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model?Promise.resolve(cache.userJobTitles[jobTitleID].model):getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model})["catch"](fetchUserJobTitle.bind(null,jobTitleID)):Promise.reject("Job Title ID required")};api.setUserJobTitle=function(values){return appModel.rest.put("me/user-job-profile/"+values.jobTitleID,values).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.createUserJobTitle=function(values){return pushNewUserJobTitle(values)};api.deactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/deactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.reactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/reactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return api.getUserJobTitle(jobTitleID).then(function(userJobTitle){if(!userJobTitle)throw{name:"Not Found",message:"You have not this job title in your profile. Maybe was deleted from your profile recently."};return Promise.all([userJobTitle,appModel.jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle)throw{name:"Not Found",message:"The job title does not exist."};return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})};return api}},{"../models/UserJobTitle":144,"../utils/CacheControl":151,knockout:!1,localforage:!1}],93:[function(require,module,exports){"use strict";var User=require("../models/User"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:User.newAnonymous(),ttl:{minutes:1},localStorageName:"profile",fetch:function fetch(){return appModel.rest.get("me/profile")},push:function push(){return appModel.rest.put("me/profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});rem.saveOnboardingStep=function saveOnboardingStep(stepReference){"undefined"==typeof stepReference?stepReference=rem.data.onboardingStep():rem.data.onboardingStep(stepReference);return appModel.rest.put("me/profile/tracking",{onboardingStep:stepReference}).then(function(){localforage.setItem(rem.localStorageName,rem.data.model.toPlainObject())})};return rem}},{"../models/User":142,"../utils/RemoteModel":162,localforage:!1}],94:[function(require,module,exports){"use strict";var UserVerification=require("../models/UserVerification"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"verificationID",Model:UserVerification});api.addLocalforageSupport("user-verifications");api.addRestSupport(appModel.rest,"me/verifications");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserVerification":147,"../utils/ListRemoteModel":160}],95:[function(require,module,exports){"use strict";exports.create=function create(appModel){var api={};api.getUser=function(userID){return appModel.rest.get("users/"+(0|userID))};api.getProfile=function(userID){return appModel.rest.get("users/"+(0|userID)+"/profile")};api.getJobProfile=function(userID){return appModel.rest.get("users/"+(0|userID)+"/job-profile")};api.getJobTitle=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/job-profile/"+(0|jobTitleID))};var getAvailability=function getAvailability(userID,format,query){return appModel.rest.get("users/"+(0|userID)+"/availability/"+format,query)};api.getAvailabilityPerDate=function(userID,startDate,endDate){return getAvailability(userID,"dates",{start:startDate,end:endDate})};api.getAvailabilityInsSlots=function(userID,startDate,endDate){return getAvailability(userID,"slots",{start:startDate,end:endDate})};var getRatings=function getRatings(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/ratings"+(modifier?"/"+modifier:""))};api.getUserRatings=getRatings.bind(api,null);api.getClientRatings=getRatings.bind(api,"client");api.getServiceProfessionalRatings=getRatings.bind(api,"service-professional");api.getJobTitleRatings=function(userID,jobTitleID){return getRatings(0|jobTitleID,userID)};api.getServiceAddresses=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-addresses/"+(0|jobTitleID))};api.getServiceProfessionalServices=function(serviceProfessionalUserID,jobTitleID){return appModel.rest.get("users/"+(0|serviceProfessionalUserID)+"/service-professional-services/"+(0|jobTitleID))};var getVerificationsSummary=function getVerificationsSummary(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/verifications-summary"+(modifier?"/"+modifier:""))};api.getUserVerificationsSummary=getVerificationsSummary.bind(api,null);api.getClientVerificationsSummary=getVerificationsSummary.bind(api,"client");api.getServiceProfessionalVerificationsSummary=getVerificationsSummary.bind(api,"service-professional");api.getJobTitleVerificationsSummary=function(userID,jobTitleID){return getVerificationsSummary(0|jobTitleID,userID)};api.getServiceAttributes=function getServiceAttributes(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-attributes/"+(0|jobTitleID))};return api}},{}],96:[function(require,module,exports){"use strict";var ko=require("knockout"),NavAction=require("../viewmodels/NavAction"),NavBar=require("../viewmodels/NavBar");require("../utils/Function.prototype._inherits");function Activity($activity,app){this.$activity=$activity;this.app=app;this.accessLevel=null;this.viewState={};this.requestData=null;this.navBar=new NavBar({title:null,leftAction:null,rightAction:null})}module.exports=Activity;Activity.prototype.show=function show(options){if(!this.__bindingDone){ko.applyBindings(this.viewModel||{},this.$activity.get(0));this.__bindingDone=!0}options=options||{};this.requestData=options;if(this._handlers&&this._handlersAreConnected!==!0){this._handlers.forEach(function(settings){if(!settings.event&&settings.target.subscribe){var subscription=settings.target.subscribe(settings.handler);settings._subscription=subscription;settings._latestSubscribedValue!==settings.target()&&settings.handler.call(settings.target,settings.target())}else settings.selector?settings.target.on(settings.event,settings.selector,settings.handler):settings.target.on?settings.target.on(settings.event,settings.handler):console.error("Activity.show: Bad registered handler",settings)});this._handlersAreConnected=!0}};Activity.prototype.hide=function hide(){if(this._handlers){this._handlers.forEach(function(settings){if(settings._subscription){settings._subscription.dispose();settings._latestSubscribedValue=settings.target()}else settings.target.off?settings.selector?settings.target.off(settings.event,settings.selector,settings.handler):settings.target.off(settings.event,settings.handler):settings.target.removeListener?settings.target.removeListener(settings.event,settings.handler):console.error("Activity.hide: Bad registered handler",settings)});this._handlersAreConnected=!1}};Activity.prototype.registerHandler=function registerHandler(settings){if(!settings)throw new Error("Register require a settings object");if(!settings.target||!settings.target.on&&!settings.target.subscribe)throw new Error("Target is null or not a jQuery, EventEmmiter or Observable object");if("function"!=typeof settings.handler)throw new Error("Handler must be a function.");if(!settings.event&&!settings.target.subscribe)throw new Error("Event is null; it's required for non observable objects");this._handlers=this._handlers||[];this._handlers.push(settings)};Activity.NavBar=NavBar;Activity.NavAction=NavAction;Activity.createSectionNavBar=function createSectionNavBar(title){return new NavBar({title:title,leftAction:NavAction.menuIn,rightAction:NavAction.menuNewItem})};Activity.createSubsectionNavBar=function createSubsectionNavBar(title,options){options=options||{};var goBackOptions={text:title,isTitle:!0};if(options.backLink){goBackOptions.link=options.backLink;goBackOptions.isShell=!1}return new NavBar({title:"",leftAction:NavAction.goBack.model.clone(goBackOptions),rightAction:options.helpId?NavAction.goHelpIndex.model.clone({link:"#"+options.helpId}):NavAction.goHelpIndex})};Activity.prototype.createCancelAction=function createCancelAction(cancelLink,state){var app=this.app,action=new NavAction({link:cancelLink,text:"cancel",handler:function(event){var link=this.link(),eoptions=event&&event.options||{},goLink=function(){link?app.shell.go(link,state):app.shell.goBack(state)};eoptions.silentMode?goLink():app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){goLink()})}});return action};Activity.prototype.convertToCancelAction=function convertToCancelAction(actionModel,cancelLink){var cancel=this.createCancelAction(cancelLink);actionModel.model.updateWith(cancel);actionModel.handler(cancel.handler())};var singlentonInstances={},createSingleton=function createSingleton(ActivityClass,$activity,app){if(singlentonInstances[ActivityClass.name]instanceof ActivityClass)return singlentonInstances[ActivityClass.name];var s=new ActivityClass($activity,app);singlentonInstances[ActivityClass.name]=s;return s};Activity["extends"]=function extendsActivity(ClassFn){ClassFn._inherits(Activity);ClassFn.init=createSingleton.bind(null,ClassFn);return ClassFn}},{"../utils/Function.prototype._inherits":154,"../viewmodels/NavAction":199,"../viewmodels/NavBar":200,knockout:!1}],97:[function(require,module,exports){var $=require("jquery"),classes={component:"DatePicker",months:"DatePicker-months",days:"DatePicker-days",monthDay:"day",month:"month",year:"year",years:"DatePicker-years",weekDays:"DatePicker-weekDays",active:"active"},events={dayRendered:"dayRendered",dateChanged:"dateChanged",show:"show",hide:"hide",dateSet:"dateSet",viewDateChanged:"viewDateChanged"},DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10},{clsName:"day",navFnc:"Date",navStep:1}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","M","Tu","W","Th","F","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||0===parts.length)throw new Error("Invalid date format.");return{separator:separator,parts:parts}},parseDate:function(date,format){var parts=date.split(format.separator),val;date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(parts.length===format.parts.length){for(var year=date.getFullYear(),day=date.getDate(),month=date.getMonth(),i=0,cnt=format.parts.length;cnt>i;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case"dd":case"d":day=val;date.setDate(val);break;case"mm":case"m":month=val-1;date.setMonth(val-1);break;case"yy":year=2e3+val;date.setFullYear(2e3+val);break;case"yyyy":year=val;date.setFullYear(val)}}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d;val.mm=(val.m<10?"0":"")+val.m;date=[];for(var i=0,cnt=format.parts.length;cnt>i;i++)date.push(val[format.parts[i]]);return date.join(format.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="'+classes.component+'"><div class="'+classes.days+'"><table class=" table-condensed">'+DPGlobal.headTemplate+'<tbody></tbody></table></div><div class="'+classes.months+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+'</table></div><div class="'+classes.years+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table></div></div>";DPGlobal.modesSet={date:DPGlobal.modes[3],month:DPGlobal.modes[0],year:DPGlobal.modes[1],decade:DPGlobal.modes[2]};var DatePicker=function(element,options){this.element=$(element);this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy");this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;this.isPlaceholder=this.element.is(".calendar-placeholder");this.picker=$(DPGlobal.template).appendTo(this.isPlaceholder?this.element:"body").on("click",$.proxy(this.click,this));this.picker.addClass(this.isPlaceholder?"":"dropdown-menu");options.extraClasses&&this.picker.addClass(options.extraClasses);if(this.isPlaceholder){this.picker.show();if("today"==this.element.data("date")){this.date=new Date;this.set()}this.element.trigger({type:events.show,date:this.date})}else this.isInput?this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)}):this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this));this.element.on("swipeleft",function(e){e.preventDefault();this.moveDate("next")}.bind(this)).on("swiperight",function(e){e.preventDefault();this.moveDate("prev")}.bind(this));this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0;if("string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=options.viewMode||this.element.data("date-viewmode")||0;if("string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=options.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};DatePicker.prototype={constructor:DatePicker,_triggerViewDateChange:function(){var viewModeName=DPGlobal.modes[this.viewMode].clsName;this.element.trigger(events.viewDateChanged,[{viewDate:this.viewDate,viewMode:viewModeName}])},show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).off("resize.datepicker").on("resize.datepicker",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}!this.isInput;var that=this;$(document).off("mousedown.datepicker").on("mousedown.datepicker",function(ev){0===$(ev.target).closest("."+classes.component).length&&that.hide()});this.element.trigger({type:events.show,date:this.date})},hide:function(){this.picker.hide();$(window).off("resize.datepicker",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||$(document).off("mousedown.datepicker",this.hide);this.element.trigger({type:events.hide,date:this.date})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);if(this.isInput)this.element.prop("value",formated);else{this.component&&this.element.find("input").prop("value",formated);this.element.data("date",formated)}this.element.trigger(events.dateSet,[this.date,formated])},setValue:function(newDate,dontNotify){"string"==typeof newDate?this.date=DPGlobal.parseDate(newDate,this.format):this.date=new Date(newDate);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange();dontNotify!==!0&&this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})},getValue:function(){return this.date},getViewDate:function(){return this.viewDate},moveValue:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode?DPGlobal.modesSet[mode]:DPGlobal.modes[this.viewMode];this.date["set"+mode.navFnc].call(this.date,this.date["get"+mode.navFnc].call(this.date)+mode.navStep*("prev"===dir?-1:1));this.setValue(this.date);return this.date}},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},update:function(newDate){this.date=DPGlobal.parseDate("string"==typeof newDate?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange()},getDaysElements:function(){return this.picker.find("."+classes.days+" ."+classes.monthDay)},fillDow:function(){for(var dowCnt=this.weekStart,html='<tr class="'+classes.weekDays+'">';dowCnt<this.weekStart+7;)html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>";html+="</tr>";this.picker.find("."+classes.days+" thead").append(html)},fillMonths:function(){for(var html="",i=0;12>i;)html+='<span class="'+classes.month+'">'+DPGlobal.dates.monthsShort[i++]+"</span>";this.picker.find("."+classes.months+" td").append(html)},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf(),prevMonth=new Date(year,month-1,28,0,0,0,0),lastDayPrevMonth=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(lastDayPrevMonth);prevMonth.setDate(lastDayPrevMonth-(prevMonth.getDay()-this.weekStart+7)%7);if(this._prevDate&&this._prevDate.getMonth()===this.viewDate.getMonth()){var tbody=this.picker.find("."+classes.days+" tbody");tbody.find("."+classes.monthDay+"."+classes.active).removeClass(classes.active);var diff=lastDayPrevMonth-prevMonth.getDate(),index=diff+this.date.getDate(),irow=index/7|0,icol=index%7;tbody.find("tr:eq("+irow+") td:eq("+icol+")").addClass(classes.active);this._prevDate=new Date(this.viewDate)}else{this._prevDate=new Date(this.viewDate);this.picker.find("."+classes.days+" th:eq(1)").html(DPGlobal.dates.months[month]+" "+year);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42);nextMonth=nextMonth.valueOf();var html=[],clsName,prevY,prevM;if(this._daysCreated!==!0){for(var r=0;6>r;r++){html.push("<tr>");for(var c=0;7>c;c++)html.push('<td class="'+classes.monthDay+'"><span>&nbsp;</span></td>');html.push("</tr>")}this.picker.find("."+classes.days+" tbody").empty().append(html.join(""));this._daysCreated=!0}for(var weekTr=this.picker.find("."+classes.days+" tbody tr:first-child()"),dayTd=null;prevMonth.valueOf()<nextMonth;){var currentWeekDayIndex=prevMonth.getDay()-this.weekStart;clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();month>prevM&&prevY===year||year>prevY?clsName+=" old":(prevM>month&&prevY===year||prevY>year)&&(clsName+=" new");prevMonth.valueOf()===currentDate&&(clsName+=" "+classes.active);dayTd=weekTr.find("td:eq("+currentWeekDayIndex+")");dayTd.attr("class",classes.monthDay+" "+clsName).data("date-time",prevMonth.toISOString()).children("span").text(prevMonth.getDate());this.picker.trigger(events.dayRendered,[dayTd]);prevMonth.getDay()===this.weekEnd&&(weekTr=weekTr.next("tr"));prevMonth.setDate(prevMonth.getDate()+1)}var currentYear=this.date.getFullYear(),months=this.picker.find("."+classes.months).find("th:eq(1)").html(year).end().find("span").removeClass(classes.active);currentYear===year&&months.eq(this.date.getMonth()).addClass(classes.active);html="";year=10*parseInt(year/10,10);var yearCont=this.picker.find("."+classes.years).find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;var i;if(this._yearsCreated!==!0){for(i=-1;11>i;i++){html+='<span class="'+classes.year+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:"")+'">'+year+"</span>";year+=1}yearCont.html(html);this._yearsCreated=!0}else{var yearSpan=yearCont.find("span:first-child()");for(i=-1;11>i;i++){yearSpan.text(year).attr("class","year"+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:""));year+=1;yearSpan=yearSpan.next()}}}},moveDate:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode||this.viewMode;this.viewDate["set"+DPGlobal.modes[mode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[mode].navFnc].call(this.viewDate)+DPGlobal.modes[mode].navStep*("prev"===dir?-1:1));this.fill();this._triggerViewDateChange();this.set()}},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest("span.month, span.year, td, th");if(1===target.length){var month,year,completeMonthYear=function completeMonthYear(){if(0!==this.viewMode){this.date=new Date(this.viewDate);this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set()}.bind(this);if(target.hasClass("switch"))this.showMode(1);else if(target.hasClass("prev")||target.hasClass("next"))this.moveDate(target[0].className);else if(target.hasClass(classes.month)){month=target.parent().find("span").index(target);this.viewDate.setMonth(month);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.year)){year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.monthDay)&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;month=this.viewDate.getMonth();month+=target.hasClass("old")?-1:target.hasClass("new")?1:0;year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0);this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0);this.fill();this._triggerViewDateChange();this.set();this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(dir){dir&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir)));this.picker.find(">div").hide().filter("."+classes.component+"-"+DPGlobal.modes[this.viewMode].clsName).show()}};$.fn.datepicker=function(option){var vals=Array.prototype.slice.call(arguments,1),returned;this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;data||$this.data("datepicker",data=new DatePicker(this,$.extend({},$.fn.datepicker.defaults,options)));if("string"==typeof option){returned=data[option].apply(data,vals);if("undefined"!=typeof returned)return!1}});return"undefined"!=typeof returned?returned:this};$.fn.datepicker.defaults={onRender:function(){return""}};$.fn.datepicker.Constructor=DatePicker;exports.DatePicker=DatePicker;exports.defaults=DPGlobal;exports.utils=DPGlobal},{}],98:[function(require,module,exports){var $=require("jquery"),clearNode=function(node){for(;node.firstChild;)node.removeChild(node.firstChild)},textboxResize=function textboxResize(el){var leftbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.left")[0],rightbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.right")[0];"undefined"==typeof leftbtn&&(leftbtn={offsetWidth:0,className:""});"undefined"==typeof rightbtn&&(rightbtn={offsetWidth:0,className:""});var margin=Math.max(leftbtn.offsetWidth,rightbtn.offsetWidth);el.style.marginLeft=margin+"px";el.style.marginRight=margin+"px";var tooLong=el.offsetWidth<el.scrollWidth?!0:!1;if(tooLong){if(leftbtn.offsetWidth<rightbtn.offsetWidth){el.style.marginLeft=leftbtn.offsetWidth+"px";el.style.textAlign="right"}else{el.style.marginRight=rightbtn.offsetWidth+"px";el.style.textAlign="left"}tooLong=el.offsetWidth<el.scrollWidth?!0:!1;if(tooLong){if(new RegExp("arrow").test(leftbtn.className)){clearNode(leftbtn.childNodes[1]);el.style.marginLeft="26px"}if(new RegExp("arrow").test(rightbtn.className)){clearNode(rightbtn.childNodes[1]);el.style.marginRight="26px"}}}};exports.textboxResize=textboxResize;var SmartNavBar=function SmartNavBar(el){this.el=el;this.refresh=function refresh(){var h=$(el).children("h1").get(0);h&&textboxResize(h)};this.refresh()};exports.SmartNavBar=SmartNavBar;exports.getAll=function getAll(){var all=$(".SmartNavBar");return $.map(all,function(item){return new SmartNavBar(item)})};exports.refreshAll=function refreshAll(){$(".SmartNavBar > h1").each(function(){textboxResize(this)})}},{}],99:[function(require,module,exports){"use strict";var moment=require("moment"),current=moment.locale();moment.locale("en-US-LC",{meridiemParse:/[ap]\.?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"p":"P":isLower?"a":"A"},calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"M/D"},longDateFormat:{LT:"h:mma",LTS:"h:mm:ssa",L:"MM/DD/YYYY",l:"M/D/YYYY",LL:"MMMM Do YYYY",ll:"MMM D YYYY",LLL:"MMMM Do YYYY LT",lll:"MMM D YYYY LT",LLLL:"dddd, MMMM Do YYYY LT",llll:"ddd, MMM D YYYY LT"}});moment.locale(current)},{moment:!1}],100:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery");exports.show=function showTextEditor(options){var modal=$("#textEditorModal"),vm=modal.data("viewmodel");if(!vm){vm=new TextEditorModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"");vm.text(options.text||"");return new Promise(function(resolve,reject){var save=function(){resolve(vm.text());modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject.bind(null,null));modal.off("click","#textEditorModal-save");modal.on("click","#textEditorModal-save",save);modal.one("shown.bs.modal",function(){setTimeout(function(){var $text=modal.find("textarea");$text.focus();$text.click();window.scrollTo(0,0)},100)});modal.modal("show")})};function TextEditorModel(){this.title=ko.observable("");this.text=ko.observable("")}},{knockout:!1}],101:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery");function twoDigits(n){return Math.floor(n/10)+""+n%10}exports.show=function showTimePicker(options){var modal=$("#timePickerModal"),vm=modal.data("viewmodel");if(!vm){vm=new TimePickerModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"Select time");vm.stepInMinutes(options.stepInMinutes||5);"string"==typeof options.selectedTime?vm.selectedTimeString(options.selectedTime):vm.selectedTime(options.selectedTime||{});vm.unsetLabel(options.unsetLabel||"Remove");vm.selectLabel(options.selectLabel||"Select");return new Promise(function(resolve,reject){var unset=function(){resolve(null);modal.modal("hide")},select=function(){resolve({time:vm.selectedTime(),timeString:vm.selectedTimeString()});modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject);modal.off("click",".timePickerModal-unset");modal.on("click",".timePickerModal-unset",unset);modal.off("click",".timePickerModal-select");modal.on("click",".timePickerModal-select",select);modal.modal("show")})};function TimePickerModel(){var vm={title:ko.observable(""),pickedHour:ko.observable(null),pickedMinute:ko.observable(null),pickedAmpm:ko.observable(null),stepInMinutes:ko.observable(5),unsetLabel:ko.observable("Remove"),selectLabel:ko.observable("Select")};vm.locale=ko.observable({lang:"en",region:"US"});vm.hourValues=ko.computed(function(){var region=this.locale().region,step=this.stepInMinutes()/60|0;0>=step&&(step=1);var values=[],i;if("US"===region){values.push({value:0,label:12});for(i=1;12>i;i+=step)values.push({value:i,label:i})}else for(i=0;24>i;i+=step)values.push({value:i,label:i});return values},vm);vm.minuteValues=ko.computed(function(){var step=0|this.stepInMinutes();0>=step&&(step=1);if(step>=60)return[];for(var values=[],i=0;60>i;i+=step)values.push({value:i,label:twoDigits(i)});return values},vm);vm.ampmValues=ko.computed(function(){var region=this.locale().region,values=[];if("US"===region){values.push({value:0,label:"AM"});values.push({value:12,label:"PM"})}return values},vm);vm.selectedTime=ko.computed({read:function(){return{hours:this.pickedHour()+this.pickedAmpm(),minutes:this.pickedMinute(),seconds:0}},write:function(v){if("object"!=typeof v)throw new Error("Invalid input for the time picker. Value:",v);v=v||{};var region=this.locale().region;if("US"===region){this.pickedHour(v.hours/12|0);this.pickedMinute(0|v.minutes);this.pickedAmpm(v.hours%12|0)}else{this.pickedHour(0|v.hours);this.pickedMinute(0|v.minutes);this.pickedAmpm(0)}},owner:vm});vm.selectedTimeString=ko.computed({read:function(){var t=this.selectedTime();return twoDigits(t.hours)+":"+twoDigits(t.minutes)+":"+twoDigits(t.seconds)},write:function(v){v=v||"";var parts=v.split(":");this.selectedTime({hours:0|parts[0],minutes:0|parts[1],seconds:0|parts[2]})},owner:vm});return vm}},{knockout:!1}],102:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Address(values){Model(this);this.model.defProperties({addressID:0,addressName:"",jobTitleID:0,userID:0,addressLine1:null,addressLine2:null,postalCode:null,city:null,stateProvinceCode:null,stateProvinceName:null,countryCode:null,latitude:null,longitude:null,specialInstructions:null,isServiceArea:!1,isServiceLocation:!1,serviceRadius:0,createdDate:null,updatedDate:null,kind:""},values);this.singleLine=ko.computed(function(){var list=[this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()];return list.filter(function(v){return!!v}).join(", ")},this);var countries={US:"United States",ES:"Spain"};this.countryName=ko.computed(function(){return countries[this.countryCode()]||"unknow"},this);this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}module.exports=Address;Address.kind={home:"home",billing:"billing",service:"service"}},{"./Model":123,knockout:!1}],103:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PricingSummaryDetail=require("./PricingSummaryDetail"),CalendarEvent=require("./CalendarEvent"),Booking=require("./Booking");function Appointment(values){Model(this);this.model.defProperties({id:null,startTime:null,endTime:null,summary:"New booking",description:null,isAllDay:!1,price:0,clientUserID:null,pricing:{Model:PricingSummaryDetail,isArray:!0},addressID:null,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,jobTitleID:0,readOnly:!1,sourceEvent:{Model:CalendarEvent,defaultValue:null},sourceBooking:{Model:Booking,defaultValue:null}},values);this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT");
},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this);this.itStarted=ko.pureComputed(function(){return this.startTime()&&new Date>=this.startTime()},this);this.itEnded=ko.pureComputed(function(){return this.endTime()&&new Date>=this.endTime()},this);this.isNew=ko.pureComputed(function(){return!this.id()},this);this.stateHeader=ko.pureComputed(function(){var text="";this.id()>0&&this.sourceEvent()&&(text=this.sourceBooking()?this.itStarted()?this.itEnded()?"Completed":"Now":"Upcoming":"Calendar block");return text},this)}module.exports=Appointment;Appointment.fromCalendarEvent=function fromCalendarEvent(event){var apt=new Appointment;apt.id(event.calendarEventID());apt.startTime(event.startTime());apt.endTime(event.endTime());apt.summary(event.summary());apt.description(event.description());apt.isAllDay(event.isAllDay());apt.readOnly(event.readOnly());apt.sourceEvent(event);return apt};Appointment.fromBooking=function fromBooking(booking,event){var apt=Appointment.fromCalendarEvent(event);apt.clientUserID(booking.clientUserID());apt.addressID(booking.serviceAddressID());apt.jobTitleID(booking.jobTitleID());apt.pricing(booking.pricingSummary()&&booking.pricingSummary().details());apt.preNotesToClient(booking.preNotesToClient());apt.postNotesToClient(booking.postNotesToClient());apt.preNotesToSelf(booking.preNotesToSelf());apt.postNotesToSelf(booking.postNotesToSelf());apt.readOnly(!1);var prices=booking.pricingSummary();prices&&apt.price(prices.totalPrice()-prices.pFeePrice());apt.sourceBooking(booking);return apt};Appointment.listFromCalendarEventsBookings=function listFromCalendarEventsBookings(events,bookings){return events.map(function(event){var booking=null;bookings.some(function(searchBooking){var found=searchBooking.serviceDateID()===event.calendarEventID();if(found){booking=searchBooking;return!0}});return booking?Appointment.fromBooking(booking,event):Appointment.fromCalendarEvent(event)})};Appointment.specialIds={loading:0,emptyDate:-1,free:-2,newEvent:-3,newBooking:-4,unavailable:-5,preparationTime:-6};var Time=require("../utils/Time");Appointment.newFreeSlot=function newFreeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.free,startTime:start,endTime:end,summary:options.text||"Free",description:null})};Appointment.newUnavailableSlot=function newUnavailableSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.unavailable,startTime:start,endTime:end,summary:options.text||"Unavailable",description:null})};Appointment.newPreparationTimeSlot=function newPreparationTimeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.preparationTime,startTime:start,endTime:end,summary:options.text||"Preparation time",description:null})}},{"../utils/Time":164,"./Booking":104,"./CalendarEvent":106,"./Model":123,"./PricingSummaryDetail":126,knockout:!1,moment:!1}],104:[function(require,module,exports){"use strict";var Model=require("./Model"),PricingSummary=require("./PricingSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),Address=require("./Address"),EventDates=require("./EventDates");function Booking(values){Model(this);this.model.defProperties({bookingID:0,clientUserID:0,serviceProfessionalUserID:0,jobTitleID:0,languageID:0,countryID:0,bookingStatusID:0,bookingTypeID:0,cancellationPolicyID:0,parentBookingID:null,serviceAddressID:null,serviceDateID:null,alternativeDate1ID:null,alternativeDate2ID:null,pricingSummaryID:0,pricingSummaryRevision:0,paymentLastFourCardNumberDigits:null,totalPricePaidByClient:null,totalServiceFeesPaidByClient:null,totalPaidToServiceProfessional:null,totalServiceFeesPaidByServiceProfessional:null,instantBooking:!1,firstTimeBooking:!1,sendReminder:!1,sendPromotional:!1,recurrent:!1,multiSession:!1,pricingAdjustmentApplied:!1,paymentEnabled:!1,paymentCollected:!1,paymentauthorized:!1,awaitingResponseFromUserID:null,pricingAdjustmentRequested:!1,updatedDate:null,specialRequests:null,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,reviewedByServiceProfessional:!1,reviewedByClient:!1,pricingSummary:new PricingSummary,serviceAddress:{Model:Address},serviceDate:{Model:EventDates},alternativeDate1:{Model:EventDates},alternativeDate2:{Model:EventDates},userJobTitle:{Model:PublicUserJobTitle}},values)}module.exports=Booking;Booking.from=function from(data){return Array.isArray(data)?data.map(Booking.from):new Booking(data)}},{"./Address":102,"./EventDates":110,"./Model":123,"./PricingSummary":125,"./PublicUserJobTitle":130}],105:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function BookingSummary(values){Model(this);this.model.defProperties({quantity:0,concept:"",time:null,timeFormat:" [@] h:mma"},values);this.phrase=ko.pureComputed(function(){var t=this.timeFormat()&&this.time()&&moment(this.time()).format(this.timeFormat())||"";return this.concept()+t},this);this.url=ko.pureComputed(function(){var url=this.time()&&"/calendar/"+this.time().toISOString();return url},this)}module.exports=BookingSummary},{"./Model":123,knockout:!1,moment:!1}],106:[function(require,module,exports){"use strict";var Model=require("./Model");function RecurrenceRule(values){Model(this);this.model.defProperties({frequencyTypeID:0,interval:1,until:null,count:null,ending:null,selectedWeekDays:[],monthlyWeekDay:!1,incompatible:!1,tooMany:!1},values)}function RecurrenceOccurrence(values){Model(this);this.model.defProperties({startTime:null,endTime:null},values)}function CalendarEvent(values){Model(this);if(values){values.startTime=values.startTime&&new Date(Date.parse(values.startTime))||null;values.endTime=values.endTime&&new Date(Date.parse(values.endTime))||null}this.model.defProperties({calendarEventID:0,userID:0,eventTypeID:3,summary:"",availabilityTypeID:0,startTime:null,endTime:null,kind:0,isAllDay:!1,timeZone:"Z",location:null,updatedDate:null,createdDate:null,description:"",readOnly:!1,recurrenceRule:{Model:RecurrenceRule},recurrenceOccurrences:{isArray:!0,Model:RecurrenceOccurrence}},values)}module.exports=CalendarEvent;CalendarEvent.RecurrenceRule=RecurrenceRule;CalendarEvent.RecurrenceOccurrence=RecurrenceOccurrence},{"./Model":123}],107:[function(require,module,exports){"use strict";var Model=require("./Model");function CalendarSyncing(values){Model(this);this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}module.exports=CalendarSyncing},{"./Model":123}],108:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model");function Client(values){Model(this);this.model.defProperties({clientUserID:0,firstName:"",lastName:"",secondLastName:"",email:"",phone:null,canReceiveSms:!1,birthMonthDay:null,birthMonth:null,notesAboutClient:null,createdDate:null,updatedDate:null,editable:!1},values);this.fullName=ko.pureComputed(function(){return(this.firstName()||"")+" "+(this.lastName()||"")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this)}module.exports=Client},{"./Model":123,knockout:!1}],109:[function(require,module,exports){"use strict";var Model=require("../models/Model"),Appointment=require("../models/Appointment"),WeekDaySchedule=require("../models/WeekDaySchedule"),SchedulingPreferences=require("../models/SchedulingPreferences"),moment=require("moment"),ko=require("knockout"),availabilityCalculation=require("../utils/availabilityCalculation"),getDateWithoutTime=require("../utils/getDateWithoutTime");function DateAvailability(values){Model(this);this.model.defProperties({date:null,weekDaySchedule:{Model:WeekDaySchedule},appointmentsList:{isArray:!0,Model:Appointment},schedulingPreferences:{Model:SchedulingPreferences}},values);this.list=ko.pureComputed(function(){return availabilityCalculation.fillDayAvailability(this.date(),this.appointmentsList(),this.weekDaySchedule(),this.schedulingPreferences())},this);this.workDayMinutes=ko.pureComputed(function(){var schedule=this.weekDaySchedule();return schedule.to()-schedule.from()|0},this);this.availableMinutes=ko.pureComputed(function(){return this.list().reduce(function(minutes,apt){if(apt.id()===Appointment.specialIds.free){var et=moment(apt.endTime()),st=moment(apt.startTime());minutes+=et.diff(st,"minutes")}return minutes},0)},this);this.availablePercent=ko.pureComputed(function(){return Math.round(this.availableMinutes()/this.workDayMinutes()*100)},this);this.availableTag=ko.pureComputed(function(){var perc=this.availablePercent(),date=this.date(),today=getDateWithoutTime();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"},this);var createTimeSlots=require("../utils/createTimeSlots");this.getFreeTimeSlots=function getFreeTimeSlots(duration,slotSizeMinutes){slotSizeMinutes=slotSizeMinutes||this.schedulingPreferences().incrementsSizeInMinutes();duration||(duration=slotSizeMinutes);var date=this.date(),today=getDateWithoutTime();return today>date||this.availableMinutes()<=0?[]:createTimeSlots.forList(this.getFreeAvailableSlots(),slotSizeMinutes,duration)};this.getFreeAvailableSlots=function getFreeAvailableSlots(){var date=this.date(),today=getDateWithoutTime();if(today>date||this.availableMinutes()<=0)return[];var slots=[];this.list().forEach(function(apt){apt.id()===Appointment.specialIds.free&&slots.push({availability:"free",startTime:apt.startTime(),endTime:apt.endTime()})});return slots}}module.exports=DateAvailability},{"../models/Appointment":103,"../models/Model":123,"../models/SchedulingPreferences":135,"../models/WeekDaySchedule":150,"../utils/availabilityCalculation":166,"../utils/createTimeSlots":169,"../utils/getDateWithoutTime":175,knockout:!1,moment:!1}],110:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),moment=require("moment");module.exports=function EventDates(values){Model(this);this.model.defProperties({startTime:null,endTime:null},values);this.duration=ko.computed({read:function(){var s=this.startTime(),e=this.endTime();return s&&e?moment.duration(e-s):null},write:function(value){var s=this.startTime();if((value||0===value)&&s){var newEnd=moment(s).clone().add(value);this.endTime(newEnd.toDate())}else this.endTime(null)},owner:this});this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this)}},{"./Model":123,knockout:!1,moment:!1}],111:[function(require,module,exports){"use strict";var Model=require("./Model");function ExperienceLevel(values){Model(this);this.model.defProperties({experienceLevelID:0,name:"",description:null,updatedDate:null},values)}module.exports=ExperienceLevel},{"./Model":123}],112:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem");function GetMore(values){Model(this);this.model.defProperties({availability:!1,payments:!1,profile:!1,coop:!0},values);var availableItems={availability:new ListViewItem({contentLine1:"Complete your availability to create a cleaner calendar",markerIcon:"fa fa-fw fa-calendar"}),payments:new ListViewItem({contentLine1:"Start accepting payments through Loconomics",markerIcon:"fa ion ion-card"}),profile:new ListViewItem({contentLine1:"Activate your profile in the marketplace",markerIcon:"fa ion ion-cash",link:"/marketplaceProfile"}),coop:new ListViewItem({contentLine1:"Learn more about our cooperative",markerIcon:"fa fa-gavel"})};this.items=ko.pureComputed(function(){var items=[];Object.keys(availableItems).forEach(function(key){this[key]()&&items.push(availableItems[key])}.bind(this));return items},this)}module.exports=GetMore},{"./ListViewItem":118,"./Model":123,knockout:!1}],113:[function(require,module,exports){"use strict";var Address=require("./Address"),Model=require("./Model"),ko=require("knockout");function InputPaymentMethod(values){Model(this);this.model.defProperties({paymentMethodID:0,nameOnCard:"",cardNumber:null,expirationMonth:null,expirationYear:null,securityCode:null,billingAddress:{Model:Address},savePayment:!1},values);this.expirationMonthYear=ko.computed({read:function(){var m=this.expirationMonth(),y=this.expirationYear();return m||y?padLeft(m,2,"0")+"/"+padLeft(y,4,"0"):""},write:function(value){var parts=value.split("/");if(2===parts.length){this.expirationMonth(padLeft(0|parts[0],2,"0"));this.expirationYear(padLeft(0|parts[1],4,"0"))}},owner:this})}module.exports=InputPaymentMethod;function padLeft(v,length,padLetter){if(!v)return"";v=v.toString();for(;v.length<length;)v=padLetter+v;return v}},{"./Address":102,"./Model":123,knockout:!1}],114:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");function JobTitle(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values);this.model.defID(["jobTitleID"]);this.pricingTypes=ko.observableArray([]);values&&values.pricingTypes&&values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}module.exports=JobTitle},{"./JobTitlePricingType":115,"./Model":123,knockout:!1}],115:[function(require,module,exports){"use strict";var Model=require("./Model");function JobTitlePricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID","clientTypeID"])}module.exports=JobTitlePricingType},{"./Model":123}],116:[function(require,module,exports){"use strict";var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");function JobTitleServiceAttributes(values){Model(this);this.model.defProperties({jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevels:{isArray:!0,Model:ExperienceLevel},languageID:0,countryID:0},values)}module.exports=JobTitleServiceAttributes},{"./ExperienceLevel":111,"./Model":123,"./ServiceAttributeCategory":137}],117:[function(require,module,exports){"use strict";var Model=require("./Model");function LicenseCertification(values){Model(this);this.model.defProperties({licenseCertificationID:0,name:"",stateProvinceID:0,countryID:0,description:null,authority:null,verificationWebsiteUrl:null,howToGetLicensedUrl:null,optionGroup:null,createdDate:null,updatedDate:null},values);this.model.defID(["licenseCertificationID"])}module.exports=LicenseCertification},{"./Model":123}],118:[function(require,module,exports){"use strict";var Model=require("./Model");function ListViewItem(values){Model(this);this.model.defProperties({markerLine1:null,markerLine2:null,markerIcon:null,contentLine1:"",contentLine2:null,link:"#",actionIcon:null,actionText:null,classNames:""},values)}module.exports=ListViewItem},{"./Model":123}],119:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),_=require("lodash");function MailFolder(values){Model(this);this.model.defProperties({messages:[],topNumber:10},values);this.top=ko.pureComputed(function top(num){num&&this.topNumber(num);return _.first(this.messages(),this.topNumber())},this)}module.exports=MailFolder},{"./Model":123,knockout:!1,lodash:!1}],120:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout");function MarketplaceProfile(values){Model(this);this.model.defProperties({userID:0,publicBio:"",serviceProfessionalProfileUrlSlug:"",serviceProfessionalProfileUrl:"",serviceProfessionalWebsiteUrl:"",bookCode:"",createdDate:null,updatedDate:null},values);this.photoUrl=ko.pureComputed(function(){var $=require("jquery"),siteUrl=$("html").attr("data-site-url")||"https://loconomics.com";return siteUrl+"/en-US/Profile/Photo/"+this.userID()},this)}module.exports=MarketplaceProfile},{"./Model":123,knockout:!1}],121:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function Message(values){Model(this);this.model.defProperties({messageID:0,threadID:0,sentByUserID:null,typeID:null,auxT:null,auxID:null,bodyText:"",createdDate:null,updatedDate:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}module.exports=Message},{"./Model":123,knockout:!1,moment:!1}],122:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),moment=require("moment");function MessageView(values,app){Model(this);this.model.defProperties({id:0,createdDate:null,updatedDate:null,subject:"",content:null,link:"#",tag:"",classNames:"",sourceThread:null,sourceMessage:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this);this.quickDateTime=ko.pureComputed(function(){var date=this.createdDate(),m=moment(date).locale("en-US-LC"),t=moment().startOf("day");return m.isAfter(t)?m.format("LT"):m.fromNow()},this);this.client=ko.computed(function(){var s=this.sourceMessage();if(!s||!app)return null;var cid=s.sentByUserID();return cid?cid===app.model.userProfile.data.userID()?app.model.userProfile.data:app.model.clients.getObservableItem(cid,!0)():null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}module.exports=MessageView;MessageView.fromThread=function(app,thread){var msg=thread.messages();msg=msg&&msg[0]||null;var tag,classNames;if("Booking"===msg.auxT()){tag="Booking";classNames="text-success"}return new MessageView({sourceThread:thread,sourceMessage:msg,id:thread.threadID(),createdDate:thread.createdDate(),updatedDate:thread.updatedDate(),subject:thread.subject(),content:msg&&msg.bodyText()||"",link:"#!/conversation/"+thread.threadID(),tag:tag,classNames:classNames},app)}},{"./Model":123,knockout:!1,moment:!1}],123:[function(require,module,exports){"use strict";var ko=require("knockout");ko.mapping=require("knockout.mapping");var $=require("jquery"),clone=function(obj){return $.extend(!0,{},obj)},cloneValue=function(val,deepCopy){return"object"==typeof val?val instanceof Date?new Date(val):deepCopy===!0?val instanceof Array?val.map(function(item){return cloneValue(item,!0)}):null===val?null:val&&val.model instanceof Model?val.model.toPlainObject(deepCopy):clone(val):deepCopy===!1?val:void 0:val};function Model(modelObject){if(!(this instanceof Model)){var model=new Model(modelObject);modelObject.model=model;return model}this.modelObject=modelObject;this.propertiesList=[];this.fieldsList=[];this.propertiesDefs={};this.fieldsDefs={};this.mappingOptions={};this.dataTimestamp=ko.observable(new Date).extend({rateLimit:0})}module.exports=Model;function prepareValueByDef(val,def){def.isArray&&!Array.isArray(val)&&(val="undefined"!=typeof val?[val]:[]);def&&def.Model&&(Array.isArray(val)?val=val.map(function(item){return item instanceof def.Model||null===item||"undefined"==typeof item?item:new def.Model(item)}):val instanceof def.Model||null===val||"undefined"==typeof val||(val=new def.Model(val)));return val}function createDef(givenVal,initialVal){var def,isModel=givenVal&&givenVal.model instanceof Model,isArray=Array.isArray(givenVal),isObject="object"==typeof givenVal&&!(givenVal instanceof Date);if(null===givenVal||isModel||!isObject||isArray){def={defaultValue:givenVal,isArray:isArray};isModel&&(def.Model=givenVal.constructor)}else def=givenVal;initialVal="undefined"==typeof initialVal?def.defaultValue:initialVal;def.initialValue=prepareValueByDef(initialVal,def);return def}Model.prototype.defProperties=function defProperties(properties,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,propertiesList=this.propertiesList,defs=this.propertiesDefs,dataTimestamp=this.dataTimestamp;Object.keys(properties).forEach(function(key){var def=createDef(properties[key],initialValues[key]);defs[key]=def;modelObject[key]=Array.isArray(def.initialValue)?ko.observableArray(def.initialValue):ko.observable(def.initialValue);modelObject[key]._defaultValue=def.defaultValue;modelObject[key]._initialValue=def.initialValue;modelObject[key].subscribe(function(){dataTimestamp(new Date)});propertiesList.push(key)});dataTimestamp(new Date)};Model.prototype.defFields=function defFields(fields,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,defs=this.fieldsDefs,fieldsList=this.fieldsList;Object.keys(fields).each(function(key){var def=createDef(fields[key],initialValues[key]);defs[key]=def;modelObject[key]=def.initialValue;fieldsList.push(key)})};Model.prototype.defID=function defID(fieldsNames){this.idFieldsNames=fieldsNames;if(1===fieldsNames.length){var field=fieldsNames[0];this.modelObject.id=ko.pureComputed(function(){return this[field]()},this.modelObject)}else this.modelObject.id=ko.pureComputed(function(){return fieldsNames.map(function(fieldName){return this[fieldName]()}.bind(this))},this.modelObject)};Model.prototype.regTimestamp=function regTimestampProperty(propertyName){var prop=this.modelObject[propertyName];if("function"!=typeof prop)throw new Error("There is no observable property with name ["+propertyName+"] to register as timestamp.");this.dataTimestamp.subscribe(function(timestamp){prop(timestamp)})};Model.prototype.toPlainObject=function toPlainObject(deepCopy){var plain={},modelObj=this.modelObject;function setValue(property,val){var clonedValue=cloneValue(val,deepCopy);"undefined"!=typeof clonedValue&&(plain[property]=clonedValue)}this.propertiesList.forEach(function(property){var val=modelObj[property]();setValue(property,val)});this.fieldsList.forEach(function(field){var val=modelObj[field];setValue(field,val)});return plain};Model.prototype.updateWith=function updateWith(data,deepCopy){var timestamp=null;if(data&&data.model instanceof Model){timestamp=data.model.dataTimestamp();data=data.model.toPlainObject(deepCopy)}var target=this.modelObject,defs=this.propertiesDefs;this.propertiesList.forEach(function(property){var val=data[property],def=defs[property];"undefined"!=typeof val&&target[property](prepareValueByDef(val,def))});defs=this.fieldsDefs;this.fieldsList.forEach(function(field){var val=data[field],def=defs[field];"undefined"!=typeof val&&(target[field]=prepareValueByDef(val,def))});timestamp&&this.modelObject.model.dataTimestamp(timestamp)};Model.prototype.mapData=function mapData(data,optionalMapping){ko.mapping.fromJS(data,optionalMapping||this.mappingOptions,this.modelObject)};Model.prototype.clone=function clone(data,deepCopy){var plain=this.toPlainObject(deepCopy),cloned=new this.modelObject.constructor(plain);data?cloned.model.updateWith(data):cloned.model.dataTimestamp(this.modelObject.model.dataTimestamp());return cloned};Model.prototype.touch=function touch(){this.dataTimestamp(new Date(Date()+1))};Model.prototype.reset=function reset(presets){var newInstance=new this.modelObject.constructor(presets);this.updateWith(newInstance,!0)}},{knockout:!1,"knockout.mapping":!1}],124:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem"),moment=require("moment"),numeral=require("numeral");function PerformanceSummary(values){Model(this);values=values||{};this.earnings=new Earnings(values.earnings);var earningsLine=new ListViewItem;earningsLine.markerLine1=ko.computed(function(){var num=numeral(this.currentAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine1=ko.computed(function(){return this.currentConcept()},this.earnings);earningsLine.markerLine2=ko.computed(function(){var num=numeral(this.nextAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine2=ko.computed(function(){return this.nextConcept()},this.earnings);this.timeBooked=new TimeBooked(values.timeBooked);var timeBookedLine=new ListViewItem;timeBookedLine.markerLine1=ko.computed(function(){var num=numeral(this.percent()).format("0%");return num},this.timeBooked);timeBookedLine.contentLine1=ko.computed(function(){return this.concept()},this.timeBooked);this.items=ko.pureComputed(function(){var items=[];items.push(earningsLine);items.push(timeBookedLine);return items},this)}module.exports=PerformanceSummary;function Earnings(values){Model(this);this.model.defProperties({currentAmount:0,currentConceptTemplate:"already paid this month",nextAmount:0,nextConceptTemplate:"projected {month} earnings"},values);this.currentConcept=ko.pureComputed(function(){var month=moment().format("MMMM");return this.currentConceptTemplate().replace(/\{month\}/,month)},this);this.nextConcept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.nextConceptTemplate().replace(/\{month\}/,month)},this)}function TimeBooked(values){Model(this);this.model.defProperties({percent:0,conceptTemplate:"of available time booked in {month}"},values);this.concept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.conceptTemplate().replace(/\{month\}/,month)},this)}},{"./ListViewItem":118,"./Model":123,knockout:!1,moment:!1,numeral:!1}],125:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),PricingSummaryDetail=require("./PricingSummaryDetail");module.exports=function PricingSummary(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceDurationMinutes:null,firstSessionDurationMinutes:null,subtotalPrice:null,feePrice:null,totalPrice:null,pFeePrice:null,subtotalRefunded:null,feeRefunded:null,totalRefunded:null,dateRefunded:null,createdDate:null,updatedDate:null,details:{Model:PricingSummaryDetail,isArray:!0}},values);this.servicesSummary=ko.computed(function(){return this.details().map(function(detail){return detail.serviceName()}).join(", ")},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}},{"./Model":123,"./PricingSummaryDetail":126,knockout:!1}],126:[function(require,module,exports){"use strict";var Model=require("./Model");function PricingSummaryDetail(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceProfessionalServiceID:0,serviceProfessionalDataInput:null,clientDataInput:null,hourlyPrice:null,price:null,serviceDurationMinutes:null,firstSessionDurationMinutes:null,serviceName:"",serviceDescription:null,numberOfSessions:1,createdDate:null,updatedDate:null},values)}module.exports=PricingSummaryDetail;PricingSummaryDetail.fromServiceProfessionalService=function(service){var allSessionMinutes=service.numberOfSessions()>0?service.serviceDurationMinutes()*service.numberOfSessions():service.serviceDurationMinutes();return new PricingSummaryDetail({serviceName:service.name(),serviceDescription:service.description(),numberOfSessions:service.numberOfSessions(),serviceDurationMinutes:allSessionMinutes,firstSessionDurationMinutes:service.serviceDurationMinutes(),price:service.price(),serviceProfessionalServiceID:service.serviceProfessionalServiceID(),hourlyPrice:"HOUR"===(service.priceRateUnit()||"").toUpperCase()?service.priceRate():null})}},{"./Model":123}],127:[function(require,module,exports){"use strict";var Model=require("./Model");function PricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,serviceProfessionalDescription:null,priceCalculation:null,isAddon:!1,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:!1,includeServiceAttributes:!1,includeSpecialPromotion:!1,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesClientMessage:null,withoutServiceAttributesServiceProfessionalMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID"])}module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":123}],128:[function(require,module,exports){"use strict";var Model=require("./Model");function PrivacySettings(values){Model(this);this.model.defProperties({userID:0,smsBookingCommunication:!1,phoneBookingCommunication:!1,loconomicsCommunityCommunication:!1,loconomicsDbmCampaigns:!1,profileSeoPermission:!1,loconomicsMarketingCampaigns:!1,coBrandedPartnerPermissions:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID"])}module.exports=PrivacySettings},{"./Model":123}],129:[function(require,module,exports){"use strict";var Model=require("./Model"),PublicUserProfile=require("./PublicUserProfile"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),ko=require("knockout");function PublicUser(values){Model(this);this.model.defProperties({profile:{Model:PublicUserProfile},rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},jobProfile:{Model:PublicUserJobTitle,isArray:!0},backgroundCheckPassed:null,selectedJobTitleID:null,isClientFavorite:!1},values);this.selectedJobTitle=ko.pureComputed(function(){var jid=this.selectedJobTitleID(),jp=this.jobProfile();if(!jid||!jp)return null;var found=null;jp.some(function(jobTitle){if(jobTitle.jobTitleID()===jid){found=jobTitle;return!0}});return found},this);this.backgroundCheckLabel=ko.pureComputed(function(){var v=this.backgroundCheckPassed();return v===!0?"OK":v===!1?"FAILED":""},this)}module.exports=PublicUser},{"./Model":123,"./PublicUserJobTitle":130,"./PublicUserProfile":131,"./PublicUserRating":132,"./PublicUserVerificationsSummary":134,knockout:!1}],130:[function(require,module,exports){"use strict";var Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary");function PublicUserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,cancellationPolicyID:0,instantBooking:!1,jobTitleSingularName:"",jobTitlePluralName:"",
rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary}},values);this.model.defID(["userID","jobTitleID"])}module.exports=PublicUserJobTitle},{"./Model":123,"./PublicUserRating":132,"./PublicUserVerificationsSummary":134}],131:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout");function PublicUserProfile(values){Model(this);this.model.defProperties({userID:0,firstName:0,lastName:0,secondLastName:0,businessName:0,publicBio:0,serviceProfessionalProfileUrlSlug:null,serviceProfessionalWebsiteUrl:null,photoUrl:null,email:null,phone:null,isServiceProfessional:!1,isClient:!1,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this)}module.exports=PublicUserProfile},{"./Model":123,knockout:!1}],132:[function(require,module,exports){"use strict";var Model=require("./Model");function PublicUserRating(values){Model(this);this.model.defProperties({rating1:0,rating2:0,rating3:0,ratingAverage:0,totalRatings:0,serviceHours:0,lastRatingDate:null},values)}module.exports=PublicUserRating},{"./Model":123}],133:[function(require,module,exports){"use strict";var Model=require("./Model");function PublicUserVerificationsGroup(values){Model(this);this.model.defProperties({verificationsCount:0,groupName:"",groupID:""},values)}module.exports=PublicUserVerificationsGroup},{"./Model":123}],134:[function(require,module,exports){"use strict";var Model=require("./Model"),PublicUserVerificationsGroup=require("./PublicUserVerificationsGroup");function PublicUserVerificationsSummary(values){Model(this);this.model.defProperties({total:0,groups:PublicUserVerificationsGroup},values)}module.exports=PublicUserVerificationsSummary},{"./Model":123,"./PublicUserVerificationsGroup":133}],135:[function(require,module,exports){"use strict";var Model=require("./Model");function SchedulingPreferences(values){Model(this);this.model.defProperties({advanceTime:24,betweenTime:0,incrementsSizeInMinutes:15},values)}module.exports=SchedulingPreferences},{"./Model":123}],136:[function(require,module,exports){"use strict";var Model=require("./Model");function ServiceAttribute(values){Model(this);this.model.defProperties({serviceAttributeID:0,name:"",description:null},values)}module.exports=ServiceAttribute},{"./Model":123}],137:[function(require,module,exports){"use strict";var Model=require("./Model"),ServiceAttribute=require("./ServiceAttribute");function ServiceAttributeCategory(values){Model(this);this.model.defProperties({serviceAttributeCategoryID:0,name:"",description:null,requiredInput:!1,eligibleForPackages:!1,serviceAttributes:{isArray:!0,Model:ServiceAttribute}},values)}module.exports=ServiceAttributeCategory},{"./Model":123,"./ServiceAttribute":136}],138:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),numeral=require("numeral");function ServiceProfessionalService(values){Model(this);this.model.defProperties({serviceProfessionalServiceID:0,serviceProfessionalUserID:0,jobTitleID:0,pricingTypeID:0,name:"",description:null,price:null,serviceDurationMinutes:null,firstTimeClientsOnly:!1,numberOfSessions:1,priceRate:null,priceRateUnit:"hour",noPriceRate:!1,isPhone:!1,serviceAttributes:[],createdDate:null,updatedDate:null},values);this.model.defID(["serviceProfessionalServiceID"]);this.noPriceRate.subscribe(function(enabled){enabled===!0&&this.priceRate(null)},this);this.refreshNoPriceRate=function refreshNoPriceRate(){if(this.serviceProfessionalServiceID()&&(0|this.priceRate())<=0){var ts=this.model.dataTimestamp();this.noPriceRate(!0);this.model.dataTimestamp(ts)}};var is=require("is_js");this.durationHoursPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)/60|0},write:function(hours){var minutes=0|this.durationMinutesPart();hours=parseInt(hours,10);is.not.number(hours)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*(0|hours)+minutes)},owner:this});this.durationMinutesPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)%60},write:function(minutes){var hours=0|this.durationHoursPart();minutes=parseInt(minutes,10);is.not.number(minutes)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*hours+(0|minutes))},owner:this});this.durationText=ko.pureComputed(function(){var minutes=this.serviceDurationMinutes()||0;return minutes?numeral(minutes).format("0,0")+" minutes":""},this);this.sessionsAndDuration=ko.pureComputed(function(){var sessions=this.numberOfSessions(),dur=this.durationText();return sessions>1?sessions+" sessions, "+dur:dur},this);this.displayedPrice=ko.pureComputed(function(){var price=this.price(),rate=this.priceRate(),unit=this.priceRateUnit(),result=price||rate;result=numeral(result).format("$0,0");!price&&rate&&unit&&(result+="/"+unit);return result},this)}module.exports=ServiceProfessionalService},{"./Model":123,is_js:!1,knockout:!1,numeral:!1}],139:[function(require,module,exports){"use strict";var ko=require("knockout"),moment=require("moment-timezone"),Model=require("./Model"),WeekDaySchedule=require("./WeekDaySchedule");function detectLocalTimezone(){var year=(new Date).getFullYear(),winter=new Date(year,1,1),winOff=winter.getTimezoneOffset(),summer=new Date(year,6,1),sumOff=summer.getTimezoneOffset(),found=null;moment.tz.names().some(function(tz){var zone=moment.tz.zone(tz);if(zone.offset(winter)===winOff&&zone.offset(summer)===sumOff){found=zone;return!0}});return found}function SimplifiedWeeklySchedule(values){Model(this);this.model.defProperties({sunday:new WeekDaySchedule,monday:new WeekDaySchedule,tuesday:new WeekDaySchedule,wednesday:new WeekDaySchedule,thursday:new WeekDaySchedule,friday:new WeekDaySchedule,saturday:new WeekDaySchedule,isAllTime:!1,timeZone:""},values);this.weekDays=[this.sunday,this.monday,this.tuesday,this.wednesday,this.thursday,this.friday,this.saturday];this.timeZoneDisplayName=ko.computed(function(){var tzid=this.timeZone(),tz=moment.tz(tzid),name=tz.tz();if(!name){var localtz=detectLocalTimezone();localtz&&(tz=moment.tz(localtz.name));tz&&(name=tz.tz());name&&setTimeout(function(){this.timeZone(name)}.bind(this),1)}return name?name:""},this)}module.exports=SimplifiedWeeklySchedule},{"./Model":123,"./WeekDaySchedule":150,knockout:!1,"moment-timezone":!1}],140:[function(require,module,exports){"use strict";var Model=require("./Model"),Message=require("./Message");function Thread(values){Model(this);this.model.defProperties({threadID:0,clientUserID:null,serviceProfessionalUserID:null,jobTitleID:null,statusID:null,subject:null,messages:{isArray:!0,Model:Message},createdDate:null,updatedDate:null},values)}module.exports=Thread},{"./Message":121,"./Model":123}],141:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary");function UpcomingBookingsSummary(){Model(this);this.today=new BookingSummary({concept:"more today",timeFormat:" [ending @] h:mma"});this.tomorrow=new BookingSummary({concept:"tomorrow",timeFormat:" [starting @] h:mma"});this.nextWeek=new BookingSummary({concept:"next week",timeFormat:null});this.items=ko.pureComputed(function(){var items=[];items.push(this.today);items.push(this.tomorrow);items.push(this.nextWeek);return items},this)}module.exports=UpcomingBookingsSummary},{"./BookingSummary":105,"./Model":123,knockout:!1}],142:[function(require,module,exports){"use strict";var ko=require("knockout"),Model=require("./Model"),UserType={none:0,anonymous:1,client:2,serviceProfessional:4,member:12,admin:16,loggedUser:30,user:31,system:32};function User(values){Model(this);this.model.defProperties({userID:0,email:"",firstName:"",lastName:"",secondLastName:"",businessName:"",alternativeEmail:"",phone:"",canReceiveSms:"",birthMonthDay:null,birthMonth:null,isServiceProfessional:!1,isClient:!1,isMember:!1,isAdmin:!1,photoUrl:null,onboardingStep:null,accountStatusID:0,createdDate:null,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this);this.userType=ko.pureComputed({read:function(){var c=this.isClient(),p=this.isServiceProfessional(),a=this.isAdmin(),userType=0;this.isAnonymous()&&(userType|=UserType.anonymous);c&&(userType|=UserType.client);p&&(userType|=UserType.serviceProfessional);a&&(userType|=UserType.admin);return userType},owner:this});this.isAnonymous=ko.pureComputed(function(){return this.userID()<1},this);this.isUserType=function isUserType(type){return this.userType()&type}.bind(this)}module.exports=User;User.UserType=UserType;User.newAnonymous=function newAnonymous(){return new User({userID:0,email:"",firstName:"",onboardingStep:null})}},{"./Model":123,knockout:!1}],143:[function(require,module,exports){"use strict";var Model=require("./Model");function UserEducation(values){Model(this);this.model.defProperties({educationID:0,userID:0,institutionName:"",degreeCertificate:"",fieldOfStudy:"",fromYearAttended:null,toYearAttended:null},values)}module.exports=UserEducation},{"./Model":123}],144:[function(require,module,exports){"use strict";var Model=require("./Model");function UserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID","jobTitleID"])}module.exports=UserJobTitle;UserJobTitle.status={on:1,incomplete:2,off:3}},{"./Model":123}],145:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout");function extendValuesByCategory(obs){obs.notifyChanges=obs.valueHasMutated;obs.serviceAttributeCategoriesIDs=ko.pureComputed(function(){return Object.keys(obs()||{}).filter(function(key){return 0===(0|key)})});var catsObs={};obs.getServiceCategoryAttributes=function(catID){var catObs=catsObs[catID]=catsObs[catID]||ko.observable({});return ko.computed(function(){var base=obs.peek();catObs();return base&&base[catID]||[]})};var prevValue=obs();obs.subscribe(function(v){if(v!==prevValue){prevValue=v;Object.keys(catsObs).forEach(function(a){a.valueHasMutated&&a.valueHasMutated()})}});obs.push=function(catID,attID){var v=obs();if(v){var cat=v[catID]||(v[catID]=[]);if(-1===cat.indexOf(attID)){cat.push(attID);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}else{v={};v[catID]=[attID];obs(v);catsObs[catID]&&catsObs[catID].valueHasMutated()}};obs.remove=function(catID,attID){var v=obs(),cat=v&&v[catID];if(cat){var i=cat.indexOf(attID);if(i>-1){cat.splice(i,1);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}}}function UserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{},proposedServiceAttributes:{},experienceLevelID:!1,languageID:0,countryID:0},values);extendValuesByCategory(this.serviceAttributes);extendValuesByCategory(this.proposedServiceAttributes)}module.exports=UserJobTitleServiceAttributes},{"./Model":123,knockout:!1}],146:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout");function UserLicenseCertification(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,statusID:0,licenseCertificationID:0,licenseCertificationUrl:"",licenseCertificationNumber:0,licenseCertificationStatus:0,expirationDate:null,issueDate:null,countryID:0,stateProvinceID:0,countyID:0,city:"",firstName:null,lastName:null,middleInitial:null,secondLastName:null,businessName:null,actions:null,comments:null,verifiedBy:null,lastVerifiedDate:null,createdDate:null,updatedDate:null},values);this.model.defID(["userID","jobTitleID","licenseCertificationID"]);this.countyName=ko.pureComputed(function(){return"Alameda"},this);this.stateProvinceName=ko.pureComputed(function(){return"California"},this);this.stateProvinceCode=ko.pureComputed(function(){return"CA"},this)}module.exports=UserLicenseCertification},{"./Model":123,knockout:!1}],147:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),Verification=require("./Verification");function UserVerification(values){Model(this);this.model.defProperties({userID:0,verificationID:0,jobTitleID:0,lastVerifiedDate:null,statusID:0,verification:{Model:Verification}},values);var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"};this.statusText=ko.pureComputed(function(){var statusName=Verification.getStatusName(this.statusID());return statusTextsenUS["verification.status."+statusName]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}module.exports=UserVerification},{"./Model":123,"./Verification":148,knockout:!1}],148:[function(require,module,exports){"use strict";var Model=require("./Model");function Verification(values){Model(this);this.model.defProperties({verificationID:0,name:"",description:null,icon:null,summaryGroup:null},values)}Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}Verification.getStatusName=function getStatusName(value){return enumGetName(value,Verification.status)};module.exports=Verification},{"./Model":123}],149:[function(require,module,exports){"use strict";module.exports={general:0,nps:1,signup:2,calendar:3,inbox:4,scheduling:5,cms:6,payments:7,performance:8,marketplaceProfile:9,mobileFriendly:10,desktopFriendly:11,coopBenefits:12,coopFee:13,senseOfCommunity:14,clientServiceAgents:15,helpPages:16}},{}],150:[function(require,module,exports){"use strict";var Model=require("./Model"),moment=require("moment"),ko=require("knockout");function WeekDaySchedule(values){Model(this);this.model.defProperties({from:0,to:0},values);this.isEnabled=ko.computed({read:function(){return"number"==typeof this.from()&&"number"==typeof this.to()&&this.from()<this.to()},write:function(val){if(val===!0){this.fromHour(9);this.toHour(17)}else{this.toHour(0);this.from(0)}},owner:this}).extend({rateLimit:0});this.isAllDay=ko.computed({read:function(){return 0===this.from()&&1440===this.to()},write:function(){this.from(0);this.to(1440)},owner:this}).extend({rateLimit:0});this.fromHour=ko.computed({read:function(){return Math.floor(this.from()/60)},write:function(hours){this.from(60*hours|0)},owner:this});this.toHour=ko.computed({read:function(){return Math.ceil(this.to()/60)},write:function(hours){this.to(60*hours|0)},owner:this});this.fromTime=ko.computed({read:function(){return minutesToTimeString(0|this.from())},write:function(time){this.from(timeStringToMinutes(time))},owner:this});this.toTime=ko.computed({read:function(){return minutesToTimeString(0|this.to())},write:function(time){this.to(timeStringToMinutes(time))},owner:this})}module.exports=WeekDaySchedule;function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}function timeStringToMinutes(time){return 0|moment.duration(time).asMinutes()}},{"./Model":123,knockout:!1,moment:!1}],151:[function(require,module,exports){"use strict";var moment=require("moment");function CacheControl(options){options=options||{};this.ttl=moment.duration(options.ttl).asMilliseconds();this.latest=options.latest||null;this.mustRevalidate=function mustRevalidate(){var tdiff=this.latest&&new Date-this.latest||Number.POSITIVE_INFINITY;return tdiff>this.ttl};this.touch=function touch(){this.latest=new Date}}module.exports=CacheControl},{moment:!1}],152:[function(require,module,exports){"use strict";var moment=require("moment"),CacheControl=require("./CacheControl");module.exports=function DateCache(settings){this.Model=settings&&settings.Model||null;this.ttl=settings&&settings.ttl||{minutes:1};this.byDate={};this.clear=function(){this.byDate={}};this.getSingle=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));return this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?this.byDate[dateKey].data:null};this.remove=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));delete this.byDate[dateKey]};this.get=function(start,end){for(var date=new Date(start),resultsPerDate={},holes=[],minRequest=null,maxRequest=null;end>=date;){var dateKey=moment(date).format("YYYY-MM-DD");this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?resultsPerDate[dateKey]=this.byDate[dateKey].data:holes.push(new Date(date));date.setDate(date.getDate()+1)}holes.sort(function(a,b){return a===b?0:b>a?-1:1});minRequest=holes.length?holes[0]:null;maxRequest=holes.length?holes[holes.length-1]:null;return{byDate:resultsPerDate,holes:holes,minHole:minRequest,maxHole:maxRequest}};this.set=function(date,data){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));var c=this.byDate[dateKey];if(c&&c.data)this.Model?c.data.model.updateWith(data):c.data=data;else{c={data:this.Model?new this.Model(data):data,control:new CacheControl({ttl:this.ttl})};this.byDate[dateKey]=c}c.control.touch();return c}}},{"./CacheControl":151,moment:!1}],153:[function(require,module,exports){Function.prototype._delayed=function delayed(milliseconds){var fn=this;return function(){var context=this,args=arguments;setTimeout(function(){fn.apply(context,args)},milliseconds)}}},{}],154:[function(require,module,exports){Function.prototype._inherits=function _inherits(superCtor){this.prototype=Object.create(superCtor.prototype,{constructor:{value:this,enumerable:!1,writable:!0,configurable:!0}})}},{}],155:[function(require,module,exports){"use strict";(function f(){}).name||Object.defineProperty(Function.prototype,"name",{get:function(){var name=this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1];Object.defineProperty(this,"name",{value:name});return name}})},{}],156:[function(require,module,exports){"use strict";var ko=require("knockout"),IndexedGroupListCache=require("./IndexedGroupListCache");function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupListRemoteModel(settings){settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedGroupListCache({listTtl:settings.listTtl,groupIdField:settings.groupIdField,itemIdField:settings.itemIdField});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);function notImplemented(){throw new Error("Not Implemented")}this.fetchGroupFromLocal=notImplemented;this.fetchGroupFromRemote=notImplemented;this.pushGroupToLocal=notImplemented;this.pushGroupToRemote=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getList=function getList(groupID){var cacheEntry=cache.getGroupCache(groupID);if(cacheEntry.control.mustRevalidate()){if(cacheEntry.list){api.state.isSyncing(!0);return this.fetchGroupFromRemote(groupID).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);api.state.isSyncing(!1);return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}api.state.isLoading(!0);return this.fetchGroupFromLocal(groupID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchGroupFromRemote(groupID).then(function(serverData){cache.setGroupCache(groupID,serverData);this.pushGroupToLocal(groupID,serverData);api.state.isSyncing(!1);return serverData}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}return Promise.resolve(cacheEntry.list)};api.getItem=function getItem(groupID,itemID){return api.getList(groupID).then(function(){var cacheItem=cache.getItemCache(groupID,itemID);if(!cacheItem){console.warn("GroupListRemoteModel Not found",groupID,itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushGroupToRemote(data).then(function(serverData){if(serverData){var groupID=serverData[settings.groupIdField];cache.setItemCache(groupID,serverData[settings.itemIdField],serverData);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list)}api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);return err})};api.delItem=function delItem(groupID,itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(groupID,itemID).then(function(removedData){cache.delItemCache(groupID,itemID);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);return err})};api.getObservableItem=function getObservableItem(groupID,itemID,asModel){var firstValue=cache.getItemCache(groupID,itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(asModel?api.asModel(firstValue):firstValue);obs.sync=function syncObservableItem(){return api.getItem(groupID,itemID).then(function(item){asModel?obs().model.updateWith(item):obs(item)})};firstValue||obs.sync();return obs};api.asModel=function asModel(object){var Model=this.settings.Model;return Array.isArray(object)?object.map(function(item){return new Model(item)}):new Model(object)};api.getItemModel=function getItemModel(groupID,itemID){return api.getItem(groupID,itemID).then(function(data){return data?api.asModel(data):null})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(groupID,itemID){return api.getItemModel(groupID,itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItemVersion=function newItemVersion(values){var version=new ModelVersion(new this.settings.Model(values));version.version.model.touch();return version}}module.exports=GroupListRemoteModel;GroupListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchGroupFromLocal=function fetchFromLocal(groupID){return localforage.getItem(baseName+groupID)};this.pushGroupToLocal=function pushToLocal(groupID,data){return localforage.setItem(baseName+groupID,data)}};GroupListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchGroupFromRemote=function fetchFromRemote(groupID){return restClient.get(baseUrl+groupID)};this.pushGroupToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],method=data[this.settings.itemIdField]?"put":"post",url=baseUrl+groupID+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(groupID,itemID){return restClient["delete"](baseUrl+groupID+"/"+itemID)}}},{"../utils/ModelVersion":161,"./IndexedGroupListCache":158,knockout:!1,localforage:!1}],157:[function(require,module,exports){"use strict";var ko=require("knockout"),CacheControl=require("./CacheControl");function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupRemoteModel(settings){settings=settings||{};settings.ttl=required(settings.ttl,"ttl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=required(settings.Model,"Model is required");this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache={},setItemCache=function(itemID,data){if(cache[itemID]){cache[itemID].data.model.updateWith(data);cache[itemID].control.touch()}else cache[itemID]={data:new settings.Model(data),control:new CacheControl({ttl:settings.ttl})};return cache[itemID]};this.clearCache=function(){cache={}};this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);function notImplemented(){throw new Error("Not Implemented")}this.fetchItemFromLocal=notImplemented;this.fetchItemFromRemote=notImplemented;this.pushItemToLocal=notImplemented;this.pushItemToRemote=notImplemented;this.removeItemFromLocal=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getItem=function getItem(itemID,forceRemoteLoad){var cacheEntry=cache[itemID];if(forceRemoteLoad||!cacheEntry||cacheEntry.control.mustRevalidate()){if(cacheEntry&&cacheEntry.data){api.state.isSyncing(!0);return this.fetchItemFromRemote(itemID).then(function(data){var cached=setItemCache(itemID,data);this.pushItemToLocal(itemID,data);api.state.isLoading(!1);api.state.isSyncing(!1);return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}api.state.isLoading(!0);return this.fetchItemFromLocal(itemID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchItemFromRemote(itemID).then(function(serverData){var cached=setItemCache(itemID,serverData);this.pushItemToLocal(itemID,serverData);api.state.isSyncing(!1);return cached.data}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){var cached=setItemCache(itemID,data);api.state.isLoading(!1);return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}return Promise.resolve(cacheEntry.data)};api.setItem=function setItem(data){data=data&&data.model&&data.model.toPlainObject(!0)||data;api.state.isSaving(!0);return this.pushItemToRemote(data[settings.itemIdField],data).then(function(serverData){var cached;if(serverData){var itemID=serverData[settings.itemIdField];cached=setItemCache(serverData[settings.itemIdField],serverData);this.pushItemToLocal(itemID,cached.data.model.toPlainObject(!0))}api.state.isSaving(!1);return cached&&cached.data}.bind(this))["catch"](function(err){api.state.isSaving(!1);return err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){delete cache[itemID];this.removeItemFromLocal(itemID);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);return err})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(itemID){var cached=cache[itemID],initialModel=cached&&cached.data||new settings.Model,version=new ModelVersion(initialModel);version.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),lastError:ko.observable(null)};if(itemID&&(!cached||cached.mustRevalidate())){version.state.isLoading(!0);api.getItem(itemID).then(function(model){version.state.lastError(null);version.state.isLoading(!1);version.original.model.updateWith(model,!0);version.version.model.updateWith(model,!0)})["catch"](function(err){version.state.lastError(err);version.state.isLoading(!1)})}version.load=function load(newItemID,forceRemoteLoad){version.state.isSyncing(!0);var oItemID=newItemID||version.original[settings.itemIdField]();return api.getItem(oItemID,forceRemoteLoad).then(function(model){version.state.lastError(null);version.state.isSyncing(!1);version.original.model.updateWith(model,!0);version.pull({eventIfNewer:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSyncing(!1);throw err})};version.reset=function reset(){version.original.model.reset();version.version.model.reset()};version.save=function save(){version.state.isSaving(!0);return api.setItem(version.version).then(function(model){version.state.lastError(null);version.state.isSaving(!1);version.version.model.updateWith(model,!0);version.push({evenIfObsolete:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSaving(!1);throw err})};return version};api.newItemVersion=function newItemVersion(values){var version=api.getItemVersion();values&&version.version.model.updateWith(values,!0);version.version.model.touch();return version}}module.exports=GroupRemoteModel;GroupRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchItemFromLocal=function fetchFromLocal(itemID){return localforage.getItem(baseName+itemID)};this.pushItemToLocal=function pushToLocal(itemID,data){return localforage.setItem(baseName+itemID,data)};this.remoteItemFromLocal=function remoteFromLocal(itemID){return localforage.removeItem(baseName+itemID)}};GroupRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchItemFromRemote=function fetchFromRemote(itemID){return restClient.get(baseUrl+itemID)};this.pushItemToRemote=function pushToRemote(itemID,data){var method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+itemID)}}},{"../utils/ModelVersion":161,"./CacheControl":151,knockout:!1,localforage:!1}],158:[function(require,module,exports){"use strict";var CacheControl=require("./CacheControl");function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[item[byField]]={index:itemIndex,item:item}});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function IndexedGroupListCache(settings){settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");var cache={};this.clearCache=function clearCache(){cache={}};function newCacheEntry(list){return{control:new CacheControl({ttl:settings.listTtl}),list:list||null,index:list&&createIndex(list,settings.itemIdField)||{}}}function setGroupCache(groupID,list){var cacheEntry=cache[groupID];if(cacheEntry){cacheEntry.list=list||[];cacheEntry.index=createIndex(list||[],settings.itemIdField)}else cacheEntry=cache[groupID]=newCacheEntry(list);cacheEntry.control.latest=new Date}this.setGroupCache=setGroupCache;function getGroupCache(groupID){var cacheEntry=cache[groupID];return cacheEntry||newCacheEntry()}this.getGroupCache=getGroupCache;function getItemCache(groupID,itemID){var cacheEntry=cache[groupID];return cacheEntry?cacheEntry.index[itemID]||null:null}this.getItemCache=getItemCache;function setItemCache(groupID,itemID,item){var cacheEntry=cache[groupID]||newCacheEntry([]),itemEntry=cacheEntry.index[itemID];
if(itemEntry){cacheEntry.list[itemEntry.index]=item;itemEntry.item=item}else{var itemIndex=cacheEntry.list.push(item)-1;cacheEntry.index[itemID]={index:itemIndex,item:item}}}this.setItemCache=setItemCache;function delItemCache(groupID,itemID){var groupEntry=cache[groupID]||null;if(groupEntry){var itemEntry=groupEntry.index[itemID];if(itemEntry){groupEntry.list.splice(itemEntry.index,1);delete groupEntry.index[itemID];Object.keys(groupEntry.index).forEach(function(key){groupEntry.index[key].index>itemEntry.index&&groupEntry.index[key].index--})}}}this.delItemCache=delItemCache;function delGroupCache(groupID){var groupEntry=cache[groupID]||null;groupEntry&&delete cache[groupID]}this.delGroupCache=delGroupCache}module.exports=IndexedGroupListCache},{"./CacheControl":151}],159:[function(require,module,exports){"use strict";var CacheControl=require("./CacheControl"),jsPropertiesTools=require("./jsPropertiesTools"),ko=require("knockout");function createItemIndexEntry(list,itemIndex){return{index:itemIndex,get item(){return list[this.index]}}}function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[ko.unwrap(item[byField])]=createItemIndexEntry(list,itemIndex)});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function defaultItemAdapter(oldItem,newItem){return newItem}function IndexedListCache(settings){settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.itemAdapter="function"==typeof settings.itemAdapter?settings.itemAdapter:defaultItemAdapter;var unused=!0,cache={control:new CacheControl({ttl:settings.listTtl}),list:ko.observableArray([]),index:{}};this.clearCache=function clearCache(){cache.control.latest=null;cache.list([]);cache.index={};unused=!0};function getItemCache(itemID){return cache.index[itemID]||null}this.getItemCache=getItemCache;function adaptItem(newItem){var oldItem=getItemCache(ko.unwrap(newItem[settings.itemIdField]));return settings.itemAdapter(oldItem,newItem)}function adaptList(list){return(list||[]).map(adaptItem)}function setList(list){cache.list(adaptList(list));cache.index=createIndex(cache.list(),settings.itemIdField);cache.control.latest=new Date;unused=!1}jsPropertiesTools.defineGetter(this,"control",function(){return cache.control});jsPropertiesTools.defineGetter(this,"list",function(){return cache.list});jsPropertiesTools.defineSetter(this,"list",function(list){return setList(list)});jsPropertiesTools.defineGetter(this,"index",function(){return cache.index});jsPropertiesTools.defineGetter(this,"unused",function(){return unused});function setItemCache(item){var itemID=ko.unwrap(item[settings.itemIdField]),itemEntry=cache.index[itemID];if(itemEntry)cache.list()[itemEntry.index]=adaptItem(item);else{var itemIndex=cache.list.push(adaptItem(item))-1;cache.index[itemID]=createItemIndexEntry(cache.list(),itemIndex)}}this.setItemCache=setItemCache;function delItemCache(itemID){var itemEntry=cache.index[itemID];if(itemEntry){cache.list.splice(itemEntry.index,1);delete cache.index[itemID];Object.keys(cache.index).forEach(function(key){cache.index[key].index>itemEntry.index&&cache.index[key].index--})}}this.delItemCache=delItemCache}module.exports=IndexedListCache},{"./CacheControl":151,"./jsPropertiesTools":179,knockout:!1}],160:[function(require,module,exports){"use strict";var ko=require("knockout"),IndexedListCache=require("./IndexedListCache");function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function ListRemoteModel(settings){settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};function itemAdapter(oldItem,newItem){if(settings.Model){if(oldItem&&oldItem instanceof settings.Model){oldItem.model.updateWith(newItem);return oldItem}return new settings.Model(newItem)}return newItem}var cache=new IndexedListCache({listTtl:settings.listTtl,itemIdField:settings.itemIdField,itemAdapter:itemAdapter});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);function notImplemented(){throw new Error("Not Implemented")}this.fetchListFromLocal=notImplemented;this.fetchListFromRemote=notImplemented;this.pushListToLocal=notImplemented;this.pushListToRemote=notImplemented;this.removeItemFromRemote=notImplemented;function getPlainCachedList(){var arr=cache.list();return arr.map(function(item){return item&&settings.Model&&item instanceof settings.Model?item.model.toPlainObject():item})}var api=this;api.list=cache.list;api.sync=function sync(){return api.getList()};api.getList=function getList(){if(cache.control.mustRevalidate()){if(cache.unused){api.state.isLoading(!0);return this.fetchListFromLocal().then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchListFromRemote().then(function(serverData){cache.list=serverData;this.pushListToLocal(serverData);api.state.isSyncing(!1);return serverData}.bind(this))["catch"](function(err){if(!data)return err;api.state.isSyncing(!1);console.error("ListRemoteModel: remote synchronization failed",err)});return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}api.state.isSyncing(!0);return this.fetchListFromRemote().then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);api.state.isSyncing(!1);return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);return err})}return Promise.resolve(cache.list)};api.getItem=function getItem(itemID){return api.getList().then(function(){var cacheItem=cache.getItemCache(itemID);if(!cacheItem){console.warn("ListRemoteModel Not found",itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api.getObservableItem=function getObservableItem(itemID){var firstValue=cache.getItemCache(itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(firstValue);obs.sync=function syncObservableItem(){return api.getItem(itemID).then(function(itemModel){obs(itemModel)})};firstValue||obs.sync();return obs};api.createWildcardItem=function createWildcardItem(){var hasID=function(id){return null!==id&&"undefined"!=typeof id},obs=ko.observable(void 0),lastID;obs.sync=function syncObservableItem(itemID){var idChanged=hasID(itemID)&&itemID!==lastID;lastID=hasID(itemID)?itemID:lastID;if(idChanged){var cachedItem=cache.getItemCache(lastID);cachedItem&&cachedItem.item&&obs(cachedItem.item)}return api.getItem(lastID).then(function(itemModel){obs(itemModel);return itemModel})};obs.newItem=function newItem(defaults){obs(settings.Model?new settings.Model(defaults):defaults||{})};return obs};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushListToRemote(data).then(function(serverData){if(serverData){cache.setItemCache(serverData);this.pushListToLocal(getPlainCachedList())}api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);return err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){cache.delItemCache(itemID);this.pushListToLocal(getPlainCachedList());api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);return err})};var ModelVersion=require("../utils/ModelVersion");api.createItemVersion=function createItemVersion(itemID){return api.getItem(itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItem=function newItem(values){var version=new ModelVersion(new settings.Model(values));version.version.model.touch();return version}}module.exports=ListRemoteModel;ListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchListFromLocal=function fetchListFromLocal(){return localforage.getItem(baseName)};this.pushListToLocal=function pushListToLocal(data){return localforage.setItem(baseName,data)}};ListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchListFromRemote=function fetchListFromRemote(){return restClient.get(baseUrl)};this.pushListToRemote=function pushListToRemote(data){var itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+"/"+itemID)}};ListRemoteModel.prototype.addMockedRemote=function addMockedRemote(dataList){this.fetchListFromRemote=function fetchListFromRemote(){return Promise.resolve(dataList)};this.pushListToRemote=function pushListToRemote(data){return Promise.resolve(data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return Promise.resolve(itemID)}}},{"../utils/ModelVersion":161,"./IndexedListCache":159,knockout:!1,localforage:!1}],161:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter;function ModelVersion(original){EventEmitter.call(this);this.original=original;this.version=original.model.clone(null,!0);this.areDifferent=ko.pureComputed(function areDifferent(){return this.original.model.dataTimestamp()!==this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isNewer=ko.pureComputed(function isNewer(){return this.original.model.dataTimestamp()<this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isObsolete=ko.pureComputed(function isComputed(){return this.original.model.dataTimestamp()>this.version.model.dataTimestamp()},this).extend({rateLimit:0})}module.exports=ModelVersion;ModelVersion._inherits(EventEmitter);ModelVersion.prototype.getRollback=function getRollback(from){if("version"===from)return createRollbackFunction(this.version);if("original"===from)return createRollbackFunction(this.original);throw new Error("from value not valid")};ModelVersion.prototype.pull=function pull(options){options=options||{};var result=!1,rollback=null;if(options.evenIfNewer||!this.isNewer()){rollback=createRollbackFunction(this.version);this.version.model.updateWith(this.original,!0);result=!0}this.emit("pull",result,rollback);return result};ModelVersion.prototype.push=function push(options){options=options||{};var result=!1,rollback=null;if(options.evenIfObsolete||!this.isObsolete()){rollback=createRollbackFunction(this.original);this.original.model.updateWith(this.version,!0);result=!0}this.emit("push",result,rollback);return result};ModelVersion.prototype.sync=function sync(){return this.isNewer()?this.push():this.isObsolete()?this.pull():!1};function createRollbackFunction(modelInstance){var backedData=modelInstance.model.toPlainObject(!0),backedTimestamp=modelInstance.model.dataTimestamp();return function rollback(){modelInstance.model.updateWith(backedData,!0);modelInstance.model.dataTimestamp(backedTimestamp)}}},{events:!1,knockout:!1}],162:[function(require,module,exports){"use strict";var ModelVersion=require("../utils/ModelVersion"),CacheControl=require("../utils/CacheControl"),ko=require("knockout"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;function RemoteModel(options){EventEmitter.call(this);options=options||{};var firstTimeLoad=!0;this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isSyncing=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);if(!options.data)throw new Error("RemoteModel data must be set on constructor and no changed later");this.data=options.data;this.cache=new CacheControl({ttl:options.ttl});this.clearCache=function clearCache(){this.cache.latest=null;this.data.model.reset()};this.localStorageName=options.localStorageName||null;this.getData=function getData(){this.load();return this.data};this.newVersion=function newVersion(){var v=new ModelVersion(this.data);this.isLoading.subscribe(function(isIt){isIt||v.pull({evenIfNewer:!0})});v.pushSave=function pushSave(){var rollback=v.getRollback("original");v.push({evenIfObsolete:!0});return this.save().then(function(){v.pull({evenIfNewer:!0})})["catch"](function(error){rollback();return error})}.bind(this);return v};this.fetch=options.fetch||function fetch(){throw new Error("Not implemented")};this.push=options.push||function push(){throw new Error("Not implementd")};var loadFromRemote=function loadFromRemote(){return this.fetch().then(function(serverData){if(!serverData)throw new Error('Remote model did not returned data, response must be a "Not Found"');this.data.model.updateWith(serverData,!0);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.isLoading()?this.emit("loaded",serverData):this.emit("synced",serverData);this.isLoading(!1);this.isSyncing(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){var wasLoad=this.isLoading();this.isLoading(!1);this.isSyncing(!1);var errPkg={task:wasLoad?"load":"sync",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);return err}.bind(this))}.bind(this);this.load=function load(){if(this.cache.mustRevalidate()){firstTimeLoad?this.isLoading(!0):this.isSyncing(!0);var promise=null;promise=firstTimeLoad&&this.localStorageName?localforage.getItem(this.localStorageName).then(function(localData){if(localData){this.data.model.updateWith(localData,!0);this.isLoading(!1);this.isSyncing(!1);loadFromRemote()["catch"](function(){});return this.data}return loadFromRemote()}.bind(this)):loadFromRemote();if(firstTimeLoad){firstTimeLoad=!1;return promise}promise["catch"](function(){});return Promise.resolve(this.data)}return Promise.resolve(this.data)};this.save=function save(){this.isSaving(!0);var ts=this.data.model.dataTimestamp();return this.push().then(function(serverData){this.data.model.updateWith(serverData,!0);this.data.model.dataTimestamp(ts);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.emit("saved",serverData);this.isSaving(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){this.isSaving(!1);var errPkg={task:"save",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);return err}.bind(this))};this.sync=function sync(){this.load()["catch"](function(){})}}module.exports=RemoteModel;RemoteModel._inherits(EventEmitter)},{"../utils/CacheControl":151,"../utils/ModelVersion":161,events:!1,knockout:!1,localforage:!1}],163:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery.ajaxQueue");function lowerFirstLetter(n){return n&&n[0]&&n[0].toLowerCase&&n[0].toLowerCase()+n.slice(1)||n}function lowerCamelizeObject(obj){if(!obj||"object"!=typeof obj)return obj;var ret=Array.isArray(obj)?[]:{};for(var k in obj)if(obj.hasOwnProperty(k)){var newk=lowerFirstLetter(k);ret[newk]="object"==typeof obj[k]?lowerCamelizeObject(obj[k]):obj[k]}return ret}function Rest(optionsOrUrl){var url="string"==typeof optionsOrUrl?optionsOrUrl:optionsOrUrl&&optionsOrUrl.url;this.baseUrl=url;this.extraHeaders=null}Rest.prototype.get=function get(apiUrl,data){return this.request(apiUrl,"get",data)};Rest.prototype.put=function get(apiUrl,data){return this.request(apiUrl,"put",data)};Rest.prototype.post=function get(apiUrl,data){return this.request(apiUrl,"post",data)};Rest.prototype["delete"]=function get(apiUrl,data){return this.request(apiUrl,"delete",data)};Rest.prototype.putFile=function putFile(apiUrl,data){return this.request(apiUrl,"delete",data,"multipart/form-data")};Rest.prototype.request=function request(apiUrl,httpMethod,data,contentType){var thisRest=this,url=this.baseUrl+apiUrl,xhr=$.ajaxQueue({url:url,cache:!1,dataType:"json",method:httpMethod,headers:this.extraHeaders,data:data&&JSON.parse(JSON.stringify(data)),contentType:contentType||"application/x-www-form-urlencoded"}),promiseXhr=Promise.resolve(xhr).then(lowerCamelizeObject)["catch"](function(err){if(401===err.status){var retry=request.bind(this,apiUrl,httpMethod,data,contentType),retryPromise=thisRest.onAuthorizationRequired(retry);if(retryPromise)return Promise.resolve(retryPromise)["catch"](function(){return err})}return err});promiseXhr.xhr=xhr;return promiseXhr};Rest.prototype.onAuthorizationRequired=function onAuthorizationRequired(){};module.exports=Rest},{}],164:[function(require,module,exports){function Time(date,hour,minute,second){if(!(date instanceof Date)){second=minute;minute=hour;hour=date;date=new Date}return new Date(date.getFullYear(),date.getMonth(),date.getDate(),hour||0,minute||0,second||0)}module.exports=Time},{}],165:[function(require,module,exports){"use strict";module.exports=function createAccessControl(app){return function accessControl(route){var activity=app.getActivityControllerByRoute(route),user=app.model.user(),currentType=user&&user.userType();if(activity&&activity.accessLevel){var can=activity.accessLevel&currentType;if(!can)return{requiredLevel:activity.accessLevel,currentType:currentType}}return null}}},{}],166:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),moment=require("moment");exports.sortAppointments=function(a,b){var as=a.startTime(),ae=a.endTime(),bs=b.startTime(),be=b.endTime();if(null===as)return-1;if(null===bs)return 1;var eq=as.toISOString()===bs.toISOString();return eq?null===ae?-1:null===be?1:ae-be:as-bs};exports.fillPreparationTimeSlots=function fillPreparationTimeSlots(date,slots,preparationHours){var prevEnd=date;slots.forEach(function(slot,index){if(slot.id()>0&&slot.sourceBooking()){var end=slot.startTime(),start=moment(end).subtract(preparationHours,"hours").toDate();if(end>prevEnd){start=prevEnd>start?prevEnd:start;slots.splice(index,0,Appointment.newPreparationTimeSlot({start:start,end:end}))}}prevEnd=slot.endTime()})};exports.fillDayAvailability=function fillDayAvailability(date,appointmentsList,weekDaySchedule,schedulingPreferences){var slots=appointmentsList.slice(0);slots.sort(exports.sortAppointments);exports.fillPreparationTimeSlots(date,slots,schedulingPreferences.betweenTime());var filledSlots=[],zeroTime="00:00:00",last=zeroTime,lastDateTime=null,timeFormat="HH:mm:ss";if(0===slots.length){var fullStart=moment(date).startOf("day"),fullEnd=fullStart.clone().add(1,"days");filledSlots=exports.createScheduleSlots({start:fullStart.toDate(),end:fullEnd.toDate()},weekDaySchedule)}else{slots.forEach(function(slot){var start=slot.startTime(),s=moment(start),end=slot.endTime(),e=moment(end);if(s.format(timeFormat)>last){null===lastDateTime&&(lastDateTime=new Date(start.getFullYear(),start.getMonth(),start.getDate(),0,0,0));filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:start},weekDaySchedule))}filledSlots.push(slot);lastDateTime=end;last=e.format(timeFormat)});var lastEnd=lastDateTime&&moment(lastDateTime).format(timeFormat);if(lastEnd!==zeroTime){var nextMidnight=new Date(lastDateTime.getFullYear(),lastDateTime.getMonth(),lastDateTime.getDate()+1,0,0,0);filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:nextMidnight},weekDaySchedule))}}return filledSlots};exports.createScheduleSlots=function createScheduleSlots(range,weekDaySchedule){var list=[],start=range.start,end=range.end,date=moment(start).startOf("day"),from=moment(date).add({minutes:weekDaySchedule.from()}).toDate(),to=moment(date).add({minutes:weekDaySchedule.to()}).toDate(),beforeSchedule=from>start&&from>=end,afterSchedule=end>to&&start>=to,insideSchedule=start>=from&&to>=end;if(beforeSchedule||afterSchedule)list.push(Appointment.newUnavailableSlot({start:start,end:end}));else if(insideSchedule)list.push(Appointment.newFreeSlot({start:start,end:end}));else{var crossStart=from>start&&end>from,crossEnd=to>start&&end>to;crossStart&&list.push(Appointment.newUnavailableSlot({start:start,end:from}));crossEnd&&list.push(Appointment.newUnavailableSlot({start:to,end:end}));crossStart&&crossEnd?list.push(Appointment.newFreeSlot({start:from,end:to})):crossStart?list.push(Appointment.newFreeSlot({start:from,end:end})):crossEnd&&list.push(Appointment.newFreeSlot({start:start,end:to}))}return list.sort(exports.sortAppointments)}},{"../models/Appointment":103,moment:!1}],167:[function(require,module,exports){"use strict";var $=require("jquery");exports.i18n=null;function createHelpers(ko){var helpers={};helpers.popover={update:function(element,valueAccessor){var srcOptions=ko.unwrap(valueAccessor()),options=$.extend(!0,{},srcOptions);options.content=ko.unwrap(srcOptions.content);if(options.content){options.content=exports.i18n&&exports.i18n.t(options.content)||options.content;$(element).popover("destroy").popover(options);$(element).is(":focus")&&$(element).popover("show")}else $(element).popover("destroy")}};return helpers}function plugIn(ko,prefix){var name,helpers=createHelpers(ko);for(var h in helpers)if(!helpers.hasOwnProperty||helpers.hasOwnProperty(h)){name=prefix?prefix+h[0].toUpperCase()+h.slice(1):h;ko.bindingHandlers[name]=helpers[h]}}exports.plugIn=plugIn;exports.createBindingHelpers=createHelpers},{}],168:[function(require,module,exports){"use strict";var $=require("jquery");require("bootstrap");require("bootstrap-switch");exports.plugIn=function plugIn(ko,prefix){ko.bindingHandlers[prefix?prefix+"switch":"switch"]={init:function(element,valueAccessor){$(element).bootstrapSwitch();$(element).on("switchChange.bootstrapSwitch",function(e,state){var v=valueAccessor()||{},oldState=!!ko.unwrap(v.state),newState=!!state;oldState!==newState&&(ko.isObservable(v.state)?ko.isWriteableObservable(v.state)&&v.state(newState):v.state=newState)})},update:function(element,valueAccessor){var srcOptions=valueAccessor(),options=srcOptions||{};options=ko.toJS(options);var $el=$(element);Object.keys(options).forEach(function(key){$el.bootstrapSwitch(key,options[key])})}}}},{}],169:[function(require,module,exports){"use strict";var moment=require("moment");exports.forRange=function forRange(from,to,size,duration){from=new Date(from);to=new Date(to);var i=moment(from),d,slots=[],now=new Date,enought;if(from>=to)return slots;for(;i.toDate()<to;){d=i.clone().toDate();enought=i.clone().add(duration,"minutes").toDate();d>=now&&to>=enought&&slots.push(d);i.add(size,"minutes")}return slots};exports.forList=function forList(list,size,duration){var slots=[];list.forEach(function(item){"free"===item.availability&&slots.push.apply(slots,exports.forRange(item.startTime,item.endTime,size,duration))});return slots};exports.getTotalFreeMinutes=function getTotalFreeMinutes(list){return list.reduce(function(count,item){if("free"===item.availability){var s=moment(item.startTime),e=moment(item.endTime);return count+e.diff(s,"minutes")}return count},0)};exports.getAvailabilityTag=function(list){if(!list||0===list.length)return"none";var minutes=exports.getTotalFreeMinutes(list),perc=minutes/480*100,date=moment(list[0].startTime).startOf("day").toDate(),today=moment().startOf("day").toDate();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"};exports.filterListBy=function filterListBy(list,start,end){var nstart=start.toISOString(),nend=end.toISOString(),result=[];list.some(function(timeRange){if(timeRange.startTime>=nend)return!0;timeRange.endTime>nstart&&(timeRange.startTime<nstart?result.push({startTime:nstart,endTime:timeRange.endTime>nend?nend:timeRange.endTime,availability:timeRange.availability}):timeRange.endTime>nend?result.push({startTime:timeRange.startTime,endTime:nend,availability:timeRange.availability}):result.push(timeRange));return void 0});return result};exports.splitListInLocalDates=function filterListBy(list){var isodateFormat="YYYY-MM-DD",lastIsodate,group,result={};list.forEach(function(timeRange){var start=moment(timeRange.startTime),isostart=start.format(isodateFormat);if(isostart!==lastIsodate){group=result[isostart]=[];lastIsodate=isostart}var end=moment(timeRange.endTime),endJustDate=end.startOf("day"),isoend=end.format(isodateFormat),nextDayStart=start.clone().startOf("day").add(1,"day");if(isostart!==isoend&&end.format()!==nextDayStart.format()){group.push({startTime:start.format(),endTime:nextDayStart.format(),availability:timeRange.availability});for(var idate=nextDayStart.clone();endJustDate>idate;){var idateIso=idate.format(isodateFormat),idatetimeIso=idate.format();idate.add(1,"day");result[idateIso]=[{startTime:idatetimeIso,endTime:idate.format(),availability:timeRange.availability}]}result[idate.format(isodateFormat)]=[{startTime:idate.format(),endTime:end.format(),availability:timeRange.availability}]}else group.push(timeRange)});return result}},{moment:!1}],170:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),createTimeSlots=require("./createTimeSlots");exports.create=function createDatepickerAvailability(app,$datepicker,isLoading){var daysElements=$datepicker.datepicker("getDaysElements"),prevMonth=null,prevUserID=null;app.model.availability.on("clearCache",function(){prevMonth=null});var tagAvailability=function tagAvailability(date,userID,refresh){var month=date.getMonth();if(userID&&(month!==prevMonth||prevUserID!==userID||refresh)){prevMonth=month;prevUserID=userID;var start=moment(date).clone().startOf("month").startOf("week"),end=start.clone().add(6,"weeks");isLoading&&isLoading(!0);app.model.availability.times(userID,start,end).then(function(result){if(month===$datepicker.datepicker("getViewDate").getMonth()){var byDate=createTimeSlots.splitListInLocalDates(result.times);daysElements.each(function(){var $dateTd=$(this),id=$dateTd.data("date-time"),timeRangeList=byDate[moment(id).format("YYYY-MM-DD")];if(id&&timeRangeList){var cellClass=$dateTd.attr("class").replace(/(^|\s)tag-[^\s]+/,""),cls="";switch(createTimeSlots.getAvailabilityTag(timeRangeList)){case"past":cls="tag-muted";break;case"full":cls="tag-blank";break;case"medium":cls="tag-dark";break;case"low":cls="tag-warning";break;case"none":cls="tag-danger"}$dateTd.attr("class",cellClass+" "+cls)}})}})["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){isLoading&&isLoading(!1)}.bind(this))}};$datepicker.on("viewDateChanged",function(e,d){"days"===d.viewMode&&tagAvailability(d.viewDate,prevUserID)});return tagAvailability}},{"./createTimeSlots":169,moment:!1}],171:[function(require,module,exports){"use strict";var moment=require("moment");module.exports=function duration2Language(duration){duration=moment.duration(duration);var y=duration.years(),d=duration.days(),h=duration.hours(),m=duration.minutes(),s=duration.seconds(),l=duration.milliseconds(),parts=[];1===y?parts.push("a year"):y&&parts.push(y+" years");1===d?parts.push("a day"):d&&parts.push(d+" days");1===h?parts.push("an hour"):h&&parts.push(h+" hours");1===m?parts.push("a minute"):m&&parts.push(m+" minutes");1===s?parts.push("a second"):s&&parts.push(s+" seconds");1===l?parts.push("a millisecond"):l&&parts.push(l+" milliseconds");return parts.join(", ")}},{moment:!1}],172:[function(require,module,exports){"use strict";var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp("["+specials.join("\\")+"]","g"),escapeRegExp=function(str){return str.replace(regex,"\\$&")};module.exports=escapeRegExp},{}],173:[function(require,module,exports){"use strict";var specials=["#","&","~","=",">","'",":",'"',"!",";",","],regexSpecials=[".","*","+","|","[","]","(",")","/","^","$"],sRE=new RegExp("("+specials.join("|")+"|\\"+regexSpecials.join("|\\")+")","g");module.exports=function(selector){return selector.replace(sRE,"\\$1")}},{}],174:[function(require,module,exports){"use strict";var loader=require("./loader"),$=require("jquery"),settings={language:"en-US",appId:null},apiStatus={ready:!1,loading:!1,stack:[]};exports.ready=function facebookReady(readyCallback){if(apiStatus.ready)"function"==typeof readyCallback&&readyCallback(window.FB);else{apiStatus.stack.push(readyCallback);if(!facebookReady.isLoading){apiStatus.loading=!0;settings.language=$("[data-facebook-language]").data("facebook-language");settings.appId=$("[data-facebook-appid]").data("facebook-appid");loader.load({scripts:["//connect.facebook.net/"+settings.language+"/all.js"],completeVerification:function(){return!!window.FB},complete:function(){window.FB.init({appId:settings.appId,status:!0,cookie:!0,xfbml:!1});apiStatus.ready=!0;apiStatus.loading=!1;for(var i=0;i<apiStatus.stack.length;i++)try{apiStatus.stack[i](window.FB)}catch(e){console&&console.error&&console.error(e)}}})}}};exports.login=function facebookLogin(options){return new Promise(function(success,error){exports.ready(function(FB){FB.login(function(response){response.authResponse?success({auth:response.authResponse,FB:FB,response:response}):error({response:response,FB:FB})},options)})})}},{"./loader":180}],175:[function(require,module,exports){"use strict";module.exports=function getDateWithoutTime(date){date?date instanceof Date||(date=new Date(date)):date=new Date;return new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}},{}],176:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function getObservable(obsOrValue){return"function"==typeof obsOrValue?obsOrValue:ko.observable(obsOrValue)}},{knockout:!1}],177:[function(require,module,exports){"user strict";module.exports=function getUrlQuery(url){url=url||window.location.href;var vars=[],hash,queryIndex=url.indexOf("?");if(queryIndex>-1)for(var hashes=url.slice(queryIndex+1).split("&"),i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=hash[1]}return vars}},{}],178:[function(require,module,exports){"use strict";var $=require("jquery");$.fn.multiline=function(text){this.text(text);this.html(this.html().replace(/\n/g,"<br/>"));return this}},{}],179:[function(require,module,exports){"use strict";function accessorDescriptor(field,fun){var desc={enumerable:!0,configurable:!0};desc[field]=fun;return desc}function defineGetter(obj,prop,get){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("get",get));if(Object.prototype.__defineGetter__)return obj.__defineGetter__(prop,get);throw new Error("browser does not support getters")}function defineSetter(obj,prop,set){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("set",set));if(Object.prototype.__defineSetter__)return obj.__defineSetter__(prop,set);throw new Error("browser does not support setters")}module.exports={defineGetter:defineGetter,defineSetter:defineSetter}},{}],180:[function(require,module,exports){"use strict";var $=require("jquery");function promiseTimeout(milliseconds){return new Promise(function(resolve){setTimeout(function(){resolve()},milliseconds)})}exports.load=function(opts){opts=$.extend(!0,{scripts:[],complete:null,completeVerification:null,loadDelay:0,trialsInterval:500},opts);if(!opts.scripts.length)return Promise.resolve();function performComplete(){if("function"!=typeof opts.completeVerification||opts.completeVerification()){opts.complete();return Promise.resolve()}console&&console.warn&&console.warn("LC.load.completeVerification failed for "+opts.scripts[0]+" retrying it in "+opts.trialsInterval+"ms");
return promiseTimeout(opts.trialsInterval).then(performComplete)}function load(){return Promise.all(opts.scripts.map(function(sc){return $.getScript(sc)})).then(opts.complete?performComplete:null)}return opts.loadDelay?promiseTimeout(opts.loadDelay).then(load):load()}},{}],181:[function(require,module,exports){"use strict";var map={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o"};module.exports=function removeAccent(str){for(var res="",c,i=0,l=str.length;l>i;i++){c=str.charAt(i);res+=map[c]||c}return res}},{}],182:[function(require,module,exports){"use strict";var $=require("jquery");module.exports=function scrollToElement(el,options){var parent=$(el).parent(),topOffset=options&&options.topOffset||0,animation=options&&options.animation,atRoot=!1;do{if(!parent||!parent.length)return;atRoot=parent.get(0)===document.documentElement;var relativeTop=atRoot?el.position().top:el.offset().top,elementTop=relativeTop-topOffset,scrollingTop=elementTop+parent.scrollTop()-parent.offset().top;atRoot?animation?$("html,body").stop().animate({scrollTop:elementTop},animation):window.scroll(0,elementTop):animation?parent.stop().animate({scrollTop:scrollingTop},animation):parent.scrollTop(scrollingTop);parent=parent.parent()}while(!atRoot)}},{}],183:[function(require,module,exports){"use strict";var $=require("jquery"),escapeSelector=require("../escapeSelector");function getFlags(){if(window.navigator&&window.navigator.userAgent){var ua=window.navigator.userAgent,iOsWebview=/iOS|iPad|iPhone|iPod/.test(ua),iOsVersion=null;if(iOsWebview){iOsVersion={full:/OS ((\d+_?){2,3})\s/.exec(ua)[1]};iOsVersion.parts=iOsVersion.full.split("_");iOsVersion.major=0|iOsVersion.full.parts[0];iOsVersion.minor=0|iOsVersion.full.parts[1];iOsVersion.revision=0|iOsVersion.full.parts[2]}var isWkWebview=iOsVersion&&iOsVersion.major>=9,isAndroid=/Android/.test(ua),isChrome=/Chrome\//.test(ua),isMobile=iOsWebview||isAndroid;return{isIos:iOsWebview,iOsVersion:iOsVersion,isWkWebview:isWkWebview,isAndroid:isAndroid,isChrome:isChrome,isMobile:isMobile}}return{}}function DomItemsManager(settings){this.idAttributeName=settings.idAttributeName||"id";this.allowDuplicates=!!settings.allowDuplicates||!1;this.root=settings.root||"body";this.$root=null;var defaultDelay=140,flags=getFlags();(!flags.isMobile||flags.isChrome||flags.isWkWebview)&&(defaultDelay=40);this.switchDelay=settings.switchDelay||defaultDelay}module.exports=DomItemsManager;DomItemsManager.prototype.getAllItems=function getAllItems(){return this.$root.children("["+this.idAttributeName+"]")};DomItemsManager.prototype.find=function find(containerName,root){var $root=$(root||this.$root);return $root.children("["+this.idAttributeName+'="'+escapeSelector(containerName)+'"]')};DomItemsManager.prototype.getActive=function getActive(){return this.$root.children("["+this.idAttributeName+"]:visible")};DomItemsManager.prototype.inject=function inject(name,html){html=html.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"");var $html=$("<div/>",{html:html}),$c=this.find(name,$html);0===$c.length&&($c=$html.attr(this.idAttributeName,name));if(!this.allowDuplicates){var $prev=this.find(name);if($prev.length>0){$prev.replaceWith($c);$c=$prev}}$c.appendTo(this.$root)};DomItemsManager.prototype["switch"]=function switchActiveItem($from,$to,shell,state){var toName=state.route.name;this.disableAccess();function hideit(){var fromIsHidden=$from.is("[hidden]");if($from.length>0&&!fromIsHidden){shell.emit(shell.events.willClose,$from,state);$from.find(":focus").blur();$from.attr("hidden","hidden").css("display","none").css("z-index","");shell.emit(shell.events.closed,$from,state)}else $from.find(":focus").blur()}var toIsHidden=$to.is("[hidden]");if(toIsHidden){shell.emit(shell.events.willOpen,$to,state);$to.css("zIndex",-1);$to.removeAttr("hidden").css("display","block");shell.emit(shell.events.itemReady,$to,state);setTimeout(function(){if(toName===shell.currentRoute.name){hideit();$to.css("zIndex",2);this.enableAccess();shell.emit(shell.events.opened,$to,state)}}.bind(this),this.switchDelay)}else{if(toName!==shell.currentRoute.name)return;shell.emit(shell.events.itemReady,$to,state);this.enableAccess();hideit()}};DomItemsManager.prototype.init=function init(){this.$root=$(this.root||"body");this.getAllItems().attr("hidden","hidden").css("display","none");$('<div class="items-backstage"/>').css({background:this.$root.css("background-color")||"white",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:0}).appendTo(this.$root);var $disableLayer=$('<div class="items-disable-layer"/>').css({background:"White",opacity:0,position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:-1}).appendTo(this.$root);this.disableAccess=function(){$disableLayer.css("zIndex",90900)};this.enableAccess=function(){$disableLayer.css("zIndex",-2)}}},{"../escapeSelector":173}],184:[function(require,module,exports){"use strict";var deps=require("./dependencies");function Shell(settings){deps.EventEmitter.call(this);this.$=settings.jquery||deps.jquery;this.$root=this.$(settings.root);this.baseUrl=settings.baseUrl||"";this.forceHashbang=settings.forceHashbang||!1;this.linkEvent=settings.linkEvent||"click";this.parseUrl=(settings.parseUrl||deps.parseUrl).bind(this,this.baseUrl);this.absolutizeUrl=(settings.absolutizeUrl||deps.absolutizeUrl).bind(this,this.baseUrl);this.history=settings.history||window.history;this.indexName=settings.indexName||"index";this.items=settings.domItemsManager;this.loader="undefined"==typeof settings.loader?deps.loader:settings.loader;this.loader&&(this.loader.baseUrl=this.baseUrl);this.events={willOpen:"shell-will-open",willClose:"shell-will-close",itemReady:"shell-item-ready",closed:"shell-closed",opened:"shell-opened"};this.accessControl=settings.accessControl||deps.accessControl;this.nonAccessName=settings.nonAccessName||"index";this.currentRoute=null;this.referrerRoute=null}Shell.prototype=Object.create(deps.EventEmitter.prototype,{constructor:{value:Shell,enumerable:!1,writable:!0,configurable:!0}});module.exports=Shell;Shell.prototype.go=function go(url,state){this.forceHashbang?/^#!/.test(url)||(url="#!"+url):url=this.absolutizeUrl(url);this.history.pushState(state,void 0,url);return this.replace(state)};Shell.prototype.goBack=function goBack(state,steps){steps=0-(steps||1);if(0>steps&&Math.abs(steps)>=this.history.length)this.go(this.indexName);else{this._pendingStateUpdate=state;this.history.go(steps)}};Shell.prototype.getUpdatedState=function getUpdatedState(state){state=this._pendingStateUpdate||state||this.history.state||{};this._pendingStateUpdate=null;var isHashBang=/#!/.test(location.href)||this.forceHashbang,link=isHashBang?location.hash:location.pathname;if(location.search){var sep=-1!==link.indexOf("?")?"&":"?";link+=sep+location.search.substr(1)}state.route=this.parseUrl(link);return state};Shell.prototype._getLocationRoutedUrl=function(){var reg=/^#!/;return reg.test(window.location.hash)?window.location.hash:window.location.pathname+window.location.search+window.location.hash};Shell.prototype._refreshReferrer=function(){this.referrerRoute=this.parseUrl(this._getLocationRoutedUrl())};Shell.prototype._refreshCurrent=function(){this.currentRoute=this.parseUrl(this._getLocationRoutedUrl())};Shell.prototype.replaceState=function replaceState(state,title,url){this._refreshReferrer();this.history.replaceState(state,title,url);this._refreshCurrent()};Shell.prototype.pushState=function pushState(state,title,url){this._refreshReferrer();this.history.pushState(state,title,url);this._refreshCurrent()};Shell.prototype.replace=function replace(state){state=this.getUpdatedState(state);state.route.root===!0&&(state.route=this.parseUrl(this.indexName));this.referrerRoute=this.currentRoute;this.currentRoute=state.route;var accessError=this.accessControl(state.route);if(accessError)return this.go(this.nonAccessName,accessError);var $cont=this.items.find(state.route.name),shell=this,promise=null;if($cont&&$cont.length)promise=new Promise(function(resolve,reject){try{var $oldCont=shell.items.getActive();$oldCont=$oldCont.not($cont);shell.items["switch"]($oldCont,$cont,shell,state);resolve()}catch(ex){reject(ex)}});else if(this.loader)promise=this.loader.load(state.route).then(function(html){shell.items.inject(state.route.name,html);return shell.items.find(state.route.name).length?shell.replace(state):void 0});else{var err=new Error("Page not found ("+state.route.name+")");console.warn("Shell Page not found, state:",state);promise=Promise.reject(err);setTimeout(function(){this.goBack()}.bind(this),1)}var thisShell=this;promise["catch"](function(err){err instanceof Error||(err=new Error(err));console.error("Shell, unexpected error.",err);thisShell.emit("error",err);return err});return promise};Shell.prototype.run=function run(){var shell=this;this.$(window).on(this.history.popstateEvent||"popstate",function(event){var state=event.state||event.originalEvent&&event.originalEvent.state||shell.history.state;shell.replace(state)});var linkWorking=null,linkWorkingDelay=80;this.$(document).on(this.linkEvent,"[href], [data-href]",function(e){if(linkWorking)return!1;linkWorking=setTimeout(function(){linkWorking=null},linkWorkingDelay);var $t=shell.$(this),href=$t.attr("href")||$t.data("href");if(!/^[a-z]+:/i.test(href))if(shell.forceHashbang&&/^#([^!]|$)/.test(href)){e.preventDefault();shell.emit("fragmentNavigation",href,this,e)}else{e.preventDefault();setTimeout(function(){shell.go(href)},1)}});this.items.init();this.replace()}},{"./dependencies":186}],185:[function(require,module,exports){"use strict";var sanitizeUrl=require("./sanitizeUrl"),escapeRegExp=require("../escapeRegExp");function absolutizeUrl(baseUrl,url){url=sanitizeUrl(url);var matchBase=new RegExp("^"+escapeRegExp(baseUrl),"i");return matchBase.test(url)?url:sanitizeUrl(baseUrl+url)}module.exports=absolutizeUrl},{"../escapeRegExp":172,"./sanitizeUrl":191}],186:[function(require,module,exports){"use strict";module.exports={parseUrl:null,absolutizeUrl:null,jquery:null,loader:null,accessControl:function allowAll(){return null},EventEmitter:null}},{}],187:[function(require,module,exports){"use strict";var $=require("jquery"),sanitizeUrl=require("./sanitizeUrl"),getUrlQuery=require("../getUrlQuery"),session=sessionStorage.getItem("hashbangHistory.store");session=session?JSON.parse(session):{states:[]};function getSuid(hash){var suid=+getUrlQuery(hash)._suid;return isNaN(suid)?null:suid}function setSuid(hash,suid){var qs=getUrlQuery(hash);qs.push("_suid");qs._suid=suid;for(var query=[],i=0;i<qs.length;i++)query.push(qs[i]+"="+encodeURIComponent(qs[qs[i]]));query=query.join("&");if(query){var index=hash.indexOf("?");index>-1&&(hash=hash.substr(0,index));hash+="?"+query}return hash}function persist(){setTimeout(function(){sessionStorage.setItem("hashbangHistory.store",JSON.stringify(session))},1500)}function checkState(state){return state?Object.keys(state).length>0?state:null:state}function cannonicalUrl(url){url=sanitizeUrl(url||"");var ihash=url.indexOf("#");ihash>-1&&(url=url.substr(ihash+1));url=url.replace(/^!/,"");return url}var latestPushedReplacedUrl=null,hashbangHistory={pushState:function pushState(state,title,url){url=cannonicalUrl(url);state=checkState(state)||null;if(null!==state){session.states.push(state);var suid=session.states.length-1;url=setSuid(url,suid);persist()}latestPushedReplacedUrl=url;location.hash="#!"+url},replaceState:function replaceState(state,title,url){url=cannonicalUrl(url);var suid=getSuid(url),hasOldState=null!==suid;state=checkState(state)||null;if(null!==state||hasOldState){if(hasOldState)session.states[suid]=state;else{session.states.push(state);suid=session.states.length-1;url=setSuid(url,suid)}persist()}latestPushedReplacedUrl=url;location.hash="#!"+url},get state(){var suid=getSuid(location.hash);return null!==suid?session.states[suid]:null},get length(){return window.history.length},go:function go(offset){window.history.go(offset)},back:function back(){window.history.back()},forward:function forward(){window.history.forward()}},$w=$(window);$w.on("hashchange",function(e){var url=e.originalEvent.newURL;url=cannonicalUrl(url);if(url!==latestPushedReplacedUrl){var suid=getSuid(url),state=null;null!==suid&&(state=session.states[suid]);$w.trigger(new $.Event("popstate",{state:state}),"hashbangHistory")}});$w.on("popstate",function(e,source){if("hashbangHistory"!==source){e.preventDefault();e.stopImmediatePropagation()}});module.exports=hashbangHistory},{"../getUrlQuery":177,"./sanitizeUrl":191}],188:[function(require,module,exports){"use strict";var deps=require("./dependencies"),DomItemsManager=require("./DomItemsManager"),parseUrl=require("./parseUrl"),absolutizeUrl=require("./absolutizeUrl"),$=require("jquery"),loader=require("./loader"),EventEmitter=require("events").EventEmitter;$.extend(deps,{parseUrl:parseUrl,absolutizeUrl:absolutizeUrl,jquery:$,loader:loader,EventEmitter:EventEmitter});var Shell=require("./Shell");exports.Shell=Shell;exports.DomItemsManager=DomItemsManager},{"./DomItemsManager":183,"./Shell":184,"./absolutizeUrl":185,"./dependencies":186,"./loader":189,"./parseUrl":190,events:!1}],189:[function(require,module,exports){"use strict";var $=require("jquery");module.exports={baseUrl:"/",load:function load(route){return new Promise(function(resolve,reject){console.log("Shell loading on demand",route.name,route);$.ajax({url:module.exports.baseUrl+route.name+".html",cache:!1}).then(resolve,reject)})}}},{}],190:[function(require,module,exports){"use strict";var getUrlQuery=require("../getUrlQuery"),escapeRegExp=require("../escapeRegExp");function parseUrl(baseUrl,link){link=link||"";var rawUrl=link;link=link.replace(/^#!/,"").replace(/^#/,"");link=link.replace(/^\/|^\.\//,"");var query=getUrlQuery(link||"?");link=link.replace(/\?.*$/,"");var path=link.replace(new RegExp("^"+escapeRegExp(baseUrl),"i"),""),match=/^\/?([^\/\.]+)[^\/]*(\/.*)*$/.exec(path),parsed={root:!0,name:null,segments:null,path:null,url:rawUrl,query:query};if(match){parsed.root=!1;if(match[1]){parsed.name=match[1];if(match[2]){parsed.path=match[2];parsed.segments=match[2].replace(/^\//,"").split("/")}else{parsed.path="/";parsed.segments=[]}}}return parsed}module.exports=parseUrl},{"../escapeRegExp":172,"../getUrlQuery":177}],191:[function(require,module,exports){"use strict";function sanitizeUrl(url){return url.replace(/\.{2,}/g,"").replace(/\/{2,}/g,"/")}module.exports=sanitizeUrl},{}],192:[function(require,module,exports){var $=require("jquery"),throttle=require("iagosrl/throttle");module.exports=function snapPoints($scrollerElement,points,precision){if(points&&Object.keys(points).length){$scrollerElement=$scrollerElement||$(window);precision=0===precision?0:Math.abs(0|precision)||16;var record={},checkScroll=function(){var top=$scrollerElement.scrollTop();Object.keys(points).forEach(function(point){point=0|point;var type;point===top?"there"!==record[point]&&(type="there"):top>point?"after"!==record[point]&&(type="after"):"before"!==record[point]&&(type="before");if(type){$scrollerElement.trigger(points[point],[type]);record[point]=type}})};precision>0&&(checkScroll=throttle(checkScroll,precision));$scrollerElement.scroll(checkScroll);checkScroll()}}},{}],193:[function(require,module,exports){"use strict";var removeAccent=require("./removeAccent");module.exports=function textSearch(search,text){var s=removeAccent(search||"").toLowerCase(),t=removeAccent(text||"").toLowerCase();return t.indexOf(s)>-1}},{"./removeAccent":181}],194:[function(require,module,exports){var ko=require("knockout"),moment=require("moment"),getObservable=require("../utils/getObservable"),Appointment=require("../models/Appointment"),AppointmentView=require("../viewmodels/AppointmentView"),ModelVersion=require("../utils/ModelVersion"),getDateWithoutTime=require("../utils/getDateWithoutTime"),PricingSummaryDetail=require("../models/PricingSummaryDetail");function AppointmentCardViewModel(params){this.sourceItem=getObservable(params.sourceItem);var app=this.app=ko.unwrap(params.app);this.editMode=getObservable(params.editMode);this.editedVersion=ko.observable(null);this.isSaving=ko.observable(!1);this.isLoading=getObservable(params.isLoading);this.isLocked=ko.computed(function(){return this.isSaving()||this.isLoading()},this);this.item=ko.observable(AppointmentView(this.sourceItem(),app));this.allowBookUnavailableTime=ko.observable(!1);this.currentID=ko.pureComputed(function(){var it=this.item();return it&&it.id()||0},this);this.currentDatetime=ko.pureComputed(function(){return this.item()&&this.item().startTime()||new Date},this);this.currentDate=ko.pureComputed(function(){return getDateWithoutTime(this.item()&&this.item().startTime())},this);this.isNew=ko.computed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this);this.isBooking=ko.computed(function(){return this.item()&&this.item().sourceBooking()},this);this.isEvent=ko.computed(function(){return this.item()&&this.item().sourceEvent()&&!this.item().sourceBooking()},this);this.headerClass=ko.pureComputed(function(){return this.isBooking()?this.editMode()?"Card-title--warning":"Card-title--primary":this.isEvent()?"Card-title--danger":""},this);this.newAppointmentVisible=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.free||id===Appointment.specialIds.emptyDate||id===Appointment.specialIds.unavailable},this);this.editScheduleVisible=ko.pureComputed(function(){return this.currentID()===Appointment.specialIds.unavailable},this);this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?this.isNew()&&this.isBooking()?"Book":"Save changes":"Saved"},this);this.sourceItem.subscribe(function(sourceItem){this.item(AppointmentView(sourceItem,app));this.editedVersion(null);this.editMode(!1);this.isNew()&&this.editMode(!0)},this);this.editMode.subscribe(function(isEdit){if(!(this.currentID()<=0)||this.isNew())if(isEdit){var version=new ModelVersion(this.sourceItem());version.version.sourceEvent(this.sourceItem().sourceEvent());version.version.sourceBooking(this.sourceItem().sourceBooking());this.editedVersion(version);this.item(AppointmentView(version.version,app));if(this.isNew()&&this.isEvent()){this.item().sourceEvent().availabilityTypeID(0);this.item().isAllDay(!1);this.item().sourceEvent().eventTypeID(3);this.item().summary("")}}else this.item(AppointmentView(this.sourceItem(),app))},this);this.edit=function edit(){this.isLocked()||this.editMode(!0)}.bind(this);this.save=function save(){if(!this.isLocked()){var version=this.editedVersion();if(version&&version.areDifferent()){this.isSaving(!0);app.model.calendar.setAppointment(version.version,this.allowBookUnavailableTime()).then(function(savedApt){version.original.model.updateWith(savedApt);version.pull({evenIfNewer:!0});this.editMode(!1);if(this.isBooking()){var msg=this.item().client().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Confirmed!",message:msg})}}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}}}.bind(this);this.cancel=function cancel(){if(!this.isLocked()){this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0});this.editMode(!1)}}.bind(this);this.confirmCancel=function confirmCancel(){this.app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this))}.bind(this);var editFieldOn=function editFieldOn(activity,data){data.appointment=this.item().model.toPlainObject(!0);data.cancelLink=this.cancelLink;if(this.progress&&!this.progress.ended){data.progress=this.progress;var step=data.progress.step||1,total=data.progress.total||1;data.title=step+" of "+total;data.navTitle=null}else{data.progress=this.progress;data.title=null;data.navTitle=this.isBooking()?"Booking":"Event"}app.shell.go(activity,data)}.bind(this);this.pickDateTime=function pickDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().startTime(),datetimeField:"startTime",headerText:"Select the start time",requiredDuration:this.item().getServiceDurationMinutes()})}.bind(this);this.pickEndDateTime=function pickEndDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().endTime(),datetimeField:"endTime",headerText:"Select the end time"})}.bind(this);this.pickClient=function pickClient(){this.isLocked()||editFieldOn("clients",{selectClient:!0,selectedClientID:this.item().sourceBooking().clientUserID()})}.bind(this);this.pickService=function pickService(){this.isLocked()||editFieldOn("serviceProfessionalService/"+this.item().jobTitleID(),{selectPricing:!0,selectedServices:this.item().pricing().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.totalPrice)}})})}.bind(this);this.changePrice=function changePrice(){this.isLocked()}.bind(this);this.pickLocation=function pickLocation(){this.isLocked()||editFieldOn("serviceAddresses/"+this.item().jobTitleID(),{selectAddress:!0,selectedAddressID:this.item().addressID()})}.bind(this);var textFieldsHeaders={preNotesToClient:"Notes to client",postNotesToClient:"Notes to client (afterwards)",preNotesToSelf:"Notes to self",postNotesToSelf:"Booking summary",summary:"What?"};this.editTextField=function editTextField(field){this.isLocked()||editFieldOn("textEditor",{request:"textEditor",field:field,title:this.isNew()?"New booking":"Booking",header:textFieldsHeaders[field],text:this.item()[field]()})}.bind(this);"function"==typeof params.api&&params.api(this);ko.computed(function calculateEndTime(){var duration=this.item().serviceDurationMinutes(),start=moment(this.item().startTime()),end;if(this.isBooking()&&start.isValid()){end=start.add(duration,"minutes").toDate();this.item().endTime(end)}},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}AppointmentCardViewModel.prototype.passIn=function passIn(requestData){if(requestData.appointment){this.editMode(!0);this.item().model.updateWith(requestData.appointment)}else this.isNew()||this.cancel();"textEditor"===requestData.request&&this.item()[requestData.field](requestData.text);requestData.selectClient===!0&&this.item().clientUserID(requestData.selectedClientID);if("undefined"!=typeof requestData.selectedDatetime){var field=requestData.datetimeField;this.item()[field](requestData.selectedDatetime);this.allowBookUnavailableTime(requestData.allowBookUnavailableTime)}requestData.selectedJobTitleID&&this.item().jobTitleID(requestData.selectedJobTitleID);requestData.selectAddress===!0&&this.item().addressID(requestData.selectedAddressID);requestData.selectPricing===!0&&this.item().pricing(requestData.selectedServices.map(function(pricing){return new PricingSummaryDetail(pricing)}));if(this.isNew())if(requestData&&requestData.cancelLink)this.cancelLink=requestData.cancelLink;else{var referrerUrl=this.app.shell.referrerRoute;referrerUrl=referrerUrl&&referrerUrl.url||"calendar";this.cancelLink=referrerUrl}if(this.currentID()===Appointment.specialIds.newBooking)if(requestData.progress){if(requestData.progress){this.progress=requestData.progress;var step=this.progress.step||1;if(2>step){this.progress.step=2;this.pickService()}else if(3>step){requestData.progress.step=3;this.pickDateTime()}else if(4>step){requestData.progress.step=4;this.pickLocation()}else this.progress.ended=!0}}else{this.progress={step:1,total:4,ended:!1};this.pickClient()}else this.progress=null};module.exports=AppointmentCardViewModel},{"../models/Appointment":103,"../models/PricingSummaryDetail":126,"../utils/ModelVersion":161,"../utils/getDateWithoutTime":175,"../utils/getObservable":176,"../viewmodels/AppointmentView":195,knockout:!1,moment:!1}],195:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function AppointmentView(appointment,app){if(appointment._isAppointmentView)return appointment;appointment._isAppointmentView=!0;appointment.client=ko.computed(function(){var b=this.sourceBooking();if(!b)return null;var cid=this.clientUserID();return cid?app.model.clients.getObservableItem(cid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.address=ko.computed(function(){var aid=this.addressID(),jid=this.jobTitleID();return aid&&jid?app.model.serviceAddresses.getObservableItem(jid,aid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.addressSummary=ko.computed(function(){var eventData=this.sourceEvent(),add=this.address();return add&&add.singleLine()||eventData&&eventData.location()||""},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.pricingWithInfo=ko.computed(function(){var b=this.sourceBooking();if(!b)return[];var jid=this.jobTitleID(),details=this.pricing();return details.map(function(det){return PricingSummaryDetailView(det,jid,app)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});appointment.servicesSummary=ko.computed(function(){return this.pricingWithInfo().map(function(service){return service.serviceProfessionalService().name()}).join(", ")},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.getServiceDurationMinutes=function(){var pricing=this.pricingWithInfo(),sum=pricing.reduce(function(prev,service){return prev+service.serviceProfessionalService().serviceDurationMinutes()},0);return sum};appointment.serviceDurationMinutes=ko.computed(function(){return this.getServiceDurationMinutes()},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var pricing=appointment.pricing();this.price(pricing.reduce(function(prev,cur){return prev+cur.price()},0))},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});return appointment};function PricingSummaryDetailView(pricingSummaryDetail,jobTitleID,app){pricingSummaryDetail.serviceProfessionalService=ko.computed(function(){var pid=this.serviceProfessionalServiceID();return app.model.serviceProfessionalServices.getObservableItem(jobTitleID,pid,!0)()},pricingSummaryDetail).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});return pricingSummaryDetail}},{knockout:!1}],196:[function(require,module,exports){"use strict";var Model=require("../models/Model"),ko=require("knockout");function BookingProgress(values){Model(this);this.model.defProperties({step:0,stepsList:[],ended:!1},values);this.totalSteps=ko.pureComputed(function(){return this.stepsList().length},this);this.currentStep=ko.pureComputed(function(){return this.stepsList()[this.step()]},this)}module.exports=BookingProgress;BookingProgress.prototype.next=function(){var step=Math.max(0,Math.min(this.step()+1,this.totalSteps()-1));this.step(step)};BookingProgress.prototype.observeStep=function(stepName){return ko.pureComputed(function(){return this.isStep(stepName)},this)};BookingProgress.prototype.isStep=function(stepName){return this.stepsList()[this.step()]===stepName}},{"../models/Model":123,knockout:!1}],197:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),getDateWithoutTime=require("../utils/getDateWithoutTime"),moment=require("moment"),Time=require("../utils/Time");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability");function DatetimePickerVM(app,element){this.selectedDate=ko.observable(getDateWithoutTime());this.userID=ko.observable();this.isLoading=ko.observable(!1);this.requiredDurationMinutes=ko.observable(0);this.durationDisplay=ko.pureComputed(function(){var fullMinutes=this.requiredDurationMinutes();if(0>=fullMinutes)return"";var hours=Math.floor(fullMinutes/60),minutes=fullMinutes%60,text="";hours>0&&(text+=moment.duration({hours:hours}).humanize()+" ");minutes>0&&(text+=moment.duration({minutes:minutes}).humanize());return text},this);this.dateAvail=ko.observable();this.groupedSlots=ko.computed(function(){var requiredDurationMinutes=this.requiredDurationMinutes(),datePart=this.selectedDate()||new Date,groups=[{group:"Morning",slots:[],starts:new Time(datePart,0,0),ends:new Time(datePart,12,0)},{group:"Afternoon",slots:[],starts:new Time(datePart,12,0),ends:new Time(datePart,17,0)},{group:"Evening",slots:[],starts:new Time(datePart,17,0),ends:new Time(datePart,24,0)}],slots=this.dateAvail()&&this.dateAvail().getFreeTimeSlots(requiredDurationMinutes)||[];slots.forEach(function(slot){groups.some(function(group){if(slot>=group.starts&&slot<group.ends){group.slots.push(slot);return!0}})});return groups},this);this.selectedDatetime=ko.observable(null);this.selectDatetime=function(selectedDatetime,event){event.preventDefault();event.stopImmediatePropagation();this.selectedDatetime(selectedDatetime)}.bind(this);this.pickedTime=ko.observable();this.allowBookUnavailableTime=ko.observable(!1);this.unavailableTimeBtnEnabled=ko.observable(!1);this.getPickedDatetime=function(){var t=this.pickedTime();if(!(t instanceof Date)){var timespan=moment.duration(t);t=moment(this.selectedDate()).startOf("day").add(timespan).toDate()}return t};this.setPickedAsSelected=function(){this.allowBookUnavailableTime(!0);this.selectedDatetime(this.getPickedDatetime())}.bind(this);this.showTimePicker=function(){app.modals.showTimePicker({title:"Book an unavailable time",selectedTime:null,unsetLabel:"Cancel"}).then(function(pickedValue){if(pickedValue.time){this.pickedTime(pickedValue.time);this.setPickedAsSelected()}}.bind(this))["catch"](function(){})}.bind(this);this.reset=function(){this.selectedDatetime(null);this.pickedTime(null);this.allowBookUnavailableTime(!1)}.bind(this);this.bindDateData=function bindDateData(date){if(date&&this.userID()){date=getDateWithoutTime(date);this.isLoading(!0);return app.model.availability.times(this.userID(),date).then(function(data){this.dateAvail(data)}.bind(this))["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){this.isLoading(!1)}.bind(this))}}.bind(this);var $datePicker=$(element).find(".calendar-placeholder");$datePicker.show().datepicker({
extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(app,$datePicker,this.isLoading);$datePicker.on("dateChanged",function(e){"days"===e.viewMode&&this.selectedDate(e.date)}.bind(this));this.selectedDate.subscribe(function(date){this.bindDateData(date);var elDate=$datePicker.datepicker("getValue");elDate!==date&&$datePicker.datepicker("setValue",date,!0)}.bind(this));ko.computed(function(){this.dateAvail()&&this.userID()&&this.tagAvailability(this.selectedDate(),this.userID())},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});$datePicker.datepicker("fill")}module.exports=DatetimePickerVM},{"../components/DatePicker":97,"../utils/Time":164,"../utils/datepickerAvailability":170,"../utils/getDateWithoutTime":175,knockout:!1,moment:!1}],198:[function(require,module,exports){"use strict";var ko=require("knockout");function FormCredentials(){this.username=ko.observable("");this.password=ko.observable("");var emailRegexp=/^[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+@[-0-9A-Za-z!#$%&'*+/=?^_`{|}~.]+$/;this.username.error=ko.observable("");this.username.subscribe(function(v){v?emailRegexp.test(v)?this.username.error(""):this.username.error("Is not a valid email"):this.username.error("Required")}.bind(this));this.password.error=ko.observable("");this.password.subscribe(function(v){var err="";v||(err="Required");this.password.error(err)}.bind(this))}module.exports=FormCredentials},{knockout:!1}],199:[function(require,module,exports){var Model=require("../models/Model");function NavAction(values){Model(this);this.model.defProperties({link:"",icon:"",text:"",isTitle:!1,isModal:!1,isShell:!1,isMenu:!1,handler:null},values);this.runHandler=function runHandler(obj,event){var handler=this.handler();if(handler){event.stopImmediatePropagation();event.preventDefault();handler.call(this,event,obj)}}.bind(this)}module.exports=NavAction;NavAction.prototype.getHref=function getHref(){return this.handler()||this.isMenu()||this.isModal()||this.isShell()?"#":this.link()};NavAction.prototype.getModalTarget=function getModalTarget(){return this.handler()||this.isMenu()||!this.isModal()||this.isShell()?"":this.link()};NavAction.prototype.getShellCommand=function getShellCommand(){return this.handler()||this.isMenu()||!this.isShell()?"":this.link()};NavAction.prototype.getMenuID=function getMenuID(){return this.handler()||!this.isMenu()?"":this.link()};NavAction.prototype.getMenuLink=function getMenuLink(){return this.handler()||!this.isMenu()?"":"#"+this.link()};NavAction.goHome=new NavAction({link:"/",icon:"fa ion ion-stats-bars"});NavAction.goBack=new NavAction({link:"goBack",icon:"fa ion ion-ios-arrow-left",isShell:!0});NavAction.menuIn=new NavAction({link:"menuIn",icon:"menu",isMenu:!0});NavAction.menuOut=new NavAction({link:"menuOut",icon:"menu",isMenu:!0});NavAction.menuNewItem=new NavAction({link:"menuNewItem",icon:"fa ion ion-ios-plus-empty",isMenu:!0});NavAction.goHelpIndex=new NavAction({link:"/contactForm/general?mustReturn=true",text:"help",isModal:!1});NavAction.goLogin=new NavAction({link:"/login",text:"log-in"});NavAction.goLogout=new NavAction({link:"/logout",text:"log-out"});NavAction.goSignup=new NavAction({link:"/signup",text:"sign-up"})},{"../models/Model":123}],200:[function(require,module,exports){var Model=require("../models/Model"),NavAction=require("./NavAction");function NavBar(values){Model(this);this.model.defProperties({title:"",leftAction:{Model:NavAction},rightAction:{Model:NavAction},hidden:!1},values)}module.exports=NavBar},{"../models/Model":123,"./NavAction":199}],201:[function(require,module,exports){var Model=require("../models/Model"),ko=require("knockout");function OnboardingProgress(values){Model(this);this.model.defProperties({group:"",stepNumber:-1,steps:[]},values);this.totalSteps=ko.pureComputed(function(){return this.steps().length-1},this);this.stepName=ko.pureComputed(function(){var num=this.stepNumber(),tot=this.steps().length;if(tot>0&&num>-1&&tot>num){var name=this.steps()[num]||"";return name}return null},this);this.stepUrl=ko.pureComputed(function(){var url=this.stepName();url&&!/^\//.test(url)&&(url="/"+url);return url},this);this.stepReference=ko.pureComputed(function(){return this.group()+":"+this.stepName()},this);this.progressText=ko.pureComputed(function(){return this.stepNumber()+" of "+this.totalSteps()},this);this.inProgress=ko.pureComputed(function(){return!!this.stepUrl()},this)}module.exports=OnboardingProgress;OnboardingProgress.prototype.setStepByName=function setStepByName(name){var stepIndex=this.steps().indexOf(name);if(stepIndex>-1){this.stepNumber(stepIndex);return!0}return!1};OnboardingProgress.predefinedStepGroups={welcome:["welcome","addJobTitles","weeklySchedule","contactInfo"],marketplace:[],payment:[]}},{"../models/Model":123,knockout:!1}],202:[function(require,module,exports){"use strict";var ko=require("knockout");function ServiceAddressesViewModel(){this.isSelectionMode=ko.observable(!1);this.sourceAddresses=ko.observableArray([]);this.addresses=ko.computed(function(){var list=this.sourceAddresses();this.isSelectionMode()&&(list=list.filter(function(add){return add.isServiceLocation()}));return list},this);this.selectedAddress=ko.observable(null);this.selectAddress=function(selectedAddress,event){this.selectedAddress(selectedAddress);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.observerSelected=function(item){return ko.pureComputed(function(){var sid=this.selectedAddress()&&ko.unwrap(this.selectedAddress().addressID),iid=item&&ko.unwrap(item.addressID);return sid===iid},this)}.bind(this)}module.exports=ServiceAddressesViewModel},{knockout:!1}],203:[function(require,module,exports){"use strict";var ko=require("knockout"),_=require("lodash"),$=require("jquery");function ServiceProfessionalServiceViewModel(app){this.isLoading=ko.observable(!1);this.list=ko.observableArray([]);this.jobTitleID=ko.observable(0);this.serviceProfessionalID=ko.observable(null);this.jobTitle=ko.observable(null);this.isAdditionMode=ko.observable(!1);this.isSelectionMode=ko.observable(!1);this.selectedServices=ko.observableArray([]);this.preSelectedServices=ko.observableArray([]);this.requestData=ko.observable();this.cancelLink=ko.observable(null);this.allowAddServices=ko.pureComputed(function(){return null===this.serviceProfessionalID()},this);this.groupedServices=ko.computed(function(){var list=this.list(),isSelection=this.isSelectionMode(),groupNamePrefix=isSelection?"Select ":"",groups=[],groupsList=[];if(!this.isAdditionMode()){groups=_.groupBy(list,function(service){return service.pricingTypeID()});groupsList=Object.keys(groups).map(function(key){var gr={services:groups[key],type:app.model.pricingTypes.getObservableItem(key)};gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr);return gr})}if(!this.isSelectionMode()){var pricingTypes=this.jobTitle()&&this.jobTitle().pricingTypes();pricingTypes&&pricingTypes.length&&pricingTypes.forEach(function(jobType){var typeID=jobType.pricingTypeID();if(!groups.hasOwnProperty(typeID)){var gr={services:[],type:app.model.pricingTypes.getObservableItem(typeID)};gr.group=ko.computed(function(){return groupNamePrefix+(this.type()&&this.type().pluralName()||"Services")},gr);groupsList.push(gr)}})}return groupsList},this);this.toggleServiceSelection=function(service){var inIndex=-1,isSelected=this.selectedServices().some(function(selectedServices,index){if(selectedServices===service){inIndex=index;return!0}});service.isSelected(!isSelected);isSelected?this.selectedServices.splice(inIndex,1):this.selectedServices.push(service)}.bind(this);this.editService=function(service){app.shell.go("serviceProfessionalServiceEditor/"+this.jobTitleID()+"/"+service.serviceProfessionalServiceID())}.bind(this);this.tapService=function(service,event){this.isSelectionMode()?this.toggleServiceSelection(service):this.editService(service);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.tapNewService=function(group,event){var url="#!serviceProfessionalServiceEditor/"+this.jobTitleID()+"/new/"+(group.type()&&group.type().pricingTypeID()),request=$.extend({},this.requestData(),{selectedJobTitleID:this.jobTitleID()});request.cancelLink||$.extend(request,{cancelLink:this.cancelLink()});this.isSelectionMode()&&(request.selectedServices=this.selectedServices().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.totalPrice)}}));app.shell.go(url,request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);var loadDataFor=function loadDataFor(serviceProfessionalID,jobTitleID){if(jobTitleID){this.isLoading(!0);Promise.all([app.model.jobTitles.getJobTitle(jobTitleID),app.model.pricingTypes.getList()]).then(function(data){var jobTitle=data[0];this.jobTitle(jobTitle);return serviceProfessionalID?app.model.users.getServiceProfessionalServices(serviceProfessionalID,jobTitleID):app.model.serviceProfessionalServices.getList(jobTitleID)}.bind(this)).then(function(list){list=app.model.serviceProfessionalServices.asModel(list);var preset=this.preSelectedServices(),selection=this.selectedServices;list.forEach(function(item){var preSelected=preset.some(function(pr){return pr.serviceProfessionalServiceID===item.serviceProfessionalServiceID()?!0:void 0})||!1;item.isSelected=ko.observable(preSelected);preSelected&&selection.push(item)});this.list(list);this.isLoading(!1)}.bind(this))["catch"](function(err){this.isLoading(!1);app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.list([]);this.jobTitle(null)}}.bind(this);ko.computed(function(){loadDataFor(this.serviceProfessionalID(),this.jobTitleID())}.bind(this)).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}module.exports=ServiceProfessionalServiceViewModel},{knockout:!1,lodash:!1}],204:[function(require,module,exports){"use strict";var ko=require("knockout"),EventEmitter=require("events").EventEmitter,newFieldObs=function(){var obs=ko.observable("");obs.error=ko.observable("");obs.subscribe(function(){obs.error("")});return obs};function SignupVM(app){EventEmitter.call(this);this.firstName=newFieldObs();this.lastName=newFieldObs();this.phone=newFieldObs();this.postalCode=newFieldObs();this.referralCode=newFieldObs();this.device=newFieldObs();this.facebookUserID=ko.observable();this.facebookAccessToken=ko.observable();this.email=newFieldObs();this.password=newFieldObs();this.signupError=ko.observable("");this.isSigningUp=ko.observable(!1);this.submitText=ko.pureComputed(function(){return this.isSigningUp()?"Signing up...":this.facebookUserID()?"Sign up with Facebook":"Sign up"},this);this.performSignup=function performSignup(){this.isSigningUp(!0);this.signupError("");var ended=function ended(){this.isSigningUp(!1)}.bind(this),plainData={email:this.email(),password:this.password(),firstName:this.firstName(),lastName:this.lastName(),phone:this.phone(),postalCode:this.postalCode(),referralCode:this.referralCode(),device:this.device(),facebookUserID:this.facebookUserID(),facebookAccessToken:this.facebookAccessToken(),profileType:this.profile()};return app.model.signup(plainData).then(function(signupData){this.signupError("");ended();app.model.onboarding&&app.model.onboarding.setStep(signupData.onboardingStep);this.reset();this.emit("signedup",signupData)}.bind(this))["catch"](function(err){err=err&&err.responseJSON;if(err&&"validation"===err.errorSource&&err.errors)Object.keys(err.errors).forEach(function(fieldKey){this[fieldKey]&&this[fieldKey].error&&this[fieldKey].error(err.errors[fieldKey])}.bind(this));else{var msg=err&&err.errorMessage||err&&err.statusText||"Invalid username or password";this.signupError(msg);this.email.error(msg)}ended();this.emit("signuperror",err)}.bind(this))}.bind(this);this.profile=ko.observable("");this.forServiceProfessional=ko.pureComputed(function(){return"service-professional"===this.profile()},this);this.reset=function(){this.firstName("");this.lastName("");this.phone("");this.postalCode("");this.referralCode("");this.device("");this.facebookUserID("");this.facebookAccessToken("")};this.facebook=function(){var fb=require("../utils/facebookUtils"),vm=this;fb.login({scope:"email"}).then(function(result){var auth=result.auth,FB=result.FB;vm.facebookUserID(auth.userID);vm.facebookAccessToken(auth.accessToken);FB.api("/me",function(user){vm.email(user.email);vm.firstName(user.first_name);vm.lastName(user.last_name)})})}}SignupVM._inherits(EventEmitter);module.exports=SignupVM},{"../utils/facebookUtils":174,events:!1,knockout:!1}],205:[function(require,module,exports){"use strict";var getObservable=require("../utils/getObservable");function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null);this.endTime=getObservable(params.endTime||null);this.subject=getObservable(params.subject||null);this.description=getObservable(params.description||null);this.link=getObservable(params.link||null);this.actionIcon=getObservable(params.actionIcon||null);this.actionText=getObservable(params.actionText||null);this.classNames=getObservable(params.classNames||null)}module.exports=TimeSlotViewModel;var numeral=require("numeral"),Appointment=require("../models/Appointment");TimeSlotViewModel.fromAppointment=function fromAppointment(apt){var link="#!appointment/"+apt.startTime().toISOString()+"/"+apt.id();apt.id()===Appointment.specialIds.preparationTime&&(link="#!schedulingPreferences?mustReturn=1");var classNames=null;if(Appointment.specialIds.free===apt.id())classNames="Tile--tag-gray-lighter ";else if(apt.id()>0&&apt.sourceBooking()){classNames=apt.sourceBooking().serviceDateID()?"Tile--tag-primary ":"Tile--tag-warning ";classNames+="ItemAddonTile--largerContent "}else classNames="Tile--tag-danger ";return new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,subject:apt.summary,description:apt.description,link:link,actionIcon:apt.sourceBooking()?null:apt.sourceEvent()?"fa ion ion-ios-arrow-right":apt.id()?null:"fa ion ion-plus",actionText:apt.sourceBooking()&&apt.sourceBooking().pricingSummary()?numeral(apt.sourceBooking().pricingSummary().totalPrice()||0).format("$0.00"):null,classNames:classNames})}},{"../models/Appointment":103,"../utils/getObservable":176,numeral:!1}],206:[function(require,module,exports){"use strict";var ko=require("knockout"),UserJobTitle=require("../models/UserJobTitle");function UserJobProfileViewModel(app){this.showMarketplaceInfo=ko.observable(!1);var jobTitlesIndex={};function syncJobTitle(jobTitleID){return app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){jobTitlesIndex[jobTitleID]=jobTitle})}function attachJobTitle(userJobTitle){userJobTitle.jobTitle=ko.computed(function(){return jobTitlesIndex[this.jobTitleID()]},userJobTitle);userJobTitle.displayedSingularName=ko.computed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Unknow"},userJobTitle)}function attachMarketplaceStatus(userJobtitle){userJobtitle.marketplaceStatusHtml=ko.pureComputed(function(){var status=this.statusID();return status===UserJobTitle.status.on?'Marketplace profile: <strong class="text-success">ON</strong>':status===UserJobTitle.status.off?'Marketplace profile: <strong class="text-danger">OFF</strong>':'<span class="text-danger">There are steps left to activate</span>'},userJobtitle)}function attachExtras(userJobtitle){attachJobTitle(userJobtitle);attachMarketplaceStatus(userJobtitle)}this.userJobProfile=ko.observableArray([]);app.model.userJobProfile.list.subscribe(function(list){Promise.all(list.map(function(userJobTitle){return syncJobTitle(userJobTitle.jobTitleID())})).then(function(){list.forEach(attachExtras);this.userJobProfile(list);this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!1)}.bind(this))["catch"](showLoadingError)},this);this.isFirstTime=ko.observable(!0);this.isLoading=ko.observable(!1);this.isSyncing=ko.observable(!1);this.thereIsError=ko.observable(!1);this.baseUrl=ko.observable("/jobtitles");this.selectJobTitle=function(jobTitle){app.shell.go(this.baseUrl()+"/"+jobTitle.jobTitleID());return!1}.bind(this);var showLoadingError=function showLoadingError(err){app.modals.showError({title:"An error happening when loading your job profile.",error:err&&err.error||err});this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!0)}.bind(this);this.sync=function sync(){var firstTime=this.isFirstTime();this.isFirstTime(!1);firstTime?this.isLoading(!0):this.isSyncing(!0);app.model.userJobProfile.syncList()["catch"](showLoadingError)}.bind(this)}module.exports=UserJobProfileViewModel},{"../models/UserJobTitle":144,knockout:!1}]},{},[64]);