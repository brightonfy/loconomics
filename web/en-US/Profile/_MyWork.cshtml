@using WebMatrix.Data;
@{
    // Provider
    var p = LcData.UserInfo.GetRequestedUserRow();
    // Current position data record:
    var pos = PageData["position"];
    
    string photosFolder = LcUrl.AppPath + "img/userphotos/u" + p.UserID.ToString() + "/";
    
    dynamic photos = null;
    using (var db = Database.Open("sqlloco")) {
        photos = db.Query(@"
            SELECT [ProviderServicePhotoID]
                  ,[PhotoCaption]
                  ,[PhotoAddress]
                  ,[IsPrimaryPhoto]
              FROM [providerservicephoto]
              WHERE UserID = @0 AND PositionID = @1 AND Active = 1
              ORDER BY RankPosition
        ", pos.UserID, pos.PositionID);
    }
    // Get primary photo, or the first if there are not one
    dynamic primaryPhoto = null;
    bool first = true;
    foreach (var photo in photos) {
        if (photo.IsPrimaryPhoto || first) {
            primaryPhoto = photo;
            first = false;
        }
    }
}
<p class="my-work-description">
A picture's worth a thousand words.  Review the provider's photos of his/her work below to help you with your decision. 
</p>

<div class="highlighted-photo-large gallery-highlighted">
    <img alt="@(primaryPhoto == null ? "No primary photo" : primaryPhoto.PhotoCaption)" src="@(primaryPhoto == null ? LcUrl.AppPath + "img/theme/user-photo-no-selected.png" : photosFolder + primaryPhoto.PhotoAddress)" />
    <h5 class="photo-caption">@(primaryPhoto == null ? "" : primaryPhoto.PhotoCaption)</h5>
</div>

<ol class="photo-library gallery-content">
    @if (photos.Count == 0)
    {
        <li class="empty volatize-my-tab">This provider has not uploaded any photos.</li>
    }
    else
    {
        foreach (var photo in photos)
        {
            <li id="UserPhoto-@photo.ProviderServicePhotoID" class="@((photo.IsPrimaryPhoto || photo == primaryPhoto) ? "selected is-primary-photo" : "")"><a href="#"><img alt="@photo.PhotoCaption" src="@(photosFolder + photo.PhotoAddress)"/></a></li>
        }
    }
</ol>
