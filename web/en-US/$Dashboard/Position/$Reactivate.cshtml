@using WebMatrix.Data;
@{
    LcHelpers.ProviderPage();
    var u = LcData.UserInfo.GetUserRow();
    var positionID = Request["PositionID"].AsInt();

    if (positionID > 0) {
        
        var done = LcData.JobTitle.ReactivateUserJobTitle(u.UserID, positionID);
        
        if (done) {
            if (Request.IsAjaxRequest()) {
                LcHelpers.ReturnJsonResult(101, null);
            }
        }
        else {
            if (Request.IsAjaxRequest()) {
                
                var alertsMsg = "You must complete another {0} steps to activate this profile--please visit the <a href='{1}'>To-dos</a> section to complete";
                
                // Notify about pending alerts:
                if (Request.IsAjaxRequest()) {
                    var alerts = LcData.GetActiveRequiredUserAlertsCount(u.UserID, positionID);
                    LcHelpers.ReturnJsonResult(102, new {
                        AlertsRequired = alerts,
                        Message = String.Format(alertsMsg, alerts, LcUrl.LangPath + "dashboard/#DashboardTodosSummary")
                    });
                }
            }
        }

    } else {
        if (Request.IsAjaxRequest()) {
            LcHelpers.ReturnJsonResult(103, new { Message = "We're sorry, we're unable to reactivate this position.  Please contact us for help" });
        }
    }
    if (!Request.IsAjaxRequest()) {
        Response.Redirect(LcHelpers.GetRedirectURLFromReferrer("/Dashboard"));
    }
}
