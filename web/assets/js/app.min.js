!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function Hash(){}var nativeCreate=require("./_nativeCreate"),objectProto=Object.prototype;Hash.prototype=nativeCreate?nativeCreate(null):objectProto;module.exports=Hash},{"./_nativeCreate":66}],2:[function(require,module,exports){var getNative=require("./_getNative"),root=require("./_root"),Map=getNative(root,"Map");module.exports=Map},{"./_getNative":46,"./_root":68}],3:[function(require,module,exports){function MapCache(values){var index=-1,length=values?values.length:0;this.clear();for(;++index<length;){var entry=values[index];this.set(entry[0],entry[1])}}var mapClear=require("./_mapClear"),mapDelete=require("./_mapDelete"),mapGet=require("./_mapGet"),mapHas=require("./_mapHas"),mapSet=require("./_mapSet");MapCache.prototype.clear=mapClear;MapCache.prototype["delete"]=mapDelete;MapCache.prototype.get=mapGet;MapCache.prototype.has=mapHas;MapCache.prototype.set=mapSet;module.exports=MapCache},{"./_mapClear":60,"./_mapDelete":61,"./_mapGet":62,"./_mapHas":63,"./_mapSet":64}],4:[function(require,module,exports){var getNative=require("./_getNative"),root=require("./_root"),Set=getNative(root,"Set");module.exports=Set},{"./_getNative":46,"./_root":68}],5:[function(require,module,exports){function Stack(values){var index=-1,length=values?values.length:0;this.clear();for(;++index<length;){var entry=values[index];this.set(entry[0],entry[1])}}var stackClear=require("./_stackClear"),stackDelete=require("./_stackDelete"),stackGet=require("./_stackGet"),stackHas=require("./_stackHas"),stackSet=require("./_stackSet");Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;module.exports=Stack},{"./_stackClear":70,"./_stackDelete":71,"./_stackGet":72,"./_stackHas":73,"./_stackSet":74}],6:[function(require,module,exports){var root=require("./_root"),Symbol=root.Symbol;module.exports=Symbol},{"./_root":68}],7:[function(require,module,exports){var root=require("./_root"),Uint8Array=root.Uint8Array;module.exports=Uint8Array},{"./_root":68}],8:[function(require,module,exports){var getNative=require("./_getNative"),root=require("./_root"),WeakMap=getNative(root,"WeakMap");module.exports=WeakMap},{"./_getNative":46,"./_root":68}],9:[function(require,module,exports){function arrayAggregator(array,setter,iteratee,accumulator){for(var index=-1,length=array.length;++index<length;){var value=array[index];setter(accumulator,value,iteratee(value),array)}return accumulator}module.exports=arrayAggregator},{}],10:[function(require,module,exports){function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}module.exports=arrayMap},{}],11:[function(require,module,exports){function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}module.exports=arraySome},{}],12:[function(require,module,exports){function assocDelete(array,key){var index=assocIndexOf(array,key);if(0>index)return!1;var lastIndex=array.length-1;index==lastIndex?array.pop():splice.call(array,index,1);return!0}var assocIndexOf=require("./_assocIndexOf"),arrayProto=Array.prototype,splice=arrayProto.splice;module.exports=assocDelete},{"./_assocIndexOf":15}],13:[function(require,module,exports){function assocGet(array,key){var index=assocIndexOf(array,key);return 0>index?void 0:array[index][1]}var assocIndexOf=require("./_assocIndexOf");module.exports=assocGet},{"./_assocIndexOf":15}],14:[function(require,module,exports){function assocHas(array,key){return assocIndexOf(array,key)>-1}var assocIndexOf=require("./_assocIndexOf");module.exports=assocHas},{"./_assocIndexOf":15}],15:[function(require,module,exports){function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}var eq=require("./eq");module.exports=assocIndexOf},{"./eq":76}],16:[function(require,module,exports){function assocSet(array,key,value){var index=assocIndexOf(array,key);0>index?array.push([key,value]):array[index][1]=value}var assocIndexOf=require("./_assocIndexOf");module.exports=assocSet},{"./_assocIndexOf":15}],17:[function(require,module,exports){function baseAggregator(collection,setter,iteratee,accumulator){baseEach(collection,function(value,key,collection){setter(accumulator,value,iteratee(value),collection)});return accumulator}var baseEach=require("./_baseEach");module.exports=baseAggregator},{"./_baseEach":19}],18:[function(require,module,exports){function baseCastPath(value){return isArray(value)?value:stringToPath(value)}var isArray=require("./isArray"),stringToPath=require("./_stringToPath");module.exports=baseCastPath},{"./_stringToPath":75,"./isArray":82}],19:[function(require,module,exports){var baseForOwn=require("./_baseForOwn"),createBaseEach=require("./_createBaseEach"),baseEach=createBaseEach(baseForOwn);module.exports=baseEach},{"./_baseForOwn":21,"./_createBaseEach":39}],20:[function(require,module,exports){var createBaseFor=require("./_createBaseFor"),baseFor=createBaseFor();module.exports=baseFor},{"./_createBaseFor":40}],21:[function(require,module,exports){function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}var baseFor=require("./_baseFor"),keys=require("./keys");module.exports=baseForOwn},{"./_baseFor":20,"./keys":93}],22:[function(require,module,exports){function baseGet(object,path){path=isKey(path,object)?[path+""]:baseCastPath(path);for(var index=0,length=path.length;null!=object&&length>index;)object=object[path[index++]];return index&&index==length?object:void 0}var baseCastPath=require("./_baseCastPath"),isKey=require("./_isKey");module.exports=baseGet},{"./_baseCastPath":18,"./_isKey":56}],23:[function(require,module,exports){function baseHas(object,key){return hasOwnProperty.call(object,key)||"object"==typeof object&&key in object&&null===getPrototypeOf(object)}var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,getPrototypeOf=Object.getPrototypeOf;module.exports=baseHas},{}],24:[function(require,module,exports){function baseHasIn(object,key){return key in Object(object)}module.exports=baseHasIn},{}],25:[function(require,module,exports){function baseIsEqual(value,other,customizer,bitmask,stack){return value===other?!0:null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,bitmask,stack)}var baseIsEqualDeep=require("./_baseIsEqualDeep"),isObject=require("./isObject"),isObjectLike=require("./isObjectLike");module.exports=baseIsEqual},{"./_baseIsEqualDeep":26,"./isObject":88,"./isObjectLike":89}],26:[function(require,module,exports){function baseIsEqualDeep(object,other,equalFunc,customizer,bitmask,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=getTag(object);objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))}if(!othIsArr){othTag=getTag(other);othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other))}var objIsObj=objTag==objectTag&&!isHostObject(object),othIsObj=othTag==objectTag&&!isHostObject(other),isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag,equalFunc,customizer,bitmask);var isPartial=bitmask&PARTIAL_COMPARE_FLAG;if(!isPartial){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,bitmask,stack)}if(!isSameTag)return!1;stack||(stack=new Stack);return(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,bitmask,stack)}var Stack=require("./_Stack"),equalArrays=require("./_equalArrays"),equalByTag=require("./_equalByTag"),equalObjects=require("./_equalObjects"),getTag=require("./_getTag"),isArray=require("./isArray"),isHostObject=require("./_isHostObject"),isTypedArray=require("./isTypedArray"),PARTIAL_COMPARE_FLAG=2,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=baseIsEqualDeep},{"./_Stack":5,"./_equalArrays":41,"./_equalByTag":42,"./_equalObjects":43,"./_getTag":47,"./_isHostObject":54,"./isArray":82,"./isTypedArray":92}],27:[function(require,module,exports){function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;object=Object(object);for(;index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var stack=new Stack,result=customizer?customizer(objValue,srcValue,key,object,source,stack):void 0;if(!(void 0===result?baseIsEqual(srcValue,objValue,customizer,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG,stack):result))return!1}}return!0}var Stack=require("./_Stack"),baseIsEqual=require("./_baseIsEqual"),UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;module.exports=baseIsMatch},{"./_Stack":5,"./_baseIsEqual":25}],28:[function(require,module,exports){function baseIteratee(value){var type=typeof value;return"function"==type?value:null==value?identity:"object"==type?isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}var baseMatches=require("./_baseMatches"),baseMatchesProperty=require("./_baseMatchesProperty"),identity=require("./identity"),isArray=require("./isArray"),property=require("./property");module.exports=baseIteratee},{"./_baseMatches":30,"./_baseMatchesProperty":31,"./identity":80,"./isArray":82,"./property":95}],29:[function(require,module,exports){function baseKeys(object){return nativeKeys(Object(object))}var nativeKeys=Object.keys;module.exports=baseKeys},{}],30:[function(require,module,exports){function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null==object?!1:object[key]===value&&(void 0!==value||key in Object(object))}}return function(object){return object===source||baseIsMatch(object,source,matchData)}}var baseIsMatch=require("./_baseIsMatch"),getMatchData=require("./_getMatchData");module.exports=baseMatches},{"./_baseIsMatch":27,"./_getMatchData":45}],31:[function(require,module,exports){function baseMatchesProperty(path,srcValue){return function(object){var objValue=get(object,path);return void 0===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,void 0,UNORDERED_COMPARE_FLAG|PARTIAL_COMPARE_FLAG)}}var baseIsEqual=require("./_baseIsEqual"),get=require("./get"),hasIn=require("./hasIn"),UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;module.exports=baseMatchesProperty},{"./_baseIsEqual":25,"./get":77,"./hasIn":79}],32:[function(require,module,exports){function baseProperty(key){return function(object){return null==object?void 0:object[key]}}module.exports=baseProperty},{}],33:[function(require,module,exports){function basePropertyDeep(path){return function(object){return baseGet(object,path)}}var baseGet=require("./_baseGet");module.exports=basePropertyDeep},{"./_baseGet":22}],34:[function(require,module,exports){function baseSlice(array,start,end){var index=-1,length=array.length;0>start&&(start=-start>length?0:length+start);end=end>length?length:end;0>end&&(end+=length);length=start>end?0:end-start>>>0;start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}module.exports=baseSlice},{}],35:[function(require,module,exports){function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}module.exports=baseTimes},{}],36:[function(require,module,exports){function baseToPairs(object,props){return arrayMap(props,function(key){return[key,object[key]]})}var arrayMap=require("./_arrayMap");module.exports=baseToPairs},{"./_arrayMap":10}],37:[function(require,module,exports){function checkGlobal(value){return value&&value.Object===Object?value:null}module.exports=checkGlobal},{}],38:[function(require,module,exports){function createAggregator(setter,initializer){return function(collection,iteratee){var func=isArray(collection)?arrayAggregator:baseAggregator,accumulator=initializer?initializer():{};return func(collection,setter,baseIteratee(iteratee),accumulator)}}var arrayAggregator=require("./_arrayAggregator"),baseAggregator=require("./_baseAggregator"),baseIteratee=require("./_baseIteratee"),isArray=require("./isArray");module.exports=createAggregator},{"./_arrayAggregator":9,"./_baseAggregator":17,"./_baseIteratee":28,"./isArray":82}],39:[function(require,module,exports){function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&iteratee(iterable[index],index,iterable)!==!1;);return collection}}var isArrayLike=require("./isArrayLike");module.exports=createBaseEach},{"./isArrayLike":83}],40:[function(require,module,exports){function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===!1)break}return object}}module.exports=createBaseFor},{}],41:[function(require,module,exports){function equalArrays(array,other,equalFunc,customizer,bitmask,stack){var index=-1,isPartial=bitmask&PARTIAL_COMPARE_FLAG,isUnordered=bitmask&UNORDERED_COMPARE_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked)return stacked==other;var result=!0;stack.set(array,other);for(;++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(isUnordered){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,bitmask,stack)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,bitmask,stack)){result=!1;break}}stack["delete"](array);return result}var arraySome=require("./_arraySome"),UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2;module.exports=equalArrays},{"./_arraySome":11}],42:[function(require,module,exports){function equalByTag(object,other,tag,equalFunc,customizer,bitmask){switch(tag){case arrayBufferTag:return object.byteLength==other.byteLength&&equalFunc(new Uint8Array(object),new Uint8Array(other))?!0:!1;case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&PARTIAL_COMPARE_FLAG;convert||(convert=setToArray);return(isPartial||object.size==other.size)&&equalFunc(convert(object),convert(other),customizer,bitmask|UNORDERED_COMPARE_FLAG);case symbolTag:return!!Symbol&&symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}var Symbol=require("./_Symbol"),Uint8Array=require("./_Uint8Array"),mapToArray=require("./_mapToArray"),setToArray=require("./_setToArray"),UNORDERED_COMPARE_FLAG=1,PARTIAL_COMPARE_FLAG=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=Symbol?symbolProto.valueOf:void 0;module.exports=equalByTag},{"./_Symbol":6,"./_Uint8Array":7,"./_mapToArray":65,"./_setToArray":69}],43:[function(require,module,exports){function equalObjects(object,other,equalFunc,customizer,bitmask,stack){var isPartial=bitmask&PARTIAL_COMPARE_FLAG,objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:baseHas(other,key)))return!1}var stacked=stack.get(object);if(stacked)return stacked==other;var result=!0;stack.set(object,other);for(var skipCtor=isPartial;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,customizer,bitmask,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor)&&(result=!1)}stack["delete"](object);return result}var baseHas=require("./_baseHas"),keys=require("./keys"),PARTIAL_COMPARE_FLAG=2;module.exports=equalObjects},{"./_baseHas":23,"./keys":93}],44:[function(require,module,exports){var baseProperty=require("./_baseProperty"),getLength=baseProperty("length");module.exports=getLength},{"./_baseProperty":32}],45:[function(require,module,exports){function getMatchData(object){for(var result=toPairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}var isStrictComparable=require("./_isStrictComparable"),toPairs=require("./toPairs");module.exports=getMatchData},{"./_isStrictComparable":59,"./toPairs":96}],46:[function(require,module,exports){function getNative(object,key){var value=null==object?void 0:object[key];return isNative(value)?value:void 0}var isNative=require("./isNative");module.exports=getNative},{"./isNative":87}],47:[function(require,module,exports){function getTag(value){return objectToString.call(value)}var Map=require("./_Map"),Set=require("./_Set"),WeakMap=require("./_WeakMap"),mapTag="[object Map]",objectTag="[object Object]",setTag="[object Set]",weakMapTag="[object WeakMap]",objectProto=Object.prototype,funcToString=Function.prototype.toString,objectToString=objectProto.toString,mapCtorString=Map?funcToString.call(Map):"",setCtorString=Set?funcToString.call(Set):"",weakMapCtorString=WeakMap?funcToString.call(WeakMap):"";(Map&&getTag(new Map)!=mapTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag)&&(getTag=function(value){var result=objectToString.call(value),Ctor=result==objectTag?value.constructor:null,ctorString="function"==typeof Ctor?funcToString.call(Ctor):"";if(ctorString)switch(ctorString){case mapCtorString:return mapTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return result});module.exports=getTag},{"./_Map":2,"./_Set":4,"./_WeakMap":8}],48:[function(require,module,exports){function hasPath(object,path,hasFunc){if(null==object)return!1;var result=hasFunc(object,path);if(!result&&!isKey(path)){path=baseCastPath(path);object=parent(object,path);if(null!=object){path=last(path);result=hasFunc(object,path)}}var length=object?object.length:void 0;return result||!!length&&isLength(length)&&isIndex(path,length)&&(isArray(object)||isString(object)||isArguments(object))}var baseCastPath=require("./_baseCastPath"),isArguments=require("./isArguments"),isArray=require("./isArray"),isIndex=require("./_isIndex"),isKey=require("./_isKey"),isLength=require("./isLength"),isString=require("./isString"),last=require("./last"),parent=require("./_parent");module.exports=hasPath},{"./_baseCastPath":18,"./_isIndex":55,"./_isKey":56,"./_parent":67,"./isArguments":81,"./isArray":82,"./isLength":86,"./isString":90,"./last":94}],49:[function(require,module,exports){function hashDelete(hash,key){return hashHas(hash,key)&&delete hash[key]}var hashHas=require("./_hashHas");module.exports=hashDelete},{"./_hashHas":51}],50:[function(require,module,exports){function hashGet(hash,key){if(nativeCreate){var result=hash[key];return result===HASH_UNDEFINED?void 0:result}return hasOwnProperty.call(hash,key)?hash[key]:void 0}var nativeCreate=require("./_nativeCreate"),HASH_UNDEFINED="__lodash_hash_undefined__",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=hashGet},{"./_nativeCreate":66}],51:[function(require,module,exports){function hashHas(hash,key){return nativeCreate?void 0!==hash[key]:hasOwnProperty.call(hash,key)}var nativeCreate=require("./_nativeCreate"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=hashHas},{"./_nativeCreate":66}],52:[function(require,module,exports){function hashSet(hash,key,value){hash[key]=nativeCreate&&void 0===value?HASH_UNDEFINED:value}var nativeCreate=require("./_nativeCreate"),HASH_UNDEFINED="__lodash_hash_undefined__";module.exports=hashSet},{"./_nativeCreate":66}],53:[function(require,module,exports){function indexKeys(object){var length=object?object.length:void 0;return isLength(length)&&(isArray(object)||isString(object)||isArguments(object))?baseTimes(length,String):null}var baseTimes=require("./_baseTimes"),isArguments=require("./isArguments"),isArray=require("./isArray"),isLength=require("./isLength"),isString=require("./isString");module.exports=indexKeys},{"./_baseTimes":35,"./isArguments":81,"./isArray":82,"./isLength":86,"./isString":90}],54:[function(require,module,exports){function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}module.exports=isHostObject},{}],55:[function(require,module,exports){function isIndex(value,length){value="number"==typeof value||reIsUint.test(value)?+value:-1;length=null==length?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&length>value}var MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;module.exports=isIndex},{}],56:[function(require,module,exports){function isKey(value,object){return"number"==typeof value?!0:!isArray(value)&&(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}var isArray=require("./isArray"),reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;module.exports=isKey},{"./isArray":82}],57:[function(require,module,exports){function isKeyable(value){var type=typeof value;return"number"==type||"boolean"==type||"string"==type&&"__proto__"!=value||null==value}module.exports=isKeyable},{}],58:[function(require,module,exports){function isPrototype(value){var Ctor=value&&value.constructor,proto=isFunction(Ctor)&&Ctor.prototype||objectProto;return value===proto}var isFunction=require("./isFunction"),objectProto=Object.prototype;module.exports=isPrototype},{"./isFunction":85}],59:[function(require,module,exports){function isStrictComparable(value){return value===value&&!isObject(value)}var isObject=require("./isObject");module.exports=isStrictComparable},{"./isObject":88}],60:[function(require,module,exports){function mapClear(){this.__data__={hash:new Hash,map:Map?new Map:[],string:new Hash}}var Hash=require("./_Hash"),Map=require("./_Map");module.exports=mapClear},{"./_Hash":1,"./_Map":2}],61:[function(require,module,exports){function mapDelete(key){var data=this.__data__;return isKeyable(key)?hashDelete("string"==typeof key?data.string:data.hash,key):Map?data.map["delete"](key):assocDelete(data.map,key)}var Map=require("./_Map"),assocDelete=require("./_assocDelete"),hashDelete=require("./_hashDelete"),isKeyable=require("./_isKeyable");module.exports=mapDelete},{"./_Map":2,"./_assocDelete":12,"./_hashDelete":49,"./_isKeyable":57}],62:[function(require,module,exports){function mapGet(key){var data=this.__data__;return isKeyable(key)?hashGet("string"==typeof key?data.string:data.hash,key):Map?data.map.get(key):assocGet(data.map,key)}var Map=require("./_Map"),assocGet=require("./_assocGet"),hashGet=require("./_hashGet"),isKeyable=require("./_isKeyable");module.exports=mapGet},{"./_Map":2,"./_assocGet":13,"./_hashGet":50,"./_isKeyable":57}],63:[function(require,module,exports){function mapHas(key){var data=this.__data__;return isKeyable(key)?hashHas("string"==typeof key?data.string:data.hash,key):Map?data.map.has(key):assocHas(data.map,key)}var Map=require("./_Map"),assocHas=require("./_assocHas"),hashHas=require("./_hashHas"),isKeyable=require("./_isKeyable");module.exports=mapHas},{"./_Map":2,"./_assocHas":14,"./_hashHas":51,"./_isKeyable":57}],64:[function(require,module,exports){function mapSet(key,value){var data=this.__data__;isKeyable(key)?hashSet("string"==typeof key?data.string:data.hash,key,value):Map?data.map.set(key,value):assocSet(data.map,key,value);return this}var Map=require("./_Map"),assocSet=require("./_assocSet"),hashSet=require("./_hashSet"),isKeyable=require("./_isKeyable");module.exports=mapSet},{"./_Map":2,"./_assocSet":16,"./_hashSet":52,"./_isKeyable":57}],65:[function(require,module,exports){function mapToArray(map){var index=-1,result=Array(map.size);map.forEach(function(value,key){result[++index]=[key,value]});return result}module.exports=mapToArray},{}],66:[function(require,module,exports){var getNative=require("./_getNative"),nativeCreate=getNative(Object,"create");module.exports=nativeCreate},{"./_getNative":46}],67:[function(require,module,exports){function parent(object,path){return 1==path.length?object:get(object,baseSlice(path,0,-1))}var baseSlice=require("./_baseSlice"),get=require("./get");module.exports=parent},{"./_baseSlice":34,"./get":77}],68:[function(require,module,exports){(function(global){var checkGlobal=require("./_checkGlobal"),objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:void 0,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:void 0,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")();module.exports=root}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_checkGlobal":37}],69:[function(require,module,exports){function setToArray(set){var index=-1,result=Array(set.size);set.forEach(function(value){result[++index]=value});return result}module.exports=setToArray},{}],70:[function(require,module,exports){function stackClear(){this.__data__={array:[],map:null}}module.exports=stackClear},{}],71:[function(require,module,exports){function stackDelete(key){var data=this.__data__,array=data.array;return array?assocDelete(array,key):data.map["delete"](key)}var assocDelete=require("./_assocDelete");module.exports=stackDelete},{"./_assocDelete":12}],72:[function(require,module,exports){function stackGet(key){var data=this.__data__,array=data.array;return array?assocGet(array,key):data.map.get(key)}var assocGet=require("./_assocGet");module.exports=stackGet},{"./_assocGet":13}],73:[function(require,module,exports){function stackHas(key){var data=this.__data__,array=data.array;return array?assocHas(array,key):data.map.has(key)}var assocHas=require("./_assocHas");module.exports=stackHas},{"./_assocHas":14}],74:[function(require,module,exports){function stackSet(key,value){var data=this.__data__,array=data.array;if(array)if(array.length<LARGE_ARRAY_SIZE-1)assocSet(array,key,value);else{data.array=null;data.map=new MapCache(array)}var map=data.map;map&&map.set(key,value);return this}var MapCache=require("./_MapCache"),assocSet=require("./_assocSet"),LARGE_ARRAY_SIZE=200;module.exports=stackSet},{"./_MapCache":3,"./_assocSet":16}],75:[function(require,module,exports){function stringToPath(string){var result=[];toString(string).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result}var toString=require("./toString"),rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,reEscapeChar=/\\(\\)?/g;module.exports=stringToPath},{"./toString":97}],76:[function(require,module,exports){function eq(value,other){return value===other||value!==value&&other!==other}module.exports=eq},{}],77:[function(require,module,exports){function get(object,path,defaultValue){var result=null==object?void 0:baseGet(object,path);return void 0===result?defaultValue:result}var baseGet=require("./_baseGet");module.exports=get},{"./_baseGet":22}],78:[function(require,module,exports){var createAggregator=require("./_createAggregator"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]});module.exports=groupBy},{"./_createAggregator":38}],79:[function(require,module,exports){function hasIn(object,path){return hasPath(object,path,baseHasIn)}var baseHasIn=require("./_baseHasIn"),hasPath=require("./_hasPath");module.exports=hasIn},{"./_baseHasIn":24,"./_hasPath":48}],80:[function(require,module,exports){function identity(value){return value}module.exports=identity},{}],81:[function(require,module,exports){function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArrayLikeObject=require("./isArrayLikeObject"),argsTag="[object Arguments]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,propertyIsEnumerable=objectProto.propertyIsEnumerable;module.exports=isArguments},{"./isArrayLikeObject":84}],82:[function(require,module,exports){var isArray=Array.isArray;module.exports=isArray},{}],83:[function(require,module,exports){function isArrayLike(value){return null!=value&&!("function"==typeof value&&isFunction(value))&&isLength(getLength(value))}var getLength=require("./_getLength"),isFunction=require("./isFunction"),isLength=require("./isLength");module.exports=isArrayLike},{"./_getLength":44,"./isFunction":85,"./isLength":86}],84:[function(require,module,exports){function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isArrayLike=require("./isArrayLike"),isObjectLike=require("./isObjectLike");module.exports=isArrayLikeObject},{"./isArrayLike":83,"./isObjectLike":89}],85:[function(require,module,exports){function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}var isObject=require("./isObject"),funcTag="[object Function]",genTag="[object GeneratorFunction]",objectProto=Object.prototype,objectToString=objectProto.toString;
module.exports=isFunction},{"./isObject":88}],86:[function(require,module,exports){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&MAX_SAFE_INTEGER>=value}var MAX_SAFE_INTEGER=9007199254740991;module.exports=isLength},{}],87:[function(require,module,exports){function isNative(value){return null==value?!1:isFunction(value)?reIsNative.test(funcToString.call(value)):isObjectLike(value)&&(isHostObject(value)?reIsNative:reIsHostCtor).test(value)}var isFunction=require("./isFunction"),isHostObject=require("./_isHostObject"),isObjectLike=require("./isObjectLike"),reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto=Object.prototype,funcToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");module.exports=isNative},{"./_isHostObject":54,"./isFunction":85,"./isObjectLike":89}],88:[function(require,module,exports){function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}module.exports=isObject},{}],89:[function(require,module,exports){function isObjectLike(value){return!!value&&"object"==typeof value}module.exports=isObjectLike},{}],90:[function(require,module,exports){function isString(value){return"string"==typeof value||!isArray(value)&&isObjectLike(value)&&objectToString.call(value)==stringTag}var isArray=require("./isArray"),isObjectLike=require("./isObjectLike"),stringTag="[object String]",objectProto=Object.prototype,objectToString=objectProto.toString;module.exports=isString},{"./isArray":82,"./isObjectLike":89}],91:[function(require,module,exports){function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&objectToString.call(value)==symbolTag}var isObjectLike=require("./isObjectLike"),symbolTag="[object Symbol]",objectProto=Object.prototype,objectToString=objectProto.toString;module.exports=isSymbol},{"./isObjectLike":89}],92:[function(require,module,exports){function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objectToString.call(value)]}var isLength=require("./isLength"),isObjectLike=require("./isObjectLike"),argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var objectProto=Object.prototype,objectToString=objectProto.toString;module.exports=isTypedArray},{"./isLength":86,"./isObjectLike":89}],93:[function(require,module,exports){function keys(object){var isProto=isPrototype(object);if(!isProto&&!isArrayLike(object))return baseKeys(object);var indexes=indexKeys(object),skipIndexes=!!indexes,result=indexes||[],length=result.length;for(var key in object)!baseHas(object,key)||skipIndexes&&("length"==key||isIndex(key,length))||isProto&&"constructor"==key||result.push(key);return result}var baseHas=require("./_baseHas"),baseKeys=require("./_baseKeys"),indexKeys=require("./_indexKeys"),isArrayLike=require("./isArrayLike"),isIndex=require("./_isIndex"),isPrototype=require("./_isPrototype");module.exports=keys},{"./_baseHas":23,"./_baseKeys":29,"./_indexKeys":53,"./_isIndex":55,"./_isPrototype":58,"./isArrayLike":83}],94:[function(require,module,exports){function last(array){var length=array?array.length:0;return length?array[length-1]:void 0}module.exports=last},{}],95:[function(require,module,exports){function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}var baseProperty=require("./_baseProperty"),basePropertyDeep=require("./_basePropertyDeep"),isKey=require("./_isKey");module.exports=property},{"./_baseProperty":32,"./_basePropertyDeep":33,"./_isKey":56}],96:[function(require,module,exports){function toPairs(object){return baseToPairs(object,keys(object))}var baseToPairs=require("./_baseToPairs"),keys=require("./keys");module.exports=toPairs},{"./_baseToPairs":36,"./keys":93}],97:[function(require,module,exports){function toString(value){if("string"==typeof value)return value;if(null==value)return"";if(isSymbol(value))return Symbol?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}var Symbol=require("./_Symbol"),isSymbol=require("./isSymbol"),INFINITY=1/0,symbolProto=Symbol?Symbol.prototype:void 0,symbolToString=Symbol?symbolProto.toString:void 0;module.exports=toString},{"./_Symbol":6,"./isSymbol":91}],98:[function(require,module,exports){"use strict";var Route=require("./lib/route");module.exports=Route},{"./lib/route":99}],99:[function(require,module,exports){"use strict";function Route(spec){var route;route=this?this:Object.create(Route.prototype);if("undefined"==typeof spec)throw new Error("A route spec is required");route.spec=spec;route.ast=Parser.parse(spec);return route}var Parser=require("./route/parser"),RegexpVisitor=require("./route/visitors/regexp"),ReverseVisitor=require("./route/visitors/reverse");Route.prototype=Object.create(null);Route.prototype.match=function(path){var re=RegexpVisitor.visit(this.ast),matched=re.match(path);return matched?matched:!1};Route.prototype.reverse=function(params){return ReverseVisitor.visit(this.ast,params)};module.exports=Route},{"./route/parser":102,"./route/visitors/regexp":104,"./route/visitors/reverse":105}],100:[function(require,module,exports){var parser=function(){function Parser(){this.yy={}}var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,9],$V1=[1,10],$V2=[1,11],$V3=[1,12],$V4=[5,11,12,13,14,15],parser={trace:function trace(){},yy:{},symbols_:{error:2,root:3,expressions:4,EOF:5,expression:6,optional:7,literal:8,splat:9,param:10,"(":11,")":12,LITERAL:13,SPLAT:14,PARAM:15,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",11:"(",12:")",13:"LITERAL",14:"SPLAT",15:"PARAM"},productions_:[0,[3,2],[3,1],[4,2],[4,1],[6,1],[6,1],[6,1],[6,1],[7,3],[8,1],[9,1],[10,1]],performAction:function anonymous(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return new yy.Root({},[$$[$0-1]]);case 2:return new yy.Root({},[new yy.Literal({value:""})]);case 3:this.$=new yy.Concat({},[$$[$0-1],$$[$0]]);break;case 4:case 5:this.$=$$[$0];break;case 6:this.$=new yy.Literal({value:$$[$0]});break;case 7:this.$=new yy.Splat({name:$$[$0]});break;case 8:this.$=new yy.Param({name:$$[$0]});break;case 9:this.$=new yy.Optional({},[$$[$0-1]]);break;case 10:this.$=yytext;break;case 11:case 12:this.$=yytext.slice(1)}},table:[{3:1,4:2,5:[1,3],6:4,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},{1:[3]},{5:[1,13],6:14,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},{1:[2,2]},o($V4,[2,4]),o($V4,[2,5]),o($V4,[2,6]),o($V4,[2,7]),o($V4,[2,8]),{4:15,6:4,7:5,8:6,9:7,10:8,11:$V0,13:$V1,14:$V2,15:$V3},o($V4,[2,10]),o($V4,[2,11]),o($V4,[2,12]),{1:[2,1]},o($V4,[2,3]),{6:14,7:5,8:6,9:7,10:8,11:$V0,12:[1,16],13:$V1,14:$V2,15:$V3},o($V4,[2,9])],defaultActions:{3:[2,2],13:[2,1]},parseError:function parseError(str,hash){function _parseError(msg,hash){this.message=msg;this.hash=hash}if(!hash.recoverable){_parseError.prototype=Error;throw new _parseError(str,hash)}this.trace(str)},parse:function parse(input){function popStack(n){stack.length=stack.length-2*n;vstack.length=vstack.length-n;lstack.length=lstack.length-n}var self=this,stack=[0],tstack=[],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,recovering=0,TERROR=2,EOF=1,args=lstack.slice.call(arguments,1),lexer=Object.create(this.lexer),sharedState={yy:{}};for(var k in this.yy)Object.prototype.hasOwnProperty.call(this.yy,k)&&(sharedState.yy[k]=this.yy[k]);lexer.setInput(input,sharedState.yy);sharedState.yy.lexer=lexer;sharedState.yy.parser=this;"undefined"==typeof lexer.yylloc&&(lexer.yylloc={});var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;"function"==typeof sharedState.yy.parseError?this.parseError=sharedState.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var lex=function(){var token;token=lexer.lex()||EOF;"number"!=typeof token&&(token=self.symbols_[token]||token);return token},symbol,preErrorSymbol,state,action,a,r,yyval={},p,len,newState,expected;;){state=stack[stack.length-1];if(this.defaultActions[state])action=this.defaultActions[state];else{(null===symbol||"undefined"==typeof symbol)&&(symbol=lex());action=table[state]&&table[state][symbol]}if("undefined"==typeof action||!action.length||!action[0]){var errStr="";expected=[];for(p in table[state])this.terminals_[p]&&p>TERROR&&expected.push("'"+this.terminals_[p]+"'");errStr=lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(symbol==EOF?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'");this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:yyloc,expected:expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol);vstack.push(lexer.yytext);lstack.push(lexer.yylloc);stack.push(action[1]);symbol=null;if(preErrorSymbol){symbol=preErrorSymbol;preErrorSymbol=null}else{yyleng=lexer.yyleng;yytext=lexer.yytext;yylineno=lexer.yylineno;yyloc=lexer.yylloc;recovering>0&&recovering--}break;case 2:len=this.productions_[action[1]][1];yyval.$=vstack[vstack.length-len];yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column};ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]);r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args));if("undefined"!=typeof r)return r;if(len){stack=stack.slice(0,-1*len*2);vstack=vstack.slice(0,-1*len);lstack=lstack.slice(0,-1*len)}stack.push(this.productions_[action[1]][0]);vstack.push(yyval.$);lstack.push(yyval._$);newState=table[stack[stack.length-2]][stack[stack.length-1]];stack.push(newState);break;case 3:return!0}}return!0}},lexer=function(){var lexer={EOF:1,parseError:function parseError(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input,yy){this.yy=yy||this.yy||{};this._input=input;this._more=this._backtrack=this.done=!1;this.yylineno=this.yyleng=0;this.yytext=this.matched=this.match="";this.conditionStack=["INITIAL"];this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0};this.options.ranges&&(this.yylloc.range=[0,0]);this.offset=0;return this},input:function(){var ch=this._input[0];this.yytext+=ch;this.yyleng++;this.offset++;this.match+=ch;this.matched+=ch;var lines=ch.match(/(?:\r\n?|\n).*/g);if(lines){this.yylineno++;this.yylloc.last_line++}else this.yylloc.last_column++;this.options.ranges&&this.yylloc.range[1]++;this._input=this._input.slice(1);return ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input;this.yytext=this.yytext.substr(0,this.yytext.length-len);this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1);this.matched=this.matched.substr(0,this.matched.length-1);lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len};this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]);this.yyleng=this.yytext.length;return this},more:function(){this._more=!0;return this},reject:function(){if(!this.options.backtrack_lexer)return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});this._backtrack=!0;return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;next.length<20&&(next+=this._input.substr(0,20-next.length));return(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer){backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done};this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))}lines=match[0].match(/(?:\r\n?|\n).*/g);lines&&(this.yylineno+=lines.length);this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length};this.yytext+=match[0];this.match+=match[0];this.matches=match;this.yyleng=this.yytext.length;this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]);this._more=!1;this._backtrack=!1;this._input=this._input.slice(match[0].length);this.matched+=match[0];token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]);this.done&&this._input&&(this.done=!1);if(token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var token,match,tempMatch,index;if(!this._more){this.yytext="";this.match=""}for(var rules=this._currentRules(),i=0;i<rules.length;i++){tempMatch=this._input.match(this.rules[rules[i]]);if(tempMatch&&(!match||tempMatch[0].length>match[0].length)){match=tempMatch;index=i;if(this.options.backtrack_lexer){token=this.test_match(tempMatch,rules[i]);if(token!==!1)return token;if(this._backtrack){match=!1;continue}return!1}if(!this.options.flex)break}}if(match){token=this.test_match(match,rules[index]);return token!==!1?token:!1}return""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function lex(){var r=this.next();return r?r:this.lex()},begin:function begin(condition){this.conditionStack.push(condition)},popState:function popState(){var n=this.conditionStack.length-1;return n>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function _currentRules(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function topState(n){n=this.conditionStack.length-1-Math.abs(n||0);return n>=0?this.conditionStack[n]:"INITIAL"},pushState:function pushState(condition){this.begin(condition)},stateStackSize:function stateStackSize(){return this.conditionStack.length},options:{},performAction:function anonymous(yy,yy_,$avoiding_name_collisions,YY_START){var YYSTATE=YY_START;switch($avoiding_name_collisions){case 0:return"(";case 1:return")";case 2:return"SPLAT";case 3:return"PARAM";case 4:return"LITERAL";case 5:return"LITERAL";case 6:return"EOF"}},rules:[/^(?:\()/,/^(?:\))/,/^(?:\*+\w+)/,/^(?::+\w+)/,/^(?:[\w%\-~\n]+)/,/^(?:.)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6],inclusive:!0}}};return lexer}();parser.lexer=lexer;Parser.prototype=parser;parser.Parser=Parser;return new Parser}();if("undefined"!=typeof require&&"undefined"!=typeof exports){exports.parser=parser;exports.Parser=parser.Parser;exports.parse=function(){return parser.parse.apply(parser,arguments)}}},{}],101:[function(require,module,exports){"use strict";function createNode(displayName){return function(props,children){return{displayName:displayName,props:props,children:children||[]}}}module.exports={Root:createNode("Root"),Concat:createNode("Concat"),Literal:createNode("Literal"),Splat:createNode("Splat"),Param:createNode("Param"),Optional:createNode("Optional")}},{}],102:[function(require,module,exports){"use strict";var parser=require("./compiled-grammar").parser;parser.yy=require("./nodes");module.exports=parser},{"./compiled-grammar":100,"./nodes":101}],103:[function(require,module,exports){"use strict";function createVisitor(handlers){nodeTypes.forEach(function(nodeType){if("undefined"==typeof handlers[nodeType])throw new Error("No handler defined for "+nodeType.displayName)});return{visit:function(node,context){return this.handlers[node.displayName].call(this,node,context)},handlers:handlers}}var nodeTypes=Object.keys(require("../nodes"));module.exports=createVisitor},{"../nodes":101}],104:[function(require,module,exports){"use strict";function Matcher(options){this.captures=options.captures;this.re=options.re}var createVisitor=require("./create_visitor"),escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;Matcher.prototype.match=function(path){var match=this.re.exec(path),matchParams={};if(match){this.captures.forEach(function(capture,i){"undefined"==typeof match[i+1]?matchParams[capture]=void 0:matchParams[capture]=decodeURIComponent(match[i+1])});return matchParams}};var RegexpVisitor=createVisitor({Concat:function(node){return node.children.reduce(function(memo,child){var childResult=this.visit(child);return{re:memo.re+childResult.re,captures:memo.captures.concat(childResult.captures)}}.bind(this),{re:"",captures:[]})},Literal:function(node){return{re:node.props.value.replace(escapeRegExp,"\\$&"),captures:[]}},Splat:function(node){return{re:"([^?]*?)",captures:[node.props.name]}},Param:function(node){return{re:"([^\\/\\?]+)",captures:[node.props.name]}},Optional:function(node){var child=this.visit(node.children[0]);return{re:"(?:"+child.re+")?",captures:child.captures}},Root:function(node){var childResult=this.visit(node.children[0]);return new Matcher({re:new RegExp("^"+childResult.re+"(?=\\?|$)"),captures:childResult.captures})}});module.exports=RegexpVisitor},{"./create_visitor":103}],105:[function(require,module,exports){"use strict";var createVisitor=require("./create_visitor"),ReverseVisitor=createVisitor({Concat:function(node,context){var childResults=node.children.map(function(child){return this.visit(child,context)}.bind(this));return childResults.some(function(c){return c===!1})?!1:childResults.join("")},Literal:function(node){return decodeURI(node.props.value)},Splat:function(node,context){return context[node.props.name]?context[node.props.name]:!1},Param:function(node,context){return context[node.props.name]?context[node.props.name]:!1},Optional:function(node,context){var childResult=this.visit(node.children[0],context);return childResult?childResult:""},Root:function(node,context){context=context||{};var childResult=this.visit(node.children[0],context);return childResult?encodeURI(childResult):!1}});module.exports=ReverseVisitor},{"./create_visitor":103}],106:[function(require,module,exports){module.exports="<ul class=IconList> <li> <i class=ion-ios-list-outline></i> <p>Find new clients with one marketplace listing</p> </li> <li> <i class=ion-cash></i> <p>No hassle payments via direct deposit or Venmo</p> </li> <li> <i class=ion-umbrella></i> <p>Protect you and your clients with access to insurance</p> </li> <li> <i class=ion-ios-close-outline></i> <p>Reduce no-shows with our standard cancellation policy</p> </li> <li> <i class=ion-ios-help-outline></i> <p>Find support and expertise in our community forums</p> </li> </ul>"},{}],107:[function(require,module,exports){module.exports='<ul class=IconList> <li> <i class=ion-ios-plus-outline></i> <p>Everything in the Free plan <strong>plus:</strong></p> </li> <li> <i class=ion-ios-glasses-outline></i> <p>Learn new skills to grow your biz at our monthly workshops</p> </li> <li> <i class="fa fa-handshake-o"></i> <p>Meet & match with referral partners in the cooperative</p> </li> <li> <i class=ion-ios-paper-outline></i> <p>Expand your offerings with extra marketplace listings</p> </li> <li> <i class=ion-ios-cart-outline></i> <p>Preferred listing placement in the marketplace</p> </li> <li> <i class=ion-ios-color-filter-outline></i> <p>Ownership-Earn patronage & vote/run for board of directors</p> </li> </ul>'},{}],108:[function(require,module,exports){module.exports='<ul class=IconList> <li> <i class=ion-ios-plus-outline></i> <p>Everything in the Growth plan <strong>plus:</strong></p> </li> <li> <i class=ion-android-calendar></i> <p>Get organized with our scheduling software</p> </li> <li> <i class=ion-ios-pricetags-outline></i> <p>Attract more clients by adding scheduling to your website</p> </li> <li> <i class=ion-ios-bolt-outline></i> <p>Increase your income & allow clients to book you instantly</p> </li> <li> <i class="fa fa-vcard-o"></i> <p>Build loyalty with client-specific pricing</p> </li> <li> <i class="fa fa-bank"></i> <p>Apply for a zero-interest loan through our partnership with Kiva</p> </li> </ul>'},{}],109:[function(require,module,exports){module.exports="<ul class=IconList> <li> <i class=ion-ios-plus-outline></i> <p>Everything in the Growth & Pro plans <strong>plus:</strong></p> </li> <li> <i class=ion-arrow-graph-up-right></i> <p>Get on track with a half-day biz assessment from experts</p> </li> <li> <i class=ion-social-usd-outline></i> <p>Save $78 with this option</p> </li> </ul>"},{}],110:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),A=Activity.extend(function AboutActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);var shell=this.app.shell;this.$activity.find("#about-index a").click(function(e){e.preventDefault();e.stopImmediatePropagation();$(this).tab("show");var link=$(this).attr("href").replace(/^#about-/,"");shell.replaceState(null,null,"#!about/"+link)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var tabName=state&&state.route.segments&&state.route.segments[0]||"us",tab=this.$activity.find('[href="#about-'+tabName+'"]');tab.length&&tab.tab("show")}},{"../components/Activity":223,jquery:!1}],111:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLinkProfessionals="/help/relatedArticles/201967756-telling-the-community-about-yourself";this.helpLinkClients="/help/relatedArticles/201960753-telling-the-community-about-yourself";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.isInOnboarding=app.model.onboarding.inProgress;this.contactInfo=new ContactInfoVM(app);this.marketplaceProfilePicture=new MarketplaceProfilePictureVM(app);this.user=this.contactInfo.user;var vms=[this.contactInfo,this.marketplaceProfilePicture];this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){Promise.all(vms.map(function(vm){return vm.save()})).then(function(){app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})};this.discard=function(){vms.forEach(function(vm){vm.discard&&vm.discard()})};this.sync=function(){vms.forEach(function(vm){vm.sync&&vm.sync()})};var createStatusObs=function(t,name){t[name]=ko.pureComputed(function(){vms.reduce(function(prev,vm){return vm[name]&&vm[name]()?!0:prev},!1)})};createStatusObs(this,"isLoading");createStatusObs(this,"isSaving");createStatusObs(this,"isSyncing");createStatusObs(this,"isLocked")}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function AboutMeActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Profile",{backLink:"/userProfile",helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Profile",{backLink:"/userProfile",helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.viewModel.navBar=this.navBar;this.registerHandler({target:this.app.model.userProfile,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save contact data.":"Unable to load contact data.";this.app.modals.showError({title:msg,error:err})}.bind(this)});this.registerHandler({target:this.app.model.homeAddress,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save address details.":"Unable to load address details.";this.app.modals.showError({title:msg,error:err})}.bind(this)});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save your public data.":"Unable to load your public data.";this.app.modals.showError({title:msg,error:err})}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.discard();this.updateNavBarState();this.viewModel.sync()};var ContactInfoVM=require("../viewmodels/ContactInfoVM"),MarketplaceProfilePictureVM=require("../viewmodels/MarketplaceProfilePictureVM")},{"../components/Activity":223,"../viewmodels/ContactInfoVM":374,"../viewmodels/MarketplaceProfilePictureVM":380,knockout:!1}],112:[function(require,module,exports){"use strict";function ViewModel(app){this.isServiceProfessional=app.model.userProfile.data.isServiceProfessional;this.activeUserPaymentPlan=app.model.userPaymentPlan.data}var Activity=require("../components/Activity"),A=Activity.extend(function AccountActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Account")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.userPaymentPlan.sync()}},{"../components/Activity":223}],113:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201211055-adding-job-profiles";this.isInOnboarding=app.model.onboarding.inProgress;this.isSaving=ko.observable(!1);this.isLocked=this.isSaving;this.jobTitles=ko.observableArray([]);this.addItem=function(item){var foundIndex=this.findItem(item);-1===foundIndex&&this.jobTitles.push(item)};this.addNewItem=function(jobTitleName){jobTitleName&&this.addItem({value:0,label:jobTitleName})};this.search=ko.observable(new SearchJobTitlesVM(app));this.search().onClickJobTitle=function(jobTitle){var item={value:jobTitle.jobTitleID(),label:jobTitle.singularName()};this.addItem(item)}.bind(this);this.search().onClickNoJobTitle=function(jobTitleName){this.addNewItem(jobTitleName)}.bind(this);this.search().customResultsButtonText("Add");this.searchText=this.search().searchTerm;this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isSaving()?"Saving...":"Save"},this);this.unsavedChanges=ko.pureComputed(function(){return!!this.jobTitles().length},this);this.findItem=function findItem(jobTitle){var foundIndex=-1;this.jobTitles().some(function(item,index){if(0!==jobTitle.value&&item.value===jobTitle.value||item.label===jobTitle.label){foundIndex=index;return!0}});return foundIndex};this.remove=function remove(jobTitle){var removeIndex=this.findItem(jobTitle);removeIndex>-1&&this.jobTitles.splice(removeIndex,1)}.bind(this);this.save=function save(){if(0!==this.jobTitles().length){this.isSaving(!0);var becomingProfessional=!app.model.userProfile.data.isServiceProfessional(),firstJobID=this.jobTitles()[0].value;Promise.all(this.jobTitles().map(function(jobTitle){return app.model.userJobProfile.createUserJobTitle({jobTitleID:jobTitle.value,jobTitleName:jobTitle.label})})).then(function(){var onEnd=function onEnd(){this.isSaving(!1);this.searchText("");this.jobTitles.removeAll();if(app.model.onboarding.inProgress()){app.model.onboarding.selectedJobTitleID(firstJobID);app.model.onboarding.goNext()}else app.successSave()}.bind(this);if(becomingProfessional)return app.model.userProfile.load({forceRemoteUpdate:!0}).then(function(){app.model.onboarding&&app.model.onboarding.skipToAddJobTitles();onEnd()});onEnd();return void 0}.bind(this))["catch"](function(error){this.searchText("");this.isSaving(!1);app.modals.showError({title:"Unable to add one or more job titles",error:error})}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),SearchJobTitlesVM=require("../viewmodels/SearchJobTitlesVM"),A=Activity.extend(function AddJobTitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduler",{backLink:"/scheduling",helpLink:this.viewModel.helpLink})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url||"/scheduling";var link=this.requestData.cancelLink||referrer;this.app.model.onboarding.updateNavBar(this.navBar)||this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var s=options.route.query.s;this.viewModel.searchText(s);this.viewModel.jobTitles.removeAll();this.updateNavBarState();if("true"===options.route.query.autoAddNew)this.viewModel.addNewItem(s);else if(options.route.query.id&&s){this.viewModel.addItem({
value:+options.route.query.id,label:s});this.viewModel.searchText("")}};var ko=require("knockout")},{"../components/Activity":223,"../viewmodels/SearchJobTitlesVM":389,knockout:!1}],114:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201965996-setting-your-service-locations-areas";this.isInOnboarding=app.model.onboarding.inProgress;this.header=ko.observable("Edit location");this.subheader=ko.observable("");this.errorMessages={postalCode:ko.observable("")};this.jobTitleID=ko.observable(0);this.addressID=ko.observable(0);this.clientUserID=ko.observable(0);this.jobTitleName=ko.observable("Job Title");this.addressVersion=ko.observable(null);this.address=ko.pureComputed(function(){var v=this.addressVersion();return v?v.version:null},this);this.postalCodeVM=new PostalCodeVM({appModel:app.model,address:this.address,postalCodeError:this.errorMessages.postalCode});this.isLoading=app.model.serviceAddresses.state.isLoading;this.isSaving=app.model.serviceAddresses.state.isSaving;this.isDeleting=app.model.serviceAddresses.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.serviceAddresses.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var add=this.address();return!add||!add.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.addressVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.addressVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){this.clientUserID()?this.onSave():app.model.serviceAddresses.setItem(this.address().model.toPlainObject()).then(function(serverData){this.address().model.updateWith(serverData);this.addressVersion().push({evenIfObsolete:!0});this.onSave(serverData.addressID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete location",message:"Are you sure? This cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.serviceAddresses.delItem(this.jobTitleID(),this.addressID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.serviceRadiusOptions=ko.observableArray([{value:.5,label:"0.5 miles"},{value:1,label:"1 mile"},{value:2,label:"2 miles"},{value:3,label:"3 miles"},{value:4,label:"4 miles"},{value:5,label:"5 miles"},{value:10,label:"10 miles"},{value:25,label:"25 miles"},{value:50,label:"50 miles"},{value:5e3,label:"I work remotely"}])}var ko=require("knockout"),Address=require("../models/Address"),Activity=require("../components/Activity"),PostalCodeVM=require("../viewmodels/PostalCode"),A=Activity.extend(function AddressEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Locations",{backLink:"/scheduling",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){jobTitleID?this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this)):this.viewModel.jobTitleName("Job Title")}.bind(this)});this.viewModel.onSave=function(addressID){if(this.requestData.returnNewAsSelected===!0){this.viewModel.clientUserID()?this.requestData.address=this.viewModel.address().model.toPlainObject(!0):this.requestData.addressID=addressID;this.app.shell.goBack(this.requestData)}else this.app.model.onboarding.inProgress()?this.app.shell.goBack():this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceAddresses/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);var params=options&&options.route&&options.route.segments||[],kind=params[0]||"",isService=kind===Address.kind.service,jobTitleID=isService?0|params[1]:0,addressID=isService?0|params[2]:0|params[1],serviceType=params[2]||"",clientUserID="clientLocation"===serviceType?params[3]:null;this.viewModel.jobTitleID(jobTitleID);this.viewModel.addressID(addressID);this.viewModel.clientUserID(clientUserID);this.updateNavBarState();if(addressID)this.app.model.serviceAddresses.getItemVersion(jobTitleID,addressID).then(function(addressVersion){if(addressVersion){this.viewModel.addressVersion(addressVersion);var address=addressVersion.original,header=address.isServiceLocation()&&address.kind()==Address.kind.service?"Place of work":"Edit location";this.viewModel.header(header)}else{this.viewModel.addressVersion(null);this.viewModel.header("Unknown or deleted location")}this.viewModel.subheader("");this.viewModel.postalCodeVM.onFormLoaded()}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.addressVersion(this.app.model.serviceAddresses.newItemVersion({jobTitleID:jobTitleID}));this.viewModel.subheader("");this.viewModel.postalCodeVM.onFormLoaded();switch(serviceType){case"serviceArea":this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!1);this.viewModel.header("Add an area where you work");this.viewModel.subheader("Clients will be able to book your offerings at locations within this area.");break;case"serviceLocation":this.viewModel.address().isServiceArea(!1);this.viewModel.address().isServiceLocation(!0);this.viewModel.header("Add a place where you work");this.viewModel.subheader("Clients will be able to book your offerings at this location.");break;case"clientLocation":this.viewModel.address().userID(clientUserID);this.viewModel.address().isServiceArea(!1);this.viewModel.address().isServiceLocation(!0);this.viewModel.header("Add a client location");break;default:this.viewModel.address().isServiceArea(!0);this.viewModel.address().isServiceLocation(!0);this.viewModel.header("Add a location")}}}},{"../components/Activity":223,"../models/Address":231,"../viewmodels/PostalCode":388,knockout:!1}],115:[function(require,module,exports){"use strict";function findAppointmentInList(list,id){var found=null,index=-1;list.some(function(apt,i){if(apt.id()===id){found=apt;index=i;return!0}});return{item:found,index:index}}function ViewModel(app){this.app=app;this.currentDate=ko.observable(new Date);this.currentID=ko.observable(0);this.currentIndex=ko.observable(0);this.editMode=ko.observable(!1);this.isLoading=ko.observable(!1);this.dateAvailability=ko.observable();this.appointments=ko.pureComputed(function(){var dateAvail=this.dateAvailability();return dateAvail&&dateAvail.appointmentsList()||[]},this);this.specialAppointmentIds=Appointment.specialIds;this.isNewCard=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this);this.formattedCurrentDate=ko.pureComputed(function(){var date=this.currentDate();return date?moment(date).format("dddd [(]M/D[)]"):""},this);this.defaultBackToCalendarUrl="calendar/";this.backToCalendarUrl=ko.pureComputed(function(){var date=this.currentDate();return date?this.defaultBackToCalendarUrl+date.toISOString():this.defaultBackToCalendarUrl},this);this.appointmentCardView=ko.observable(null);this.isEditButtonVisible=ko.pureComputed(function(){var a=this.appointmentCardView();return this.currentID()>0&&a&&!a.isLocked()&&!a.editMode()},this);var loadingAppointment=new Appointment({id:Appointment.specialIds.loading,summary:"Loading..."}),newEmptyDateAppointment=function newEmptyDateAppointment(){return new Appointment({id:Appointment.specialIds.emptyDate,summary:"You have nothing scheduled",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newUnavailableAppointment=function newUnavailableAppointment(){return new Appointment({id:Appointment.specialIds.unavailable,summary:"You`re unavailable all day",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newFreeAppointment=function newFreeAppointment(){return new Appointment({id:Appointment.specialIds.free,summary:"Free",startTime:this.currentDate(),endTime:moment(this.currentDate()).add(1,"days").toDate()})}.bind(this),newEventAppointment=function newEventAppointment(){return new Appointment({id:Appointment.specialIds.newEvent,summary:"New event...",sourceEvent:new CalendarEvent})},newBookingAppointment=function newBookingAppointment(){return new Appointment({id:Appointment.specialIds.newBooking,summary:"New booking...",sourceEvent:new CalendarEvent,sourceBooking:new Booking})};this.currentAppointment=ko.observable(loadingAppointment);this.updateUrl=function updateUrl(){var apt=this.currentAppointment(),aptId=apt.id(),found=/appointment\/([^\/]+)\/(\-?\d+)/i.exec(window.location),urlId=found&&0|found[2],urlDate=found&&found[1],curDateStr=getDateWithoutTime(apt.startTime()).toISOString();if(!found||urlId!==aptId.toString()||urlDate!==curDateStr){var url="appointment/"+curDateStr+"/"+aptId;""===urlId?this.app.shell.replaceState(null,null,url):this.app.shell.pushState(null,null,url)}};this.goPrevious=function goPrevious(){if(!this.editMode()){var index=this.currentIndex()-1;if(0>index){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var prevDate=m.subtract(1,"days").toDate();this.setCurrent(prevDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.goNext=function goNext(){if(!this.editMode()){var index=this.currentIndex()+1;if(index>=this.appointments().length){var m=moment(this.currentDate());m.isValid()||(m=moment(new Date));var nextDate=m.add(1,"days").toDate();this.setCurrent(nextDate).then(function(){this.updateUrl()}.bind(this))}else{index%=this.appointments().length;var apt=this.appointments()[index];this.currentIndex(index);this.currentID(apt.id());this.currentAppointment(apt);this.updateUrl()}}};this.getSpecialItem=function(id){switch(id){default:return newEmptyDateAppointment();case Appointment.specialIds.free:return newFreeAppointment();case Appointment.specialIds.newEvent:return newEventAppointment();case Appointment.specialIds.newBooking:return newBookingAppointment();case Appointment.specialIds.loading:return loadingAppointment;case Appointment.specialIds.unavailable:return newUnavailableAppointment()}};this.setItemFromCurrentList=function(id){var list=this.appointments(),index,item;if(-1>id){item=this.getSpecialItem(id);index=-1}else if(0===list.length){index=-1;item=0===this.dateAvailability().workDayMinutes()?newUnavailableAppointment():newEmptyDateAppointment()}else{item=list[0];index=0;if(id)if(id>0){var found=findAppointmentInList(list,id);if(found.item){item=found.item;index=found.index}}else{item=this.getSpecialItem(id);index=-1}}this.currentID(item.id());this.currentIndex(index);this.currentAppointment(item)};var _setCurrent=function setCurrent(date,id,type){date=date&&getDateWithoutTime(date)||null;date&&this.currentDate(date);if(date){this.isLoading(!0);return app.model.calendar.getDateAvailability(date).then(function(dateAvail){this.isLoading(!1);this.dateAvailability(dateAvail);this.setItemFromCurrentList(id)}.bind(this))["catch"](function(err){this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err})}.bind(this))}if(id>0){this.isLoading(!0);var notFound=function notFound(){this.isLoading(!1);return _setCurrent(new Date)}.bind(this),ids={};"booking"===type?ids.bookingID=id:ids.calendarEventID=id;return app.model.calendar.getAppointment(ids).then(function(item){if(item){var itDate=getDateWithoutTime(item.startTime());this.isLoading(!1);return _setCurrent(itDate,item.id())}return notFound()}.bind(this))["catch"](notFound)}return 0>id?_setCurrent(new Date,id):_setCurrent(new Date)}.bind(this),promiseSetCurrent=Promise.resolve();this.setCurrent=function setCurrent(date,id,type){promiseSetCurrent=promiseSetCurrent.then(function(){return _setCurrent(date,id,type)});return promiseSetCurrent}}var $=require("jquery"),moment=require("moment"),Appointment=require("../models/Appointment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),AppointmentCardViewModel=require("../viewmodels/AppointmentCard"),Listener=require("../utils/EventEmitterListener");require("../components/DatePicker");var Activity=require("../components/Activity"),A=Activity.extend(function AppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.menuItem="calendar";this.$appointmentView=this.$activity.find("#calendarAppointmentView");this.$chooseNew=$("#calendarChooseNew");this.viewModel=new ViewModel(this.app);this.appointmentListeners=[];var backActionSettings={link:this.viewModel.defaultBackToCalendarUrl,icon:Activity.NavAction.goBack.icon(),isTitle:!0,text:"Calendar"};this.navBar=new Activity.NavBar({title:"",leftAction:new Activity.NavAction(backActionSettings),rightAction:Activity.NavAction.goHelpIndex});ko.computed(function(){var editMode=this.viewModel.editMode(),isNew=this.viewModel.appointmentCardView()&&this.viewModel.appointmentCardView().isNew();if(editMode)if(isNew){var cancelLink=this.viewModel.appointmentCardView();cancelLink=cancelLink&&cancelLink.progress&&cancelLink.progress.cancelLink;this.convertToCancelAction(this.navBar.leftAction(),cancelLink||this.requestData.cancelLink)}else this.navBar.leftAction().model.updateWith({link:null,text:"cancel",handler:this.viewModel.appointmentCardView().confirmCancel.bind(this)});else{var defBackText=backActionSettings.text,link=this.viewModel.backToCalendarUrl(),text=this.viewModel.formattedCurrentDate()||defBackText;this.navBar.leftAction().model.updateWith($.extend({},backActionSettings,{link:link,text:text,handler:null}))}},this);this.registerHandler({target:this.viewModel.currentAppointment,handler:function(apt){if(apt&&(apt.id()===Appointment.specialIds.newBooking||apt.id()===Appointment.specialIds.newEvent)&&!apt.__idDateHandlersAttached){apt.__idDateHandlersAttached=!0;var prevID=apt.id();apt.id.subscribe(function relocateList(){var id=apt.id();if(!(prevID>0||0>=id)){prevID=id;this.viewModel.setCurrent(null,id).then(function(){this.viewModel.updateUrl()}.bind(this))}}.bind(this))}}.bind(this)._delayed(10)});this.registerHandler({target:this.viewModel.currentAppointment,handler:function(){this.registerAppointmentListeners()}.bind(this)});this.registerHandler({target:this.viewModel.appointmentCardView,handler:function(){this.registerAppointmentListeners()}.bind(this)})});exports.init=A.init;A.prototype.registerAppointmentListeners=function(){var listeners=[],events=AppointmentCardViewModel.events,cardView=this.viewModel.appointmentCardView(),viewModel=this.viewModel,app=this.app;this.disposeAppointmentListeners();if(cardView){listeners.push(new Listener(cardView,events.confirmed,function(appointment){viewModel.setCurrent(null,appointment.sourceBooking().bookingID(),"booking")}));listeners.push(new Listener(cardView,events.declined,function(appointment){app.shell.go("calendar/"+appointment.startTime().toISOString())}));listeners.push(new Listener(cardView,events.cancelled,function(appointment){app.shell.go("calendar/"+appointment.startTime().toISOString())}));this.appointmentListeners=listeners}};A.prototype.disposeAppointmentListeners=function(){this.appointmentListeners.forEach(function(listener){listener.dispose()})};A.prototype.show=function show(options){options&&options.appointment?this.resetScroll=!1:this.resetScroll=!0;Activity.prototype.show.call(this,options);if(!this.requestData.cancelLink){var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url;var reg=/\/?appointment\/([^\/]*)\/((\-3)|(\-4))/i;referrer&&reg.test(referrer)&&(referrer=referrer.replace(reg,"/appointment/$1/"));this.requestData.cancelLink=referrer}var s1=options&&options.route&&options.route.segments[0],s2=options&&options.route&&options.route.segments[1],s3=options&&options.route&&options.route.segments[2],date,datetime,id,type,isNumber=/^\-?\d+$/;if(isNumber.test(s1)){id=0|s1;type=s2}else{date=getDateWithoutTime(s1);datetime=s1&&new Date(s1)||date;id=0|s2;type=s3}var setupCard=function(){var cardApi=this.viewModel.appointmentCardView();if(cardApi){this.viewModel.appointmentCardView().currentID()<=0&&this.viewModel.appointmentCardView().item().startTime(datetime);cardApi.passIn(this.requestData)}else setTimeout(setupCard,80)}.bind(this);this.viewModel.setCurrent(date,id,type).then(setupCard)};A.prototype.hide=function hide(){Activity.prototype.hide.call(this);this.disposeAppointmentListeners()};var CalendarEvent=require("../models/CalendarEvent"),Booking=require("../models/Booking")},{"../components/Activity":223,"../components/DatePicker":224,"../models/Appointment":232,"../models/Booking":234,"../models/CalendarEvent":236,"../utils/EventEmitterListener":313,"../utils/getDateWithoutTime":340,"../viewmodels/AppointmentCard":370,jquery:!1,knockout:!1,moment:!1}],116:[function(require,module,exports){"use strict";function ViewModel(){this.isSyncing=ko.observable(!1);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.list=ko.observableArray(testdata())}function testdata(){var verA=new BackgroundCheck({name:"Database Search"}),verB=new BackgroundCheck({name:"Basic Criminal"}),verC=new BackgroundCheck({name:"Risk Adverse"}),verD=new BackgroundCheck({name:"Healthcare Check"});return[new UserBackgroundCheck({statusID:Verification.status.confirmed,lastVerifiedDate:new Date(2015,1,12,10,23,32),backgroundCheck:verA}),new UserBackgroundCheck({statusID:Verification.status.revoked,lastVerifiedDate:new Date(2015,5,20,16,4,0),backgroundCheck:verB}),new UserBackgroundCheck({statusID:Verification.status.pending,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verC}),new UserBackgroundCheck({statusID:Verification.status.obsolete,lastVerifiedDate:new Date(2014,11,30,19,54,4),backgroundCheck:verD})]}function UserBackgroundCheck(values){Model(this);this.model.defProperties({statusID:0,lastVerifiedDate:null,backgroundCheck:{Model:BackgroundCheck}},values);this.statusText=ko.pureComputed(function(){var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"},statusCode=enumGetName(this.statusID(),Verification.status);return statusTextsenUS["verification.status."+statusCode]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}function BackgroundCheck(values){Model(this);this.model.defProperties({name:""},values)}function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function BackgroundCheckActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace Profile",{backLink:"/marketplaceProfile"})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options)};var Verification=function(){};Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};var Model=require("../models/Model")},{"../components/Activity":223,"../models/Model":264,knockout:!1}],117:[function(require,module,exports){"use strict";function ViewModel(){this.blog=ko.observableArray([]);this.searchText=ko.observable("");this.searchDate=ko.observable("");this.searchTags=ko.observable("");this.isLoading=ko.observable(!1);this.params=ko.observable("");this.viewType=ko.observable("");this.tailId=ko.observable("");this.selectedPostId=ko.observable(0);this.fullPostData=ko.pureComputed(function(){var selectedPostId=this.selectedPostId(),result=this.blog().filter(function(post){var postIsSelected=post.id()===selectedPostId;return postIsSelected});return result.length?result[0]:null},this);this.filteredPostsBySearch=ko.pureComputed(function(){var s=this.searchText().toLowerCase();return this.blog().filter(function(v){var n=v&&v.title()||"";n+=v&&v.content()||"";n+=v&&v.date()||"";n+=v&&v.tags()||"";n=n.toLowerCase();return n.indexOf(s)>-1})},this);this.filteredPostsByDate=ko.pureComputed(function(){var s=this.searchDate();return this.blog().filter(function(v){var n=v&&v.date()||"";n=n.toLowerCase();return n.indexOf(s)>-1})},this);this.filteredPostsByTags=ko.pureComputed(function(){var s=this.searchTags().toLowerCase();return this.blog().filter(function(v){var n=v&&v.tags()||"";n=n.toLowerCase();return n.indexOf(s)>-1})},this);this.nothingFound=ko.pureComputed(function(){return!this.filteredPostsBySearch().length+("blogView"==this.viewType()&&!this.filteredPostsBySearch().length)},this)}function Post(values){Model(this);this.model.defProperties({id:0,date:"",title:"",author:"",content:"",excerpt:"",tags:"",tail:"",urlPath:""},values)}function slug(str){str=str.replace(/^\s+|\s+$/g,"");str=str.toLowerCase();for(var from="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;'",to="aaaaaeeeeeiiiiooooouuuunc-------",i=0,l=from.length;l>i;i++)str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i));str=str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return str}var Activity=require("../components/Activity"),A=Activity.extend(function HelpActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=null;this.navBar=Activity.createSectionNavBar("Blog");this.currentLabels="";this.loadPosts=function(){if(!(this.viewModel.blog().length>0)){var url="https://public-api.wordpress.com/rest/v1.1/sites/loconomics.wordpress.com/posts/"+encodeURIComponent(this.currentLabels);this.viewModel.isLoading(!0);var $=require("jquery");Promise.resolve($.get(url)).then(function(resPosts){resPosts?this.viewModel.blog(resPosts.posts.map(function(post){var tail=post.ID+"-"+slug(post.title);return new Post({id:post.ID,date:post.date,title:post.title,author:post.author.first_name+""+post.author.last_name,content:post.content,excerpt:post.excerpt,tags:post.tags,tail:tail,urlPath:"/blog/posts/"+tail})})):this.viewModel.blog([]);this.viewModel.isLoading(!1)}.bind(this))["catch"](function(){this.viewModel.isLoading(!1)}.bind(this))}}.bind(this);this.subSectionFunction={posts:function(tailId){this.viewModel.selectedPostId(parseInt(tailId,10));this.viewModel.viewType("postView")}.bind(this)};this.renderSubSection=function(subSectionPath,tail){var tailId=tail.split("-")[0];""===tailId?"posts"===subSectionPath?this.viewModel.viewType("postView"):this.viewModel.viewType("blogView"):this.subSectionFunction[subSectionPath](tailId)}});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.loadPosts();var params=state&&state.route&&state.route.segments,subSections=["posts"];this.viewModel.viewType("");if(params){var subSectionPath=params[0]||"",tail=params[1]||"";subSections.indexOf(subSectionPath)>-1?this.renderSubSection(subSectionPath,tail):""===subSectionPath?this.viewModel.viewType("blogView"):this.viewModel.viewType("404")}};var ko=require("knockout"),Model=require("../models/Model")},{"../components/Activity":223,"../models/Model":264,jquery:!1,knockout:!1}],118:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201959913-electing-board-members"}var Activity=require("../components/Activity"),A=Activity.extend(function BoardMemberNominationsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("Owner information",{backLink:"/ownerInfo",helpLink:this.viewModel.helpLink})});module.exports=A},{"../components/Activity":223}],119:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201959943-add-scheduling-to-your-website";var marketplaceProfile=app.model.marketplaceProfile;this.jobTitleName=ko.observable("Job Title");this.bookCode=ko.computed(function(){return marketplaceProfile.data.bookCode()});this.jobTitleID=ko.observable(0);this.copyText=ko.observable("Copy");this.type=ko.observable("icon");this.type.subscribe(function(){this.copyText("Copy")}.bind(this));this.isLocked=marketplaceProfile.isLocked;var buttonTemplate='<!-- begin Loconomics book-me-button --><a style="display:inline-block"><img alt="" style="border:none" width="200" height="50" /></a><!-- end Loconomics book-me-button -->',linkTemplate="<!-- begin Loconomics book-me-button --><a><span></span></a><!-- end Loconomics book-me-button -->";this.buttonHtmlCode=ko.pureComputed(function(){if(marketplaceProfile.isLoading())return"loading...";var type=this.type(),tpl=buttonTemplate;"link"===type&&(tpl=linkTemplate);var siteUrl=$("html").attr("data-site-url")||window.location.origin,linkUrl=siteUrl+"/book/"+this.bookCode()+"/"+this.jobTitleID()+"/",imgUrl=siteUrl+"/img/extern/book-me-now-button.svg",code=generateButtonCode({tpl:tpl,label:"Click here to book me now (on loconomics.com)",linkUrl:linkUrl,imgUrl:imgUrl});return code},this);this.sendByEmailURL=ko.pureComputed(function(){var btn=this.buttonHtmlCode().replace(/\n+/,"");return"mailto:?body="+encodeURIComponent("Loconomics Book Me Now Button HTML code: "+btn)},this);this.userJobTitle=ko.observable(null);this.bookMeButtonReady=ko.pureComputed(function(){var j=this.userJobTitle();return j&&j.bookMeButtonReady()||!1},this);this.collectPaymentAtBookMeButtonString=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&j.collectPaymentAtBookMeButton()&&"true"||"false"},write:function(val){var j=this.userJobTitle();j&&("true"===val?j.collectPaymentAtBookMeButton(!0):j.collectPaymentAtBookMeButton(!1))},owner:this});this.copyCode=function(){var text=this.buttonHtmlCode(),errMsg=clipboard.copy(text);errMsg?app.modals.showError({error:errMsg}):this.copyText("Copied!")}.bind(this);this.save=function(){var ujt=this.userJobTitle();if(ujt){var plain=ujt.model.toPlainObject();plain.collectPaymentAtBookMeButton=ujt.collectPaymentAtBookMeButton();app.model.userJobProfile.setUserJobTitle(plain).then(function(){}.bind(this))["catch"](function(err){app.modals.showError({title:'Error saving your "collect payment" preference',error:err})}.bind(this))}}.bind(this)}function generateButtonCode(options){var $btn=$($.parseHTML("<div>"+options.tpl+"</div>"));$btn.find("a").attr("href",options.linkUrl).find("span").text(options.label);$btn.find("img").attr("src",options.imgUrl).attr("alt",options.label);return $btn.html()}var Activity=require("../components/Activity"),ko=require("knockout"),$=require("jquery"),clipboard=require("../utils/clipboard"),A=Activity.extend(function BookMeButtonActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Website scheduling",{backLink:"scheduling",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.$activity,event:"click",selector:"textarea",handler:function(){$(this).select();this.setSelectionRange(0,99999)}});this.registerHandler({target:this.app.model.marketplaceProfile,event:"error",handler:function(err){if(!err||"save"!==err.task){var msg="Error loading data to build the Button.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}}.bind(this)});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID)this.app.model.userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.userJobTitle(job.userJobTitle);this.viewModel.jobTitleName(job.jobTitle.singularName())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));else{this.viewModel.jobTitleName("Job Title");this.viewModel.userJobTitle(null)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){this.viewModel.jobTitleID(!1);Activity.prototype.show.call(this,state);this.app.model.marketplaceProfile.sync();var jobID=0|state.route.segments[0];this.viewModel.jobTitleID(jobID);this.viewModel.copyText("Copy")}},{"../components/Activity":223,"../utils/clipboard":332,jquery:!1,knockout:!1}],120:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),ko=require("knockout"),NewClientBookingCardVM=require("../viewmodels/NewClientBookingCardVM"),A=Activity.extend(function BookingActivity(){Activity.apply(this,arguments);this.viewModel=new NewClientBookingCardVM(this.app);this.navBar=Activity.createSubsectionNavBar("Booking",{helpLink:"/help"});this.navBar.title("Booking");this.viewModel.presetGratuity.subscribe(function(preset){"custom"===preset&&setTimeout(function(){this.$activity.find("[name=custom-gratuity]").focus()}.bind(this),50)}.bind(this));this.registerHandler({target:this.viewModel.progress.step,handler:function(){var load=this[this.viewModel.progress.currentStep()+"Load"];load&&load.call(this)}.bind(this)});var labelTpl="__step__ of __total__",nav=this.navBar;ko.computed(function(){var step=this.step()+1,total=this.totalSteps(),label="Booking";step>0&&total>1&&(label=labelTpl.replace("__step__",step).replace("__total__",total));nav.title(label)},this.viewModel.progress)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var referrer=this.app.shell.referrerRoute;referrer=referrer&&referrer.url;var reg=/\/?booking/i;(!referrer||reg.test(referrer))&&(referrer="/");this.convertToCancelAction(this.navBar.leftAction(),referrer);var params=state&&state.route&&state.route.segments,bookCode=state&&state.route&&state.route.query.bookCode;this.viewModel.initBooking(0|params[0],0|params[1],bookCode)};A.prototype.hide=function hide(){Activity.prototype.hide.call(this);this.viewModel.isDone()||this.viewModel.saveState()};A.prototype.servicesLoad=function(){this.viewModel.supportsGratuity(!1);this.viewModel.loadServices()};A.prototype.selectLocationLoad=function(){this.viewModel.loadServiceAddresses()};A.prototype.selectTimesLoad=function(){};A.prototype.selectTimeLoad=function(){};A.prototype.paymentLoad=function(){};A.prototype.confirmLoad=function(){}},{"../components/Activity":223,"../viewmodels/NewClientBookingCardVM":384,knockout:!1}],121:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/sections/202884403-Setting-Your-Booking-Policies";this.isInOnboarding=app.model.onboarding.inProgress;this.jobTitleID=ko.observable(0);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.selectedCancellationPolicyID=ko.observable(null);this.instantBooking=ko.observable(null);this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/bookingPolicies");this.jobTitles.selectJobTitle=function(jobTitle){
this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.cancellationPolicyID=this.selectedCancellationPolicyID();plain.instantBooking=this.instantBooking();app.model.userJobProfile.setUserJobTitle(plain).then(function(){this.isSaving(!1);if(app.model.onboarding.inProgress()){app.model.onboarding.selectedJobTitleID(this.jobTitleID());app.model.onboarding.goNext()}else app.successSave()}.bind(this))["catch"](function(err){this.isSaving(!1);app.modals.showError({title:"Unable to save booking policies",error:err})}.bind(this))}}.bind(this);this.policies=app.model.cancellationPolicies.list}var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function BookingPoliciesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Scheduler",{backLink:"scheduling",helpLink:this.viewModel.helpLink});this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Unable to load listing details.",error:err})}.bind(this));this.viewModel.isLoading(!0);this.app.model.userJobProfile.getUserJobTitle(jobTitleID).then(function(userJobTitle){this.viewModel.userJobTitle(userJobTitle);this.viewModel.selectedCancellationPolicyID(userJobTitle.cancellationPolicyID());this.viewModel.instantBooking(userJobTitle.instantBooking())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Unable to load policies.",error:err})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this));var found=/bookingPolicies\/(\d+)/i.exec(window.location),urlID=found&&0|found[1];if(urlID!==jobTitleID){var url="/bookingPolicies/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.userJobTitle(null);this.viewModel.selectedCancellationPolicyID(null);this.viewModel.instantBooking(null)}}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar,!0)};A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.selectedCancellationPolicyID(null);this.viewModel.instantBooking(null);Activity.prototype.show.call(this,state);this.updateNavBarState();var params=state&&state.route&&state.route.segments,jid=0|params[0];this.viewModel.jobTitleID(jid);this.app.model.cancellationPolicies.sync();jid||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile")},{"../components/Activity":223,"../viewmodels/UserJobProfile":397,knockout:!1}],122:[function(require,module,exports){"use strict";function ViewModel(app){this.currentDate=ko.observable(getDateWithoutTime());var fullDayFree=[Appointment.newFreeSlot({date:this.currentDate()})];this.currentDate.subscribe(function(date){if(date){fullDayFree[0].startTime(date);fullDayFree[0].endTime(date)}},this);this.slotsSource=ko.observable(fullDayFree);this.slots=ko.computed(function(){var slots=this.slotsSource();slots.length>1&&(slots=slots.filter(function(slot){return slot.id()!==Appointment.specialIds.unavailable}));return slots.map(TimeSlotViewModel.fromAppointment)},this);this.isLoading=ko.observable(!1);this.previousDate=this.currentDate().toISOString();this.currentDate.subscribe(function(date){date=new Date(Date.parse(date.toISOString()));if(date.toISOString()!==this.previousDate){this.previousDate=date.toISOString();this.isLoading(!0);app.model.calendar.getDateAvailability(date).then(function(dateAvail){if(date.toISOString()===this.currentDate().toISOString()){this.slotsSource(dateAvail.list());this.isLoading(!1)}}.bind(this))["catch"](function(err){this.slotsSource(fullDayFree);this.isLoading(!1);var msg="Error loading calendar events.";app.modals.showError({title:msg,error:err})}.bind(this))}}.bind(this))}var $=require("jquery"),moment=require("moment"),ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),Activity=require("../components/Activity"),A=Activity.extend(function CalendarActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Calendar");this.$datepicker=this.$activity.find("#calendarDatePicker");this.$dailyView=this.$activity.find("#calendarDailyView");this.$dateTitle=this.$activity.find(".CalendarDateHeader > .btn");this.$chooseNew=$("#calendarChooseNew");this.$datepicker.show().datepicker({extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(this.app,this.$datepicker,this.viewModel.isLoading);this.registerHandler({target:this.viewModel.currentDate,handler:function(date){if(date){var mdate=moment(date);if(mdate.isValid()){var isoDate=mdate.toISOString();this.$datepicker.removeClass("is-visible");this.$datepicker.datepicker("getValue").toISOString()!==isoDate&&this.$datepicker.datepicker("setValue",date,!0);this.app.shell.pushState(null,null,"calendar/"+isoDate);return}}this.viewModel.currentDate(getDateWithoutTime())}.bind(this)});this.registerHandler({target:this.$dailyView,event:"swipeleft swiperight",handler:function(e){e.preventDefault();var dir="swipeleft"===e.type?"next":"prev";$(document).trigger("touchend");this.$datepicker.datepicker("moveValue",dir,"date")}.bind(this)});this.hideDatepicker=function(){this.$datepicker.datepicker("hide").children().show()};this.viewModel.openDatePicker=function(d,e){this.$datepicker.toggleClass("is-visible");this.hideDatepicker();e.preventDefault();e.stopPropagation()}.bind(this);this.viewModel.nextDate=function(d,e){e.preventDefault();this.$datepicker.datepicker("moveValue","next","date")}.bind(this);this.viewModel.prevDate=function(d,e){e.preventDefault();this.$datepicker.datepicker("moveValue","prev","date")}.bind(this);this.registerHandler({target:this.$datepicker,event:"dateChanged",handler:function(e){"days"===e.viewMode&&this.viewModel.currentDate(getDateWithoutTime(e.date))}.bind(this)});this.viewModel.currentDate(getDateWithoutTime())});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.hideDatepicker();var sdate=options.route&&options.route.segments&&options.route.segments[0],date;if(sdate){var mdate=moment(sdate);date=mdate.isValid()?getDateWithoutTime(mdate.toDate()):null}date||(date=getDateWithoutTime());this.viewModel.previousDate=null;this.viewModel.currentDate(date);this.tagAvailability(date,this.app.model.userProfile.data.userID(),!0)};var Appointment=require("../models/Appointment"),TimeSlotViewModel=require("../viewmodels/TimeSlot")},{"../components/Activity":223,"../components/DatePicker":224,"../models/Appointment":232,"../utils/datepickerAvailability":334,"../utils/getDateWithoutTime":340,"../viewmodels/TimeSlot":396,jquery:!1,knockout:!1,moment:!1}],123:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201959953-syncing-your-existing-calendar";var calendarSyncing=app.model.calendarSyncing,syncVersion=calendarSyncing.newVersion();syncVersion.isObsolete.subscribe(function(itIs){itIs&&syncVersion.pull({evenIfNewer:!0})});this.sync=syncVersion.version;this.isLocked=ko.pureComputed(function(){return this.isLocked()||this.isReseting()},calendarSyncing);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},calendarSyncing);this.resetText=ko.pureComputed(function(){return this.isReseting()?"reseting...":"Reset Private URL"},calendarSyncing);this.discard=function discard(){syncVersion.pull({evenIfNewer:!0})};this.save=function save(){syncVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})};this.reset=function reset(){calendarSyncing.resetExportUrl()}}var Activity=require("../components/Activity"),$=require("jquery"),ko=require("knockout"),A=Activity.extend(function CalendarSyncingActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Calendar",{backLink:"calendar",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.$activity.find("#calendarSync-icalExportUrl"),event:"click",handler:function(){$(this).select()}});this.registerHandler({target:this.app.model.calendarSyncing,event:"error",handler:function(err){var msg="save"===err.task?"Error saving calendar syncing settings.":"Error loading calendar syncing settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.calendarSyncing.sync();this.viewModel.discard()}},{"../components/Activity":223,jquery:!1,knockout:!1}],124:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=app.model.cancellationPolicies.state.isLoading;this.policies=app.model.cancellationPolicies.list}var $=require("jquery"),Activity=require("../components/Activity"),A=Activity.extend(function CancellationPoliciesActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.viewModel=new ViewModel(this.app);var shell=this.app.shell;this.$activity.find("#cancellationPolicies-index").on("click","a",function(e){e.preventDefault();e.stopImmediatePropagation();$(this).tab("show");var link=$(this).attr("href").replace(/^#cancellationPolicies-/,"");shell.replaceState(null,null,"#!cancellationPolicies/"+link)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var tabName=state&&state.route.segments&&state.route.segments[0],tab=this.$activity.find('[href="#cancellationPolicies-'+tabName+'"]');tab.length&&tab.tab("show");this.app.model.cancellationPolicies.sync()}},{"../components/Activity":223,jquery:!1}],125:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201983163-making-changes-canceling-appointments";this.list=app.model.clientAppointments.list;this.currentIndex=ko.observable(-1);this.currentItem=new EditClientBookingCardVM(app);this.isLoading=ko.observable(!1);this.returnText=ko.observable("Back");this.isEditButtonVisible=ko.pureComputed(function(){return(this.canCancel()||this.canEdit())&&!this.isEditMode()&&!this.isCancelMode()},this.currentItem);this.isCancelEditButtonVisible=ko.pureComputed(function(){return(this.canCancel()||this.canEdit())&&(this.isEditMode()||this.isCancelMode())},this.currentItem);this.isEmpty=ko.pureComputed(function(){return-2===this.currentIndex()},this);var updateListIndex=function(){if(this.list().length&&-1===this.currentIndex()){var bID=this.currentItem.booking().bookingID();this.list().some(function(b,i){if(b.bookingID()===bID){this.currentIndex(i);return!0}}.bind(this))}}.bind(this);this.load=function(id){if(id){this.currentIndex(-1);this.currentItem.load(id).then(function(){app.model.clientAppointments.sync().then(updateListIndex)})["catch"](function(err){app.modals.showError({title:"Error loading the appointment",error:err})}.bind(this))}else{this.isLoading(!0);this.currentItem.reset();app.model.clientAppointments.sync().then(function(){var first=this.list().length?this.list()[0]:null;if(first){this.currentIndex(0);this.currentItem.load(first);updateListIndex();app.shell.replaceState(null,null,"/clientAppointment/"+first.bookingID())}else{this.currentIndex(-2);app.shell.replaceState(null,null,"/clientAppointment")}this.isLoading(!1)}.bind(this))["catch"](function(err){this.isLoading(!1);app.modals.showError({title:"Error loading appointments",error:err})}.bind(this))}}.bind(this);var goToIndex=function(i){var min=0,max=this.list().length-1;if(this.currentIndex()>=min){var ni=Math.max(min,Math.min(max,i));this.currentIndex(ni);var b=this.list()[ni];this.currentItem.load(b);app.shell.replaceState(null,null,"/clientAppointment/"+b.bookingID())}}.bind(this);this.goNext=function(){goToIndex(this.currentIndex()+1)}.bind(this);this.goPrevious=function(){goToIndex(this.currentIndex()-1)}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),EditClientBookingCardVM=require("../viewmodels/EditClientBookingCardVM"),A=Activity.extend(function ClientAppointmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("",{backLink:"/myAppointments",helpLink:this.viewModel.helpLink})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options&&options.route&&options.route.segments,id=0|params[0];this.viewModel.load(id);var returnText=options&&options.route&&options.route.query.returnText||"Back";this.viewModel.returnText(decodeURIComponent(returnText))}},{"../components/Activity":223,"../viewmodels/EditClientBookingCardVM":377,knockout:!1}],126:[function(require,module,exports){"use strict";function seemsAPhoneNumber(str){return/\d{3,}/.test(str||"")}function clientDataFromSearchText(txt,client){if(is.email(txt))client.email(txt);else if(seemsAPhoneNumber(txt))client.phone(txt);else{var nameParts=txt.split(" ",2);client.firstName(nameParts[0]);nameParts.length>1&&client.lastName(nameParts[1])}}function ViewModel(app){this.helpLink="/help/relatedArticles/201152639-managing-clients";this.clientID=ko.observable(0);this.clientVersion=ko.observable(null);this.client=ko.pureComputed(function(){var v=this.clientVersion();return v?v.version:null},this);this.header=ko.observable("");this.isLoadingServices=ko.observable(!1);this.isLoading=ko.pureComputed(function(){return app.model.clients.state.isLoading()||this.isLoadingServices()},this);this.isSyncing=app.model.clients.state.isSyncing;this.isSaving=app.model.clients.state.isSaving;this.isLocked=ko.pureComputed(function(){return app.model.clients.state.isLocked()||this.isDeleting()},this);this.isReadOnly=ko.pureComputed(function(){var c=this.client();return c&&!c.editable()},this);this.isDeleting=app.model.clients.state.isDeleting;this.wasRemoved=ko.observable(!1);this.isNew=ko.pureComputed(function(){var c=this.client();return!c||!c.updatedDate()},this);this.serviceSummaries=ko.observable([]);this.loadServices=function(clientID){var view=this;this.isLoadingServices(!0);Promise.all([app.model.serviceProfessionalServices.getClientSpecificServices(clientID),app.model.userJobProfile.getJobTitles(),app.model.pricingTypes.getList()]).then(function(models){var services=app.model.serviceProfessionalServices.asModel(models[0]),jobTitles=models[1],pricingTypes=models[2](),summaries=ServicesSummaryPresenter.summaries(jobTitles,services,pricingTypes).sort(ServicesSummaryPresenter.sortByJobTitle);view.serviceSummaries(summaries)})["catch"](function(error){var messagePrefix="Unable to load special pricings",messageName=view.client()?" for "+view.client().firstName():"",message=messagePrefix+messageName+".";app.modals.showError({title:message,error:error})}).then(function(){view.isLoadingServices(!1)})};this.submitText=ko.pureComputed(function(){var v=this.clientVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":this.isNew()?"Add client":v&&v.areDifferent()?"Save changes to client":"Client saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.clientVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting client...":"Delete client"},this);this.showServices=ko.pureComputed(function(){return!this.isNew()&&this.client()},this);this.save=function(){app.model.clients.setItem(this.client().model.toPlainObject()).then(function(serverData){this.client().model.updateWith(serverData);this.clientVersion().push({evenIfObsolete:!0});this.onSave(serverData.clientUserID)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete client",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.clients.delItem(this.clientID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.tapServiceSummary=function(serviceSummary,event){var route=new RouteParser("#!serviceProfessionalService/:jobTitleID/client/:clientID?mustReturn=#!clientEditor/:clientID"),url=route.reverse({jobTitleID:serviceSummary.jobTitleID(),clientID:this.clientID()});app.shell.go(url);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.tapServiceSummaryNew=function(serviceSummary,event){var route=new RouteParser("#!serviceProfessionalService/:jobTitleID/client/:clientID/new"),url=route.reverse({jobTitleID:serviceSummary.jobTitleID(),clientID:this.clientID()});app.shell.go(url,null);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var c=this.client();if(c){var birthMonth=c.birthMonth();return birthMonth?this.months()[birthMonth-1]:null}return null},write:function(month){var c=this.client();c&&c.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);this.validEmail=ko.pureComputed(function(){var c=this.client();if(c){var e=c.email();return is.email(e)?e:""}return""},this);this.validPhone=ko.pureComputed(function(){var c=this.client();if(c){var e=c.phone();return seemsAPhoneNumber(e)?e:""}return""},this);var foundPublicUser=function foundPublicUser(user){var c=this.client();if(c&&c.clientUserID()!==user.clientUserID&&(c.email()===user.email||c.phone()===user.phone)){var msg="We`ve found an existing record for {0}. Would you like to add him to your clients?".replace(/\{0\}/g,user.firstName);app.modals.confirm({title:"client found at loconomics.com",message:msg}).then(function(){var notes=c.notesAboutClient();c.model.updateWith(user);c.notesAboutClient(notes);this.clientID(user.clientUserID)}.bind(this))["catch"](function(){})}}.bind(this);ko.computed(function(){var c=this.client();if(c){var email=c.email(),phone=c.phone();(email||phone)&&app.model.clients.publicSearch({email:email,phone:phone}).then(function(r){r&&r[0]&&foundPublicUser(r[0])}.bind(this))["catch"](function(){})}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}})}var Activity=require("../components/Activity"),is=require("is_js"),ServicesSummaryPresenter=require("../viewmodels/presenters/ServicesSummaryPresenter"),RouteParser=require("../utils/Router.js").RouteParser,A=Activity.extend(function ClientEditionActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"clients",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){if(clientID){var nope=this.requestData.returnNewAsSelected===!0;if(!nope){var found=/clientEditor\/(\-?\d+)/i.exec(window.location),urlID=found&&0|found[1];found&&urlID===clientID||this.app.shell.replaceState(null,null,"clientEditor/"+clientID)}}}.bind(this)});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){this.viewModel.serviceSummaries([]);clientID&&this.viewModel.loadServices(clientID)}.bind(this)});this.viewModel.onSave=function(clientID){if(this.requestData.returnNewAsSelected===!0){this.requestData.clientID=clientID;this.app.shell.goBack(this.requestData)}else this.app.successSave()}.bind(this)});exports.init=A.init;var ko=require("knockout");A.prototype.updateNavBarState=function updateNavBarState(){var referrerRoute=this.app.shell.referrerRoute,referrer=0===this.viewModel.clientID()?referrerRoute&&referrerRoute.url:null,link=this.requestData.cancelLink||referrer||"/clients";this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.clientID(0);var params=state&&state.route&&state.route.segments||[],clientID=0|params[0];if(clientID){this.viewModel.clientID(clientID);this.app.model.clients.createItemVersion(clientID).then(function(clientVersion){if(clientVersion){this.viewModel.clientVersion(clientVersion);this.viewModel.header("Edit client")}else{this.viewModel.clientVersion(null);this.viewModel.header("Unknow client or was deleted")}}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading client data",error:err})}.bind(this))}else{var presetData=this.requestData.presetData||{};presetData.editable!==!1&&(presetData.editable=!0);this.viewModel.clientVersion(this.app.model.clients.newItem(presetData));this.viewModel.header("Add a client");this.requestData.newForSearchText&&clientDataFromSearchText(this.requestData.newForSearchText||"",this.viewModel.client())}this.updateNavBarState()}},{"../components/Activity":223,"../utils/Router.js":326,"../viewmodels/presenters/ServicesSummaryPresenter":399,is_js:!1,knockout:!1}],127:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201966046-adding-new-clients";this.headerText=ko.observable("");this.isSelectionMode=ko.observable(!1);this.clients=app.model.clients.list;this.isLoading=app.model.clients.state.isLoading;this.isSyncing=app.model.clients.state.isSyncing;this.searchText=ko.observable("");this.getFilteredList=function getFilteredList(){var s=(this.searchText()||"").toLowerCase();return this.clients().filter(function(client){if(!client)return!1;if(client.deleted())return!1;var found=textSearch(s,client.fullName());if(found)return!0;found=textSearch(s,client.email());if(found)return!0;found=textSearch(s,client.phone());return found})};this.filteredClients=ko.computed(function(){return this.getFilteredList()},this);this.groupedClients=ko.computed(function(){var clients=this.filteredClients().sort(function(clientA,clientB){var a=clientA.firstName().toLowerCase(),b=clientB.firstName().toLowerCase();return a===b?0:a>b?1:-1}),groups=[],latestGroup=null,latestLetter=null;clients.forEach(function(client){var letter=(client.firstName()[0]||"").toUpperCase();if(letter!==latestLetter){latestGroup={letter:letter,clients:[client]};groups.push(latestGroup);latestLetter=letter}else latestGroup.clients.push(client)});return groups},this);this.publicSearchResults=ko.observableArray([]);this.publicSearchRunning=ko.observable(null);ko.computed(function(){var filtered=this.filteredClients(),searchText=this.searchText(),request=null;if(0===filtered.length&&searchText){this.publicSearchResults([]);request=app.model.clients.publicSearch({fullName:searchText,email:searchText,phone:searchText});this.publicSearchRunning(request);request.then(function(r){this.publicSearchResults(r)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error when on remote clients search",error:err})}).then(function(){this.publicSearchRunning()===request&&this.publicSearchRunning(null)}.bind(this))}else{this.publicSearchResults([]);request=this.publicSearchRunning();if(request&&request.xhr&&request.xhr.abort){request.xhr.abort();this.publicSearchRunning(null)}}},this).extend({rateLimit:{timeout:400,method:"notifyWhenChangesStop"}});this.addRemoteClient=function(client,event){var data=client.model&&client.model.toPlainObject()||client,request=$.extend({},this.requestData,{presetData:data,returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addNew=function(data,event){event.preventDefault();event.stopImmediatePropagation();var request=$.extend({},this.requestData,{newForSearchText:this.searchText(),returnNewAsSelected:this.isSelectionMode()});app.shell.go("clientEditor",request)}.bind(this);this.selectedClient=ko.observable(null);this.selectClient=function(selectedClient,event){event.preventDefault();event.stopImmediatePropagation();this.selectedClient(selectedClient)}.bind(this)}var $=require("jquery"),ko=require("knockout"),Activity=require("../components/Activity"),textSearch=require("../utils/textSearch"),A=Activity.extend(function ClientsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Clients",{backLink:"cms",helpLink:this.viewModel.helpLink});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();this.$index=this.$activity.find("#clientsIndex");this.$listView=this.$activity.find("#clientsListView");this.registerHandler({target:this.viewModel.selectedClient,handler:function(theSelectedClient){if(this.requestData&&this.requestData.selectClient===!0&&theSelectedClient){this.requestData.selectedClientID=theSelectedClient.clientUserID();this.app.shell.goBack(this.requestData);this.requestData=null}}.bind(this)});this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var itIs=this.viewModel.isSelectionMode();this.viewModel.headerText(itIs?"Select a client":"My clients");this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):itIs||this.navBar.leftAction().handler(null)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.viewModel.selectedClient(null);this.viewModel.requestData=this.requestData;if(state.returnNewAsSelected===!0&&state.clientID)setTimeout(function(){delete state.returnNewAsSelected;this.requestData.selectedClientID=state.clientID;this.app.shell.goBack(this.requestData)}.bind(this),1);else{this.viewModel.isSelectionMode(state.selectClient===!0);this.updateNavBarState();this.app.model.clients.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this))}}},{"../components/Activity":223,"../utils/textSearch":365,jquery:!1,knockout:!1}],128:[function(require,module,exports){"use strict";function ViewModel(app){this.clients=app.model.clients.list;this.clientsCount=ko.pureComputed(function(){var cs=this.clients();return 0>=cs?"0 clients":1===cs?"1 client":numeral(0|cs.length).format("0,0")+" clients"},this)}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function CmsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("Client Management")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.clients.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading the clients list",error:err})}.bind(this))};var numeral=require("numeral")},{"../components/Activity":223,knockout:!1,numeral:!1}],129:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=app.model.onboarding.inProgress;this.message=ko.observable("");this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);this.emailSubject=ko.observable("");this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":"Send"},this);this.isValid=ko.pureComputed(function(){var m=this.message();return m&&!/^\s*$/.test(m)},this);this.anonymousButtonUrl=ko.pureComputed(function(){if(!app.model.user().isAnonymous())return"";var subject=encodeURIComponent(this.emailSubject()||"I need help!"),body=encodeURIComponent(this.message()),url="mailto:support@loconomics.com?subject="+subject+"&body="+body;return url},this);this.send=function send(){if(this.isValid()&&!app.model.user().isAnonymous()){this.isSending(!0);var msg=this.message();this.emailSubject()&&(msg=this.emailSubject()+": "+msg);app.model.feedback.postSupport({message:msg,vocElementID:this.vocElementID()}).then(function(){app.successSave({message:"Thank you, we'll be in touch soon!"});this.message("")}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity.extend(function ContactFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=null;this.navBar=Activity.createSubsectionNavBar("Back");this.navBar.rightAction(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];this.viewModel.emailSubject(this.requestData.route.query.subject||"");this.viewModel.message(this.requestData.route.query.body||this.requestData.route.query.message||"");elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Support: given a bad VOC Element name:",elementName):console.log("Feedback Support: Accessing without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout")},{"../components/Activity":223,"../models/VocElementEnum":306,knockout:!1}],130:[function(require,module,exports){"use strict";function ViewModel(app){this.user=app.model.userProfile.data;this.helpLinkProfessionals="/help/relatedArticles/201966986-sending-and-receiving-messages";this.helpLinkClients="/help/relatedArticles/201966996-sending-and-receiving-messages";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.isLoading=app.model.messaging.state.isLoading;this.isSyncing=app.model.messaging.state.isSyncing;this.isSaving=app.model.messaging.state.isSaving;this.threadID=ko.observable(null);this.thread=app.model.messaging.createWildcardItem();this.subject=ko.pureComputed(function(){var m=this.thread();return this.isLoading()?"Loading...":m&&(m.subject()||"").replace(/^\s+|\s+$/g,"")||"Conversation without subject"},this);var userProfile=app.model.userProfile,profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({
evenIfNewer:!0})});this.bookingID=ko.pureComputed(function(){var msg=this.thread()&&this.thread().messages()[0];return msg&&"booking"===(msg.auxT()||"").toLowerCase()&&msg.auxID()?msg.auxID():null},this);this.linkToBooking=ko.pureComputed(function(){return"#!/viewBooking/"+this.bookingID()},this)}var Activity=require("../components/Activity"),A=Activity.extend(function ConversationActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Inbox",{backLink:"/inbox",helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Inbox",{backLink:"/inbox",helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.threadID(0);this.viewModel.thread(null);this.updateNavBarState();var params=state&&state.route&&state.route.segments||[],threadID=0|params[0];this.viewModel.threadID(threadID);threadID?this.viewModel.thread.sync(threadID)["catch"](function(err){this.app.modals.showError({title:"Error loading conversation",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):this.app.modals.showError({title:"Conversation Not Found"}).then(function(){this.app.shell.goBack()}.bind(this))};var ko=require("knockout")},{"../components/Activity":223,knockout:!1}],131:[function(require,module,exports){"use strict";function ViewModel(app){this.upcomingBookings=new UpcomingBookingsSummary;this.upcomingBookings.isLoading=ko.observable(!1);this.upcomingBookings.isSyncing=ko.observable(!1);this.upcomingAppointments=new UpcomingAppointmentsSummary;this.upcomingAppointments.isLoading=ko.observable(!1);this.upcomingAppointments.isSyncing=ko.observable(!1);this.nextAppointmentServiceProfessionalInfo=ko.observable(null);this.nextBooking=ko.observable(null);this.inbox=new MailFolder({topNumber:4});this.inbox.isLoading=ko.observable(!1);this.inbox.isSyncing=ko.observable(!1);this.performance=new PerformanceSummary;this.getMore=new GetMore;this.user=app.model.userProfile.data;this.getMapUrlFor=function(address){var lat=ko.unwrap(address.latitude),lng=ko.unwrap(address.longitude),place=address.singleLine?address.singleLine():"";return"https://www.google.com/maps/?q="+encodeURIComponent(lat)+","+encodeURIComponent(lng)+"&near="+encodeURIComponent(place)+"&z=16"};this.getUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.upcomingAppointments.nextBooking.bookingID+"?mustReturn=/dashboard/&returnText= Dashboard"},this)}}function setSomeTestingData(viewModel){var moreData={};moreData=viewModel.user.isServiceProfessional()?{availability:!1,payments:!1,profile:!1,coop:!1}:{availability:!1,payments:!1,profile:!1,coop:!0};viewModel.getMore.model.updateWith(moreData)}var ko=require("knockout"),Activity=require("../components/Activity"),AppointmentView=require("../viewmodels/AppointmentView"),Appointment=require("../models/Appointment"),UserJobTitle=require("../models/UserJobTitle"),PublicUser=require("../models/PublicUser"),A=Activity.extend(function DashboardActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.prepareShowErrorFor=function prepareShowErrorFor(title){return function(err){this.app.modals.showError({title:title,error:err})}.bind(this)}.bind(this);var app=this.app;this.getUserData=function(userID,jobTitleID){return app.model.users.getUser(userID).then(function(info){info.selectedJobTitleID=jobTitleID;return new PublicUser(info)}.bind(this))};setSomeTestingData(this.viewModel)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.user().isServiceProfessional()&&this.syncUpcomingBookings();this.app.model.user().isClient()&&this.syncUpcomingAppointments();this.syncMessages();this.syncGetMore()};A.prototype.syncMessages=function syncMessages(){var v=this.viewModel,app=this.app,MessageView=require("../models/MessageView");v.inbox.messages().length?v.inbox.isSyncing(!0):v.inbox.isLoading(!0);this.app.model.messaging.getList().then(function(threads){v.inbox.messages(threads().map(MessageView.fromThread.bind(null,app)))})["catch"](this.prepareShowErrorFor("Error loading latest messages")).then(function(){v.inbox.isLoading(!1);v.inbox.isSyncing(!1)})};A.prototype.syncUpcomingBookings=function syncUpcomingBookings(){var v=this.viewModel,app=this.app,appModel=this.app.model;v.upcomingBookings.items().length?v.upcomingBookings.isSyncing(!0):v.upcomingBookings.isLoading(!0);appModel.bookings.getUpcomingBookings().then(function(upcoming){v.upcomingBookings.model.updateWith(upcoming,!0);var b=v.upcomingBookings.nextBooking();b?v.nextBooking(new AppointmentView(Appointment.fromBooking(b),app)):v.nextBooking(null)}.bind(this))["catch"](this.prepareShowErrorFor("Error loading upcoming bookings")).then(function(){v.upcomingBookings.isLoading(!1);v.upcomingBookings.isSyncing(!1)})};A.prototype.syncUpcomingAppointments=function syncUpcomingAppointments(){var v=this.viewModel,appModel=this.app.model;v.upcomingAppointments.items().length?v.upcomingAppointments.isSyncing(!0):v.upcomingAppointments.isLoading(!0);appModel.bookings.getUpcomingAppointments().then(function(upcoming){v.upcomingAppointments.model.updateWith(upcoming,!0);return upcoming.nextBooking?this.getUserData(upcoming.nextBooking.serviceProfessionalUserID,upcoming.nextBooking.jobTitleID):null}.bind(this)).then(function(user){v.nextAppointmentServiceProfessionalInfo(user)})["catch"](this.prepareShowErrorFor("Error loading upcoming appointments")).then(function(){v.upcomingAppointments.isLoading(!1);v.upcomingAppointments.isSyncing(!1)})};A.prototype.syncGetMore=function syncGetMore(){this.app.model.user().isServiceProfessional()&&this.app.model.userJobProfile.syncList().then(function(list){var yep=list.some(function(job){return job.statusID()!==UserJobTitle.status.on?!0:void 0});this.viewModel.getMore.profile(!!yep)}.bind(this))};var UpcomingBookingsSummary=require("../models/UpcomingBookingsSummary"),MailFolder=require("../models/MailFolder"),PerformanceSummary=require("../models/PerformanceSummary"),GetMore=require("../models/GetMore"),UpcomingAppointmentsSummary=require("../models/UpcomingAppointmentsSummary")},{"../components/Activity":223,"../models/Appointment":232,"../models/GetMore":244,"../models/MailFolder":260,"../models/MessageView":263,"../models/PerformanceSummary":268,"../models/PublicUser":275,"../models/UpcomingAppointmentsSummary":295,"../models/UpcomingBookingsSummary":296,"../models/UserJobTitle":300,"../viewmodels/AppointmentView":371,knockout:!1}],132:[function(require,module,exports){"use strict";function ViewModel(){this.headerText=ko.observable("Select a time");this.component=ko.observable(null)}var ko=require("knockout"),getDateWithoutTime=require("../utils/getDateWithoutTime"),Activity=require("../components/Activity"),A=Activity.extend(function DatetimePickerActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel;this.navBar=Activity.createSubsectionNavBar("");this.viewModel.navBar=this.navBar;this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject();ko.computed(function(){var datetime=this.viewModel.component()&&this.viewModel.component().selectedDatetime();if(datetime){this.requestData.selectedDatetime=datetime;this.requestData.allowBookUnavailableTime=this.viewModel.component().allowBookUnavailableTime();this.app.shell.goBack(this.requestData)}},this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var header=this.requestData.headerText;this.viewModel.headerText(header||"Select date and time");if(this.requestData.title)this.navBar.title(this.requestData.title);else{this.navBar.title("");this.navBar.leftAction().text(this.requestData.navTitle||"")}if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction);this.requestData.navTitle&&this.navBar.leftAction().text(this.requestData.navTitle);this.navBar.leftAction().handler(this.returnRequest)}};A.prototype.show=function show(state){this.viewModel.component()&&this.viewModel.component().reset();Activity.prototype.show.call(this,state);this.viewModel.component().requiredDurationMinutes(0|this.requestData.requiredDuration||15);this.viewModel.component().includeEndTime(!!this.requestData.includeEndTime);this.viewModel.component().userID(this.app.model.user().userID());var selDate=getDateWithoutTime(this.requestData.selectedDatetime);this.viewModel.component().selectedDate(selDate);this.updateNavBarState()}},{"../components/Activity":223,"../utils/getDateWithoutTime":340,knockout:!1}],133:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function DownloadAppActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar("Download the App");this.navBar.rightAction(null)});exports.init=A.init},{"../components/Activity":223}],134:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201960833-adding-education-to-your-profile";this.isLoading=app.model.education.state.isLoading;this.isSyncing=app.model.education.state.isSyncing;this.list=app.model.education.list}var Activity=require("../components/Activity"),A=Activity.extend(function EducationActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Profile",{backLink:"/userProfile",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.education.sync()["catch"](function(err){this.app.modals.showError({title:"Error loading education information",error:err})}.bind(this))}},{"../components/Activity":223}],135:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201960833-adding-education-to-your-profile";this.educationID=ko.observable(0);this.isLoading=app.model.education.state.isLoading;this.isSaving=app.model.education.state.isSaving;this.isSyncing=app.model.education.state.isSyncing;this.isDeleting=app.model.education.state.isDeleting;this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.education.state.isLocked()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.isNew=ko.pureComputed(function(){var p=this.item();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.version();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.education.setItem(this.item().model.toPlainObject()).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while saving.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete",message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.education.delItem(this.educationID()).then(function(){app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error while deleting.",error:err})})}.bind(this);this.yearsOptions=ko.computed(function(){for(var l=[],i=(new Date).getFullYear();i>1900;i--)l.push(i);return l})}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function EducationFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar("Education",{backLink:"/education",helpLink:this.viewModel.helpLink})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/education/";this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[];this.viewModel.educationID(0|params[0]);this.updateNavBarState();0===this.viewModel.educationID()?this.viewModel.version(this.app.model.education.newItem()):this.app.model.education.createItemVersion(this.viewModel.educationID()).then(function(educationVersion){if(!educationVersion)throw new Error("No data");this.viewModel.version(educationVersion)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this))}},{"../components/Activity":223,knockout:!1}],136:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=app.model.onboarding.inProgress;this.user=app.model.userProfile.data;this.helpLinkProfessionals="/help/relatedArticles/201960863-providing-feedback-to-us";this.helpLinkClients="/help/relatedArticles/202894686-providing-feedback-to-us";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.message=ko.observable("");this.becomeCollaborator=ko.observable(!1);this.isCollaborator=app.model.userProfile.data.isCollaborator;this.isSending=ko.observable(!1);this.vocElementID=ko.observable(0);this.emailSubject=ko.observable("");this.submitText=ko.pureComputed(function(){return this.isSending()?"Sending..":"Send"},this);this.isValid=ko.pureComputed(function(){var m=this.message();return m&&!/^\s*$/.test(m)},this);this.anonymousButtonUrl=ko.pureComputed(function(){if(!app.model.user().isAnonymous())return"";var subject=encodeURIComponent("Feedback"),body=encodeURIComponent(this.message()),url="mailto:support@loconomics.com?subject="+subject+"&body="+body;return url},this);this.send=function send(){if(this.isValid()&&!app.model.user().isAnonymous()){this.isSending(!0);app.model.feedback.postIdea({message:this.message(),becomeCollaborator:this.becomeCollaborator(),vocElementID:this.vocElementID()}).then(function(){if(!this.isCollaborator()&&this.becomeCollaborator()){this.isCollaborator(!0);app.model.userProfile.save()}app.successSave({message:"Sent! Thank you for your input."});this.message("");this.becomeCollaborator(!1)}.bind(this))["catch"](function(err){app.modals.showError({title:"There was an error sending your feedback",error:err})}).then(function(){this.isSending(!1)}.bind(this))}}.bind(this)}var Activity=require("../components/Activity"),VocElementEnum=require("../models/VocElementEnum"),A=Activity.extend(function FeedbackFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=null;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Back",{helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Back",{helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.updateNavBarState();var params=this.requestData.route.segments||[],elementName=params[0]||"",elementID=0|VocElementEnum[elementName];this.viewModel.message(this.requestData.route.query.body||this.requestData.route.query.message||"");elementName?VocElementEnum.hasOwnProperty(elementName)||console.error("Feedback Ideas: given a bad VOC Element name:",elementName):console.log("Feedback Ideas: Accessing feedback without specify an element, using General (0)");this.viewModel.vocElementID(elementID)};var ko=require("knockout")},{"../components/Activity":223,"../models/VocElementEnum":306,knockout:!1}],137:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=app.model.onboarding.inProgress;this.articles=ko.observableArray([]);this.searchText=ko.observable("");this.isLoading=ko.observable(!1);this.params=ko.observable("");this.viewType=ko.observable("");this.tailId=ko.observable("");this.categories=ko.observableArray([]);this.sections=ko.observableArray([]);this.selectedArticleId=ko.observable(0);this.selectedCategoryId=ko.observable(0);this.selectedSectionId=ko.observable(0);this.fullArticleData=ko.pureComputed(function(){return app.model.help.findByIdAt(this.selectedArticleId(),this.articles())},this);this.selectedSection=ko.pureComputed(function(){return app.model.help.findByIdAt(this.selectedSectionId(),this.sections())},this);this.selectedCategory=ko.pureComputed(function(){return app.model.help.findByIdAt(this.selectedCategoryId(),this.categories())},this);this.filteredSectionArticles=ko.pureComputed(function(){var selectedSectionId=this.selectedSectionId(),result=this.articles().filter(function(article){var articleIsSelected=article.section_id()===selectedSectionId;return articleIsSelected});return result.length?result:null},this);this.filteredCategorySections=ko.pureComputed(function(){var selectedCategoryId=this.selectedCategoryId(),result=this.sections().filter(function(section){var sectionIsSelected=section.category_id()===selectedCategoryId;return sectionIsSelected});return result.length?result:null},this);this.filteredArticles=ko.pureComputed(function(){var s=this.searchText().toLowerCase(),result=this.articles().filter(function(v){var n=v&&v.title()||"";n+=v&&v.description()||"";n=n.toLowerCase();return n.indexOf(s)>-1});return result.length?result:null},this);this.nothingFound=ko.pureComputed(function(){return this.filteredArticles()===null+("404"==this.viewType())+("viewAllSections"==this.viewType()&&null===this.sections())+("categoryView"==this.viewType()&&null===this.filteredCategorySections())+("sectionView"==this.viewType()&&null===this.filteredSectionArticles())+("viewAllArticles"==this.viewType()&&null===this.articles())+("articleView"==this.viewType()&&null===this.fullArticleData())+("helpView"==this.viewType()&&null===this.filteredSectionArticles())},this)}var Activity=require("../components/Activity"),A=Activity.extend(function HelpActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=null;this.navBar=Activity.createSubsectionNavBar("Back");this.currentLabels="";this.loadArticles=function(){if(!this.viewModel.articles().length||!this.viewModel.sections().length){this.viewModel.isLoading(!0);Promise.all([this.app.model.help.getArticles(),this.app.model.help.getCategories(),this.app.model.help.getSections()]).then(function(res){this.viewModel.articles(res[0]);this.viewModel.categories(res[1]);this.viewModel.sections(res[2]);this.viewModel.isLoading(!1)}.bind(this))["catch"](function(){this.viewModel.isLoading(!1)}.bind(this))}}.bind(this);this.subSectionFunction={categories:function(tailId){this.viewModel.selectedCategoryId(parseInt(tailId,10));this.viewModel.viewType("categoryView")}.bind(this),sections:function(tailId){this.viewModel.selectedSectionId(parseInt(tailId,10));this.viewModel.viewType("sectionView")}.bind(this),articles:function(tailId){this.viewModel.selectedArticleId(parseInt(tailId,10));this.viewModel.viewType("articleView")}.bind(this),relatedArticles:function(tailId){this.viewModel.selectedSectionId(parseInt(tailId,10));this.viewModel.viewType("helpView")}.bind(this)};this.renderSubSection=function(subSectionPath,tail){var tailId=tail.split("-")[0];if(""===tailId){"categories"===subSectionPath&&this.viewModel.viewType("viewAllCategories");"sections"===subSectionPath&&this.viewModel.viewType("viewAllSections");"articles"===subSectionPath&&this.viewModel.viewType("articleView");"relatedArticles"===subSectionPath?this.viewModel.viewType("helpView"):this.viewModel.viewType("viewAllArticles")}else this.subSectionFunction[subSectionPath](tailId)}});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.searchText("");this.loadArticles();var params=state&&state.route&&state.route.segments,subSections=["articles","sections","categories","relatedArticles"];this.viewModel.viewType("");if(params){var subSectionPath=params[0]||"",tail=params[1]||"";subSections.indexOf(subSectionPath)>-1?this.renderSubSection(subSectionPath,tail):""===subSectionPath?this.viewModel.viewType("viewAllCategories"):this.viewModel.viewType("404")}};var ko=require("knockout")},{"../components/Activity":223,knockout:!1}],138:[function(require,module,exports){"use strict";function ViewModel(appModel){this.isLoading=ko.observable(!1);this.searchTerm=ko.observable();this.lat=ko.observable(DEFAULT_LOCATION.lat);this.lng=ko.observable(DEFAULT_LOCATION.lng);this.city=ko.observable();this.searchDistance=ko.observable(DEFAULT_LOCATION.searchDistance);this.searchResults=new SearchResults;var latestRequest=null;this.loadData=function(searchTerm,lat,lng){latestRequest&&latestRequest.xhr.abort();this.isLoading(!0);latestRequest=appModel.rest.get("search",{searchTerm:searchTerm,origLat:lat||DEFAULT_LOCATION.lat,origLong:lng||DEFAULT_LOCATION.lng,searchDistance:DEFAULT_LOCATION.searchDistance});return latestRequest.then(function(searchResults){searchResults?this.searchResults.model.updateWith(searchResults,!0):this.searchResults.model.reset();this.isLoading(!1)}.bind(this))["catch"](function(){this.isLoading(!1)}.bind(this))};this.search=function(){var s=this.searchTerm();s&&s.length>2?this.loadData(s,this.lat(),this.lng()):this.searchResults.model.reset()};ko.computed(function(){this.search()},this).extend({rateLimit:{method:"notifyAtFixedRate",timeout:300}});this.isSearchAutocompleteOpened=ko.pureComputed(function(){return this.searchResults.jobTitles().length||this.searchResults.serviceProfessionals().length||this.searchResults.categories().length},this)}var $=require("jquery"),SearchResults=require("../models/SearchResults"),ko=require("knockout"),Activity=require("../components/Activity"),snapPoints=require("../utils/snapPoints"),googleMapReady=require("../utils/googleMapReady");require("geocomplete");var A=Activity.extend(function HomeActivity(){Activity.apply(this,arguments);this.navBar=Activity.createSectionNavBar(null);var navBar=this.navBar;navBar.additionalNavClasses("AppNav--home");this.accessLevel=null;this.viewModel=new ViewModel(this.app.model);this.viewModel.nav=this.app.navBarBinding;this.$header=$(".AppNav");this.registerHandler({target:this.$activity,event:"scroll-fixed-header",handler:function(e,what){var cs=navBar.additionalNavClasses();"after"===what?navBar.additionalNavClasses(cs+" is-fixed"):navBar.additionalNavClasses(cs.replace("is-fixed",""))}});this.registerHandler({target:this.$activity,event:"scroll-search",handler:function(e,what){var cs=navBar.additionalNavClasses();"after"===what?navBar.additionalNavClasses(cs+" is-search"):navBar.additionalNavClasses(cs.replace("is-search",""))}});var $location=this.$activity.find("[name=location]"),vm=this.viewModel;googleMapReady(function(){var options={types:["geocode"],bounds:null,componentRestrictions:{country:"US"}};$location.geocomplete(options);$location.on("geocode:result",function(e,place){if(place&&place.geometry){vm.lat(place.geometry.location.lat());vm.lng(place.geometry.location.lng());vm.city(place.formatted_address);console.log("LOCATION: ",place)}})})});exports.init=A.init;var DEFAULT_LOCATION={lat:"37.788479",lng:"-122.40297199999998",searchDistance:30,city:"San Francisco, CA USA"};A.prototype._registerSnapPoints=function(){var $searchBox=this.$activity.find("#homeSearch"),searchPoint=Math.max(1,$searchBox.offset().top+this.$activity.scrollTop()+$searchBox.outerHeight()-this.$header.outerHeight()|0),pointsEvents={0:"scroll-fixed-header"};pointsEvents[searchPoint]="scroll-search";snapPoints(this.$activity,pointsEvents)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(!this._notFirstShow){this._registerSnapPoints();this._notFirstShow=!0;var showIt=!localStorage.sanFranciscoLaunchPopup&&this.app.model.userProfile.data.isAnonymous();showIt&&this.app.modals.showAnnouncement({message:"We're an app for booking local services that's cooperatively owned by service professionals. Right now we're busy recruiting service professional owners in San Francisco and Oakland. Click below to learn more.",primaryButtonText:"I'm a service professional",primaryButtonLink:"#!/learnMoreProfessionals",secondaryButtonText:"I'm a potential client",secondaryButtonLink:"#!/"}).then(function(){localStorage.sanFranciscoLaunchPopup=!0})}this.viewModel.searchTerm("")}},{"../components/Activity":223,"../models/SearchResults":286,"../utils/googleMapReady":343,"../utils/snapPoints":364,geocomplete:!1,jquery:!1,knockout:!1}],139:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=app.model.messaging.state.isLoading;this.isSyncing=app.model.messaging.state.isSyncing;this.sourceThreads=ko.observableArray([]);this.searchText=ko.observable("");this.threads=ko.pureComputed(function(){var t=this.sourceThreads(),s=this.searchText();return t?s?t.filter(function(thread){var found=!1;found=textSearch(s,thread.subject());found||thread.messages().some(function(msg){found=textSearch(s,msg.bodyText());return found});return found}).map(MessageView.fromThread.bind(null,app)):t.map(MessageView.fromThread.bind(null,app)):[]},this)}var Activity=require("../components/Activity"),ko=require("knockout"),MessageView=require("../models/MessageView"),textSearch=require("../utils/textSearch"),A=Activity.extend(function InboxActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("Inbox")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.messaging.getList().then(function(threads){this.viewModel.sourceThreads(threads())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading messages",error:err})}.bind(this))}},{"../components/Activity":223,"../models/MessageView":263,"../utils/textSearch":365,knockout:!1}],140:[function(require,module,exports){"use strict";function ViewModel(app){this.isServiceProfessional=ko.pureComputed(function(){var u=app.model.user();return u&&u.isServiceProfessional()});this.isClient=ko.pureComputed(function(){var u=app.model.user();return u&&u.isClient()});this.signup=ko.observable();this.resetSignup=function(){var signup=this.signup();if(signup instanceof SignupVM){signup.reset();signup.profile(SignupVM.profileType.serviceProfessional);signup.isCountryVisible(!1)}};this.signup.subscribe(this.resetSignup.bind(this));this.signupRedirect=function(){app.goDashboard()};this.setSignupJobTitle=function(id,name){var signup=this.signup();if(signup instanceof SignupVM){signup.jobTitleID(id||void 0);signup.jobTitleName(name||void 0)}};this.inApp=ko.observable(!!window.cordova);this.reset=function(){this.search().searchTerm("");this.resetSignup()}.bind(this);this.search=ko.observable(new SearchJobTitlesVM(app));this.search().onClickJobTitle=function(jobTitle,e){if(app.model.userProfile.data.isAnonymous())this.setSignupJobTitle(jobTitle.jobTitleID());else{e.preventDefault();e.stopImmediatePropagation();var url="addJobTitles?s="+encodeURIComponent(jobTitle.singularName())+"&id="+encodeURIComponent(jobTitle.jobTitleID());app.shell.go(url)}}.bind(this);this.search().onClickNoJobTitle=function(jobTitleName,e){if(app.model.userProfile.data.isAnonymous())this.setSignupJobTitle(null,jobTitleName);else{e.preventDefault();e.stopImmediatePropagation();var url="addJobTitles?s="+encodeURIComponent(jobTitleName)+"&autoAddNew=true";app.shell.go(url)}}.bind(this);this.search().jobTitleHref("#learnMoreProfessionals-signup");this.search().noJobTitleHref("#learnMoreProfessionals-signup")}var $=require("jquery"),ko=require("knockout"),Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),snapPoints=require("../utils/snapPoints"),SearchJobTitlesVM=require("../viewmodels/SearchJobTitlesVM"),googleMapReady=require("../utils/googleMapReady");require("geocomplete");var A=Activity.extend(function LearnMoreProfessionalsActivity(){Activity.apply(this,arguments);this.navBar=Activity.createSectionNavBar(null);var navBar=this.navBar;navBar.additionalNavClasses("AppNav--home");this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.viewModel.nav=this.app.navBarBinding;var $header=this.$header=$(".AppNav");this.registerHandler({target:this.$activity,event:"scroll-fixed-header",handler:function(e,what){"after"===what?$header.addClass("is-fixed"):$header.removeClass("is-fixed")}});this.registerHandler({target:this.$activity,event:"scroll-search",handler:function(e,what){"after"===what?$header.addClass("is-search"):$header.removeClass("is-search")}});var $location=this.$activity.find("[name=location]");googleMapReady(function(){var vm=this.viewModel.search(),options={types:["geocode"],bounds:null,componentRestrictions:{country:"US"}};$location.geocomplete(options);$location.on("geocode:result",function(e,place){if(place&&place.geometry){vm.lat(place.geometry.location.lat());vm.lng(place.geometry.location.lng());vm.city(place.formatted_address);console.log("LOCATION: ",place)}})}.bind(this))});exports.init=A.init;A.prototype._registerSnapPoints=function(){var $searchBox=this.$activity.find("[name=s]"),searchPoint=Math.max(1,$searchBox.offset().top+this.$activity.scrollTop()+$searchBox.outerHeight()-this.$header.outerHeight()|0),pointsEvents={0:"scroll-fixed-header"};pointsEvents[searchPoint]="scroll-search";snapPoints(this.$activity,pointsEvents)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(!this._notFirstShow){this._registerSnapPoints();this._notFirstShow=!0}this.viewModel.reset()}},{"../components/Activity":223,"../utils/googleMapReady":343,"../utils/snapPoints":364,"../viewmodels/SearchJobTitlesVM":389,"../viewmodels/Signup":395,geocomplete:!1,jquery:!1,knockout:!1}],141:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967966-adding-credentials";this.isInOnboarding=app.model.onboarding.inProgress;this.jobTitleID=ko.observable(0);this.submittedUserLicensesCertifications=ko.observableArray([]);
this.jobTitleApplicableLicences=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.isSyncing=app.model.userLicensesCertifications.state.isSyncing();this.isLoading=app.model.userLicensesCertifications.state.isLoading();this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/licensesCertifications");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.addNew=function(item){var url="#!licensesCertificationsForm/"+this.jobTitleID()+"/0?licenseCertificationID="+item.licenseCertificationID(),cancelUrl=app.shell.currentRoute.url,request=$.extend({},this.requestData,{cancelLink:cancelUrl});app.shell.go(url,request)}.bind(this);this.selectItem=function(item){var url="/licensesCertificationsForm/"+this.jobTitleID()+"/"+item.userLicenseCertificationID()+"?mustReturn="+encodeURIComponent(app.shell.currentRoute.url)+"&returnText="+encodeURIComponent("Licenses/certifications");app.shell.go(url,this.requestData)}.bind(this);this.onboardingNextReady=ko.computed(function(){if(!app.model.onboarding.inProgress())return!1;var groups=this.jobTitleApplicableLicences();if(!groups)return!1;var hasAllRequiredOfGroup=function(group){if(!group||!group.length)return!0;var allAccomplished=!group.some(function(credential){return credential.required()?!credential.submitted():void 0});return allAccomplished};return hasAllRequiredOfGroup(groups.municipality())&&hasAllRequiredOfGroup(groups.county())&&hasAllRequiredOfGroup(groups.stateProvince())&&hasAllRequiredOfGroup(groups.country())},this);this.goNext=function(){if(app.model.onboarding.inProgress()){app.model.onboarding.selectedJobTitleID(this.jobTitleID());app.model.onboarding.goNext()}}.bind(this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),DEFAULT_BACK_LINK="/marketplaceJobtitles",DEFAULT_BACK_TEXT="Back",A=Activity.extend(function LicensesCertificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar(DEFAULT_BACK_TEXT,{backLink:DEFAULT_BACK_LINK,helpLink:this.viewModel.helpLink});this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName());this.updateNavBarState()}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Unable to load listing details.",error:err})}.bind(this));this.app.model.userLicensesCertifications.getList(jobTitleID).then(function(list){this.viewModel.submittedUserLicensesCertifications(this.app.model.userLicensesCertifications.asModel(list))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Unable to load submitted licenses and credentials.",error:err})}.bind(this));this.app.model.jobTitleLicenses.getItem(jobTitleID).then(function(item){this.viewModel.jobTitleApplicableLicences(item);this.viewModel.onboardingNextReady()&&this.viewModel.goNext()}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Unable to load license requirements.",error:err})}.bind(this));var found=/licensesCertifications\/(\d+)/i.exec(window.location),urlID=found&&0|found[1];if(urlID!==jobTitleID){var url="/licensesCertifications/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.submittedUserLicensesCertifications([]);this.viewModel.jobTitleApplicableLicences(null);this.updateNavBarState()}}.bind(this)})});exports.init=A.init;A.prototype.useJobTitleInNavBar=function(){this.navBar.model.updateWith(this.defaultNavBar,!0);var text=this.viewModel.jobTitleName()||DEFAULT_BACK_TEXT,id=this.viewModel.jobTitleID(),link=id?DEFAULT_BACK_LINK+"/"+id:DEFAULT_BACK_LINK;this.navBar.leftAction().model.updateWith({text:text,link:link})};A.prototype.updateNavBarState=function updateNavBarState(){var done=this.app.model.onboarding.updateNavBar(this.navBar);done||(done=this.app.applyNavbarMustReturn(this.requestData));done||this.useJobTitleInNavBar()};A.prototype.show=function show(options){this.viewModel.jobTitleID(0);Activity.prototype.show.call(this,options);this.updateNavBarState();var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];this.viewModel.jobTitleID(jobTitleID);jobTitleID||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile")},{"../components/Activity":223,"../viewmodels/UserJobProfile":397,jquery:!1,knockout:!1}],142:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=app.model.onboarding.inProgress;this.userLicenseCertificationID=ko.observable(0);this.licenseCertificationID=ko.observable(0);this.jobTitleID=ko.observable(0);this.jobTitleNamePlural=ko.observable();this.isLoading=ko.pureComputed(function(){return app.model.userLicensesCertifications.state.isLoading()},this);this.isSaving=app.model.userLicensesCertifications.state.isSaving;this.isSyncing=app.model.userLicensesCertifications.state.isSyncing;this.isDeleting=app.model.userLicensesCertifications.state.isDeleting;this.isLocked=ko.pureComputed(function(){return app.model.userLicensesCertifications.state.isLocked()},this);this.isReady=ko.pureComputed(function(){var it=this.item();return!(!it||!it.localTempFilePath()&&!it.localTempFileData())},this);this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());this.submitText=ko.pureComputed(function(){return this.isLoading()||this.isSyncing()?"Loading..":this.isSaving()?"Saving..":this.isDeleting()?"Deleting..":"Save"},this);this.isNew=ko.pureComputed(function(){return!this.userLicenseCertificationID()},this);this.version=ko.observable(null);this.item=ko.pureComputed(function(){var v=this.version();return v?v.version:null},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.version();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){var data=this.item().model.toPlainObject(!0);app.model.userLicensesCertifications.setItem(data).then(function(serverData){this.item().model.updateWith(serverData);this.version().push({evenIfObsolete:!0});app.model.jobTitleLicenses.clearCache();app.model.userLicensesCertifications.clearCache();app.model.onboarding.inProgress()?app.shell.goBack():app.successSave()}.bind(this))["catch"](function(err){app.modals.showError({title:"Unable to save.",error:err})})}.bind(this);this.confirmRemoval=function(){app.modals.confirm({title:"Delete",message:"Are you sure? This cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.userLicensesCertifications.delItem(this.jobTitleID(),this.userLicenseCertificationID()).then(function(){app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"Unable to delete.",error:err})})}.bind(this);var addNew=function(fromCamera){var settings={sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY};if(photoTools.takePhotoSupported())return photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){this.item().localTempFilePath(imgLocalUrl);this.item().localTempPhotoPreviewUrl(photoTools.getPreviewPhotoUrl(imgLocalUrl))}.bind(this))["catch"](function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&app.modals.showError({error:err,title:"Error selecting photo."})});app.modals.showError({error:"This feature is currently only available on mobile devices"});return void 0}.bind(this);this.takePhotoForNew=function(){addNew(!0)}.bind(this);this.pickPhotoForNew=function(){addNew(!1)}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),photoTools=require("../utils/photoTools");require("jquery.fileupload-image");var A=Activity.extend(function LicensesCertificationsFormActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/marketplaceProfile",helpLink:"/help/relatedArticles/201967966-adding-professional-licenses-and-certifications"});this.defaultNavBarSettings=this.navBar.model.toPlainObject(!0);if(!photoTools.takePhotoSupported()){var $input=this.$activity.find("#licensesCertificationsForm-photoFile"),PHOTO_WIDTH=442,PHOTO_HEIGHT=332;$input.fileupload({dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(png|gif|tiff|pdf|jpe?g)$/i,maxFileSize:2e7,disableImageResize:!0,previewMaxWidth:PHOTO_WIDTH,previewMaxHeight:PHOTO_HEIGHT,previewCrop:!0}).on("fileuploadadd",function(e,data){this.viewModel.item().localTempFileData(data);data.originalFiles.length&&/^image\//.test(data.originalFiles[0].type)||this.viewModel.item().localTempPhotoPreview(null);this.viewModel.item().localTempFileName(data.originalFiles[0]&&data.originalFiles[0].name)}.bind(this)).on("fileuploadprocessalways",function(e,data){var file=data.files[data.index];if(file.error){this.viewModel.item().localTempPhotoPreview(null);console.error("Photo Preview",file.error)}else file.preview&&this.viewModel.item().localTempPhotoPreview(file.preview)}.bind(this))}});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/licensesCertifications/";this.viewModel.isNew()?this.convertToCancelAction(this.navBar.leftAction(),link):this.navBar.model.updateWith(this.defaultNavBarSettings,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.version(null);var params=state&&state.route&&state.route.segments||[],query=state&&state.route&&state.route.query||{};this.viewModel.jobTitleID(0|params[0]);this.viewModel.userLicenseCertificationID(0|params[1]);this.viewModel.licenseCertificationID(0|query.licenseCertificationID);this.updateNavBarState();var ModelVersion=require("../utils/ModelVersion"),UserLicenseCertification=require("../models/UserLicenseCertification");this.viewModel.isNew()?this.app.model.licenseCertification.getItem(this.viewModel.licenseCertificationID()).then(function(data){var item=new UserLicenseCertification({jobTitleID:this.viewModel.jobTitleID(),licenseCertificationID:this.viewModel.licenseCertificationID()});item.licenseCertification().model.updateWith(data);this.viewModel.version(new ModelVersion(item))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this)):this.app.model.userLicensesCertifications.getItem(this.viewModel.jobTitleID(),this.viewModel.userLicenseCertificationID()).then(function(data){this.viewModel.version(new ModelVersion(new UserLicenseCertification(data)))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this))}},{"../components/Activity":223,"../models/UserLicenseCertification":302,"../utils/ModelVersion":322,"../utils/photoTools":350,knockout:!1}],143:[function(require,module,exports){"use strict";function ViewModel(app){fb.load();var credentials=new FormCredentials;this.username=credentials.username;this.password=credentials.password;this.validatedPassword=new ValidatedPasswordViewModel;this.resetToken=ko.observable("");this.view=ko.observable("login");this.requestResetMessage=ko.observable("");this.isWorking=ko.observable(!1);this.redirectUrl=ko.observable("");this.reset=function(){this.username("");this.password("");this.validatedPassword.reset();this.resetToken("");this.requestResetMessage("");this.isWorking(!1)};this.loginButtonText=ko.pureComputed(function(){return this.isWorking()?"Logging you in...":"Log in"},this);this.requestResetButtonText=ko.pureComputed(function(){return this.isWorking()?"Requesting a reset code...":"Reset my password"},this);this.confirmResetButtonText=ko.pureComputed(function(){return this.isWorking()?"Resetting password...":"Reset my password"},this);this.facebookButtonText=ko.pureComputed(function(){return fb.isReady()?"Log in with Facebook":"Loading Facebook..."},this);this.enableFacebookButton=ko.pureComputed(function(){return fb.isReady()},this);this.performLogin=function performLogin(){if(!this.username.error()&&!this.password.error()&&this.username()&&this.password()){this.isWorking(!0);app.model.login(this.username(),this.password()).then(function(){this.reset();this.isWorking(!1);app.model.onboarding.setStep(app.model.user().onboardingStep());app.model.onboarding.goIfEnabled()||(this.redirectUrl()?app.shell.go(this.redirectUrl()):app.goDashboard())}.bind(this))["catch"](function(err){this.isWorking(!1);var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid username or password";app.modals.showError({title:"Error logging in",error:msg})}.bind(this))}else app.modals.showError({title:"Validation",error:"Type a valid e-mail and a password"})}.bind(this);this.requestReset=function requestReset(){this.isWorking(!0);app.model.resetPassword({username:this.username()}).then(function(result){this.requestResetMessage(result.message);this.isWorking(!1);this.goConfirm()}.bind(this))["catch"](function(error){this.isWorking(!1);app.modals.showError({title:"Error requesting a password reset",error:error})}.bind(this))}.bind(this);this.confirmReset=function confirmReset(){if(this.validatedPassword.isValid()){this.isWorking(!0);app.model.confirmResetPassword({password:this.validatedPassword.password(),token:this.resetToken()}).then(function(result){app.modals.showNotification({title:"Done!",message:result.message});this.isWorking(!1);this.goLogin()}.bind(this))["catch"](function(error){this.isWorking(!1);app.modals.showError({title:"Error resetting the password",error:error})}.bind(this))}else app.modals.showError({title:"Validation",error:"Please create a valid password"})}.bind(this);this.facebook=function(){facebookLogin().then(function(result){var accessToken=result.authResponse&&result.authResponse.accessToken||result.auth&&result.auth.accessToken;this.isWorking(!0);return app.model.facebookLogin(accessToken).then(function(){this.reset();this.isWorking(!1);this.redirectUrl()?app.shell.go(this.redirectUrl()):app.goDashboard()}.bind(this))}.bind(this))["catch"](function(err){this.isWorking(!1);var msg=err&&err.responseJSON&&err.responseJSON.errorMessage||err&&err.statusText||"Invalid Facebook login";app.modals.showError({title:"Error logging in",error:msg})}.bind(this))}.bind(this);this.goLogin=function(){this.view("login")}.bind(this);this.goReset=function(){this.view("reset-password")}.bind(this);this.goConfirm=function(){this.view("confirm-reset")}.bind(this)}var ko=require("knockout"),Activity=require("../components/Activity"),ValidatedPasswordViewModel=require("../viewmodels/ValidatedPassword"),A=Activity.extend(function LoginActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Log in");this.navBar.rightAction(null);var app=this.app,act=this;this.registerHandler({target:this.viewModel.view,handler:function(view){if(act.isNotFirstTime)switch(view){case"reset-password":app.shell.pushState(void 0,void 0,"/login/reset-password");break;case"confirm-reset":app.shell.pushState(void 0,void 0,"/login/reset-password/confirm");break;default:case"login":app.shell.pushState(void 0,void 0,"/login")}}})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.reset();var params=state&&state.route&&state.route.segments,query=state&&state.route&&state.route.query,redirectUrl=state.redirectUrl||query.redirectUrl;!redirectUrl&&state.requiredLevel&&(redirectUrl=this.app.shell.referrerRoute&&this.app.shell.referrerRoute.url);this.viewModel.redirectUrl(redirectUrl);if("reset-password"===params[0]){var t=query.token||"";this.viewModel.resetToken(t);"confirm"===params[1]?this.viewModel.goConfirm():this.viewModel.goReset()}else this.viewModel.goLogin();this.isNotFirstTime=!0};var FormCredentials=require("../viewmodels/FormCredentials"),fb=require("../utils/facebookUtils"),facebookLogin=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.login(["email"],s,e)}):fb.login({scope:"email"})}},{"../components/Activity":223,"../utils/facebookUtils":338,"../viewmodels/FormCredentials":379,"../viewmodels/ValidatedPassword":398,knockout:!1}],144:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function LogoutActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.logout().then(function(){var newAnon=this.app.model.user().constructor.newAnonymous();this.app.model.user().model.updateWith(newAnon);this.app.shell.go("/")}.bind(this))}},{"../components/Activity":223}],145:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/202034083-managing-your-marketplace-profile";this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.userJobTitle=ko.observable(null);this.returnText=ko.observable("Back");this.jobTitleName=ko.pureComputed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Job Title"},this);this.userID=ko.pureComputed(function(){return app.model.userProfile.data.userID()},this);this.addresses=ko.observable([]);this.pricing=ko.observable([]);this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.serviceProfessionalServices.state.isLoading()},this);this.addressesCount=ko.pureComputed(function(){var count=this.addresses().length,one="1 location",more=" locations";return 1===count?one:count+more},this);this.getJobUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.jobTitleID()+"?mustReturn=marketplaceJobtitles/"+this.jobTitleID()+"&returnText="+encodeURIComponent(this.jobTitleName())},this)};var UserJobTitle=require("../models/UserJobTitle");this.isToggleReady=ko.pureComputed(function(){return this.userJobTitle()&&this.userJobTitle().isComplete()},this);this.isActiveStatus=ko.pureComputed({read:function(){var j=this.userJobTitle();return j&&j.statusID()===UserJobTitle.status.on||!1},write:function(v){var status=this.userJobTitle()&&this.userJobTitle().statusID();if(v===!0&&status===UserJobTitle.status.off){this.userJobTitle().statusID(UserJobTitle.status.on);app.model.userJobProfile.reactivateUserJobTitle(this.jobTitleID())["catch"](function(err){app.modals.showError({title:"Error enabling your listing",error:err})})}else if(v===!1&&status===UserJobTitle.status.on){this.userJobTitle().statusID(UserJobTitle.status.off);app.model.userJobProfile.deactivateUserJobTitle(this.jobTitleID())["catch"](function(err){app.modals.showError({title:"Error disabling your listing",error:err})});app.modals.showNotification({message:'Clients will no longer be able to find you in the marketplace. However, any "book me now" links you have posted will still be active.',buttonText:"Got it!"})}},owner:this});this.statusLabel=ko.pureComputed(function(){var statusID=this.userJobTitle()&&this.userJobTitle().statusID();switch(statusID){case UserJobTitle.status.on:return"This listing is active";case UserJobTitle.status.off:return"This listing is inactive";default:return"Steps Remaining"}},this);this.submittedUserLicensesCertifications=ko.observableArray([]);this.jobTitleApplicableLicences=ko.observable(null);this.workPhotos=ko.observable([]);this.isLoading=ko.pureComputed(function(){return app.model.serviceAddresses.state.isLoading()||app.model.serviceProfessionalServices.state.isLoading()},this);this.licensesCertificationsSummary=ko.pureComputed(function(){var lc=this.submittedUserLicensesCertifications();if(lc&&lc.length){var verified=0,other=0,pending=0;lc.forEach(function(l){if(l&&1===l.statusID())verified++;else if(l&&2===l.statusID())pending++;else{if(l&&4===l.statusID())return"Expired, please update";if(l&&5===l.statusID())other++;else{if(l&&6===l.statusID())return"Expiring soon, please update";if(l&&3===l.statusID())return"Please contact us"}}});return verified+" verified, "+pending+" pending, "+other+" supplemental"}return"None verified"},this);this.workPhotosSummary=ko.pureComputed(function(){var wp=this.workPhotos();return wp&&wp.length>1?wp.length+" images":wp&&1===wp.length?"1 image":"No images"},this);this.pricingCount=ko.pureComputed(function(){var count=this.pricing().length,one="1 offering",more=" offerings";return 1===count?one:count+more},this);this.deleteJobTitle=function(){var jid=this.jobTitleID(),jname=this.jobTitleName();jid&&app.modals.confirm({title:"Delete "+jname+" listing",message:"Are you sure you really want to delete your "+jname+" listing?",yes:"Delete",no:"Keep"}).then(function(){app.shell.goBack();return app.model.userJobProfile.deleteUserJobTitle(jid)})["catch"](function(err){err&&app.modals.showError({error:err,title:"Error while deleting your listing"})})}.bind(this);this.requiredAlertLinks=ko.pureComputed(function(){var userJobTitle=this.userJobTitle(),jobTitleID=userJobTitle&&userJobTitle.jobTitleID(),requiredAlerts=userJobTitle&&userJobTitle.requiredAlerts()||[];return requiredAlerts.map(function(profileAlert){return AlertLink.fromProfileAlert(profileAlert,{jobTitleID:jobTitleID})})},this)}var Activity=require("../components/Activity"),ko=require("knockout"),AlertLink=require("../viewmodels/AlertLink"),A=Activity.extend(function MarketplaceJobtitlesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Your listings",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.userJobProfile.getUserJobTitleAndJobTitle(jobTitleID).then(function(job){this.viewModel.jobTitle(job.jobTitle);this.viewModel.userJobTitle(job.userJobTitle)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error loading your listing.",error:err})}.bind(this));this.app.model.serviceAddresses.getList(jobTitleID).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.addresses(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error loading your locations.",error:err})}.bind(this));this.app.model.serviceProfessionalServices.getList(jobTitleID).then(function(list){list=this.app.model.serviceProfessionalServices.asModel(list);this.viewModel.pricing(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error loading your offerings.",error:err})}.bind(this));this.app.model.workPhotos.getList(jobTitleID).then(function(list){list=this.app.model.workPhotos.asModel(list);this.viewModel.workPhotos(list)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while your work photos.",error:err})}.bind(this));this.app.model.userLicensesCertifications.getList(jobTitleID).then(function(list){this.viewModel.submittedUserLicensesCertifications(this.app.model.userLicensesCertifications.asModel(list))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));this.app.model.jobTitleLicenses.getItem(jobTitleID).then(function(item){this.viewModel.jobTitleApplicableLicences(item)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}else{this.viewModel.addresses([]);this.viewModel.pricing([]);this.viewModel.jobTitle(null);this.viewModel.userJobTitle(null)}}.bind(this)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.viewModel.jobTitleID(0);var params=state&&state.route&&state.route.segments||{},jobID=0|params[0];this.viewModel.jobTitleID(jobID);var returnText=state&&state.route&&state.route.query.returnText||"Back";this.viewModel.returnText(decodeURIComponent(returnText))}},{"../components/Activity":223,"../models/UserJobTitle":300,"../viewmodels/AlertLink":369,knockout:!1}],146:[function(require,module,exports){"use strict";function ViewModel(app){var jobVm=new UserJobProfileViewModel(app);jobVm.verificationsCount=ko.observable(3);jobVm.displayedVerificationsNumber=ko.computed(function(){var verificationsCount=this.verificationsCount();return"("+verificationsCount+")"},jobVm);jobVm.verificationsSecondaryText=ko.computed(function(){var verificationsLimit=10,count=this.verificationsCount(),remaining=verificationsLimit-count;return remaining>0?"You can add up to "+remaining+" more":"You cannot add more"},jobVm);jobVm.displayedLastBackgroundCheck=ko.computed(function(){var lastDate=new Date(2014,10,14);return moment(lastDate).format("L")},jobVm);jobVm.user=app.model.userProfile.data;jobVm.marketplaceProfileUrl=ko.computed(function(){var example="www.loconomics.com/YOURNAME",slug=app.model.marketplaceProfile.data.serviceProfessionalProfileUrlSlug(),url=app.model.marketplaceProfile.data.serviceProfessionalProfileUrl();return slug?url:example},jobVm);return jobVm}var Activity=require("../components/Activity"),UserJobProfileViewModel=require("../viewmodels/UserJobProfile"),ko=require("knockout"),moment=require("moment"),A=Activity.extend(function MarketplaceProfileActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar("Your Listings");this.viewModel.showMarketplaceInfo(!0);this.viewModel.baseUrl("/marketplaceJobtitles")});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);if(this.viewModel.user.isServiceProfessional()){this.viewModel.sync();this.app.model.marketplaceProfile.sync()}}},{"../components/Activity":223,"../viewmodels/UserJobProfile":397,knockout:!1,moment:!1}],147:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function mockupHouseCleanerServiceEditorActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSubsectionNavBar("Scheduler",{backLink:"/scheduling",helpLink:"/help/relatedArticles/201964153-how-owner-user-fees-work"})});module.exports=A},{"../components/Activity":223}],148:[function(require,module,exports){"use strict";function ViewModel(){this.upcomingAppointments=new UpcomingAppointmentsSummary;this.upcomingAppointments.isLoading=ko.observable(!1);this.upcomingAppointments.isSyncing=ko.observable(!1);this.pastAppointments={pastAppointments:ko.observable(!1),count:ko.observable(0)};this.getUrlTo=function(name){return ko.pureComputed(function(){return"/"+name+"/"+this.upcomingAppointments.nextBooking.bookingID+"?mustReturn=myAppointments/&returnText= My appointments"},this)}}var ko=require("knockout"),Activity=require("../components/Activity"),UpcomingAppointmentsSummary=require("../models/UpcomingAppointmentsSummary"),A=Activity.extend(function MyAppointmentsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSectionNavBar("My appointments");this.prepareShowErrorFor=function prepareShowErrorFor(title){return function(err){this.app.modals.showError({title:title,error:err})}.bind(this)}.bind(this)});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.syncUpcomingAppointments()};A.prototype.syncUpcomingAppointments=function syncUpcomingAppointments(){var v=this.viewModel,appModel=this.app.model;v.upcomingAppointments.items().length?v.upcomingAppointments.isSyncing(!0):v.upcomingAppointments.isLoading(!0);appModel.bookings.getUpcomingAppointments().then(function(upcoming){v.upcomingAppointments.model.updateWith(upcoming,!0)})["catch"](this.prepareShowErrorFor("Error loading upcoming appointments")).then(function(){v.upcomingAppointments.isLoading(!1);v.upcomingAppointments.isSyncing(!1)})}},{"../components/Activity":223,"../models/UpcomingAppointmentsSummary":295,knockout:!1}],149:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function OnboardingSuccessActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;var app=this.app;this.viewModel={userProfile:app.model.userProfile.data,isServiceProfessional:app.model.userProfile.data.isServiceProfessional,jobTitleName:""};this.navBar=new Activity.NavBar({title:null,leftAction:Activity.NavAction.menuIn,rightAction:Activity.NavAction.menuNewItem})});exports.init=A.init},{"../components/Activity":223}],150:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=app.model.ownerAcknowledgment.isLoading;this.isSaving=app.model.ownerAcknowledgment.isSaving;this.acknowledgment=app.model.ownerAcknowledgment.data;this.ownerFullName=ko.observable("");this.reset=function(){this.ownerFullName("")};this.acknowledge=function(){app.model.ownerAcknowledgment.acknowledge({ownerFullName:this.ownerFullName()}).then(function(){app.successSave()})["catch"](function(err){app.modals.showError({title:"Error saving",error:err})})}}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function OwnerAcknowledgmentActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.isServiceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Owner information",{backLink:"/ownerInfo",helpLink:"/help/relatedArticles/201964153-how-owner-user-fees-work"})});module.exports=A;A.prototype.show=function show(state){this.viewModel.reset();Activity.prototype.show.call(this,state);this.app.model.ownerAcknowledgment.sync()}},{"../components/Activity":223,knockout:!1}],151:[function(require,module,exports){"use strict";function ViewModel(){this.helpLink="/help/relatedArticles/201096629-ownership-in-loconomics";this.ownerStatus=ko.observable("pending");this.ownerStatusName=ko.observable("Pending");this.ownerStatusOK=ko.pureComputed(function(){return"active"===this.ownerStatus()},this)}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function OwnerInfoActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel;this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSectionNavBar("Cooperative")});exports.init=A.init},{"../components/Activity":223,knockout:!1}],152:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function OwnerPerksActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={helpLink:"/help/relatedArticles/201973183-owner-perks-and-benefits"};this.navBar=Activity.createSubsectionNavBar("Owner information",{backLink:"/ownerInfo",helpLink:this.viewModel.helpLink})});module.exports=A},{"../components/Activity":223}],153:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967096-accepting-and-receiving-payments";this.isInOnboarding=app.model.onboarding.inProgress;this.simplifiedFormEnabled=ko.observable(!1);this.isInOnboarding.subscribe(function(itIs){this.simplifiedFormEnabled(itIs)}.bind(this));var paymentAccount=app.model.paymentAccount;this.errorMessages=paymentAccount.errorMessages;var dataVersion=paymentAccount.newVersion();
dataVersion.isObsolete.subscribe(function(itIs){if(itIs){dataVersion.pull({evenIfNewer:!0});this.formVisible(!dataVersion.version.status())}}.bind(this));this.paymentAccount=dataVersion.version;this.isLocked=paymentAccount.isLocked;this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},paymentAccount);this.discard=function discard(){dataVersion.pull({evenIfNewer:!0});this.formVisible(!dataVersion.version.status());this.userSelectedAccount(null);this.simplifiedFormEnabled(this.isInOnboarding())}.bind(this);this.save=function save(){this.isInOnboarding()&&dataVersion.version.status()&&!this.formVisible()?app.model.onboarding.goNext():dataVersion.pushSave().then(function(){this.isInOnboarding()?app.model.onboarding.goNext():app.successSave()}.bind(this))["catch"](function(){this.simplifiedFormEnabled(!1)}.bind(this))}.bind(this);this.onSkip=function(){app.model.onboarding.goNext()}.bind(this);this.errorMessages={postalCode:ko.observable()};this.postalCodeVM=new PostalCodeVM({appModel:app.model,address:this.paymentAccount,postalCodeError:this.errorMessages.postalCode});app.model.paymentAccount.isLoading.subscribe(function(isLoading){isLoading||this.postalCodeVM.onFormLoaded()},this);this.formVisible=ko.observable(!1);this.showForm=function(){this.formVisible(!0)};this.userSelectedAccount=ko.observable(null);this.isVenmoAccount=ko.pureComputed(function(){return this.userSelectedAccount()?"venmo"===this.userSelectedAccount():this.paymentAccount.status()?!(this.paymentAccount.accountNumber()&&this.paymentAccount.routingNumber()):!1},this);this.isBankAccount=ko.pureComputed(function(){return!this.isVenmoAccount()},this);this.chooseVenmoAccount=function(){this.userSelectedAccount("venmo")}.bind(this);this.chooseBankAccount=function(){this.userSelectedAccount("bank")}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),PostalCodeVM=require("../viewmodels/PostalCode"),A=Activity.extend(function PaymentAccountActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.app.model.paymentAccount,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save your payment account.":"Unable to load your payment account.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar,!0)};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();this.viewModel.discard();this.app.model.paymentAccount.sync()}},{"../components/Activity":223,"../viewmodels/PostalCode":388,knockout:!1}],154:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function PaymentsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Payments")});module.exports=A},{"../components/Activity":223}],155:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function PerformanceActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar("Performance")});module.exports=A},{"../components/Activity":223}],156:[function(require,module,exports){"use strict";function ViewModel(app){this.user=app.model.userProfile.data;this.helpLinkProfessionals="/help/relatedArticles/201967106-protecting-your-privacy";this.helpLinkClients="/help/relatedArticles/201960903-protecting-your-privacy";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.user=app.model.userProfile.data;var privacySettings=app.model.privacySettings,settingsVersion=privacySettings.newVersion();settingsVersion.isObsolete.subscribe(function(itIs){itIs&&settingsVersion.pull({evenIfNewer:!0})});this.settings=settingsVersion.version;this.isLocked=privacySettings.isLocked;this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},privacySettings);this.discard=function discard(){settingsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){settingsVersion.pushSave().then(function(){app.successSave()})["catch"](function(){})}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function PrivacySettingsActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;var serviceProfessionalNavBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar;this.registerHandler({target:this.app.model.privacySettings,event:"error",handler:function(err){var msg="save"===err.task?"Error saving privacy settings.":"Error loading privacy settings.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.app.model.privacySettings.sync();this.viewModel.discard();this.updateNavBarState()}},{"../components/Activity":223,knockout:!1}],157:[function(require,module,exports){"use strict";function ViewModel(app){this.isLoading=ko.observable(!1);this.user=ko.observable(null);this.userID=ko.observable(null);this.reviews=new ReviewsVM(app);this.showMessageBar=ko.observable(!1);this.refreshTs=ko.observable(new Date);this.reset=function(){this.user(null);this.userID(null);this.showMessageBar(!1)};var DEFAULT_WORKPHOTOS_LIMIT=2;this.isShowingAllPhotos=ko.observable(!1);this.workPhotos=ko.pureComputed(function(){var u=this.user(),ph=u&&u.selectedJobTitle()&&u.selectedJobTitle().workPhotos();if(ph){if(this.isShowingAllPhotos())return ph;var firsts=[];ph.some(function(p,i){if(i>DEFAULT_WORKPHOTOS_LIMIT-1)return!0;firsts.push(p);return void 0});return firsts}return[]},this);this.viewMoreWorkPhotosLabel=ko.pureComputed(function(){var imgCount=this.user()&&this.user().selectedJobTitle()&&this.user().selectedJobTitle().workPhotos();imgCount=imgCount&&imgCount.length||0;return this.isShowingAllPhotos()||0===imgCount||DEFAULT_WORKPHOTOS_LIMIT>=imgCount?"":"View all "+imgCount+" images"},this);this.viewAllPhotos=function(){this.isShowingAllPhotos(!0)}.bind(this);this.serviceAddresses=ko.pureComputed(function(){var u=this.user(),adds=u&&u.selectedJobTitle()&&u.selectedJobTitle().serviceAddresses();return adds||[]},this);this.changeJobTitle=function(jobTitle,event){this.user().selectedJobTitleID(jobTitle.jobTitleID());this.reviews.reset(void 0,jobTitle.jobTitleID());this.reviews.load({limit:2});if(event){event.preventDefault();event.stopImmediatePropagation()}var url=event.target.getAttribute("href");app.shell.pushState(null,null,url)}.bind(this);this.getEmailLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"mailto:?body="+encodeURIComponent(u.profile().fullName()+": ")+url},this);this.getFacebookLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://www.facebook.com/share.php?u="+url+"&t="+encodeURIComponent(u.profile().fullName())},this);this.getTwitterLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"http://twitter.com/intent/tweet?text="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getGooglePlusLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl());return"https://plus.google.com/share?url="+url},this);this.getPinterestLink=ko.pureComputed(function(){var u=this.user();if(!u)return"";var url=encodeURIComponent(u.profile().serviceProfessionalProfileUrl()),photo=encodeURIComponent(u.profile().photoUrl());return"http://pinterest.com/pin/create/button/?url="+url+"&media="+photo+"&description="+encodeURIComponent(u.profile().fullName()+": "+url)},this);this.getBookLink=ko.pureComputed(function(){var u=this.user();return u?"#!booking/"+u.profile().userID()+"/"+u.selectedJobTitleID():""},this);this.getSendMessageLink=ko.pureComputed(function(){var u=this.user();return u?"#!inbox/new/"+u.profile().userID():""},this);this.hasServicesOverview=ko.pureComputed(function(){var jobTitle=this.user()&&this.user().selectedJobTitle(),hasIntro=jobTitle&&jobTitle.hasIntro(),hasAttributes=jobTitle&&jobTitle.serviceAttributes().hasAttributes();return hasIntro||hasAttributes},this);this.jobTitleSingularName=ko.pureComputed(function(){return this.selectedJobTitle().jobTitleSingularName()},this);this.selectedJobTitle=ko.pureComputed(function(){return this.user()&&this.user().selectedJobTitle()||new PublicUserJobTitle},this);this.editListing=function(){app.shell.go("/marketplaceJobtitles/"+this.selectedJobTitle().jobTitleID())}.bind(this);this.listingIsActive=ko.pureComputed(function(){return this.selectedJobTitle().isActive()},this);this.isOwnProfile=ko.pureComputed(function(){var user=app.model.user(),profileOwnerUserID=this.userID();return user.isAnonymous()||null===profileOwnerUserID?!1:profileOwnerUserID==user.userID()},this);this.isMessageBarVisible=ko.pureComputed(function(){return this.isOwnProfile()&&this.showMessageBar()},this);this.messageBarTone=ko.pureComputed(function(){return this.listingIsActive()?MessageBar.tones.success:MessageBar.tones.warning},this)}function ReviewsVM(app){this.userID=ko.observable(null);this.jobTitleID=ko.observable(null);this.list=ko.observableArray([]);this.isLoading=ko.observable(!1);this.endReached=ko.observable(!1);var currentXhr=null;this.reset=function reset(userID,jobTitleID){this.list([]);userID&&this.userID(userID);this.jobTitleID(jobTitleID);this.endReached(!1);currentXhr&&currentXhr.abort&&currentXhr.abort()};this.load=function loadReviews(options){options=options||{};if(!this.isLoading()&&!this.endReached()&&this.userID()){this.isLoading(!0);var task=app.model.users.getReviews(this.userID(),this.jobTitleID(),options).then(function(newData){if(newData&&newData.length){newData.length<(options.limit||20)&&this.endReached(!0);newData=newData.map(function(d){return new PublicUserReview(d)});var list=this.list();if(options.since&&options.until)throw new Error("UNSUPPORTED SET-UP: since and until parameters at the same time");options.since?list=newData.concat.apply(newData,list):options.until?list.push.apply(list,newData):list=newData;this.list(list)}else this.endReached(!0);this.isLoading(!1);currentXhr=null}.bind(this))["catch"](function(err){this.isLoading(!1);currentXhr=null;if(err&&"abort"!==err.statusText){console.error("Error loading user reviews",err);throw err}}.bind(this));currentXhr=task.xhr;return task}}.bind(this);this.loadOlder=function loadOlderReviews(){var l=this.list(),last=l[l.length-1];return this.load({limit:10,until:last&&last.updatedDate()})}.bind(this);this.loadNewer=function loadOlderReviews(){var first=this.list()[0];return this.load({limit:10,since:first&&first.updatedDate()})}.bind(this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),PublicUser=require("../models/PublicUser"),MessageBar=require("../components/MessageBar"),PublicUserJobTitle=require("../models/PublicUserJobTitle"),A=Activity.extend(function ProfileActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.registerHandler({event:"layoutUpdate",target:$(window),handler:function(){this.viewModel.refreshTs(new Date)}.bind(this)})});exports.init=A.init;A.prototype.loadData=function(userID,jobTitleID){this.viewModel.reset();if(userID){this.viewModel.isLoading(!0);this.app.model.users.getUser(userID,{includeFullJobTitleID:-1}).then(function(data){var pu=new PublicUser(data);this.viewModel.user(pu);return jobTitleID?jobTitleID:pu.jobProfile()&&pu.jobProfile()[0]&&pu.jobProfile()[0].jobTitleID()}.bind(this)).then(function(jobTitleID){if(jobTitleID){this.viewModel.user().selectedJobTitleID(jobTitleID);this.viewModel.reviews.load({limit:2})}}.bind(this))["catch"](function(err){this.app.modals.showError({error:err,title:"The user profile could not be loaded."})}.bind(this)).then(function(){this.viewModel.isLoading(!1)}.bind(this))}};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=options.route&&options.route.segments,userID=0|params[0]||this.app.model.user().userID(),jobTitleID=0|params[1];this.loadData(userID,jobTitleID);this.viewModel.reviews.reset(userID,jobTitleID);this.viewModel.refreshTs(new Date);this.viewModel.userID(userID);this.viewModel.showMessageBar(!0)};A.prototype.hide=function(){Activity.prototype.hide.call(this);this.viewModel.showMessageBar(!1)};var PublicUserReview=require("../models/PublicUserReview")},{"../components/Activity":223,"../components/MessageBar":225,"../models/PublicUser":275,"../models/PublicUserJobTitle":277,"../models/PublicUserReview":281,jquery:!1,knockout:!1}],158:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201961423-setting-your-scheduling-preferences";this.goBackLink=ko.observable("");this.goBackLabel=ko.observable("");this.isInOnboarding=app.model.onboarding.inProgress;this.schedulingPreferences=new SchedulingPreferencesVM(app);this.weeklySchedule=new WeeklyScheduleVM(app);this.save=function save(){return Promise.all([this.schedulingPreferences.save(),this.weeklySchedule.save()]).then(function(){app.model.userJobProfile.clearCache();app.model.userJobProfile.syncList();app.model.onboarding.inProgress()?app.model.onboarding.goNext():app.successSave()})["catch"](function(){})}.bind(this);this.discard=function discard(){this.schedulingPreferences.discard();this.weeklySchedule.discard()}.bind(this);this.isLoading=ko.pureComputed(function(){return this.schedulingPreferences.isLoading()||this.weeklySchedule.isLoading()},this);this.isSaving=ko.pureComputed(function(){return this.schedulingPreferences.isSaving()||this.weeklySchedule.isSaving()},this);this.isLocked=ko.pureComputed(function(){return this.schedulingPreferences.isLocked()||this.weeklySchedule.isLocked()},this);this.submitText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"Save and continue":this.isLoading()?"loading...":this.isSaving()?"Saving...":"Save"},this)}function SchedulingPreferencesVM(app){var schedulingPreferences=app.model.schedulingPreferences,prefsVersion=schedulingPreferences.newVersion();prefsVersion.isObsolete.subscribe(function(itIs){itIs&&prefsVersion.pull({evenIfNewer:!0})});this.prefs=prefsVersion.version;this.isLoading=schedulingPreferences.isLoading;this.isSaving=schedulingPreferences.isSaving;this.isLocked=schedulingPreferences.isLocked;this.discard=function discard(){prefsVersion.pull({evenIfNewer:!0})}.bind(this);this.save=function save(){return prefsVersion.pushSave()}.bind(this)}function WeeklyScheduleVM(app){var weeklySchedule=app.model.weeklySchedule,scheduleVersion=weeklySchedule.newVersion();scheduleVersion.isObsolete.subscribe(function(itIs){itIs&&scheduleVersion.pull({evenIfNewer:!0})});this.schedule=scheduleVersion.version;this.isLoading=weeklySchedule.isLoading;this.isSaving=weeklySchedule.isSaving;this.isLocked=weeklySchedule.isLocked;this.discard=function discard(){scheduleVersion.pull({evenIfNewer:!0})};this.save=function save(){return scheduleVersion.pushSave()};var autoTz=timeZoneList.getUsAliasWhenPossible(timeZoneList.getLocalTimeZone()),autoLabel="Auto ("+timeZoneList.timeZoneToDisplayFormat(autoTz)+")";this.autoTimeZone=ko.observable({id:autoTz,label:autoLabel});this.timeZonesList=ko.observable(timeZoneList.getUserList());this.topUsTimeZones=ko.observable(timeZoneList.getTopUsZones())}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function SchedulingPreferencesActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.serviceProfessional;this.navBar=Activity.createSubsectionNavBar("Calendar",{backLink:"/calendar",helpLink:this.viewModel.helpLink});this.defaultNavBar=this.navBar.model.toPlainObject(!0);this.registerHandler({target:this.app.model.weeklySchedule,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save your weekly schedule.":"Unable to load your weekly schedule.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)});this.registerHandler({target:this.app.model.schedulingPreferences,event:"error",handler:function(err){var msg="save"===err.task?"Unable to save scheduling preferences.":"Unable to load scheduling preferences.";this.app.modals.showError({title:msg,error:err&&err.task&&err.error||err})}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.navBar.model.updateWith(this.defaultNavBar,!0);var info=this.app.getReturnRequestInfo(this.requestData);this.viewModel.goBackLink(info&&info.link||"/calendar");this.viewModel.goBackLabel(info&&info.label||"Calendar")};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState();this.app.model.schedulingPreferences.sync();this.app.model.weeklySchedule.sync();this.viewModel.discard()};var timeZoneList=require("../utils/timeZoneList")},{"../components/Activity":223,"../utils/timeZoneList":366,knockout:!1}],159:[function(require,module,exports){"use strict";function ViewModel(appModel){this.isLoading=ko.observable(!1);this.isCategoryLoading=ko.observable(!1);this.categoryID=ko.observable();this.origLat=ko.observable();this.origLong=ko.observable();this.searchDistance=ko.observable();this.jobTitleSearchResult=ko.observableArray();this.categorySearchResult=ko.observable();this.categoryBackgroundImage=ko.pureComputed(function(){var id=this.categoryID();return id?"CategoryBackground-"+id:""},this);var loadCategoryData=function(categoryID,origLat,origLong,searchDistance){this.isCategoryLoading(!0);return appModel.rest.get("search/categories/"+categoryID,{origLat:origLat,origLong:origLong,searchDistance:searchDistance}).then(function(data){this.categorySearchResult(data);this.isCategoryLoading(!1)}.bind(this))["catch"](function(){this.isCategoryLoading(!1)}.bind(this))}.bind(this),loadData=function(categoryID,origLat,origLong,searchDistance){this.isLoading(!0);return appModel.rest.get("search/job-titles/by-category",{categoryID:categoryID,origLat:origLat,origLong:origLong,searchDistance:searchDistance}).then(function(list){this.jobTitleSearchResult(list);this.isLoading(!1)}.bind(this))["catch"](function(){this.isLoading(!1)}.bind(this))}.bind(this);this.load=function(categoryID,origLat,origLong,searchDistance){this.categoryID(categoryID);this.origLat(origLat);this.origLong(origLong);this.searchDistance(searchDistance);return Promise.all([loadCategoryData(categoryID,origLat,origLong,searchDistance),loadData(categoryID,origLat,origLong,searchDistance)])}}var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function SearchCategoryActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app.model);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null)});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],categoryID=params[0]||"",origLat=params[1]||"",origLong=params[2]||"",searchDistance=params[3]||"";this.viewModel.load(categoryID,origLat,origLong,searchDistance)}},{"../components/Activity":223,knockout:!1}],160:[function(require,module,exports){"use strict";function ViewModel(appModel){this.isLoading=ko.observable(!1);this.isJobTitleLoading=ko.observable(!1);this.jobTitleID=ko.observable();this.origLat=ko.observable();this.origLong=ko.observable();this.searchDistance=ko.observable();this.serviceProfessionalSearchResult=ko.observableArray();this.jobTitleSearchResult=ko.observable();this.loadJobTitleData=function(jobTitleID,origLat,origLong,searchDistance){this.isJobTitleLoading(!0);return appModel.rest.get("search/job-titles/"+jobTitleID,{origLat:origLat,origLong:origLong,searchDistance:searchDistance}).then(function(data){this.jobTitleSearchResult(data);this.isJobTitleLoading(!1)}.bind(this))["catch"](function(){this.isJobTitleLoading(!1)}.bind(this))};this.loadData=function(jobTitleID,origLat,origLong,searchDistance){this.isLoading(!0);return appModel.rest.get("search/service-professionals/by-job-title",{jobTitleID:jobTitleID,origLat:origLat,origLong:origLong,searchDistance:searchDistance}).then(function(list){var listAsModel=list.map(function(item){return new ServiceProfessionalSearchResult(item)});this.serviceProfessionalSearchResult(listAsModel);this.isLoading(!1)}.bind(this))["catch"](function(){this.isLoading(!1)}.bind(this))}}var ServiceProfessionalSearchResult=require("../models/ServiceProfessionalSearchResult"),ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function SearchJobTitleActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app.model);this.navBar=Activity.createSubsectionNavBar("Back")});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);var params=this.requestData.route.segments||[],jobTitleID=params[0]||"",origLat=params[1]||"",origLong=params[2]||"",searchDistance=params[3]||"";this.viewModel.loadJobTitleData(jobTitleID,origLat,origLong,searchDistance);this.viewModel.loadData(jobTitleID,origLat,origLong,searchDistance)}},{"../components/Activity":223,"../models/ServiceProfessionalSearchResult":290,knockout:!1}],161:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201965996-setting-your-service-locations-areas";this.isInOnboarding=app.model.onboarding.inProgress;this.serviceAddresses=new ServiceAddresses;this.headerText=ko.pureComputed(function(){return this.isInOnboarding()&&0===this.serviceAddresses.sourceAddresses().length?"":this.isInOnboarding()?"Locations for your listing":this.serviceAddresses.isSelectionMode()?"Choose a place for this booking":"Locations"},this);this.addMoreHeaderText=ko.pureComputed(function(){return this.isInOnboarding()&&0===this.serviceAddresses.sourceAddresses().length?"Add at least one for your listing":this.isInOnboarding()?"Want to add any more?":""},this);this.addLocationLabel=ko.pureComputed(function(){return this.isInOnboarding()?"Place clients come to see you":"Add a service location"},this);this.addAreaLabel=ko.pureComputed(function(){return this.isInOnboarding()?"Area where you go to clients":"Add a service area/radius"},this);this.jobTitleID=ko.observable(0);this.jobTitle=ko.observable(null);this.clientUserID=ko.observable(null);this.clientAddresses=new ServiceAddresses;this.clientAddresses.isSelectionMode(!0);this.showSupportingText=ko.pureComputed(function(){return!(this.clientAddresses.hasAddresses()||this.serviceAddresses.isSelectionMode())},this);this.jobTitleName=ko.observable("Job Title");this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceAddress");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.isSyncing=app.model.serviceAddresses.state.isSyncing();this.isLoading=ko.computed(function(){var add=app.model.serviceAddresses.state.isLoading(),jobs=this.jobTitles.isLoading(),cli=app.model.clientAddresses.state.isLoading();return add||jobs||cli},this);this.goNext=function(){if(app.model.onboarding.inProgress()){app.model.onboarding.selectedJobTitleID(this.jobTitleID());app.model.onboarding.goNext()}}.bind(this);this.serviceAddresses.selectAddress=function(selectedAddress,event){this.serviceAddresses.isSelectionMode()===!0?this.returnSelected(selectedAddress.addressID(),selectedAddress.jobTitleID()):app.shell.go("addressEditor/service/"+this.jobTitleID()+"/"+selectedAddress.addressID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.clientAddresses.selectAddress=function(selectedAddress,event){this.clientAddresses.isSelectionMode()===!0&&this.returnAddress(selectedAddress.model.toPlainObject());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.addServiceLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceLocation",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addServiceArea=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/serviceArea",request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.addClientLocation=function(){var url="#!addressEditor/service/"+this.jobTitleID()+"/clientLocation/"+this.clientUserID(),request=$.extend({},this.requestData,{returnNewAsSelected:this.serviceAddresses.isSelectionMode()});app.shell.go(url,request)}.bind(this);this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasItems=this.serviceAddresses.sourceAddresses().length>0;return isin&&hasItems},this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),A=Activity.extend(function ServiceAddressesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/scheduling",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitle(jobTitle);this.updateNavBarState();this.viewModel.jobTitleName(jobTitle.singularName());return this.app.model.serviceAddresses.getList(jobTitleID)}.bind(this)).then(function(list){list=this.app.model.serviceAddresses.asModel(list);this.viewModel.serviceAddresses.sourceAddresses(list);this.requestData.selectedAddressID&&this.viewModel.serviceAddresses.presetSelectedAddressID(this.requestData.selectedAddressID)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this));if(this.viewModel.serviceAddresses.isSelectionMode())return;var found=/serviceAddresses\/(\d+)/i.exec(window.location),urlID=found&&0|found[1];if(urlID!==jobTitleID){var url="/serviceAddresses/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.serviceAddresses.sourceAddresses([]);this.viewModel.serviceAddresses.selectedAddress(null);this.viewModel.jobTitle(null);this.updateNavBarState();this.viewModel.jobTitleName("Job Title")}}.bind(this)});this.registerHandler({target:this.viewModel.clientUserID,handler:function(clientUserID){if(clientUserID)this.app.model.clientAddresses.getList(clientUserID).then(function(list){list=this.app.model.clientAddresses.asModel(list);this.viewModel.clientAddresses.sourceAddresses(list);this.requestData.selectedAddressID&&this.viewModel.clientAddresses.presetSelectedAddressID(this.requestData.selectedAddressID)}.bind(this));else{this.viewModel.clientAddresses.sourceAddresses([]);this.viewModel.clientAddresses.selectedAddress(null)}}.bind(this)});this.viewModel.returnSelected=function(addressID,jobTitleID){this.requestData.selectedAddressID=addressID;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.viewModel.returnAddress=function(addressDetails){this.requestData.address=addressDetails;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){var itIs=this.viewModel.serviceAddresses.isSelectionMode();this.requestData.title?this.navBar.title(this.requestData.title):this.navBar.title("");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);var jid=this.viewModel.jobTitleID(),jname=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName()||"Scheduler",url=this.mustReturnTo||jid&&"/marketplaceJobtitles/"+jid||"/scheduling";this.navBar.leftAction().link(url);this.navBar.leftAction().text(this.requestData.navTitle||jname)}itIs&&!this.requestData.cancelLink?this.navBar.leftAction().handler(this.returnRequest):this.requestData.cancelLink||this.navBar.leftAction().handler(null)};A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.jobTitleID(0);this.viewModel.clientUserID(0);this.viewModel.requestData=this.requestData;this.viewModel.serviceAddresses.isSelectionMode(options.selectAddress===!0);this.viewModel.clientUserID(options.clientUserID||null);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];if(options.returnNewAsSelected!==!0){this.viewModel.jobTitleID(jobTitleID);this.updateNavBarState();0===jobTitleID&&this.viewModel.jobTitles.sync()}else setTimeout(function(){delete options.returnNewAsSelected;options.address?this.viewModel.returnAddress(options.address):options.addressID&&this.viewModel.returnSelected(options.addressID,jobTitleID)}.bind(this),1)};var UserJobProfile=require("../viewmodels/UserJobProfile"),ServiceAddresses=require("../viewmodels/ServiceAddresses")},{"../components/Activity":223,"../viewmodels/ServiceAddresses":390,"../viewmodels/UserJobProfile":397,jquery:!1,knockout:!1}],162:[function(require,module,exports){"use strict";function ViewModel(app){ServiceProfessionalServiceViewModel.call(this,app);this.clientID=ko.observable(null);this.client=ko.observable(null);this.requestData=ko.observable(null);this.serviceEditorCancelLink=ko.observable(null);this.helpLink="/help/relatedArticles/201967166-listing-and-pricing-your-services";this.isInOnboarding=app.model.onboarding.inProgress;this.isLocked=this.isLoading;this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/serviceProfessionalService");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());
this.loadServicesData();return!1}.bind(this);this.loadServicesData=function(){var clientID=this.clientID(),jobTitleID=this.jobTitleID(),model=app.model.serviceProfessionalServices,services=null;services=this.isSelectionMode()?model.getServicesBookableByProvider(clientID,jobTitleID):clientID?model.getClientSpecificServicesForJobTitle(clientID,jobTitleID):model.getList(jobTitleID);return this.loadData(null,jobTitleID,services)}.bind(this);this.clientName=ko.pureComputed(function(){return this.client()&&this.client().firstName()||""},this);this.serviceListGroupsFactory=function(services,pricingTypes){var factories=serviceListGroupFactories,listGroupsFactory=this.isSelectionMode()?factories.providerBookedServices:factories.providerManagedServices,isClientSpecific=!!this.clientID();services=this.isAdditionMode()?[]:services;return listGroupsFactory(services,pricingTypes,this.clientName(),isClientSpecific)};this.clientFullName=ko.pureComputed(function(){return this.client()&&this.client().fullName()||""},this);this.clientManagerLink=ko.pureComputed(function(){return this.client()||this.isSelectionMode()||app.model.onboarding.inProgress()?null:"#!/clients"},this);this.jobTitleName=ko.pureComputed(function(){return this.jobTitle()&&this.jobTitle().singularName()||""},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":"Save and continue"},this);this.onboardingNextReady=ko.computed(function(){var isin=app.model.onboarding.inProgress(),hasPricing=this.list().length>0;return isin&&hasPricing},this);this.editServiceRequest=function(){return $.extend({cancelLink:this.serviceEditorCancelLink()},this.requestData())}.bind(this);this.newServiceRequest=function(){return $.extend({cancelLink:this.serviceEditorCancelLink()},this.requestData())}.bind(this);var baseNewServiceURL=this.newServiceURL.bind(this);this.newServiceURL=function(jobTitleID,pricingTypeID,isClientSpecific){return isClientSpecific?"#!serviceProfessionalServiceEditor/"+jobTitleID+"/pricingType/"+pricingTypeID+"/client/"+this.clientID()+"/new":baseNewServiceURL(jobTitleID,pricingTypeID)}.bind(this);this.endSelection=function(data,event){if(app.model.onboarding.inProgress()){app.model.onboarding.selectedJobTitleID(this.jobTitleID());app.model.onboarding.goNext()}else this.returnSelected(this.selectedServices().map(function(pricing){return pricing.model.toPlainObject(!0)}),this.jobTitleID());event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.selectedServiceRequest=function(pricing){return pricing.model.toPlainObject(!0)}}var ko=require("knockout"),Activity=require("../components/Activity"),ServiceProfessionalServiceViewModel=require("../viewmodels/ServiceProfessionalService"),$=require("jquery"),RouteMatcher=require("../utils/Router").RouteMatcher,Route=require("../utils/Router").Route,serviceListGroupFactories=require("../viewmodels/ServiceListGroupFactories"),DEFAULT_BACK_LINK="/marketplaceJobtitles",A=Activity.extend(function ServiceProfessionalServiceActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:DEFAULT_BACK_LINK,helpLink:this.viewModel.helpLink});this.defaultLeftAction=this.navBar.leftAction().model.toPlainObject(!0);this.viewModel.navBar=this.navBar;this.registerHandler({target:this.viewModel.jobTitle,handler:function(){this.updateNavBarState();this.viewModel.serviceEditorCancelLink(this.serviceEditorCancelLink(this.viewModel.isAdditionMode()))}.bind(this)});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){var params=this.parseRoute(this.requestData.route.path),urlJobTitleID=0|params.jobTitleID,clientID=0|params.clientID;if(urlJobTitleID!==jobTitleID){var url=this.buildRoute(jobTitleID,clientID,params.isNew);this.app.shell.replaceState(this.requestData,null,url)}}}.bind(this)});this.registerHandler({target:this.viewModel.clientID,handler:function(clientID){var viewModel=this.viewModel,app=this.app;viewModel.client(null);clientID&&app.model.clients.getItem(clientID).then(function(client){viewModel.client(client)})["catch"](function(error){app.modals.showError({title:"Unable to load client.",error:error})})}.bind(this)});this.registerHandler({target:this.viewModel.client,handler:function(){this.updateNavBarState()}.bind(this)});this.viewModel.returnSelected=function(pricing,jobTitleID){this.requestData.selectedServices=pricing;this.requestData.selectedJobTitleID=jobTitleID;this.app.shell.goBack(this.requestData)}.bind(this);this.returnRequest=function returnRequest(){this.app.shell.goBack(this.requestData)}.bind(this)});exports.init=A.init;A.prototype.applyOwnNavbarRules=function(){this.navBar.title(this.requestData.title||"");if(this.requestData.cancelLink)this.convertToCancelAction(this.navBar.leftAction(),this.requestData.cancelLink,this.requestData);else{this.navBar.leftAction().model.updateWith(this.defaultLeftAction,!0);this.navBar.leftAction().model.updateWith(this.newLeftAction(),!0)}};A.prototype.newLeftAction=function(){var leftAction={},jid=this.viewModel.jobTitleID(),url=this.mustReturnTo||DEFAULT_BACK_LINK+(jid?"/"+jid:""),handler=this.viewModel.isSelectionMode()?this.returnRequest:null;leftAction.link=url;leftAction.text=this.leftActionText();leftAction.handler=handler;return leftAction};A.prototype.leftActionText=function(){var clientName=this.viewModel.client()&&this.viewModel.clientFullName(),jobTitle=this.viewModel.jobTitle()&&this.viewModel.jobTitle().singularName();return this.requestData.navTitle||clientName||jobTitle||"Back"};A.prototype.updateNavBarState=function updateNavBarState(){this.app.model.onboarding.updateNavBar(this.navBar)||this.applyOwnNavbarRules()};A.prototype.referrerURL=function(){return this.app.shell.referrerRoute&&this.app.shell.referrerRoute.url||"/"};A.prototype.serviceEditorCancelLink=function(isAdditionMode){return isAdditionMode?this.referrerURL():"/serviceProfessionalService"+this.requestData.route.path};A.prototype.buildRoute=function(jobTitleID,clientID,isAdditionMode){var base="/serviceProfessionalService",jobTitle="/"+jobTitleID,client=clientID>0?"/client/"+clientID:"",newParam=isAdditionMode?"/new":"";return base+jobTitle+client+newParam};A.prototype.parseRoute=function(url){var paramsDefaults={jobTitleID:0,isNew:!1,clientID:null},matcher=new RouteMatcher([new Route("/:jobTitleID/new",{isNew:!0}),new Route("/:jobTitleID/client/:clientID/new",{isNew:!0}),new Route("/:jobTitleID/client/:clientID"),new Route("/new",{isNew:!0}),new Route("/:jobTitleID")],paramsDefaults);return matcher.match(url)||paramsDefaults};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.mustReturnTo=this.requestData.route.query.mustReturn||this.mustReturnTo;this.viewModel.reset();this.viewModel.requestData(this.requestData);this.viewModel.preSelectedServices(this.requestData.selectedServices||[]);this.viewModel.isSelectionMode(this.requestData.selectPricing===!0);var params=this.parseRoute(options.route.path),jobTitleID=0|params.jobTitleID;0===jobTitleID&&options.selectedJobTitleID>0&&(jobTitleID=0|options.selectedJobTitleID);this.viewModel.clientID(0|params.clientID);var isAdditionMode=params.isNew;this.viewModel.serviceEditorCancelLink(this.serviceEditorCancelLink(isAdditionMode));isAdditionMode&&(this.requestData.cancelLink=this.referrerURL());this.viewModel.isAdditionMode(isAdditionMode);this.updateNavBarState();this.viewModel.jobTitleID(jobTitleID);if(0===jobTitleID){this.viewModel.clearData();this.viewModel.jobTitles.sync()}else this.viewModel.loadServicesData()};var UserJobProfile=require("../viewmodels/UserJobProfile");ViewModel._inherits(ServiceProfessionalServiceViewModel)},{"../components/Activity":223,"../utils/Router":326,"../viewmodels/ServiceListGroupFactories":393,"../viewmodels/ServiceProfessionalService":394,"../viewmodels/UserJobProfile":397,jquery:!1,knockout:!1}],163:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967166-listing-and-pricing-your-services";this.isInOnboarding=app.model.onboarding.inProgress;this.isLoading=ko.observable(!1);this.isSaving=app.model.serviceProfessionalServices.state.isSaving;this.isSyncing=app.model.serviceProfessionalServices.state.isSyncing;this.isDeleting=app.model.serviceProfessionalServices.state.isDeleting;this.jobTitleID=ko.observable(0);this.serviceProfessionalServiceID=ko.observable(0);this.moneySymbol=ko.observable("$");this.pricingType=ko.observable(new PricingType);this.serviceProfessionalServiceVersion=ko.observable(null);this.serviceProfessionalService=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v?v.version:null},this);this.client=ko.observable(null);this.header=ko.pureComputed(function(){var pricingName=this.pricingType()&&this.pricingType().singularName()||"Service",prefix=this.isNew()?"New ":"",postfix=this.client()?" only for "+this.client().fullName():"";return this.isLoading()?"Loading...":this.serviceProfessionalServiceVersion()?prefix+pricingName+postfix:"Unable to load service"},this);this.current=ko.pureComputed(function(){var t=this.pricingType(),p=this.serviceProfessionalService();return t&&p?{type:t,pricing:p}:null},this);this.showFirstTimeClientsOnlyLabel=ko.pureComputed(function(){var pricingLabel=this.pricingType()&&this.pricingType().firstTimeClientsOnlyLabel();return pricingLabel&&!this.client()},this);this.wasRemoved=ko.observable(!1);this.isLocked=ko.computed(function(){return this.isDeleting()||app.model.serviceProfessionalServices.state.isLocked()},this);this.isNew=ko.pureComputed(function(){var p=this.serviceProfessionalService();return p&&!p.updatedDate()},this);this.submitText=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);this.unsavedChanges=ko.pureComputed(function(){var v=this.serviceProfessionalServiceVersion();return v&&v.areDifferent()},this);this.deleteText=ko.pureComputed(function(){return this.isDeleting()?"Deleting...":"Delete"},this);this.save=function(){app.model.serviceProfessionalServices.setItem(this.serviceProfessionalService().model.toPlainObject()).then(function(serverData){this.serviceProfessionalService().model.updateWith(serverData);this.serviceProfessionalServiceVersion().push({evenIfObsolete:!0});this.onSave(serverData)}.bind(this))["catch"](function(err){app.modals.showError({title:"Unable to save the service.",error:err})})}.bind(this);this.confirmRemoval=function(){var p=this.pricingType();app.modals.confirm({title:"Delete "+(p&&p.singularName()),message:"Are you sure? The operation cannot be undone.",yes:"Delete",no:"Keep"}).then(function(){this.remove()}.bind(this))}.bind(this);this.remove=function(){app.model.serviceProfessionalServices.delItem(this.jobTitleID(),this.serviceProfessionalServiceID()).then(function(){this.wasRemoved(!0);app.shell.goBack()}.bind(this))["catch"](function(err){app.modals.showError({title:"Unable to delete the service.",error:err})})}.bind(this)}var ko=require("knockout"),Activity=require("../components/Activity"),PricingType=require("../models/PricingType"),RouteMatcher=require("../utils/Router").RouteMatcher,Route=require("../utils/Router").Route,A=Activity.extend(function ServiceProfessionalServiceEditorActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Services",{helpLink:this.viewModel.helpLink});this.viewModel.onSave=function(pricing){if(this.requestData.selectedServices){this.requestData.selectedServices.push({serviceProfessionalServiceID:pricing.serviceProfessionalServiceID,totalPrice:pricing.totalPrice});this.app.shell.goBack(this.requestData)}else this.app.model.onboarding.inProgress()?this.app.shell.goBack():this.app.successSave()}.bind(this)});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var link=this.requestData.cancelLink||"/serviceProfessionalService/"+this.viewModel.jobTitleID();this.convertToCancelAction(this.navBar.leftAction(),link)};A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.viewModel.wasRemoved(!1);this.viewModel.serviceProfessionalServiceVersion(null);this.viewModel.pricingType(null);var paramsDefaults={jobTitleID:0,serviceID:0,pricingTypeID:0,clientID:0},matcher=new RouteMatcher([new Route("/:jobTitleID/pricingType/:pricingTypeID/client/:clientID/new"),new Route("/:jobTitleID/pricingType/:pricingTypeID/new"),new Route("/:jobTitleID/:serviceID")],paramsDefaults),params=matcher.match(options.route.path)||{},jobTitleID=0|params.jobTitleID,pricingTypeID=0|params.pricingTypeID,serviceProfessionalServiceID=0|params.serviceID,clientID=0|params.clientID;this.viewModel.jobTitleID(jobTitleID);this.viewModel.serviceProfessionalServiceID(serviceProfessionalServiceID);this.updateNavBarState();var pricingSetup=function pricingSetup(){var c=this.viewModel.current();if(c){c.pricing.name(c.type.fixedName()||c.pricing.name()||c.type.suggestedName());c.pricing.refreshNoPriceRate()}}.bind(this),showLoadingError=function(error){this.viewModel.isLoading(!1);this.app.modals.showError({title:"Unable to load service",error:error}).then(function(){this.app.shell.goBack()}.bind(this))}.bind(this);this.viewModel.isLoading(!0);var loadClient=function(service){var clientID=service.clientID();if(clientID)return this.app.model.clients.getItem(clientID).then(function(client){this.viewModel.client(client)}.bind(this));this.viewModel.client(null);return Promise.resolve(service)}.bind(this);pricingTypeID?this.app.model.pricingTypes.getItem(pricingTypeID).then(function(type){this.viewModel.pricingType(type);var serviceVersion=this.app.model.serviceProfessionalServices.newItemVersion({jobTitleID:jobTitleID,pricingTypeID:pricingTypeID,visibleToClientID:clientID});this.viewModel.serviceProfessionalServiceVersion(serviceVersion);pricingSetup();return serviceVersion.version}.bind(this)).then(loadClient)["catch"](showLoadingError).then(function(){this.viewModel.isLoading(!1)}.bind(this)):serviceProfessionalServiceID?this.app.model.serviceProfessionalServices.getItemVersion(jobTitleID,serviceProfessionalServiceID).then(function(serviceProfessionalServiceVersion){if(!serviceProfessionalServiceVersion)throw new Error("Unable to load service");return this.app.model.pricingTypes.getItem(serviceProfessionalServiceVersion.version.pricingTypeID()).then(function(type){this.viewModel.pricingType(type);this.viewModel.serviceProfessionalServiceVersion(serviceProfessionalServiceVersion);pricingSetup();return serviceProfessionalServiceVersion.version}.bind(this))}.bind(this)).then(loadClient)["catch"](showLoadingError).then(function(){this.viewModel.isLoading(!1)}.bind(this)):showLoadingError("Unable to load service — missing parameters")}},{"../components/Activity":223,"../models/PricingType":272,"../utils/Router":326,knockout:!1}],164:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967766-describing-your-services-to-clients";this.jobTitleID=ko.observable(0);this.isLoadingUserJobTitle=ko.observable(!1);this.userJobTitle=ko.observable(null);this.jobTitleName=ko.observable("Job Title");this.jobTitles=new UserJobProfile(app);this.jobTitles.baseUrl("/servicesOverview");this.jobTitles.selectJobTitle=function(jobTitle){this.jobTitleID(jobTitle.jobTitleID());return!1}.bind(this);this.intro=ko.observable(null);this.serviceAttributesControl=app.model.serviceAttributes.newItemVersion();this.serviceAttributes=this.serviceAttributesControl.version;this.jobTitleServiceAttributesControl=app.model.jobTitleServiceAttributes.newItemVersion();this.jobTitleServiceAttributes=this.jobTitleServiceAttributesControl.original;this.isLoading=ko.pureComputed(function(){return this.isLoadingUserJobTitle()||this.serviceAttributesControl.state.isLoading()||this.jobTitleServiceAttributesControl.state.isLoading()},this);this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.categoriesView=ko.pureComputed(function(){var userAtts=this.serviceAttributes;return this.jobTitleServiceAttributes.serviceAttributes().map(function(cat){return new AttributesCategoryVM(cat,userAtts)})},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);this.save=function(){var ujt=this.userJobTitle();if(ujt){this.isSaving(!0);var plain=ujt.model.toPlainObject();plain.intro=this.intro();Promise.all([this.serviceAttributesControl.save(),app.model.userJobProfile.setUserJobTitle(plain)]).then(function(){this.isSaving(!1);var props=this.serviceAttributes.proposedServiceAttributes(),propCats=props&&Object.keys(props);if(propCats&&propCats.length){var thereAreNews=propCats.reduce(function(sum,k){var cat=props[k];return sum+(cat&&cat.length||0)},0)>0;thereAreNews&&this.jobTitleServiceAttributesControl.load(void 0,!0)}this.serviceAttributes.proposedServiceAttributes({});app.successSave()}.bind(this))["catch"](function(err){this.isSaving(!1);app.modals.showError({title:"Error saving your Services Overview",error:err})}.bind(this))}}.bind(this)}function AttributesCategoryVM(cat,userAtts){var catID=cat.serviceAttributeCategoryID(),selectedAttsIds=userAtts.serviceAttributes.getServiceCategoryAttributes(catID);this.category=ko.observable(cat);this.proposedServiceAttributes=ko.pureComputed(function(){var props=userAtts.proposedServiceAttributes();return props&&props[catID]&&props[catID].length?props[catID].map(function(name){return new ServiceAttribute({name:name})}):[]},this);this.selectedAttributes=ko.pureComputed(function(){var atts=cat.serviceAttributes().filter(function(att){return selectedAttsIds().indexOf(att.serviceAttributeID())>-1});return atts.concat.apply(atts,this.proposedServiceAttributes())},this);this.availableAttributes=ko.computed(function(){var props=this.proposedServiceAttributes(),atts=selectedAttsIds();return cat.serviceAttributes().filter(function(att){var toInclude=-1===atts.indexOf(att.serviceAttributeID());return toInclude===!1?!1:props.every(function(propAtt){return att.name()!==propAtt.name()})})},this);this.attributeSearch=ko.observable("");var foundAttItem=function(att,item){return item.name()===att.name};this.addAttribute=function(){var newOne=this.attributeSearch()||"",isEmpty=/^\s*$/.test(newOne),wasFound=this.selectedAttributes().some(foundAttItem.bind(null,{name:newOne}));isEmpty||wasFound||userAtts.proposedServiceAttributes.push(catID,newOne);this.attributeSearch("");this.autocompleteOpenedByUser(!1)};this.selectAttribute=function(att){att.serviceAttributeID()?userAtts.serviceAttributes.push(catID,att.serviceAttributeID()):this.addAttribute()}.bind(this);this.removeAttribute=function(att){var id=att.serviceAttributeID();id?userAtts.serviceAttributes.remove(catID,id):userAtts.proposedServiceAttributes.remove(catID,att.name())}.bind(this);var textSearch=require("../utils/textSearch");this.autocompleteAttributes=ko.computed(function(){var s=this.attributeSearch(),a=this.availableAttributes();if(!s)return a;var result=a.filter(function(att){return textSearch(s,att.name())});result.unshift(new ServiceAttribute({serviceAttributeID:0,name:"Add new: "+s}));return result},this);this.clearAttributeSearch=function(){this.attributeSearch("");this.autocompleteOpenedByUser(!1)}.bind(this);this.autocompleteOpenedByUser=ko.observable();this.showFullAutocomplete=function(){this.autocompleteOpenedByUser(!0)}.bind(this);this.hideFullAutocomplete=function(){this.autocompleteOpenedByUser(!1)}.bind(this)}var Activity=require("../components/Activity"),ko=require("knockout"),DEFAULT_BACK_LINK="/marketplaceJobtitles",DEFAULT_BACK_TEXT="Back",A=Activity.extend(function ServicesOverviewActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.accessLevel=this.app.UserType.loggedUser;this.navBar=Activity.createSubsectionNavBar(DEFAULT_BACK_TEXT,{backLink:DEFAULT_BACK_LINK,helpLink:this.viewModel.helpLink});this.registerHandler({target:this.viewModel.jobTitleID,handler:function(jobTitleID){if(jobTitleID){this.app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.viewModel.jobTitleName(jobTitle.singularName());this.updateNavBarState()}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading the job title.",error:err})}.bind(this));this.viewModel.isLoadingUserJobTitle(!0);Promise.all([this.app.model.userJobProfile.getUserJobTitle(jobTitleID),this.viewModel.serviceAttributesControl.load(jobTitleID),this.viewModel.jobTitleServiceAttributesControl.load(jobTitleID)]).then(function(datas){var userJobTitle=datas&&datas[0];this.viewModel.userJobTitle(userJobTitle);this.viewModel.intro(userJobTitle.intro());this.viewModel.isLoadingUserJobTitle(!1)}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err});this.viewModel.isLoadingUserJobTitle(!1)}.bind(this));var found=/servicesOverview\/(\d+)/i.exec(window.location),urlID=found&&0|found[1];if(urlID!==jobTitleID){var url="/servicesOverview/"+jobTitleID;this.app.shell.replaceState(null,null,url)}}else{this.viewModel.jobTitleName("Job Title");this.viewModel.serviceAttributesControl.reset();this.viewModel.jobTitleServiceAttributesControl.reset();this.updateNavBarState()}}.bind(this)})});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){var done=this.app.applyNavbarMustReturn(this.requestData);if(!done){var text=this.viewModel.jobTitleName()||DEFAULT_BACK_TEXT,id=this.viewModel.jobTitleID(),link=id?DEFAULT_BACK_LINK+"/"+id:DEFAULT_BACK_LINK;this.navBar.leftAction().model.updateWith({text:text,link:link})}};A.prototype.show=function show(state){this.viewModel.jobTitleID(null);this.viewModel.intro(null);this.viewModel.serviceAttributes.proposedServiceAttributes({});Activity.prototype.show.call(this,state);var params=state&&state.route&&state.route.segments,jid=0|params[0];this.viewModel.jobTitleID(jid);jid||this.viewModel.jobTitles.sync()};var UserJobProfile=require("../viewmodels/UserJobProfile"),ServiceAttribute=require("../models/ServiceAttribute")},{"../components/Activity":223,"../models/ServiceAttribute":287,"../utils/textSearch":365,"../viewmodels/UserJobProfile":397,knockout:!1}],165:[function(require,module,exports){"use strict";function ViewModel(app){this.signup=ko.observable();this.reset=function(){var signup=this.signup();signup instanceof SignupVM&&signup.reset()};this.signup.subscribe(this.reset.bind(this));this.redirect=function(){app.goDashboard()};this.setupWith=function(options){var signup=this.signup();if(signup instanceof SignupVM){signup.email(options.email||void 0);signup.emailIsLocked(!!options.email);signup.confirmationCode(options.confirmationCode||void 0);signup.profile(options.profile||void 0)}};this.inApp=ko.observable(!!window.cordova)}var Activity=require("../components/Activity"),SignupVM=require("../viewmodels/Signup"),A=Activity.extend(function SignupActivity(){Activity.apply(this,arguments);this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);this.viewModel.focusWrongField=function(){var $el=this.$activity.find(".form-group.has-error:first").find("input");setTimeout(function(){$el.focus()},100)}.bind(this)});exports.init=A.init;A.prototype.show=function show(options){this.viewModel.reset();Activity.prototype.show.call(this,options);var p=options&&options.route&&options.route.segments&&options.route.segments[0]||"",q=options&&options.route&&options.route.query||{};this.viewModel.setupWith({profile:p,email:q.email,confirmationCode:q.confirmationCode})};var ko=require("knockout")},{"../components/Activity":223,"../viewmodels/Signup":395,knockout:!1}],166:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),$=require("jquery"),A=Activity.extend(function TermsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.navBar=Activity.createSectionNavBar(null);this.navBar.rightAction(null);var shell=this.app.shell;this.$activity.find("#terms-index a").click(function(e){e.preventDefault();e.stopImmediatePropagation();$(this).tab("show");var link=$(this).attr("href").replace(/^#terms-/,"");shell.replaceState(null,null,"#!terms/"+link)})});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var tabName=state&&state.route.segments&&state.route.segments[0]||"terms-of-service",tab=this.$activity.find('[href="#terms-'+tabName+'"]');tab.length&&tab.tab("show")}},{"../components/Activity":223,jquery:!1}],167:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function UpgradeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.navBar=new Activity.NavBar({title:null,leftAction:Activity.NavAction.menuIn,rightAction:Activity.NavAction.menuNewItem})});exports.init=A.init},{"../components/Activity":223}],168:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201964153-how-owner-user-fees-work";this.isLoading=app.model.userFeePayments.state.isLoading;this.isSyncing=app.model.userFeePayments.state.isSyncing;this.payments=ko.observableArray([])}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function UserFeePaymentsActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink})});module.exports=A;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.userFeePayments.getList().then(function(threads){this.viewModel.payments(threads())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading payments",error:err})}.bind(this))}},{"../components/Activity":223,knockout:!1}],169:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201964153-how-owner-user-fees-work";this.plans=app.model.paymentPlans.list;this.activeUserPaymentPlan=app.model.userPaymentPlan.data;this.selectedPaymentPlanID=ko.observable("");this.paymentMethod=new InputPaymentMethod;this.paymentMethod.billingAddress(new Address);this.reset=function(){this.selectedPaymentPlanID("");this.paymentMethod.model.reset()}.bind(this);this.isLoading=ko.pureComputed(function(){return app.model.paymentPlans.state.isLoading()||app.model.userPaymentPlan.isLoading()});this.isSaving=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.isNew=this.activeUserPaymentPlan.isNew;this.activePaymentPlan=ko.pureComputed(function(){var id=this.activeUserPaymentPlan.paymentPlan();return id?app.model.paymentPlans.getObservableItem(id)():null},this);this.submitText=ko.pureComputed(function(){return this.isLoading()?"loading...":this.isSaving()?"saving...":"Save"},this);var createSubscription=function(){var plain={paymentPlan:this.selectedPaymentPlanID(),paymentMethod:this.paymentMethod.model.toPlainObject(!0)};app.model.userPaymentPlan.createSubscription(plain).then(function(){this.isSaving(!1);app.modals.showNotification({title:"Payment plan saved",message:"Thank you"}).then(function(){app.successSave()})}.bind(this))["catch"](function(err){this.isSaving(!1);app.modals.showError({title:"Error creating your subscription",error:err})}.bind(this))}.bind(this);this.save=function(){this.isSaving(!0);if(!this.isNew())throw{name:"NotImplemented",description:"Change active plan"};createSubscription()}.bind(this);this.changePlan=function(){app.modals.showNotification({title:"Not Implemented",message:"Not Implemented"})}}var Activity=require("../components/Activity"),ko=require("knockout"),InputPaymentMethod=require("../models/InputPaymentMethod"),Address=require("../models/Address"),A=Activity.extend(function UserFeesActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Account",{backLink:"/account",helpLink:this.viewModel.helpLink})});module.exports=A;A.prototype.show=function show(state){this.viewModel.reset();Activity.prototype.show.call(this,state);this.app.model.paymentPlans.sync();this.app.model.userPaymentPlan.sync()}},{"../components/Activity":223,"../models/Address":231,"../models/InputPaymentMethod":248,knockout:!1}],170:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function UserProfileActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=this.app.model.userProfile.data;this.navBar=Activity.createSectionNavBar("Profile")});exports.init=A.init},{"../components/Activity":223}],171:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201967776-adding-verifications-to-your-profile";this.isSyncing=app.model.userVerifications.state.isSyncing;this.isLoading=app.model.userVerifications.state.isLoading;this.isSaving=app.model.userVerifications.state.isSaving;this.userVerifications=ko.observableArray();this.emailInfo=ko.observable('Please click on "Verify my account" in the e-mail we sent you to verify your address. <a class="btn btn-link btn-block"  href="#resendEmailConfirmation">Click here to resend.</a>');this.facebookInfo=ko.pureComputed(function(){var tpl='Letting potential __kind__ know you have a trusted online presence helps them know you\'re real. <a class="btn btn-link btn-block" href="#connectWithFacebook">Click here to connect your account.</a>';return tpl.replace(/__kind__/,app.model.user().isServiceProfessional()?"clients":"service professionals")})}var ko=require("knockout"),Activity=require("../components/Activity"),A=Activity.extend(function VerificationsActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Marketplace profile",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.viewModel.navBar=this.navBar;this.registerHandler({target:this.$activity,event:"click",selector:'[href="#resendEmailConfirmation"]',handler:function(){this.app.modals.showNotification({message:"TO-DO: resend email confirmation"})}.bind(this)});this.registerHandler({target:this.$activity,event:"click",selector:'[href="#connectWithFacebook"]',handler:function(){this.app.modals.showNotification({message:"TO-DO: ask for connect with Facebook API"})}.bind(this)})});exports.init=A.init;A.prototype.show=function show(options){Activity.prototype.show.call(this,options);this.app.model.userVerifications.getList().then(function(list){this.viewModel.userVerifications(list())}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Error loading your verifications",error:err})}.bind(this))}},{"../components/Activity":223,knockout:!1}],172:[function(require,module,exports){"use strict";var Activity=require("../components/Activity"),A=Activity.extend(function ViewBookingActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser});exports.init=A.init;A.prototype.show=function show(state){Activity.prototype.show.call(this,state);var bookingID=state&&state.route.segments&&state.route.segments[0],currentUserID=this.app.model.userProfile.data.userID();this.app.model.bookings.getBooking(bookingID).then(function(booking){booking.serviceProfessionalUserID()===currentUserID?this.app.shell.go("/appointment/"+booking.serviceDateID(),null,!0):this.app.shell.go("/clientAppointment/"+bookingID,null,!0);
}.bind(this))["catch"](function(err){this.app.modals.showError({title:"Booking",error:err}).then(function(){this.app.goDashboard()}.bind(this))}.bind(this))}},{"../components/Activity":223}],173:[function(require,module,exports){"use strict";function ViewModel(app){this.isInOnboarding=app.model.onboarding.inProgress;this.user=app.model.userProfile.data;this.helpLinkProfessionals="/help/relatedArticles/201211855-getting-started";this.helpLinkClients="/help/relatedArticles/201313875-getting-started";this.helpLink=ko.pureComputed(function(){return this.user.isServiceProfessional()?this.helpLinkProfessionals:this.helpLinkClients},this);this.startOnboarding=function startOnboarding(){app.model.onboarding.goNext()};this.clientOnboarding=function clientOnboarding(){app.model.onboarding.stepNumber(-1);app.model.userProfile.saveOnboardingStep(null)};this.userProfile=app.model.userProfile.data;this.isServiceProfessional=app.model.userProfile.data.isServiceProfessional}var Activity=require("../components/Activity"),ko=require("knockout"),A=Activity.extend(function WelcomeActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.loggedUser;this.viewModel=new ViewModel(this.app);var serviceProfessionalNavBar=Activity.createSubsectionNavBar(this.app.model.onboarding.navbarTitle(),{leftAction:Activity.NavAction.goLogout,helpLink:this.viewModel.helpLinkProfessionals});this.serviceProfessionalNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);var clientNavBar=Activity.createSubsectionNavBar(this.app.model.onboarding.navbarTitle(),{leftAction:Activity.NavAction.goLogout,helpLink:this.viewModel.helpLinkClients});this.clientNavBar=serviceProfessionalNavBar.model.toPlainObject(!0);this.navBar=this.viewModel.user.isServiceProfessional()?serviceProfessionalNavBar:clientNavBar});exports.init=A.init;A.prototype.updateNavBarState=function updateNavBarState(){if(!this.app.model.onboarding.updateNavBar(this.navBar)){var nav=this.viewModel.user.isServiceProfessional()?this.serviceProfessionalNavBar:this.clientNavBar;this.navBar.model.updateWith(nav,!0)}};A.prototype.show=function show(state){Activity.prototype.show.call(this,state);this.updateNavBarState()}},{"../components/Activity":223,knockout:!1}],174:[function(require,module,exports){"use strict";function ViewModel(app){this.helpLink="/help/relatedArticles/201964193-showcase-your-work-with-photos";this.jobTitleID=ko.observable(0);this.list=ko.observableArray([]);this.removedItems=ko.observableArray([]);this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());this.state=app.model.workPhotos.state;this.saveBtnText=ko.pureComputed(function(){return this.state.isSaving()?"Saving..":this.state.isLoading()?"Loading..":this.state.isDeleting()?"Deleting..":"Save"},this);var cameraSettings={targetWidth:1326,targetHeight:996,correctOrientation:!0},addNew=function(fromCamera){this.openPhotoPicker(fromCamera).then(function(data){var newItem=new WorkPhoto({workPhotoID:0,jobTitleID:this.jobTitleID(),url:data.previewUrl,localTempFilePath:data.localUrl,caption:""});this.list.push(newItem)}.bind(this))["catch"](function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&app.modals.showError({error:err,title:"Error getting photo."})})}.bind(this);this.takePhotoForNew=function(){addNew(!0)}.bind(this);this.pickPhotoForNew=function(){addNew(!1)}.bind(this);this.removeImg=function(item){this.removedItems.push(item);this.list.remove(item)}.bind(this);this.rotateImg=function(item){var d=0|item.rotationAngle();item.rotationAngle((d+90)%360)}.bind(this);this.openPhotoPicker=function(fromCamera){var settings=$.extend({},cameraSettings,{sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY});return photoTools.takePhotoSupported()?photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){return{localUrl:imgLocalUrl,previewUrl:photoTools.getPreviewPhotoUrl(imgLocalUrl)}}):Promise.reject("Take photo is not supported on the web right now")};this.updateSort=function(info){for(var list=info.sourceParent(),i=0,l=list.length;l>i;i++)list[i].rankPosition(i+1)};var remoteDeleteFlaggedItems=function(){return this.removedItems().reduce(function(cur,next){return cur.then(function(){return app.model.workPhotos.delItem(next.jobTitleID(),next.workPhotoID())})},Promise.resolve())}.bind(this),uploadAllItems=function(){return this.list().reduce(function(cur,next){return cur.then(function(){return app.model.workPhotos.setItem(next.model.toPlainObject(!0))})},Promise.resolve())}.bind(this);this.save=function(){remoteDeleteFlaggedItems().then(uploadAllItems).then(function(){app.successSave();this.removedItems.removeAll()}.bind(this))["catch"](function(err){app.modals.showError({title:"Error saving your photos",error:err})})}.bind(this)}var ko=require("knockout"),$=require("jquery"),Activity=require("../components/Activity"),WorkPhoto=require("../models/WorkPhoto"),photoTools=require("../utils/photoTools");require("jquery.fileupload-image");var A=Activity.extend(function WorkPhotosActivity(){Activity.apply(this,arguments);this.accessLevel=this.app.UserType.serviceProfessional;this.viewModel=new ViewModel(this.app);this.navBar=Activity.createSubsectionNavBar("Job Title",{backLink:"/marketplaceProfile",helpLink:this.viewModel.helpLink});this.registerHandler({target:this.$activity,selector:".WorkPhotos-imgBtn",event:"click mouseenter mouseleave",handler:function(event){this.viewModel.state.isLocked()||$(event.target).closest("li").toggleClass("is-selected","mouseenter"===event.type||"click"===event.type)}.bind(this)});if(!photoTools.takePhotoSupported()){var $input=this.$activity.find("#workPhotos-photoFile"),PHOTO_WIDTH=442,PHOTO_HEIGHT=332;$input.fileupload({dataType:"json",autoUpload:!1,acceptFileTypes:/(\.|\/)(jpe?g)$/i,maxFileSize:5e6,disableImageResize:!0,previewMaxWidth:PHOTO_WIDTH,previewMaxHeight:PHOTO_HEIGHT,previewCrop:!1}).on("fileuploadprocessalways",function(e,data){var file=data.files[data.index];if(file.error)console.error("Photo Preview",file.error);else if(file.preview){var newItem=new WorkPhoto({workPhotoID:0,jobTitleID:this.viewModel.jobTitleID(),url:null,localTempFileData:data,localTempPhotoPreview:file.preview,caption:""});this.viewModel.list.push(newItem)}}.bind(this))}});exports.init=A.init;A.prototype.show=function show(options){this.viewModel.list.removeAll();this.viewModel.removedItems.removeAll();this.viewModel.jobTitleID(0);Activity.prototype.show.call(this,options);var params=options&&options.route&&options.route.segments,jobTitleID=0|params[0];this.viewModel.jobTitleID(jobTitleID);jobTitleID?this.app.model.workPhotos.getList(jobTitleID).then(function(list){this.viewModel.list(this.app.model.workPhotos.asModel(list))}.bind(this))["catch"](function(err){this.app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this)):this.viewModel.list([])}},{"../components/Activity":223,"../models/WorkPhoto":309,"../utils/photoTools":350,jquery:!1,knockout:!1}],175:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),propTools=require("./utils/jsPropertiesTools"),getObservable=require("./utils/getObservable"),MessageBar=require("./components/MessageBar");exports.registerAll=function(app){ko.components.register("app-navbar-action",{template:{element:"navbar-action-template"},viewModel:function(params){propTools.defineGetter(this,"action",function(){return params.action&&params.navBar()?params.navBar()[params.action]():null})}});ko.components.register("app-unlabeled-input",{template:{element:"unlabeled-input-template"},viewModel:function(params){this.value=getObservable(params.value);this.placeholder=getObservable(params.placeholder);this.disable=getObservable(params.disable);this.showRemaining=getObservable(!1);var userAttr=getObservable(params.attr);this.attr=ko.pureComputed(function(){var attr=userAttr()||{};return $.extend({},attr,{"aria-label":this.placeholder(),placeholder:this.placeholder(),type:this.type()})},this);var type=getObservable(params.type);this.type=ko.computed(function(){return type()||"text"},this);this.charRemaining=ko.pureComputed(function(){return this.value()?userAttr().maxlength-this.value().length:userAttr().maxlength},this);this.showRemaining("undefined"!=typeof userAttr()&&"undefined"!=typeof userAttr().maxlength)}});ko.components.register("app-payment-plans",{template:{element:"payment-plans-template"},viewModel:function(){this.isServiceProfessional=app.model.userProfile.data.isServiceProfessional}});ko.components.register("app-inline-user-menu",{template:{element:"inline-user-menu-template"},viewModel:{instance:app.navBarBinding}});ko.components.register("app-onboarding-menu",{template:{element:"onboarding-menu-template"},viewModel:{instance:{}}});ko.components.register("app-inline-side-menu",{template:{element:"inline-side-menu-template"},viewModel:function(params){var vm=this;Object.keys(app.navBarBinding).forEach(function(prop){vm[prop]=app.navBarBinding[prop]});vm.vocElement=getObservable(params.vocElement||"general");vm.feedbackLink=ko.pureComputed(function(){return"feedbackForm/"+this.vocElement()},vm);vm.contactLink=ko.pureComputed(function(){return"contactForm/"+this.vocElement()},vm);vm.helpLink=getObservable(params.helpLink||"");vm.items=ko.observableArray();var category2Item=function(a){return{label:a&&a.name(),link:a&&a.urlPath()}},section2Item=category2Item,article2Item=function(a){return{label:a&&a.title(),link:a&&a.urlPath()}},idFromLink=function(link){var result=/\/(\d+)/i.exec(link);return result&&0|result[1]},types={categories:function(link){var id=idFromLink(link);return id?app.model.help.getSectionsByCategory(id).then(function(d){return d.map(section2Item)}):app.model.help.getCategories().then(function(d){return d.map(category2Item)})},sections:function(link){var id=idFromLink(link);return id?app.model.help.getArticlesBySection(id).then(function(d){return d.map(article2Item)}):app.model.help.getSections().then(function(d){return d.map(section2Item)})},articles:function(link){var id=idFromLink(link);return id?app.model.help.getArticle(id).then(article2Item):app.model.help.getArticles().then(function(d){return d.map(article2Item)})}};types.relatedArticles=types.sections;ko.computed(function(){var link=this.helpLink();if(link){var type;Object.keys(types).some(function(t){if(link.indexOf(t)>-1){type=t;return!0}});if(!type){console.warn("Help Link not recognized",link);vm.items([]);return}types[type](link).then(function(list){vm.items(list?Array.isArray(list)?list:[list]:[])})}else vm.items([])},vm)}});ko.components.register("app-feedback-entry",{template:{element:"feedback-entry-template"},viewModel:function(params){this.section=getObservable(params.section||"");this.url=ko.pureComputed(function(){return"/feedbackForm/"+this.section()},this)}});ko.components.register("app-time-slot-tile",{template:{element:"time-slot-tile-template"},viewModel:require("./viewmodels/TimeSlot")});ko.components.register("app-loading-spinner",{template:{element:"loading-spinner-template"},viewModel:function(params){var base="loadingSpinner";this.mod=getObservable(params.mod||"");this.cssClass=ko.pureComputed(function(){var c=base,mods=(this.mod()||"").split(" ");mods.length&&(c+=" "+base+"--"+mods.join(" "+base+"--"));return c},this)}});ko.components.register("app-appointment-card",{template:{element:"appointment-card-template"},viewModel:require("./viewmodels/AppointmentCard")});ko.components.register("app-job-titles-list",{template:{element:"job-titles-list-template"},viewModel:function(params){this.allJobTitles=getObservable(params.jobTitles||[]);this.jobTitles=ko.pureComputed(function(){return this().filter(function(j){return!j.isBeingDeleted()})},this.allJobTitles);this.selectJobTitle=params.selectJobTitle||function(){};this.showMarketplaceInfo=getObservable(params.showMarketplaceInfo||!1)}});ko.components.register("app-stars-rating",{template:{element:"stars-rating-template"},viewModel:function(params){function computeStarValue(rating,starPosition){var x=rating/starPosition|0,z=rating%1;return x>0?1:(0|rating)===starPosition-1&&0!==z&&z>=.5?.5:0}this.rating=getObservable(params.rating||0);this.total=getObservable(params.total||0);this.size=getObservable(params.size||"");this.stars=ko.pureComputed(function(){for(var r=this.rating(),list=[],i=1;5>=i;i++)list.push(computeStarValue(r,i));return list},this);this.totalText=ko.pureComputed(function(){return"("+this.total()+")"},this);this.classes=ko.pureComputed(function(){return this.size()?"StarsRating--"+this.size():""},this)}});var PublicUser=require("./models/PublicUser");ko.components.register("app-service-professional-info",{synchronous:!0,template:{element:"service-professional-info-template"},viewModel:{createViewModel:function(params){var view=new PublicUser;params&&params.api&&params.api(view);return view}}});var DateTimePickerVM=require("./viewmodels/DatetimePicker");ko.components.register("app-datetime-picker",{synchronous:!0,template:{element:"datetime-picker-template"},viewModel:{createViewModel:function(params,componentInfo){var view=new DateTimePickerVM(app,componentInfo.element);params&&params.api&&params.api(view);params&&Object.keys(params).forEach(function(key){if(ko.isObservable(view[key])){view[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&view[key].subscribe(params[key])}});return view}}});var googleMapReady=require("./utils/googleMapReady"),i18n=require("./utils/i18n");ko.components.register("app-address-map",{synchronous:!0,template:"<div></div>",viewModel:{createViewModel:function(params,componentInfo){var v={lat:ko.unwrap(params.lat),lng:ko.unwrap(params.lng),zoom:ko.unwrap(params.zoom)||11,radius:0|ko.unwrap(params.radius),isServiceLocation:ko.unwrap(params.isServiceLocation)||!1,radiusMeters:0,refreshTs:getObservable(params.refreshTs),map:null,circle:null};v.circleColor=v.isServiceLocation?"#5F2393":"#00989A";var c=i18n.getCurrentCulture(),unit=i18n.distanceUnits[c.country];if(v.isServiceLocation||!v.radius){v.radius=.5;unit="miles"}v.radiusMeters=1e3*i18n.convertMilesKm(v.radius,unit);googleMapReady(function(google){var mapLimits=[70,-168,14,-63];v.lat>mapLimits[0]?v.lat=mapLimits[0]:v.lat<mapLimits[2]&&(v.lat=mapLimits[0]);v.lng<mapLimits[1]?v.lng=mapLimits[1]:v.lng>mapLimits[3]&&(v.lng=mapLimits[3]);var myLatlng=new google.maps.LatLng(v.lat,v.lng),mapOptions={zoom:v.zoom,center:myLatlng,mapTypeId:google.maps.MapTypeId.ROADMAP};v.map=new google.maps.Map(componentInfo.element.children[0],mapOptions);v.circle=new google.maps.Circle({center:myLatlng,map:v.map,clickable:!1,radius:v.radiusMeters,fillColor:v.circleColor,fillOpacity:.3,strokeWeight:0});var refresh=googleMapReady.refreshMap.bind(null,v.map);v.refreshTs.subscribe(refresh)});return v}}});var OnboardingProgressMarkVM=require("./viewmodels/OnboardingProgressMarkVM");ko.components.register("app-onboarding-progress-mark",{template:{element:"onboarding-progress-mark-template"},viewModel:{createViewModel:function(){return new OnboardingProgressMarkVM(app)}}});var OnboardingProgressBarVM=require("./viewmodels/OnboardingProgressBarVM");ko.components.register("app-onboarding-progress-bar",{template:{element:"onboarding-progress-bar-template"},viewModel:{createViewModel:function(){return new OnboardingProgressBarVM(app)}}});var SearchJobTitlesVM=require("./viewmodels/SearchJobTitlesVM");ko.components.register("app-search-job-titles",{template:{element:"search-job-titles-template"},viewModel:{createViewModel:function(params){var view=new SearchJobTitlesVM(app);params&&params.api&&params.api(view);params&&Object.keys(params).forEach(function(key){if(ko.isObservable(view[key])){view[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&view[key].subscribe(params[key])}});return view}}});ko.components.register("app-select-job-title",{template:{element:"select-job-title-template"},synchronous:!0,viewModel:{createViewModel:function(params,componentInfo){var vm={selected:ko.observable(null),list:ko.observableArray([]),caption:getObservable(params.caption)};if(params&&ko.isWritableObservable(params.selected)){vm.selected.subscribe(params.selected);params.selected.subscribe(vm.selected)}if(params&&params.jobTitles){var l=Object.keys(params.jobTitles).map(function(key){return{id:params.jobTitles[key],name:key}});vm.list(l)}else componentInfo.templateNodes.forEach(function(node){if(node.tagName&&"item"===node.tagName.toLowerCase()){var id=0|node.getAttribute("id"),name=node.textContent;vm.list.push({id:id,name:name})}});return vm}}});var SignupVM=require("./viewmodels/Signup");ko.components.register("app-signup",{template:{element:"signup-template"},synchronous:!0,viewModel:{createViewModel:function(params,componentInfo){var vm=new SignupVM(app);ko.isWritableObservable(params.api)&&params.api(vm);Object.keys(params).forEach(function(key){if(ko.isWritableObservable(vm[key])){vm[key](ko.unwrap(params[key]));ko.isObservable(params[key])&&vm[key].subscribe(params[key])}});"function"==typeof params.onSignedUp&&vm.on("signedup",function(signedupData){params.onSignedUp.call(vm,signedupData)});"function"==typeof params.onSignUpError&&vm.on("signuperror",function(error){params.onSignUpError.call(vm,error)});vm.isThenLabelDisplayed=ko.observable(!1);componentInfo.templateNodes.length&&vm.isThenLabelDisplayed(!0);return vm}}});ko.components.register("app-message-bar",{template:MessageBar.template,viewModel:{createViewModel:function(params,componentInfo){return new MessageBar(params,componentInfo.element,componentInfo.templateNodes)}}})}},{"./components/MessageBar":225,"./models/PublicUser":275,"./utils/getObservable":341,"./utils/googleMapReady":343,"./utils/i18n":345,"./utils/jsPropertiesTools":347,"./viewmodels/AppointmentCard":370,"./viewmodels/DatetimePicker":376,"./viewmodels/OnboardingProgressBarVM":386,"./viewmodels/OnboardingProgressMarkVM":387,"./viewmodels/SearchJobTitlesVM":389,"./viewmodels/Signup":395,"./viewmodels/TimeSlot":396,jquery:!1,knockout:!1}],176:[function(require,module,exports){"use strict";var ko=require("knockout"),$=require("jquery"),NavBar=require("./viewmodels/NavBar"),NavAction=require("./viewmodels/NavAction");exports.extend=function(app){function adjustUserBar(){var user=app.model.user();if(user.isAnonymous()){var prev=app.navBar().leftAction();if(prev!==NavAction.menuIn){app.navBar().leftAction(NavAction.menuIn);app.navBar().prevLeftAction=prev}var prevRight=app.navBar().rightAction();if(prevRight===NavAction.menuNewItem){app.navBar().rightAction(null);app.navBar().prevRightAction=prevRight}}else{if(app.navBar().prevLeftAction){app.navBar().leftAction(app.navBar().prevLeftAction);app.navBar().prevLeftAction=null}if(user.isServiceProfessional()){if(app.navBar().preRightAction){app.navBar().rightAction(app.navBar().preRightAction);app.navBar().preRightAction=null}}else if(app.navBar().rightAction()===NavAction.menuNewItem){app.navBar().preRightAction=app.navBar().rightAction();app.navBar().rightAction(NavAction.goMarketplace)}}}app.navBar=ko.observable(null);var refreshNav=function refreshNav(){$(".AppNav").trigger("contentChange")},autoRefreshNav=function autoRefreshNav(action){if(action){action.text.subscribe(refreshNav);action.isTitle.subscribe(refreshNav);action.icon.subscribe(refreshNav);action.isMenu.subscribe(refreshNav)}};app.updateAppNav=function updateAppNav(activity,state){"navBar"in activity?null===activity.navBar?app.navBar(new NavBar({hidden:!0})):app.navBar(activity.navBar):app.navBar(new NavBar);app.applyNavbarMustReturn(state)||adjustUserBar();refreshNav();autoRefreshNav(app.navBar().leftAction());autoRefreshNav(app.navBar().rightAction())};app.getReturnRequestInfo=function(state){var q=state&&state.route&&state.route.query;if(q.mustReturn){var data={link:null,label:null,isGoBack:!1},returnLink=decodeURIComponent(q.mustReturn);"1"===returnLink||"true"===returnLink?data.isGoBack=!0:data.link=returnLink;data.label=decodeURIComponent(q.returnText||"");return data}return null},app.applyNavbarMustReturn=function(state){var info=app.getReturnRequestInfo(state);if(info){info.isGoBack?app.navBar().leftAction(NavAction.goBack.model.clone({text:info.label,isShell:!0,isTitle:!0})):app.navBar().leftAction(NavAction.goBack.model.clone({link:info.link,text:info.label,isShell:!1,isTitle:!0}));return!0}return!1};app.updateMenu=function updateMenu(){var $menu=$(".App-menus .navbar-collapse");$menu.filter(":visible").collapse("hide")};app.navBarBinding={navBar:app.navBar,photoUrl:ko.observable("about:blank"),userName:ko.observable("Me"),isServiceProfessional:ko.observable(!1),isClient:ko.observable(!1),isApp:ko.observable(!!window.cordova),isInOnboarding:ko.observable(!1),isAtCurrentOnboardingStep:ko.observable(!1),active:ko.observable("")};app.model.on("modulesLoaded",function(){ko.computed(function(){app.navBarBinding.isInOnboarding(app.model.onboarding.inProgress());app.navBarBinding.isAtCurrentOnboardingStep(app.model.onboarding.isAtCurrentStep())})});app.navBarBinding.continueOnboarding=function(){app.model.onboarding.goCurrentStep()};app.shell.on(app.shell.events.itemReady,function(){app.navBarBinding.active(app.shell.currentRoute.name)});app.navBarBinding.isAnonymous=ko.pureComputed(function(){return!this.isServiceProfessional()&&!this.isClient()},app.navBarBinding);app.navBarBinding.cssIfActive=function(activityName){return ko.computed(function(){return activityName===app.navBarBinding.active()?"active":""})};app.setupNavBarBinding=function setupNavBarBinding(){app.navBarBinding.isApp(!!window.cordova);ko.applyBindings(app.navBarBinding,$(".AppNav").get(0))};app.performsNavBarBack=function performsNavBarBack(options){var nav=this.navBar(),left=nav&&nav.leftAction(),$btn=$("body > .AppNav .SmartNavBar-edge.left > a.SmartNavBar-btn");if(left&&!left.isMenu()){var event=$.Event("click");event.options=options||{};$btn.trigger(event)}else this.shell&&this.shell.goBack()};var lastNotificationTimer=null;app.showNavBarNotification=function showNavBarNotification(settings){var msg=settings&&settings.message||"Hello World!",duration=settings&&settings.duration||2e3,transitionDuration=settings&&settings.transitionDuration||400,$el=$(".AppNav .SmartNavBar-notification");$el.text(msg);$el.fadeIn(transitionDuration).queue(function(){$el.off("click.manualHide").on("click.manualHide",function(){$el.fadeOut(transitionDuration)});clearTimeout(lastNotificationTimer);lastNotificationTimer=setTimeout(function(){$el.fadeOut(transitionDuration)},duration);$(this).dequeue()})}}},{"./viewmodels/NavAction":382,"./viewmodels/NavBar":383,jquery:!1,knockout:!1}],177:[function(require,module,exports){"use strict";var Activity=require("./components/Activity"),EmptyActivity=Activity.extend(function EmptyActivity(){Activity.apply(this,arguments);this.accessLevel=null;this.viewModel={};this.navBar=Activity.createSectionNavBar()});module.exports={_test:EmptyActivity,downloadApp:require("./activities/downloadApp"),calendar:require("./activities/calendar"),datetimePicker:require("./activities/datetimePicker"),clients:require("./activities/clients"),serviceProfessionalService:require("./activities/serviceProfessionalService"),serviceAddresses:require("./activities/serviceAddresses"),dashboard:require("./activities/dashboard"),appointment:require("./activities/appointment"),login:require("./activities/login"),logout:require("./activities/logout"),signup:require("./activities/signup"),welcome:require("./activities/welcome"),addressEditor:require("./activities/addressEditor"),account:require("./activities/account"),inbox:require("./activities/inbox"),conversation:require("./activities/conversation"),help:require("./activities/help"),feedbackForm:require("./activities/feedbackForm"),contactForm:require("./activities/contactForm"),cms:require("./activities/cms"),clientEditor:require("./activities/clientEditor"),schedulingPreferences:require("./activities/schedulingPreferences"),calendarSyncing:require("./activities/calendarSyncing"),bookMeButton:require("./activities/bookMeButton"),ownerInfo:require("./activities/ownerInfo"),privacySettings:require("./activities/privacySettings"),addJobTitles:require("./activities/addJobTitles"),serviceProfessionalServiceEditor:require("./activities/serviceProfessionalServiceEditor"),marketplaceProfile:require("./activities/marketplaceProfile"),marketplaceJobtitles:require("./activities/marketplaceJobtitles"),servicesOverview:require("./activities/servicesOverview"),verifications:require("./activities/verifications"),education:require("./activities/education"),backgroundCheck:require("./activities/backgroundCheck"),educationForm:require("./activities/educationForm"),bookingPolicies:require("./activities/bookingPolicies"),licensesCertifications:require("./activities/licensesCertifications"),licensesCertificationsForm:require("./activities/licensesCertificationsForm"),workPhotos:require("./activities/workPhotos"),profile:require("./activities/profile"),home:require("./activities/home"),learnMoreProfessionals:require("./activities/learnMoreProfessionals"),booking:require("./activities/booking"),terms:require("./activities/terms"),about:require("./activities/about"),payments:require("./activities/payments"),userFees:require("./activities/userFees"),performance:require("./activities/performance"),searchJobTitle:require("./activities/searchJobTitle"),searchCategory:require("./activities/searchCategory"),boardMemberNominations:require("./activities/boardMemberNominations"),paymentAccount:require("./activities/paymentAccount"),myAppointments:require("./activities/myAppointments"),clientAppointment:require("./activities/clientAppointment"),viewBooking:require("./activities/viewBooking"),blog:require("./activities/blog"),ownerPerks:require("./activities/ownerPerks"),cancellationPolicies:require("./activities/cancellationPolicies"),mockupHouseCleanerServiceEditor:require("./activities/mockupHouseCleanerServiceEditor"),aboutMe:require("./activities/aboutMe"),onboardingSuccess:require("./activities/onboardingSuccess"),userFeePayments:require("./activities/userFeePayments"),ownerAcknowledgment:require("./activities/ownerAcknowledgment"),userProfile:require("./activities/userProfile"),upgrade:require("./activities/upgrade")}},{"./activities/about":110,"./activities/aboutMe":111,"./activities/account":112,"./activities/addJobTitles":113,"./activities/addressEditor":114,"./activities/appointment":115,"./activities/backgroundCheck":116,"./activities/blog":117,"./activities/boardMemberNominations":118,"./activities/bookMeButton":119,"./activities/booking":120,"./activities/bookingPolicies":121,"./activities/calendar":122,"./activities/calendarSyncing":123,"./activities/cancellationPolicies":124,"./activities/clientAppointment":125,"./activities/clientEditor":126,"./activities/clients":127,"./activities/cms":128,"./activities/contactForm":129,"./activities/conversation":130,"./activities/dashboard":131,"./activities/datetimePicker":132,"./activities/downloadApp":133,"./activities/education":134,"./activities/educationForm":135,"./activities/feedbackForm":136,"./activities/help":137,"./activities/home":138,"./activities/inbox":139,"./activities/learnMoreProfessionals":140,"./activities/licensesCertifications":141,"./activities/licensesCertificationsForm":142,"./activities/login":143,"./activities/logout":144,"./activities/marketplaceJobtitles":145,"./activities/marketplaceProfile":146,"./activities/mockupHouseCleanerServiceEditor":147,"./activities/myAppointments":148,"./activities/onboardingSuccess":149,"./activities/ownerAcknowledgment":150,"./activities/ownerInfo":151,"./activities/ownerPerks":152,"./activities/paymentAccount":153,"./activities/payments":154,"./activities/performance":155,"./activities/privacySettings":156,"./activities/profile":157,"./activities/schedulingPreferences":158,"./activities/searchCategory":159,"./activities/searchJobTitle":160,"./activities/serviceAddresses":161,"./activities/serviceProfessionalService":162,"./activities/serviceProfessionalServiceEditor":163,"./activities/servicesOverview":164,"./activities/signup":165,"./activities/terms":166,"./activities/upgrade":167,"./activities/userFeePayments":168,"./activities/userFees":169,"./activities/userProfile":170,"./activities/verifications":171,"./activities/viewBooking":172,"./activities/welcome":173,"./activities/workPhotos":174,"./components/Activity":223}],178:[function(require,module,exports){"use strict";function preBootstrapWorkarounds(){function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}$(document).on("click.bs.collapse.data-api.workaround",'[data-toggle="collapse"]',function(){var $t=$(this),$target=getTargetFromTrigger($t),data=$target&&$target.data("bs.collapse");data&&(data.$trigger=$t)})}var $=require("jquery");require("jquery-mobile");require("./utils/jquery.multiline");var ko=require("knockout");ko.bindingHandlers.format=require("ko/formatBinding").formatBinding;ko.bindingHandlers.domElement=require("ko/domElementBinding").domElementBinding;var bootknock=require("./utils/bootknockBindingHelpers");require("./utils/Function.prototype._inherits");require("./utils/Function.prototype._delayed");require("./utils/Function.prototype.name-polyfill");require("es6-promise").polyfill();var layoutUpdateEvent=require("layoutUpdateEvent"),AppModel=require("./appmodel/AppModel");require("./locales/en-US-LC");var attachFastClick=require("fastclick").attach,app={shell:require("./app.shell"),model:new AppModel,activities:require("./app.activities"),modals:require("./app.modals"),goDashboard:function goDashboard(){goDashboard._going!==!0&&setTimeout(function(){goDashboard._going=!0;this.model.onboarding.goIfEnabled()||this.shell.go("/dashboard");setTimeout(function(){goDashboard._going=!1},1)}.bind(this),1)}};require("./app-navbar").extend(app);require("./app-components").registerAll(app);app.getActivity=function getActivity(name){var activity=this.activities[name];if(activity){var $act=this.shell.items.find(name);if($act&&$act.length)return activity.init($act,this,name)}return null};app.getActivityControllerByRoute=function getActivityControllerByRoute(route){var actName=route.name||this.shell.indexName;return this.getActivity(actName)};app.shell.accessControl=require("./utils/accessControl")(app);app.UserType=require("./models/User").UserType;app.successSave=function successSave(settings){settings=$.extend({message:"Your changes have been saved",link:null},settings);this.showNavBarNotification(settings);settings.link?this.shell.go(settings.link):this.performsNavBarBack({silentMode:!0})};var appInit=function appInit(){attachFastClick(document.body);require("knockout-sortable");require("jquery.ui.touch-punch");layoutUpdateEvent.layoutUpdateEvent+=" orientationchange";layoutUpdateEvent.on();var trigLayout=function trigLayout(){$(window).trigger("layoutUpdate")};window.addEventListener("native.keyboardshow",trigLayout);window.addEventListener("native.keyboardhide",trigLayout);window.addEventListener("native.keyboardshow",function(){window.scrollTo(0,0);setTimeout(function(){window.scrollTo(0,0)},100)});if(window.StatusBar){window.StatusBar.overlaysWebView(!1);window.StatusBar.backgroundColorByHexString("#ffffff");window.StatusBar.styleDefault();"android"==window.cordova.platformId&&window.StatusBar.backgroundColorByHexString("#00989a")}setTimeout(function(){$(window).trigger("layoutUpdate")},200);preBootstrapWorkarounds();require("bootstrap");bootknock.plugIn(ko);require("./utils/bootstrapSwitchBinding").plugIn(ko);require("./utils/pressEnterBindingHandler").plugIn(ko);require("./utils/fileUploaderBindingHandler").plugIn(ko);if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard){window.cordova.plugins.Keyboard.disableScroll(!1);window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1)}$(document).on("click","[data-shell]",function(e){
var cmdline=$(this).attr("data-shell")||"",args=cmdline.split(" "),cmd=args[0];if(cmd&&"function"==typeof app.shell[cmd]){app.shell[cmd].apply(app.shell,args.slice(1));e.stopImmediatePropagation();e.preventDefault()}});window.cordova&&$(document).on("click",'[target="_blank"], [target="_system"]',function(e){window.open(this.getAttribute("href"),this.getAttribute("target"));e.preventDefault()});app.shell.on(app.shell.events.itemReady,function($act,state){var routeName=app.shell.currentRoute.name,actName=$act.data("activity");if(routeName===actName){var activity=app.getActivity(actName);activity.show(state);routeName=app.shell.currentRoute.name;if(routeName===actName){var menuItem=activity.menuItem||actName;app.updateMenu(menuItem);app.updateAppNav(activity,state);app._currentActivity=activity}}});app.shell.on(app.shell.events.closed,function($act){var actName=$act.data("activity"),activity=app.getActivity(actName);activity.hide&&activity.hide()});app.shell.on("error",function(err){app.modals.showError({error:err})});var scrollToElement=require("./utils/scrollToElement");app.shell.on("fragmentNavigation",function(href){if("#"===href)console.warn('Navigation to an empty fragment, this may be not wanted. For root links, use "/"; on script handled links, call event.preventDefault; A touch event was listened on a link, but not the click event.');else{var target=$(href);if(target.length){var opts={animation:{duration:300}},act=target.closest("[data-activity]"),isHome="home"===act.data("activity");isHome&&(opts.topOffset=act.children("header").outerHeight());scrollToElement(target,opts)}}});app.setupNavBarBinding();var SmartNavBar=require("./components/SmartNavBar"),navBars=SmartNavBar.getAll();navBars.forEach(function(navbar){$(navbar.el).on("contentChange",function(){navbar.refresh()})});var togglingBackdrop=!1;$(document).on("show.bs.collapse hide.bs.collapse",".AppNav .navbar-collapse",function(e){if(!togglingBackdrop){togglingBackdrop=!0;var enabled="show"===e.type;$("body").toggleClass("has-appNav-open",enabled);$(".collapsing, .collapse.in").collapse("hide");togglingBackdrop=!1}});app.model.on("error",function(err){app.modals.showError({error:err})});$(document).on("focus",'[data-autoselect="true"]',function(){$(this).select()});var alertError=function(err){app.modals.showError({title:"There was an error loading",error:err})};require("./utils/toggleActionSheet").on();app.shell.baseUrl&&$("html").attr("data-site-url",app.shell.baseUrl.replace(/^\//,""));if(window.ga){var gaTrackerId="UA-72265353-4",appId=$("html").data("app-id"),appName=$("html").data("app-name"),appVersion=$("html").data("app-version");appVersion=(window.device&&window.device.platform||"web")+"-"+appVersion;if(window.cordova){window.ga.startTrackerWithId(gaTrackerId);window.ga.setAppVersion(appVersion);window.ga.trackView("index")}else{window.ga("create",gaTrackerId,"auto");window.ga("set","appVersion",appVersion);window.ga("set","appName",appName);window.ga("set","appId",appId);window.ga("send","screenview",{screenName:"index"})}app.shell.on(app.shell.events.itemReady,function($act,state){var view=state.route.name;window.cordova?window.ga.trackView(view):window.ga("send","screenview",{screenName:view})})}var connectUserNavbar=function(){ko.computed(function(){var u=app.model.userProfile.data,n=u.firstName();app.navBarBinding.userName(n||"Me");app.navBarBinding.isServiceProfessional(u.isServiceProfessional());app.navBarBinding.isClient(u.isClient())});ko.computed(function(){var p=app.model.userProfile.data.photoUrl();p&&app.navBarBinding.photoUrl(p)});ko.computed(function(){var p=app.model.marketplaceProfile.data.photoUrl();p&&app.navBarBinding.photoUrl(p)})},setupOnboarding=function(){return app.model.userProfile.loadFromLocal().then(function(userProfile){app.model.onboarding.init(app);app.model.onboarding.setStep(userProfile&&userProfile.onboardingStep||null);return app.model.onboarding.recoverLocalJobTitleID()}).then(function(){var r=window.document.referrer,fromItSelf=r&&0===r.indexOf(window.document.location.origin);fromItSelf||app.model.onboarding.goIfEnabled()})},setAppAsReady=function(){$("html").addClass("is-ready");window.navigator&&window.navigator.splashscreen&&window.navigator.splashscreen.hide()};app.model.init().then(app.shell.run.bind(app.shell)).then(connectUserNavbar).then(setupOnboarding).then(setAppAsReady)["catch"](alertError);window.app=app};$(window.cordova?function(){$(document).on("deviceready",appInit)}:appInit)},{"./app-components":175,"./app-navbar":176,"./app.activities":177,"./app.modals":179,"./app.shell":180,"./appmodel/AppModel":198,"./components/SmartNavBar":226,"./locales/en-US-LC":227,"./models/User":297,"./utils/Function.prototype._delayed":314,"./utils/Function.prototype._inherits":315,"./utils/Function.prototype.name-polyfill":316,"./utils/accessControl":328,"./utils/bootknockBindingHelpers":330,"./utils/bootstrapSwitchBinding":331,"./utils/fileUploaderBindingHandler":339,"./utils/jquery.multiline":346,"./utils/pressEnterBindingHandler":351,"./utils/scrollToElement":353,"./utils/toggleActionSheet":367,"es6-promise":!1,jquery:!1,knockout:!1,"knockout-sortable":!1}],179:[function(require,module,exports){"use strict";var $=require("jquery");exports.getErrorMessageFrom=function getErrorMessageFrom(err,defaultText){defaultText=defaultText||"Unknow error";if(!err)return defaultText;!err.error||"object"!=typeof err.error&&"string"!=typeof err.error||(err=err.error);if("string"==typeof err)return err||defaultText;err=err.responseJSON||err;var msg=err.name&&err.name+": "||"";msg+=err.errorMessage||err.message||"";if(err.errors)msg+="\n"+exports.stringifyErrorsList(err.errors);else try{var jserr=JSON.stringify(err),hasMoreInfo=jserr&&"{}"!==jserr;if(hasMoreInfo){hasMoreInfo=!1;var messagePropertiesList=["name","errorMessage","message","errors"];Object.keys(err).forEach(function(key){-1===messagePropertiesList.indexOf(key)&&(hasMoreInfo=!0)})}hasMoreInfo&&(msg+="\n\nTechnical details: "+jserr)}catch(ex){console.log("Impossible to stringify JSON error",err,ex)}return msg||defaultText};exports.stringifyErrorsList=function(errors){var msg="";msg=Array.isArray(errors)?errors.join("\n"):Object.keys(errors).map(function(key){var m=errors[key];return m&&m.join?m.join("\n"):m}).join("\n");return msg};exports.showError=function showErrorModal(options){var modal=$("#errorModal"),header=modal.find("#errorModal-label"),body=modal.find("#errorModal-body");options=options||{};var msg=body.data("default-text");msg=exports.getErrorMessageFrom(options.error||options.message,msg);body.multiline(msg);header.text(options.title||header.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.confirm=function confirm(options){var modal=$("#confirmModal"),header=modal.find("#confirmModal-label"),body=modal.find("#confirmModal-body"),yesBtn=modal.find("#confirmModal-yesBtn"),noBtn=modal.find("#confirmModal-noBtn");options=options||{};var title=header.data("default-text"),msg=body.data("default-text"),yes=yesBtn.data("default-text"),no=noBtn.data("default-text");body.multiline(options.message||msg);header.text(options.title||title);yesBtn.text(options.yes||yes);noBtn.text(options.no||no);return new Promise(function(resolve,reject){modal.modal("show");yesBtn.on("click",function(){resolve()});noBtn.on("click",function(){reject()});modal.on("hide.bs.modal",function(){reject()})})};exports.showNotification=function showNotification(options){var modal=$("#notificationModal"),header=modal.find("#notificationModal-label"),button=modal.find("#notificationModal-button"),body=modal.find("#notificationModal-body");options=options||{};var msg=options.message||body.data("default-text");body.multiline(msg);header.text(options.title||header.data("default-text"));button.text(options.buttonText||button.data("default-text"));return new Promise(function(resolve){modal.modal("show");modal.on("hide.bs.modal",function(){resolve()})})};exports.showTimePicker=require("./modals/timePicker").show;exports.showTextEditor=require("./modals/textEditor").show;exports.showAnnouncement=require("./modals/announcementModal").show},{"./modals/announcementModal":228,"./modals/textEditor":229,"./modals/timePicker":230,jquery:!1}],180:[function(require,module,exports){"use strict";var baseUrl="",hashBang=!0;if(!window.cordova){var t=/^http.?:\/\/[^\/]+(\/[^#]*)/.exec(window.document.baseURI);if(t&&t[1]){baseUrl=t[1];hashBang=!1}}var History=require("./utils/shell/hashbangHistory"),shell=require("./utils/shell/index"),Shell=shell.Shell,DomItemsManager=shell.DomItemsManager,shell=new Shell({root:"App-activities",baseUrl:baseUrl,forceHashbang:hashBang,indexName:"home",forbiddenAccessName:"login",linkEvent:"click",loader:null,history:History,domItemsManager:new DomItemsManager({idAttributeName:"data-activity",root:".App-activities"})});module.exports=shell},{"./utils/shell/hashbangHistory":358,"./utils/shell/index":359}],181:[function(require,module,exports){"use strict";function performLocalLogin(thisAppModel,username){return function(logged){return thisAppModel.clearLocalData().then(function(){thisAppModel.rest.extraHeaders={Authorization:"LC alu="+logged.userID+",alk="+logged.authKey};localforage.setItem("credentials",{userID:logged.userID,username:username,authKey:logged.authKey});thisAppModel.user().model.updateWith(logged.profile);thisAppModel.userProfile.saveLocal();window.ga&&(window.cordova?window.ga.setUserId(logged.userID):window.ga("set","userId",logged.userID));return logged})}}var localforage=require("localforage"),getUrlQuery=require("../utils/getUrlQuery"),$=require("jquery");exports.plugIn=function(AppModel){AppModel.prototype.login=function login(username,password){this.rest.extraHeaders=null;return this.rest.post("login",{username:username,password:password,returnProfile:!0}).then(performLocalLogin(this,username,password))};AppModel.prototype.facebookLogin=function facebookLogin(accessToken){this.rest.extraHeaders=null;return this.rest.post("login/facebook",{accessToken:accessToken,returnProfile:!0}).then(function(logged){return performLocalLogin(this,logged.profile.email,null)(logged)}.bind(this))};AppModel.prototype.logout=function logout(){this.rest.extraHeaders=null;localforage.removeItem("credentials");localforage.removeItem("profile");this.clearLocalData();this.rest.post("logout");return Promise.resolve()};AppModel.prototype.signup=function signup(data){this.rest.extraHeaders=null;data.returnProfile=!0;var query=getUrlQuery(),utm={utm_source:window.cordova?"app":"web"};query.forEach(function(name){/^utm_/.test(name)&&(utm[name]=query[name])});return this.rest.post("signup?"+$.param(utm),data).then(performLocalLogin(this,data.email,data.password))};AppModel.prototype.resetPassword=function resetPassword(data){var username=data.username||data.email;return this.rest.post("auth/reset-password",{username:username})};AppModel.prototype.confirmResetPassword=function confirmResetPassword(data){return this.rest.post("auth/reset-password/confirm",data)}}},{"../utils/getUrlQuery":342,jquery:!1,localforage:!1}],182:[function(require,module,exports){"use strict";var CacheControl=require("../utils/CacheControl"),moment=require("moment"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}function saveTimesInCache(userID,queryKey,data){var userC=cache.times[userID],c=userC&&userC[queryKey];if(c){c.times=data.times;c.incrementsSizeInMinutes=data.incrementsSizeInMinutes;c.control.touch()}else{userC||(userC=cache.times[userID]={});c=userC[queryKey]={times:data.times,incrementsSizeInMinutes:data.incrementsSizeInMinutes,control:new CacheControl({ttl:{minutes:1}}),getFreeTimeSlots:function(duration,slotSizeMinutes,includeEndTime){var size=slotSizeMinutes||this.incrementsSizeInMinutes;duration=duration||size;return createTimeSlots.forList(this.times,size,duration,!0,includeEndTime)}}}return c}function getTimesFromCache(userID,queryKey){var userC=cache.times[userID],c=userC&&userC[queryKey];return c&&!c.control.mustRevalidate()?c:void 0}Api._inherits(EventEmitter);var api=new Api,cache={times:{}};api.clearCache=function clearCache(){cache.times={};this.emit("clearCache")};api.clearUserCache=function clearUserCache(userID){delete cache.times[userID];this.emit("clearCache",{userID:userID})};appModel.on("clearLocalData",function(){api.clearCache()});var createTimeSlots=require("../utils/createTimeSlots");api.times=function times(userID,start,end){end||(end=moment(start).add(1,"day").toDate());var queryKey=start.toISOString()+"-"+end.toISOString(),cached=getTimesFromCache(userID,queryKey);return cached?Promise.resolve(cached):appModel.rest.get("users/"+userID+"/availability/times",{start:start,end:end}).then(function(data){data.times=createTimeSlots.filterListBy(data.times,start,end);return saveTimesInCache(userID,queryKey,data)})};return api}},{"../utils/CacheControl":310,"../utils/createTimeSlots":333,events:!1,moment:!1}],183:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getBookings:function(filters){return appModel.rest.get("me/bookings",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new Booking(rawItem)})})}}};api.getBookingsByDates=function getBookingsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getBookings({start:date,end:end}).then(function(bookings){var arr=ko.observableArray(bookings);return arr})};api.getUpcomingBookings=function getUpcomingBookings(){return appModel.rest.get("me/upcoming-bookings")};api.getUpcomingAppointments=function getUpcomingAppointments(){return appModel.rest.get("me/upcoming-appointments")};api.getBooking=function getBooking(id){return id?appModel.rest.get("me/bookings/"+id).then(function(booking){return new Booking(booking)}):Promise.reject("The bookingID is required to get a booking")};api.appointmentToSimplifiedBooking=function(apt){return{bookingID:apt.sourceBooking().bookingID(),jobTitleID:apt.jobTitleID(),clientUserID:apt.clientUserID(),serviceAddress:apt.address()?apt.address().model.toPlainObject():null,startTime:apt.startTime(),services:apt.pricing().map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:apt.preNotesToClient(),preNotesToSelf:apt.preNotesToSelf(),postNotesToClient:apt.postNotesToClient(),postNotesToSelf:apt.postNotesToSelf()}};api.bookingToSimplifiedBooking=function(booking){return{bookingID:booking().bookingID(),clientUserID:booking.clientUserID(),serviceAddress:booking.serviceAddress().model.toPlainObject(),startTime:booking.startTime(),services:booking.pricingSummary()&&booking.pricingSummary().details().pricing.map(function(pricing){return pricing.serviceProfessionalServiceID()}),preNotesToClient:booking.preNotesToClient(),preNotesToSelf:booking.preNotesToSelf(),postNotesToClient:booking.postNotesToClient(),postNotesToSelf:booking.postNotesToSelf()}};api.setServiceProfessionalBooking=function setServiceProfessionalBooking(booking,allowBookUnavailableTime){booking=booking.bookingID?api.bookingToSimplifiedBooking(booking):booking.sourceBooking?api.appointmentToSimplifiedBooking(booking):booking;var id=booking.bookingID||"",method=id?"put":"post";booking.allowBookUnavailableTime=allowBookUnavailableTime||!1;return appModel.rest[method]("me/service-professional-booking/"+id,booking).then(function(serverBooking){if(!booking.serviceAddress.addressID)if(booking.serviceAddress.userID==booking.clientUserID){appModel.clientAddresses.clearCache();appModel.clientAddresses.removeGroupFromLocalCache(booking.clientUserID)}else{appModel.serviceAddresses.clearCache();appModel.serviceAddresses.removeGroupFromLocalCache(booking.jobTitleID)}return new Booking(serverBooking)})};api.declineBookingByServiceProfessional=function declineBookingByServiceProfessional(bookingID){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/deny").then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};api.cancelBookingByServiceProfessional=function cancelBookingByServiceProfessional(bookingID){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/cancel").then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};api.cancelBookingByClient=function cancelBookingByClient(bookingID){return appModel.rest.post("me/client-booking/"+bookingID+"/cancel").then(function(serverBooking){return new Booking(serverBooking)})};api.declineBookingByClient=function declineBookingByClient(bookingID){return appModel.rest.post("me/client-booking/"+bookingID+"/deny").then(function(serverBooking){return new Booking(serverBooking)})};api.confirmBookingRequest=function confirmBookingRequest(bookingID,dateType){return appModel.rest.post("me/service-professional-booking/"+bookingID+"/confirm",{dateType:dateType}).then(function(serverBooking){appModel.calendar.clearCache();return new Booking(serverBooking)})};var createClientBookingRequest=function(booking,requestOptions,paymentMethod){var billingAddress=paymentMethod&&paymentMethod.billingAddress();paymentMethod=paymentMethod&&paymentMethod.model.toPlainObject();if(billingAddress){billingAddress=billingAddress.model.toPlainObject();delete paymentMethod.billingAddress}return{serviceProfessionalUserID:booking.serviceProfessionalUserID(),jobTitleID:booking.jobTitleID(),serviceStartTime:booking.serviceDate()&&booking.serviceDate().startTime(),alternative1StartTime:booking.alternativeDate1()&&booking.alternativeDate1().startTime(),alternative2StartTime:booking.alternativeDate2()&&booking.alternativeDate2().startTime(),serviceAddress:booking.serviceAddress()&&booking.serviceAddress().model.toPlainObject(),services:booking.pricingSummary()&&booking.pricingSummary().details().map(function(pricing){return pricing.serviceProfessionalServiceID()}),bookCode:ko.unwrap(requestOptions.bookCode),promotionalCode:ko.unwrap(requestOptions.promotionalCode),billingAddress:billingAddress&&{addressLine1:billingAddress.addressLine1,addressLine2:billingAddress.addressLine2,postalCode:billingAddress.postalCode},paymentMethod:paymentMethod,specialRequests:booking.specialRequests()}};api.requestClientBooking=function requestClientBooking(booking,requestOptions,billingAddress,paymentMethod){var data=createClientBookingRequest(booking,requestOptions,billingAddress,paymentMethod);return appModel.rest.post("me/client-booking",data)};api.getNewClientBooking=function getNewClientBooking(options){return appModel.rest.get("me/client-booking",options)};var createClientBookingUpdateObject=function(booking){return{serviceStartTime:booking.serviceDate()&&booking.serviceDate().startTime(),serviceAddress:booking.serviceAddress()&&booking.serviceAddress().model.toPlainObject(),services:booking.pricingSummary()&&booking.pricingSummary().details().map(function(pricing){return pricing.serviceProfessionalServiceID()}),specialRequests:booking.specialRequests()}};api.setClientBooking=function setClientBooking(booking){return appModel.rest.put("me/client-booking/"+booking.bookingID(),createClientBookingUpdateObject(booking))};return api}},{"../models/Booking":234,knockout:!1,moment:!1}],184:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),DateAvailability=require("../models/DateAvailability"),DateCache=require("../utils/DateCache"),EventEmitter=require("events").EventEmitter;exports.create=function create(appModel){function Api(){EventEmitter.call(this);this.setMaxListeners(30)}Api._inherits(EventEmitter);var api=new Api,cache=new DateCache({Model:DateAvailability,ttl:{minutes:10}});api.clearCache=function clearCache(){cache.clear();this.emit("clearCache")};appModel.on("clearLocalData",function(){api.clearCache()});api.getAppointment=function getAppointment(ids){return ids.calendarEventID?appModel.calendarEvents.getEvent(ids.calendarEventID).then(Appointment.fromCalendarEvent):ids.bookingID?appModel.bookings.getBooking(ids.bookingID).then(function(booking){return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):Promise.reject("Unrecognized ID")};api.setAppointment=function setAppointment(apt,allowBookUnavailableTime){return apt.sourceBooking()?appModel.bookings.setServiceProfessionalBooking(apt,allowBookUnavailableTime).then(function(booking){api.clearCache();return appModel.calendarEvents.getEvent(booking.serviceDateID()).then(function(event){return Appointment.fromBooking(booking,event)})}):apt.sourceEvent()?appModel.calendarEvents.setEvent(apt).then(function(event){return Appointment.fromCalendarEvent(event)}):Promise.reject(new Error("Unrecognized appointment object"))};var getRemoteAppointmentsByDate=function getRemoteAppointmentsByDate(date){return Promise.all([appModel.bookings.getBookingsByDates(date),appModel.calendarEvents.getEventsByDates(date)]).then(function(group){var events=group[1],bookings=group[0],apts=[];events&&events().length&&(apts=Appointment.listFromCalendarEventsBookings(events(),bookings()));return apts})},getRemoteDateAvailability=function getRemoteDateAvailability(date){return Promise.all([getRemoteAppointmentsByDate(date),appModel.weeklySchedule.load(),appModel.schedulingPreferences.load()]).then(function(result){var apts=result[0],settings=result[1],prefs=result[2],dateInfo={date:date,appointmentsList:apts||[],weeklySchedule:settings,schedulingPreferences:prefs};return dateInfo})};api.getDateAvailability=function getDateAvailability(date){var cached=cache.getSingle(date);return cached?Promise.resolve(cached):getRemoteDateAvailability(date).then(function(dateInfo){return cache.set(date,dateInfo).data})};return api}},{"../models/Appointment":232,"../models/DateAvailability":241,"../utils/DateCache":311,events:!1}],185:[function(require,module,exports){"use strict";var CalendarEvent=require("../models/CalendarEvent"),moment=require("moment"),ko=require("knockout");exports.create=function create(appModel){var api={remote:{rest:appModel.rest,getCalendarEvents:function(filters){return appModel.rest.get("me/events",filters).then(function(rawItems){return rawItems&&rawItems.map(function(rawItem){return new CalendarEvent(rawItem)})})}}};api.getEventsByDates=function getEventsByDates(date,end){end=end||moment(date).clone().add(1,"days").toDate();return api.remote.getCalendarEvents({start:date,end:end}).then(function(events){var arr=ko.observableArray(events);return arr})};api.getEvent=function getEvent(id){return id?appModel.rest.get("me/events/"+id).then(function(event){return new CalendarEvent(event)}):Promise.reject("The calendarEventID is required to get an event")};api.appointmentToSimplifiedEvent=function(apt){var rrule=apt.sourceEvent().recurrenceRule();rrule&&(rrule=apt.sourceEvent().recurrenceRule().model.toPlainObject());var occs=apt.sourceEvent().recurrenceOccurrences();occs&&(occs=occs.map(function(occ){return occ&&occ.model.toPlainObject()||null}).filter(function(occ){return null!==occ}));return{calendarEventID:apt.id()<0?0:apt.id(),eventTypeID:apt.sourceEvent().eventTypeID(),summary:apt.summary(),description:apt.description(),availabilityTypeID:apt.sourceEvent().availabilityTypeID(),location:apt.addressSummary(),startTime:apt.startTime(),endTime:apt.endTime(),isAllDay:apt.sourceEvent().isAllDay(),recurrenceRule:rrule,recurrenceOccurrences:occs}};api.setEvent=function setEvent(event){event=event.calendarEventID?event.model.toPlainObject():event.sourceEvent?api.appointmentToSimplifiedEvent(event):event;var id=event.calendarEventID||"",method=id?"put":"post";return appModel.rest[method]("me/events"+(id?"/":"")+id,event).then(function(serverEvent){return new CalendarEvent(serverEvent)})};return api}},{"../models/CalendarEvent":236,knockout:!1,moment:!1}],186:[function(require,module,exports){"use strict";var ko=require("knockout"),CalendarSyncing=require("../models/CalendarSyncing"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new CalendarSyncing,ttl:{minutes:1},localStorageName:"calendarSyncing",fetch:function fetch(){return appModel.rest.get("me/calendar-syncing")},push:function push(){return appModel.rest.put("me/calendar-syncing",this.data.model.toPlainObject())}});rem.isReseting=ko.observable(!1);rem.resetExportUrl=function resetExportUrl(){rem.isReseting(!0);return appModel.rest.post("me/calendar-syncing/reset-export-url").then(function(updatedSyncSettings){rem.data.model.updateWith(updatedSyncSettings);rem.isReseting(!1);return updatedSyncSettings})};appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/CalendarSyncing":237,"../utils/RemoteModel":324,knockout:!1}],187:[function(require,module,exports){"use strict";var CancellationPolicy=require("../models/CancellationPolicy"),ListRemoteModel=require("../utils/ListRemoteModel"),data=[new CancellationPolicy({cancellationPolicyID:3,name:"Flexible",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 50% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:.5}),new CancellationPolicy({cancellationPolicyID:2,name:"Moderate",description:"No cancellation fees if changed or cancelled at least 24 hours in advance, otherwise a cancellation fee of 100% the price of booked services apply (including no-shows).",hoursRequired:24,cancellationFeeBefore:0,cancellationFeeAfter:1}),new CancellationPolicy({cancellationPolicyID:1,name:"Strict",description:"Cancellation fees of 50% of the price of booked services up to 5 days before the booking start time and 100% after.",hoursRequired:120,cancellationFeeBefore:.5,cancellationFeeAfter:1})];exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"cancellationPolicyID",Model:CancellationPolicy});appModel.on("clearLocalData",function(){});api.list(data);api.getList=function(){return Promise.resolve(data)};return api}},{"../models/CancellationPolicy":238,"../utils/ListRemoteModel":321}],188:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"userID",itemIdField:"addressID",Model:Address});api.addLocalforageSupport("addresses/clients/");api.addRestSupport(appModel.rest,"me/addresses/clients/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Address":231,"../utils/GroupListRemoteModel":317}],189:[function(require,module,exports){"use strict";var Booking=require("../models/Booking"),ko=require("knockout"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),moment=require("moment");exports.create=function create(appModel){function loadLocalCopy(){return localforage.getItem("clientAppointments").then(function(data){if(data){data.latest&&(cache.latest=new Date(data.latest));data.data&&cache.data(data.data.map(function(b){return new Booking(b)}));if(data.range){cache.range.startTime=data.range.startTime?new Date(data.range.startTime):null;cache.range.endTime=data.range.endTime?new Date(data.range.endTime):null}}})}function saveLocalCopy(){return localforage.setItem("clientAppointments",{latest:cache.latest,data:cache.data().map(function(b){return b.model.toPlainObject(!0)})})}function isClientBooking(booking){return appModel.userProfile.data.userID()===booking.clientUserID()}function sortBookingByDateComparator(a,b){var c=a.serviceDate().startTime()>b.serviceDate().startTime();return c?1:-1}function getFromRemote(options){if(remoteRequest)return remoteRequest;options=options||{};var start=new Date,end=moment().add(3,"month").toDate();remoteRequest=appModel.bookings.getBookingsByDates(start,end).then(function(remoteData){remoteRequest=null;var d=remoteData().filter(isClientBooking).sort(sortBookingByDateComparator);if(d&&d.length){cache.range.startTime=d[0].serviceDate().startTime();cache.range.endTime=d[d.length-1].serviceDate().endTime();cache.touch();cache.data(d);saveLocalCopy()}else cache.data([])})["catch"](function(er){remoteRequest=null;throw er});return remoteRequest}function syncData(){var p=Promise.resolve();cache.localLoaded||(p=loadLocalCopy());cache.mustRevalidate()&&(p=p.then(getFromRemote));return p}var cache=new CacheControl({ttl:{minutes:10},data:ko.observableArray([])});cache.localLoaded=!1;cache.range={startTime:null,endTime:null};var remoteRequest=null,api={};api.sync=syncData;api.list=cache.data;api.clearCache=function(){cache.data([]);cache.reset()};appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Booking":234,"../utils/CacheControl":310,knockout:!1,localforage:!1,moment:!1}],190:[function(require,module,exports){"use strict";var Client=require("../models/Client"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"clientUserID",Model:Client});api.addLocalforageSupport("clients");api.addRestSupport(appModel.rest,"me/clients");appModel.on("clearLocalData",function(){api.clearCache()});var publicSearchRequest=null;api.publicSearch=function publicSearch(search){if(publicSearchRequest&&publicSearchRequest.abort)try{publicSearchRequest.abort()}catch(abortErr){console.error("Error aborting request",abortErr)}var request=appModel.rest.get("me/clients/public-search",search);publicSearchRequest=request.xhr;request=request["catch"](function(err){if(err&&"abort"===err.statusText)return[];throw err});request.xhr=publicSearchRequest;return request};return api}},{"../models/Client":240,"../utils/ListRemoteModel":321}],191:[function(require,module,exports){"use strict";var UserEducation=require("../models/UserEducation"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"educationID",Model:UserEducation});api.addLocalforageSupport("education");api.addRestSupport(appModel.rest,"me/education");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserEducation":298,"../utils/ListRemoteModel":321}],192:[function(require,module,exports){"use strict";exports.create=function create(appModel){var getUserDeviceInfo=function getUserDeviceInfo(){var dev=window.device||{platform:"web",model:"unknow",cordova:"",version:""};return{userAgent:navigator.userAgent,platform:dev.platform,version:dev.version,model:dev.model,cordova:dev.cordova}};return{postIdea:function postIdea(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/ideas",values)},postSupport:function postSupport(values){values.userDevice=JSON.stringify(getUserDeviceInfo());return appModel.rest.post("feedback/support",values)}}}},{}],193:[function(require,module,exports){"use strict";function getArticlesUrl(labels){return articlesUrl+encodeURIComponent(labels)}function getRemoteArticles(labels){var result=[];return Promise.resolve($.get(getArticlesUrl(labels))).then(function next(data){data.articles&&(result=result.concat(data.articles));return data.next_page?$.get(data.next_page).then(next):result})}function getRemoteCategories(){var result=[];return Promise.resolve($.get(categoriesUrl)).then(function next(data){data.categories&&(result=result.concat(data.categories));return data.next_page?$.get(data.next_page).then(next):result})}function getRemoteSections(){var result=[];return Promise.resolve($.get(sectionsUrl)).then(function next(data){data.sections&&(result=result.concat(data.sections));
return data.next_page?$.get(data.next_page).then(next):result})}var ko=require("knockout"),articlesUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/articles.json?label_names=",categoriesUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/categories.json",sectionsUrl="https://loconomics.zendesk.com/api/v2/help_center/en-us/sections.json",$=require("jquery"),CacheControl=require("../utils/CacheControl");exports.create=function create(appModel){var ttl={days:1},cache={categories:new CacheControl({ttl:ttl}),sections:new CacheControl({ttl:ttl}),articles:{},clear:function(){this.categories.reset();this.categories.data=null;this.sections.reset();this.sections.data=null;this.articles={}},getArticlesCache:function(labels){var cacheItem=this.articles[labels];cacheItem||(cacheItem=this.articles[labels]=new CacheControl({ttl:ttl}));return cacheItem},setArticles:function(labels,data){var cacheItem=this.getArticlesCache(labels);cacheItem.data=data;cacheItem.latest=new Date;return cacheItem}},api={};api.clearCache=function(){cache.clear()};appModel.on("clearLocalData",function(){api.clearCache()});var HelpCategory=require("../models/HelpCategory");api.isLoadingCategories=ko.observable(!1);api.getCategories=function(){if(cache.categories.mustRevalidate()){api.isLoadingCategories(!0);return getRemoteCategories().then(function(data){cache.categories.data=data.map(function(a){return new HelpCategory(a)});cache.categories.latest=new Date;api.isLoadingCategories(!1);return cache.categories.data},function(err){api.isLoadingCategories(!1);throw err})}return Promise.resolve(cache.categories.data)};var HelpSection=require("../models/HelpSection");api.isLoadingSections=ko.observable(!1);api.getSections=function(){if(cache.sections.mustRevalidate()){api.isLoadingSections(!0);return getRemoteSections().then(function(data){cache.sections.data=data.map(function(a){return new HelpSection(a)});cache.sections.latest=new Date;api.isLoadingSections(!1);return cache.sections.data},function(err){api.isLoadingSections(!1);throw err})}return Promise.resolve(cache.sections.data)};var HelpArticle=require("../models/HelpArticle");api.isLoadingArticles=ko.observable(!1);api.getArticles=function(labels){labels=labels||"";var cached=cache.getArticlesCache(labels);if(cached.mustRevalidate()){api.isLoadingArticles(!0);return getRemoteArticles(labels).then(function(data){cache.setArticles(labels,data.map(function(a){return new HelpArticle(a)}));api.isLoadingArticles(!1);return cached.data},function(err){api.isLoadingArticles(!1);throw err})}return Promise.resolve(cached.data)};api.findByIdAt=function(id,atList){var found;atList.some(function(item){if(item.id()==id){found=item;return!0}});return found};api.getCategory=function(id){return api.getCategories().then(function(list){return api.findByIdAt(id,list)})};api.getSection=function(id){return api.getSections().then(function(list){return api.findByIdAt(id,list)})};api.getArticle=function(id){return api.getArticles().then(function(list){return api.findByIdAt(id,list)})};api.getArticlesBySection=function(sectionID){return api.getArticles().then(function(list){return list.filter(function(item){return item.section_id()==sectionID})})};api.getSectionsByCategory=function(categoryID){return api.getSections().then(function(list){return list.filter(function(item){return item.category_id()==categoryID})})};return api}},{"../models/HelpArticle":245,"../models/HelpCategory":246,"../models/HelpSection":247,"../utils/CacheControl":310,jquery:!1,knockout:!1}],194:[function(require,module,exports){"use strict";var Address=require("../models/Address"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new Address,ttl:{minutes:1},localStorageName:"homeAddress",fetch:function fetch(){return appModel.rest.get("me/addresses/home")},push:function push(){return appModel.rest.put("me/addresses/home",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/Address":231,"../utils/RemoteModel":324}],195:[function(require,module,exports){"use strict";var JobTitleLicense=require("../models/JobTitleLicense"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:JobTitleLicense});api.addLocalforageSupport("job-title-licenses/");api.addRestSupport(appModel.rest,"me/job-title-licenses/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/JobTitleLicense":252,"../utils/GroupRemoteModel":318}],196:[function(require,module,exports){"use strict";var JobTitleServiceAttributes=require("../models/JobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{hours:1},itemIdField:"jobTitleID",Model:JobTitleServiceAttributes});api.addLocalforageSupport("job-title-service-attributes/");api.addRestSupport(appModel.rest,"job-title-service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/JobTitleServiceAttributes":256,"../utils/GroupRemoteModel":318}],197:[function(require,module,exports){"use strict";var localforage=require("localforage"),JobTitle=require("../models/JobTitle"),ko=require("knockout"),CacheControl=require("../utils/CacheControl");exports.create=function create(appModel){var api={state:{isLoading:ko.observable(!1)}},cache={jobTitles:{}},getCacheItem=function(id){var c=cache.jobTitles[id];c||(c=cache.jobTitles[id]=new CacheControl({ttl:{minutes:60}}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new JobTitle(rawData);c.touch();return c};api.clearCache=function clearCache(){cache.jobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});api.getJobTitle=function getJobTitle(id){if(!id)return Promise.reject("Needs an ID to get a Job Title");var c=getCacheItem(id);if(c.request)return c.request;if(c.mustRevalidate()){api.state.isLoading(!0);c.request=localforage.getItem("jobTitles/"+id).then(function(jobTitle){jobTitle&&(c.latest=new Date(jobTitle.updatedDate));if(c.mustRevalidate())return appModel.rest.get("job-titles/"+id).then(function(raw){localforage.setItem("jobTitles/"+id,raw);api.state.isLoading(!1);c.request=null;return setCacheItem(id,raw).data});api.state.isLoading(!1);c.request=null;return setCacheItem(id,jobTitle).data})["catch"](function(err){api.state.isLoading(!1);c.request=null;throw err});return c.request}return Promise.resolve(c.data)};return api}},{"../models/JobTitle":249,"../utils/CacheControl":310,knockout:!1,localforage:!1}],198:[function(require,module,exports){function AppModel(){EventEmitter.call(this);this.setMaxListeners(50)}var ko=require("knockout"),$=require("jquery"),Rest=require("../utils/Rest"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;AppModel._inherits(EventEmitter);module.exports=AppModel;require("./AppModel-account").plugIn(AppModel);AppModel.prototype.loadLocalCredentials=function loadLocalCredentials(){return new Promise(function(resolve){var resolveAnyway=function(doesnMatter){console.warning("App Model Init err",doesnMatter);resolve()};localforage.getItem("credentials").then(function(credentials){if(credentials&&credentials.userID&&credentials.username&&credentials.authKey){this.rest.extraHeaders={Authorization:"LC alu="+credentials.userID+",alk="+credentials.authKey};this.userProfile.load().then(resolve,resolveAnyway);window.ga&&(window.cordova?window.ga.setUserId(credentials.userID):window.ga("set","userId",credentials.userID))}else resolve()}.bind(this),resolveAnyway)}.bind(this))};AppModel.prototype.init=function init(){localforage.config({name:"LoconomicsApp",version:.1,size:4980736,storeName:"keyvaluepairs",description:"Loconomics App",driver:localforage.LOCALSTORAGE});return localforage.getItem("config").then(function(config){config=config||{};config.siteUrl?$("html").attr("data-site-url",config.siteUrl):config.siteUrl=$("html").attr("data-site-url")||"";this.config=config;this.rest=new Rest(config.siteUrl+"/api/v1/en-US/");this.loadModules();return this.loadLocalCredentials()}.bind(this))};AppModel.prototype.loadModules=function loadModules(){this.userProfile=require("./AppModel.userProfile").create(this);this.user=ko.computed(function(){return this.userProfile.data},this);this.onboarding=require("./AppModel.onboarding").create(this);this.schedulingPreferences=require("./AppModel.schedulingPreferences").create(this);this.calendarSyncing=require("./AppModel.calendarSyncing").create(this);this.weeklySchedule=require("./AppModel.weeklySchedule").create(this);this.marketplaceProfile=require("./AppModel.marketplaceProfile").create(this);this.homeAddress=require("./AppModel.homeAddress").create(this);this.privacySettings=require("./AppModel.privacySettings").create(this);this.bookings=require("./AppModel.bookings").create(this);this.calendarEvents=require("./AppModel.calendarEvents").create(this);this.jobTitles=require("./AppModel.jobTitles").create(this);this.userJobProfile=require("./AppModel.userJobProfile").create(this);this.calendar=require("./AppModel.calendar").create(this);this.serviceAddresses=require("./AppModel.serviceAddresses").create(this);this.serviceProfessionalServices=require("./AppModel.serviceProfessionalServices").create(this);this.pricingTypes=require("./AppModel.pricingTypes").create(this);this.messaging=require("./AppModel.messaging").create(this);this.clients=require("./AppModel.clients").create(this);this.postalCodes=require("./AppModel.postalCodes").create(this);this.feedback=require("./AppModel.feedback").create(this);this.education=require("./AppModel.education").create(this);this.users=require("./AppModel.users").create(this);this.availability=require("./AppModel.availability").create(this);this.serviceAttributes=require("./AppModel.serviceAttributes").create(this);this.jobTitleServiceAttributes=require("./AppModel.jobTitleServiceAttributes").create(this);this.userVerifications=require("./AppModel.userVerifications").create(this);this.workPhotos=require("./AppModel.workPhotos").create(this);this.userLicensesCertifications=require("./AppModel.userLicensesCertifications").create(this);this.statesProvinces=require("./AppModel.statesProvinces").create(this);this.paymentAccount=require("./AppModel.paymentAccount").create(this);this.clientAppointments=require("./AppModel.clientAppointments").create(this);this.jobTitleLicenses=require("./AppModel.jobTitleLicenses").create(this);this.licenseCertification=require("./AppModel.licenseCertification").create(this);this.clientAddresses=require("./AppModel.clientAddresses").create(this);this.cancellationPolicies=require("./AppModel.cancellationPolicies").create(this);this.help=require("./AppModel.help").create(this);this.paymentPlans=require("./AppModel.paymentPlans").create(this);this.userPaymentPlan=require("./AppModel.userPaymentPlan").create(this);this.ownerAcknowledgment=require("./AppModel.ownerAcknowledgment").create(this);this.userFeePayments=require("./AppModel.userFeePayments").create(this);this.emit("modulesLoaded")};AppModel.prototype.clearLocalData=function clearLocalData(){return localforage.getItem("config").then(function(config){localforage.clear();config&&localforage.setItem("config",config);this.emit("clearLocalData")}.bind(this))}},{"../utils/Rest":325,"./AppModel-account":181,"./AppModel.availability":182,"./AppModel.bookings":183,"./AppModel.calendar":184,"./AppModel.calendarEvents":185,"./AppModel.calendarSyncing":186,"./AppModel.cancellationPolicies":187,"./AppModel.clientAddresses":188,"./AppModel.clientAppointments":189,"./AppModel.clients":190,"./AppModel.education":191,"./AppModel.feedback":192,"./AppModel.help":193,"./AppModel.homeAddress":194,"./AppModel.jobTitleLicenses":195,"./AppModel.jobTitleServiceAttributes":196,"./AppModel.jobTitles":197,"./AppModel.licenseCertification":199,"./AppModel.marketplaceProfile":200,"./AppModel.messaging":201,"./AppModel.onboarding":202,"./AppModel.ownerAcknowledgment":203,"./AppModel.paymentAccount":204,"./AppModel.paymentPlans":205,"./AppModel.postalCodes":206,"./AppModel.pricingTypes":207,"./AppModel.privacySettings":208,"./AppModel.schedulingPreferences":209,"./AppModel.serviceAddresses":210,"./AppModel.serviceAttributes":211,"./AppModel.serviceProfessionalServices":212,"./AppModel.statesProvinces":213,"./AppModel.userFeePayments":214,"./AppModel.userJobProfile":215,"./AppModel.userLicensesCertifications":216,"./AppModel.userPaymentPlan":217,"./AppModel.userProfile":218,"./AppModel.userVerifications":219,"./AppModel.users":220,"./AppModel.weeklySchedule":221,"./AppModel.workPhotos":222,events:!1,jquery:!1,knockout:!1,localforage:!1}],199:[function(require,module,exports){"use strict";var LicenseCertification=require("../models/LicenseCertification"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{month:1},itemIdField:"licenseCertificationID",Model:LicenseCertification});api.addLocalforageSupport("license-certification/");api.addRestSupport(appModel.rest,"license-certification/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/LicenseCertification":258,"../utils/GroupRemoteModel":318}],200:[function(require,module,exports){"use strict";var MarketplaceProfile=require("../models/MarketplaceProfile"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new MarketplaceProfile,ttl:{minutes:1},localStorageName:"marketplaceProfile",fetch:function fetch(){return appModel.rest.get("me/marketplace-profile")},push:function push(){return appModel.rest.put("me/marketplace-profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/MarketplaceProfile":261,"../utils/RemoteModel":324}],201:[function(require,module,exports){"use strict";var Thread=require("../models/Thread"),CacheControl=require("../utils/CacheControl"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:1},itemIdField:"threadID",Model:Thread});api.addLocalforageSupport("messaging");api.addRestSupport(appModel.rest,"me/messaging");appModel.on("clearLocalData",function(){api.clearCache()});var fullThreadsCache={},fetchThreadRemote=function(threadID){return appModel.rest.get("me/messaging/"+threadID,{limit:1e3}).then(function(thread){if(thread){thread=new Thread(thread);var cached=fullThreadsCache[threadID];if(cached){cached.control.latest=new Date;cached.thread=thread}else{fullThreadsCache[threadID]={control:new CacheControl({ttl:{minutes:1}}),thread:thread};fullThreadsCache[threadID].control.latest=new Date}return thread}throw new Error("Not Found")})},markAsEndedAndFollowUp=function(any){api.state.isSyncing(!1);api.state.isLoading(!1);return any};api.getItem=function getItem(threadID){var cached=fullThreadsCache[threadID];if(cached&&cached.thread){if(cached.control.mustRevalidate()){api.state.isSyncing(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)}return Promise.resolve(cached.thread)}api.state.isLoading(!0);return fetchThreadRemote(threadID).then(markAsEndedAndFollowUp,markAsEndedAndFollowUp)};return api}},{"../models/Thread":293,"../utils/CacheControl":310,"../utils/ListRemoteModel":321}],202:[function(require,module,exports){"use strict";var OnboardingProgress=require("../viewmodels/OnboardingProgress"),NavAction=require("../viewmodels/NavAction"),ko=require("knockout"),localforage=require("localforage");exports.create=function create(appModel){var NAVBAR_TITLE="Create your first listing",api=new OnboardingProgress;api.navbarTitle=function(){return NAVBAR_TITLE};api.currentActivity=ko.observable("");api.init=function init(app){api.app=app;api.currentActivity(app.shell.currentRoute.name);app.shell.on(app.shell.events.itemReady,function(){api.currentActivity(app.shell.currentRoute.name)})};api.setStep=function(stepName){if(this.setStepByName(stepName))return!0;this.model.reset();return!1};api.skipToAddJobTitles=function(){this.setStep(OnboardingProgress.steps.names[1])};api.updateNavBar=function(navBar){var yep=this.inProgress();if(yep){navBar.leftAction(NavAction.menuIn);navBar.title(api.navbarTitle())}return yep};api.goCurrentStep=function(){var url=this.inProgress()?this.stepUrl():"dashboard";this.app.shell.go(url)};api.goNext=function goNext(){var url;if(this.isAtCurrentStep()){this.incrementStep();appModel.userProfile.saveOnboardingStep(this.stepName());url=this.isFinished()?"/onboardingSuccess":this.stepUrl()}else url=this.stepAfter(api.currentActivity()).stepUrl();this.app.shell.go(url,null,!0)};api.isAtCurrentStep=ko.computed(function(){return api.currentActivity()===api.stepName()});api.goIfEnabled=function(){this.inProgress()&&!api.isAtCurrentStep()&&api.app.shell.go(api.stepUrl());return this.inProgress()};var LOCAL_JOBTITLEID_KEY="onboardingJobTitleID",persistLocalJobTitleID=function(jobTitleID){return localforage.setItem(LOCAL_JOBTITLEID_KEY,jobTitleID)},getLocalJobTitleID=function(){return localforage.getItem(LOCAL_JOBTITLEID_KEY)};api.selectedJobTitleID.subscribe(persistLocalJobTitleID);api.recoverLocalJobTitleID=function(){return getLocalJobTitleID().then(function(id){api.selectedJobTitleID(id);return id})};return api}},{"../viewmodels/NavAction":382,"../viewmodels/OnboardingProgress":385,knockout:!1,localforage:!1}],203:[function(require,module,exports){"use strict";var OwnerAcknowledgment=require("../models/OwnerAcknowledgment"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:new OwnerAcknowledgment,ttl:{minutes:1},localStorageName:"ownerAcknowledgment",fetch:function fetch(){return appModel.rest.get("me/owner-acknowledgment")["catch"](function(err){if(!err||404!==err.status)throw err;rem.data.model.reset()})},push:function push(){throw{name:"Raw update of payment plan is not supported; use specialized methods"}}});appModel.on("clearLocalData",function(){rem.clearCache()});rem.acknowledge=function acknowledge(data){rem.isSaving(!0);return appModel.rest.post("me/owner-acknowledgment",data).then(function(serverData){rem.data.model.updateWith(serverData,!0);localforage.setItem(rem.localStorageName,serverData);rem.isSaving(!1)})["catch"](function(err){rem.isSaving(!1);throw err})};return rem}},{"../models/OwnerAcknowledgment":265,"../utils/RemoteModel":324,localforage:!1}],204:[function(require,module,exports){"use strict";var PaymentAccount=require("../models/PaymentAccount"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PaymentAccount,ttl:{minutes:1},localStorageName:"paymentAccount",fetch:function fetch(){return appModel.rest.get("me/payment-account")},push:function push(){return appModel.rest.put("me/payment-account",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/PaymentAccount":266,"../utils/RemoteModel":324}],205:[function(require,module,exports){"use strict";var PaymentPlan=require("../models/PaymentPlan"),ListRemoteModel=require("../utils/ListRemoteModel"),data=[{paymentPlanID:"",name:"Free",summary:"Always $0",description:require("../../html/parts/PaymentPlanFree.html")},{paymentPlanID:"OwnerGrowth",name:"Owner Growth",summary:"$19 charged once a month",description:require("../../html/parts/PaymentPlanGrowth.html")},{paymentPlanID:"OwnerPro",name:"Owner Pro",summary:"$39 charged once a month",description:require("../../html/parts/PaymentPlanPro.html")},{paymentPlanID:"OwnerProAnnual",name:"Owner Pro Annual",summary:"$390 charged once a year (Save $78 with this option)",description:require("../../html/parts/PaymentPlanProAnnual.html")}];exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"paymentPlanID",Model:PaymentPlan});appModel.on("clearLocalData",function(){});api.list=data;api.getList=function(){return Promise.resolve(api.list())};return api}},{"../../html/parts/PaymentPlanFree.html":106,"../../html/parts/PaymentPlanGrowth.html":107,"../../html/parts/PaymentPlanPro.html":108,"../../html/parts/PaymentPlanProAnnual.html":109,"../models/PaymentPlan":267,"../utils/ListRemoteModel":321}],206:[function(require,module,exports){"use strict";exports.create=function create(appModel){var api={},cache={};api.getItem=function getItem(postalCode){return cache.hasOwnProperty(postalCode)?Promise.resolve(cache[postalCode]):appModel.rest.get("postal-codes/"+postalCode).then(function(info){info&&(cache[postalCode]=info);return info})};appModel.on("clearLocalData",function(){cache={}});api.isValid=function(postalCode){return!/^\s*$/.test(postalCode)};api.updateAddressModel=function(addressObject,addressModel){addressModel.city&&addressModel.city(addressObject.city);addressModel.stateProvinceCode&&addressModel.stateProvinceCode(addressObject.stateProvinceCode);addressModel.stateProvinceName&&addressModel.stateProvinceName(addressObject.stateProvinceName)};api.emptyAddress={city:"",stateProvinceCode:"",stateProvinceName:""};return api}},{}],207:[function(require,module,exports){"use strict";var PricingType=require("../models/PricingType"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{days:1},itemIdField:"pricingTypeID",Model:PricingType});api.addLocalforageSupport("pricing-types");api.addRestSupport(appModel.rest,"pricing-types");appModel.on("clearLocalData",function(){api.clearCache()});api.getListByIDs=function(pricingTypeIDs){return api.getList().then(function(pricingTypes){return pricingTypes().filter(function(pricingType){return pricingTypeIDs.indexOf(pricingType.pricingTypeID())>-1})})};return api}},{"../models/PricingType":272,"../utils/ListRemoteModel":321}],208:[function(require,module,exports){"use strict";var PrivacySettings=require("../models/PrivacySettings"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new PrivacySettings,ttl:{minutes:1},localStorageName:"privacySettings",fetch:function fetch(){return appModel.rest.get("me/privacy-settings")},push:function push(){return appModel.rest.put("me/privacy-settings",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/PrivacySettings":273,"../utils/RemoteModel":324}],209:[function(require,module,exports){"use strict";var SchedulingPreferences=require("../models/SchedulingPreferences"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new SchedulingPreferences,ttl:{minutes:1},localStorageName:"schedulingPreferences",fetch:function fetch(){return appModel.rest.get("me/scheduling-preferences")},push:function push(){return appModel.rest.put("me/scheduling-preferences",this.data.model.toPlainObject()).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/SchedulingPreferences":285,"../utils/RemoteModel":324}],210:[function(require,module,exports){"use strict";var Address=require("../models/Address"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"addressID",Model:Address});api.addLocalforageSupport("addresses/service/");api.addRestSupport(appModel.rest,"me/addresses/service/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/Address":231,"../utils/GroupListRemoteModel":317}],211:[function(require,module,exports){"use strict";var UserJobTitleServiceAttributes=require("../models/UserJobTitleServiceAttributes"),GroupRemoteModel=require("../utils/GroupRemoteModel");exports.create=function create(appModel){var api=new GroupRemoteModel({ttl:{minutes:1},itemIdField:"jobTitleID",Model:UserJobTitleServiceAttributes});api.addLocalforageSupport("service-attributes/");api.addRestSupport(appModel.rest,"me/service-attributes/");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserJobTitleServiceAttributes":301,"../utils/GroupRemoteModel":318}],212:[function(require,module,exports){"use strict";var ServiceProfessionalService=require("../models/ServiceProfessionalService"),GroupListRemoteModel=require("../utils/GroupListRemoteModel");exports.create=function create(appModel){var api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"serviceProfessionalServiceID",Model:ServiceProfessionalService}),restUrlPrefix="me/service-professional-services/";api.addLocalforageSupport("service-professional-services/");api.addRestSupport(appModel.rest,restUrlPrefix);appModel.on("clearLocalData",function(){api.clearCache()});api.getItem=function(jobTitleID,serviceID){api.state.isLoading(!0);return appModel.rest.get(restUrlPrefix+jobTitleID+"/"+serviceID).then(function(data){api.state.isLoading(!1);return data})["catch"](function(err){api.state.isLoading(!1);throw err})};var baseSetItem=api.setItem.bind(api);api.setItem=function(item){return baseSetItem(item).then(function(serverObject){api.clearCache();return serverObject})};api.getClientSpecificServices=function(clientID){return appModel.rest.get(restUrlPrefix+"client/"+clientID)};api.getClientSpecificServicesForJobTitle=function(clientID,jobTitleID){return api.getClientSpecificServices(clientID).then(function(services){return services.filter(function(service){return service.jobTitleID==jobTitleID})})};api.getServicesBookableByProvider=function(clientID,jobTitleID){return appModel.rest.get(restUrlPrefix+jobTitleID+"/client/"+clientID)};return api}},{"../models/ServiceProfessionalService":291,"../utils/GroupListRemoteModel":317}],213:[function(require,module,exports){"use strict";var StateProvince=require("../models/StateProvince"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{years:1},itemIdField:"code",Model:StateProvince});api.addLocalforageSupport("states-provinces");api.addRestSupport(appModel.rest,"states-provinces");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/StateProvince":292,"../utils/ListRemoteModel":321}],214:[function(require,module,exports){"use strict";var UserFeePayment=require("../models/UserFeePayment"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"userFeePaymentID",Model:UserFeePayment});api.addLocalforageSupport("user-fee-payments");api.addRestSupport(appModel.rest,"me/fee-payments");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserFeePayment":299,"../utils/ListRemoteModel":321}],215:[function(require,module,exports){"use strict";var UserJobTitle=require("../models/UserJobTitle"),CacheControl=require("../utils/CacheControl"),localforage=require("localforage"),ko=require("knockout"),$=require("jquery");exports.create=function create(appModel){function mapToUserJobProfile(rawItems){cache.userJobProfile.list=[];cache.userJobTitles={};rawItems&&rawItems.forEach(function(rawItem){var m=new UserJobTitle(rawItem);m.isBeingDeleted=ko.observable(!1);cache.userJobProfile.list.push(m);setGetUserJobTitleToCache(rawItem)});api.list(cache.userJobProfile.list);cache.userJobProfile.cache.latest=new Date;return cache.userJobProfile.list}function getUserJobProfileFromLocal(){return localforage.getItem("userJobProfile").then(function(userJobProfile){return userJobProfile?mapToUserJobProfile(userJobProfile):null})}function deleteUserJobTitleFromCache(jobTitleID){delete cache.userJobTitles[jobTitleID];api.list.remove(function(j){return j.jobTitleID()===jobTitleID});cache.userJobProfile.cache.touch()}function setGetUserJobTitleToCache(rawItem){var c=cache.userJobTitles[rawItem.jobTitleID]||{};if(c.model)c.model.model.updateWith(rawItem);else{c.model=new UserJobTitle(rawItem);c.model.isBeingDeleted=ko.observable(!1)}c.cache?c.cache.latest=new Date:c.cache=new CacheControl({ttl:defaultTtl});var fullList=cache.userJobProfile.list;if(fullList){var found=null;fullList.some(function(it){if(it.jobTitleID()===rawItem.jobTitleID){found=it;return!0}});found?found.model.updateWith(rawItem):fullList.push(c.model)}return c.model}var api={},defaultTtl={minutes:1},cache={userJobProfile:{cache:new CacheControl({ttl:defaultTtl}),list:null},userJobTitles:{}};api.list=ko.observableArray([]);api.syncList=function syncList(){return api.getUserJobProfile().then(function(list){api.list(list);return list})};api.clearCache=function clearCache(){cache.userJobProfile.cache.latest=null;cache.userJobProfile.list=[];cache.userJobTitles={}};appModel.on("clearLocalData",function(){api.clearCache()});var fetchUserJobProfile=function(){return appModel.rest.get("me/user-job-profile").then(function(raw){localforage.setItem("userJobProfile",raw);return mapToUserJobProfile(raw)})},saveCacheToLocal=function(){var raw=cache.userJobProfile.list.map(function(j){return j.model.toPlainObject(!0)});localforage.setItem("userJobProfile",raw)};api.getUserJobProfile=function(){return cache.userJobProfile.cache.mustRevalidate()?cache.userJobProfile.list?fetchUserJobProfile():getUserJobProfileFromLocal().then(function(data){var remotePromise=fetchUserJobProfile();return data?data:remotePromise}):Promise.resolve(cache.userJobProfile.list)};var fetchUserJobTitle=function(jobTitleID){return appModel.rest.get("me/user-job-profile/"+jobTitleID).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})},pushNewUserJobTitle=function(values){return appModel.rest.post("me/user-job-profile",$.extend({jobTitleID:0,jobTitleName:"",intro:"",cancellationPolicyID:null,instantBooking:!1},values)).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.getUserJobTitle=function(jobTitleID){return jobTitleID?!cache.userJobTitles[jobTitleID]||cache.userJobTitles[jobTitleID].cache.mustRevalidate()?fetchUserJobTitle(jobTitleID):cache.userJobTitles[jobTitleID]&&cache.userJobTitles[jobTitleID].model?Promise.resolve(cache.userJobTitles[jobTitleID].model):getUserJobProfileFromLocal().then(function(){return cache.userJobTitles[jobTitleID].model})["catch"](fetchUserJobTitle.bind(null,jobTitleID)):Promise.reject("Job Title ID required")};api.setUserJobTitle=function(values){return appModel.rest.put("me/user-job-profile/"+values.jobTitleID,values).then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.createUserJobTitle=function(values){return pushNewUserJobTitle(values)};api.deactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/deactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.reactivateUserJobTitle=function(jobTitleID){return appModel.rest.post("me/user-job-profile/"+(0|jobTitleID)+"/reactivate").then(function(raw){var m=setGetUserJobTitleToCache(raw);return m})};api.deleteUserJobTitle=function(jobTitleID){var found=api.list().filter(function(j){j.jobTitleID()===jobTitleID&&j.isBeingDeleted(!0)});return appModel.rest["delete"]("me/user-job-profile/"+(0|jobTitleID)).then(function(){deleteUserJobTitleFromCache(jobTitleID);saveCacheToLocal();return null})["catch"](function(err){found.forEach(function(j){j.isBeingDeleted(!1)});throw err})};api.getUserJobTitleAndJobTitle=function getUserJobTitleAndJobTitle(jobTitleID){return api.getUserJobTitle(jobTitleID).then(function(userJobTitle){
if(!userJobTitle)throw{name:"Not Found",message:"We don't have a record of this job titleIt may have been recently deleted."};return Promise.all([userJobTitle,appModel.jobTitles.getJobTitle(jobTitleID)])}).then(function(all){var jobTitle=all[1];if(!jobTitle)throw{name:"Not Found",message:"The job title does not exist."};return{jobTitleID:jobTitleID,userJobTitle:all[0],jobTitle:jobTitle}})};api.getJobTitles=function(){return api.getUserJobProfile().then(function(list){return Promise.all(list.map(function(userJobTitle){return appModel.jobTitles.getJobTitle(userJobTitle.jobTitleID())}))})};return api}},{"../models/UserJobTitle":300,"../utils/CacheControl":310,jquery:!1,knockout:!1,localforage:!1}],216:[function(require,module,exports){"use strict";var UserLicenseCertification=require("../models/UserLicenseCertification"),GroupListRemoteModel=require("../utils/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),extend=require("jquery").extend,$=require("jquery");exports.create=function create(appModel){var baseUrl="me/licenses-certifications/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"userLicenseCertificationID",Model:UserLicenseCertification});api.addLocalforageSupport("userLicensesCertifications/");api.addRestSupport(appModel.rest,baseUrl);appModel.on("clearLocalData",function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.userLicenseCertificationID?Promise.reject("An image of the license/certification is required"):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:photoUploadFieldName,httpMethod:options.method,params:data,headers:extend(!0,{},appModel.rest.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName=photoUploadFieldName;fd.formData=Object.keys(data).filter(function(k){return!/^local/.test(k)}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},appModel.rest.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:appModel.rest.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")},after=function(serverData){api._pushItemToCache(serverData);return serverData};return photoTools.takePhotoSupported()?nativeUploadFile(data,options).then(after):webUploadFile(data,options).then(after)}.bind(api);return api}},{"../models/UserLicenseCertification":302,"../utils/GroupListRemoteModel":317,"../utils/photoTools":350,jquery:!1}],217:[function(require,module,exports){"use strict";var UserPaymentPlan=require("../models/UserPaymentPlan"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:new UserPaymentPlan,ttl:{minutes:1},localStorageName:"userPaymentPlan",fetch:function fetch(){return appModel.rest.get("me/payment-plan")},push:function push(){throw{name:"Raw update of payment plan is not supported; use specialized methods"}}});appModel.on("clearLocalData",function(){rem.clearCache()});rem.createSubscription=function createSubscription(data){rem.isSaving(!0);return appModel.rest.post("me/payment-plan",data).then(function(serverData){rem.data.model.updateWith(serverData,!0);localforage.setItem(rem.localStorageName,serverData);rem.isSaving(!1)})["catch"](function(err){rem.isSaving(!1);throw err})};return rem}},{"../models/UserPaymentPlan":303,"../utils/RemoteModel":324,localforage:!1}],218:[function(require,module,exports){"use strict";var User=require("../models/User"),RemoteModel=require("../utils/RemoteModel"),localforage=require("localforage");exports.create=function create(appModel){var rem=new RemoteModel({data:User.newAnonymous(),ttl:{minutes:1},localStorageName:"profile",fetch:function fetch(){return appModel.rest.get("me/profile")},push:function push(){return appModel.rest.put("me/profile",this.data.model.toPlainObject())}});appModel.on("clearLocalData",function(){rem.clearCache()});rem.saveOnboardingStep=function saveOnboardingStep(stepReference){"undefined"==typeof stepReference?stepReference=rem.data.onboardingStep():rem.data.onboardingStep(stepReference);return appModel.rest.put("me/profile/tracking",{onboardingStep:stepReference}).then(function(){localforage.setItem(rem.localStorageName,rem.data.model.toPlainObject())})};return rem}},{"../models/User":297,"../utils/RemoteModel":324,localforage:!1}],219:[function(require,module,exports){"use strict";var UserVerification=require("../models/UserVerification"),ListRemoteModel=require("../utils/ListRemoteModel");exports.create=function create(appModel){var api=new ListRemoteModel({listTtl:{minutes:10},itemIdField:"verificationID",Model:UserVerification});api.addLocalforageSupport("user-verifications");api.addRestSupport(appModel.rest,"me/verifications");appModel.on("clearLocalData",function(){api.clearCache()});return api}},{"../models/UserVerification":304,"../utils/ListRemoteModel":321}],220:[function(require,module,exports){"use strict";var GroupRemoteModel=require("../utils/GroupRemoteModel"),PublicUserProfile=require("../models/PublicUserProfile");exports.create=function create(appModel){var api={};api.getUser=function(userID,options){return appModel.rest.get("users/"+(0|userID),options)};var profile=new GroupRemoteModel({ttl:{minutes:10},Model:PublicUserProfile,itemIdField:"userID"});profile.addRestSupport(appModel.rest,"users/","/profile");profile.addLocalforageSupport("userProfiles/");api.getProfile=function(userID){return profile.getItem(userID)};api.getJobProfile=function(userID){return appModel.rest.get("users/"+(0|userID)+"/job-profile")};api.getJobTitle=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/job-profile/"+(0|jobTitleID))};var getRatings=function getRatings(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/ratings"+(modifier?"/"+modifier:""))};api.getUserRatings=getRatings.bind(api,null);api.getClientRatings=getRatings.bind(api,"client");api.getServiceProfessionalRatings=getRatings.bind(api,"service-professional");api.getJobTitleRatings=function(userID,jobTitleID){return getRatings(0|jobTitleID,userID)};api.getServiceAddresses=function(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-addresses/"+(0|jobTitleID))};api.getServiceProfessionalServices=function(serviceProfessionalUserID,jobTitleID){return appModel.rest.get("users/"+(0|serviceProfessionalUserID)+"/service-professional-services/"+(0|jobTitleID))};var getVerificationsSummary=function getVerificationsSummary(modifier,userID){return appModel.rest.get("users/"+(0|userID)+"/verifications-summary"+(modifier?"/"+modifier:""))};api.getUserVerificationsSummary=getVerificationsSummary.bind(api,null);api.getClientVerificationsSummary=getVerificationsSummary.bind(api,"client");api.getServiceProfessionalVerificationsSummary=getVerificationsSummary.bind(api,"service-professional");api.getJobTitleVerificationsSummary=function(userID,jobTitleID){return getVerificationsSummary(0|jobTitleID,userID)};api.getServiceAttributes=function getServiceAttributes(userID,jobTitleID){return appModel.rest.get("users/"+(0|userID)+"/service-attributes/"+(0|jobTitleID))};api.getReviews=function getReviews(userID,jobTitleID,options){return appModel.rest.get("users/"+(0|userID)+"/reviews"+(jobTitleID?"/"+(0|jobTitleID):""),options)};return api}},{"../models/PublicUserProfile":279,"../utils/GroupRemoteModel":318}],221:[function(require,module,exports){"use strict";var WeeklySchedule=require("../models/WeeklySchedule"),RemoteModel=require("../utils/RemoteModel");exports.create=function create(appModel){var rem=new RemoteModel({data:new WeeklySchedule,ttl:{minutes:1},localStorageName:"weeklySchedule",fetch:function fetch(){return appModel.rest.get("me/weekly-schedule")},push:function push(){return appModel.rest.put("me/weekly-schedule",this.data.model.toPlainObject(!0)).then(function(result){appModel.calendar.clearCache();return result})}});appModel.on("clearLocalData",function(){rem.clearCache()});return rem}},{"../models/WeeklySchedule":308,"../utils/RemoteModel":324}],222:[function(require,module,exports){"use strict";var WorkPhoto=require("../models/WorkPhoto"),GroupListRemoteModel=require("../utils/GroupListRemoteModel"),photoTools=require("../utils/photoTools"),extend=require("jquery").extend,$=require("jquery");exports.create=function create(appModel){var baseUrl="me/work-photos/",api=new GroupListRemoteModel({listTtl:{minutes:1},groupIdField:"jobTitleID",itemIdField:"workPhotoID",Model:WorkPhoto});api.addLocalforageSupport("workPhotos");api.addRestSupport(appModel.rest,baseUrl);appModel.on("clearLocalData",function(){api.clearCache()});var pushJustBasicDataToRemote=api.pushItemToRemote.bind(api),photoUploadFieldName="photo",pushWithoutFile=function(data){return 0===data.workPhotoID?Promise.resolve(null):pushJustBasicDataToRemote(data)},nativeUploadFile=function pushToRemote(data,options){if(data.localTempFilePath){var uploadSettings={fileKey:photoUploadFieldName,mimeType:"image/jpeg",httpMethod:options.method,params:data,headers:extend(!0,{},appModel.rest.extraHeaders)};return photoTools.uploadLocalFileJson(data.localTempFilePath,options.url,uploadSettings)}return pushWithoutFile(data)}.bind(api),webUploadFile=function(data,options){if(data.localTempFileData){var fd=data.localTempFileData;if(!fd)return Promise.resolve(null);fd.url=options.url;fd.type=options.method;fd.paramName=photoUploadFieldName;fd.formData=Object.keys(data).filter(function(k){return"localTempFileData"!==k&&"localTempPhotoPreview"!==k}).map(function(k){return{name:k,value:data[k]}});fd.headers=$.extend(!0,{},appModel.rest.extraHeaders);return Promise.resolve(fd.submit())}return pushWithoutFile(data)};api.pushItemToRemote=function(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],options={method:itemID?"put":"post",url:appModel.rest.baseUrl+baseUrl+groupID+(itemID?"/"+itemID:"")};return photoTools.takePhotoSupported()?nativeUploadFile(data,options):webUploadFile(data,options)}.bind(api);return api}},{"../models/WorkPhoto":309,"../utils/GroupListRemoteModel":317,"../utils/photoTools":350,jquery:!1}],223:[function(require,module,exports){"use strict";function Activity($activity,app){this.$activity=$activity;this.app=app;this.accessLevel=null;this.resetScroll=!0;this.viewState={};this.requestData=null;this.navBar=new NavBar({title:null,leftAction:null,rightAction:null})}var ko=require("knockout"),NavAction=require("../viewmodels/NavAction"),NavBar=require("../viewmodels/NavBar");require("../utils/Function.prototype._inherits");module.exports=Activity;Activity.prototype.show=function show(options){if(!this.__bindingDone){ko.applyBindings(this.viewModel||{},this.$activity.get(0));this.__bindingDone=!0}options=options||{};this.requestData=options;if(this._handlers&&this._handlersAreConnected!==!0){this._handlers.forEach(function(settings){if(!settings.event&&settings.target.subscribe){var subscription=settings.target.subscribe(settings.handler);settings._subscription=subscription;settings._latestSubscribedValue!==settings.target()&&settings.handler.call(settings.target,settings.target())}else settings.selector?settings.target.on(settings.event,settings.selector,settings.handler):settings.target.on?settings.target.on(settings.event,settings.handler):console.error("Activity.show: Bad registered handler",settings)});this._handlersAreConnected=!0}this.resetScroll&&this.$activity.scrollTop(0)};Activity.prototype.hide=function hide(){if(this._handlers){this._handlers.forEach(function(settings){if(settings._subscription){settings._subscription.dispose();settings._latestSubscribedValue=settings.target()}else settings.target.off?settings.selector?settings.target.off(settings.event,settings.selector,settings.handler):settings.target.off(settings.event,settings.handler):settings.target.removeListener?settings.target.removeListener(settings.event,settings.handler):console.error("Activity.hide: Bad registered handler",settings)});this._handlersAreConnected=!1}};Activity.prototype.registerHandler=function registerHandler(settings){if(!settings)throw new Error("Register require a settings object");if(!settings.target||!settings.target.on&&!settings.target.subscribe)throw new Error("Target is null or not a jQuery, EventEmmiter or Observable object");if("function"!=typeof settings.handler)throw new Error("Handler must be a function.");if(!settings.event&&!settings.target.subscribe)throw new Error("Event is null; it's required for non observable objects");this._handlers=this._handlers||[];this._handlers.push(settings)};Activity.NavBar=NavBar;Activity.NavAction=NavAction;Activity.createSectionNavBar=function createSectionNavBar(title){return new NavBar({title:title,leftAction:NavAction.menuIn,rightAction:NavAction.menuNewItem})};Activity.createSubsectionNavBar=function createSubsectionNavBar(title,options){options=options||{};var goBackOptions={text:title,isTitle:!0};if(options.backLink){goBackOptions.link=options.backLink;goBackOptions.isShell=!1}var helpLink=options.helpLink;if(helpLink){var del=helpLink.indexOf("?")>-1?"&":"?";helpLink+=del+"mustReturn=true&returnText="+encodeURIComponent(title)}var rightOptions=helpLink?NavAction.goHelpIndex.model.clone({link:helpLink,text:"Help"}):NavAction.goHelpIndex;return new NavBar({title:"",leftAction:NavAction.goBack.model.clone(goBackOptions),rightAction:rightOptions})};Activity.prototype.createCancelAction=function createCancelAction(cancelLink,state){var app=this.app,action=new NavAction({link:cancelLink,text:"Cancel",handler:function(event){var link=this.link(),eoptions=event&&event.options||{},goLink=function(){link?app.shell.go(link,state):app.shell.goBack(state)};eoptions.silentMode?goLink():app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){goLink()})}});return action};Activity.prototype.convertToCancelAction=function convertToCancelAction(actionModel,cancelLink){var cancel=this.createCancelAction(cancelLink);actionModel.model.updateWith(cancel);actionModel.handler(cancel.handler())};var singletonInstances={},createSingleton=function createSingleton(ActivityClass,$activity,app,name){var key=ActivityClass.name+"::"+(name||"");if(singletonInstances[key]instanceof ActivityClass)return singletonInstances[key];var s=new ActivityClass($activity,app);singletonInstances[key]=s;return s};Activity.extend=function extendsActivity(ClassFn){ClassFn._inherits(Activity);ClassFn.init=createSingleton.bind(null,ClassFn);return ClassFn}},{"../utils/Function.prototype._inherits":315,"../viewmodels/NavAction":382,"../viewmodels/NavBar":383,knockout:!1}],224:[function(require,module,exports){var $=require("jquery"),classes={component:"DatePicker",months:"DatePicker-months",days:"DatePicker-days",monthDay:"day",month:"month",year:"year",years:"DatePicker-years",weekDays:"DatePicker-weekDays",active:"active"},events={dayRendered:"dayRendered",dateChanged:"dateChanged",show:"show",hide:"hide",dateSet:"dateSet",viewDateChanged:"viewDateChanged"},DPGlobal={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10},{clsName:"day",navFnc:"Date",navStep:1}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","M","Tu","W","Th","F","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth:function(year,month){return[31,DPGlobal.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},parseFormat:function(format){var separator=format.match(/[.\/\-\s].*?/),parts=format.split(/\W+/);if(!separator||!parts||0===parts.length)throw new Error("Invalid date format.");return{separator:separator,parts:parts}},parseDate:function(date,format){var parts=date.split(format.separator),val;date=new Date;date.setHours(0);date.setMinutes(0);date.setSeconds(0);date.setMilliseconds(0);if(parts.length===format.parts.length){for(var year=date.getFullYear(),day=date.getDate(),month=date.getMonth(),i=0,cnt=format.parts.length;cnt>i;i++){val=parseInt(parts[i],10)||1;switch(format.parts[i]){case"dd":case"d":day=val;date.setDate(val);break;case"mm":case"m":month=val-1;date.setMonth(val-1);break;case"yy":year=2e3+val;date.setFullYear(2e3+val);break;case"yyyy":year=val;date.setFullYear(val)}}date=new Date(year,month,day,0,0,0)}return date},formatDate:function(date,format){var val={d:date.getDate(),m:date.getMonth()+1,yy:date.getFullYear().toString().substring(2),yyyy:date.getFullYear()};val.dd=(val.d<10?"0":"")+val.d;val.mm=(val.m<10?"0":"")+val.m;date=[];for(var i=0,cnt=format.parts.length;cnt>i;i++)date.push(val[format.parts[i]]);return date.join(format.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};DPGlobal.template='<div class="'+classes.component+'"><div class="'+classes.days+'"><table class=" table-condensed">'+DPGlobal.headTemplate+'<tbody></tbody></table></div><div class="'+classes.months+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+'</table></div><div class="'+classes.years+'"><table class="table-condensed">'+DPGlobal.headTemplate+DPGlobal.contTemplate+"</table></div></div>";DPGlobal.modesSet={date:DPGlobal.modes[3],month:DPGlobal.modes[0],year:DPGlobal.modes[1],decade:DPGlobal.modes[2]};var DatePicker=function(element,options){this.element=$(element);this.format=DPGlobal.parseFormat(options.format||this.element.data("date-format")||"mm/dd/yyyy");this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;this.isPlaceholder=this.element.is(".calendar-placeholder");this.picker=$(DPGlobal.template).appendTo(this.isPlaceholder?this.element:"body").on("click",$.proxy(this.click,this));this.picker.addClass(this.isPlaceholder?"":"dropdown-menu");options.extraClasses&&this.picker.addClass(options.extraClasses);for(var html="",r=0;6>r;r++){html+="<tr>";for(var c=0;7>c;c++)html+='<td class="'+classes.monthDay+'"><span>&nbsp;</span></td>';html+="</tr>"}this.picker.find("."+classes.days+" tbody").append(html);html="";for(var yearCont=this.picker.find("."+classes.years+" td"),i=-1;11>i;i++)html+='<span class="'+classes.year+(-1===i||10===i?" old":"")+'"></span>';yearCont.html(html);if(this.isPlaceholder){this.picker.show();if("today"==this.element.data("date")){this.date=new Date;this.set()}this.element.trigger({type:events.show,date:this.date})}else this.isInput?this.element.on({focus:$.proxy(this.show,this),keyup:$.proxy(this.update,this)}):this.component?this.component.on("click",$.proxy(this.show,this)):this.element.on("click",$.proxy(this.show,this));this.element.on("swipeleft",function(e){e.preventDefault();this.moveDate("next")}.bind(this)).on("swiperight",function(e){e.preventDefault();this.moveDate("prev")}.bind(this));this.minViewMode=options.minViewMode||this.element.data("date-minviewmode")||0;if("string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=options.viewMode||this.element.data("date-viewmode")||0;if("string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;this.weekStart=options.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=options.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};DatePicker.prototype={constructor:DatePicker,_triggerViewDateChange:function(){var viewModeName=DPGlobal.modes[this.viewMode].clsName;this.element.trigger(events.viewDateChanged,[{viewDate:this.viewDate,viewMode:viewModeName}])},show:function(e){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();$(window).off("resize.datepicker").on("resize.datepicker",$.proxy(this.place,this));if(e){e.stopPropagation();e.preventDefault()}!this.isInput;var that=this;$(document).off("mousedown.datepicker").on("mousedown.datepicker",function(ev){0===$(ev.target).closest("."+classes.component).length&&that.hide()});this.element.trigger({type:events.show,date:this.date})},hide:function(){this.picker.hide();$(window).off("resize.datepicker",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||$(document).off("mousedown.datepicker",this.hide);this.element.trigger({type:events.hide,date:this.date})},set:function(){var formated=DPGlobal.formatDate(this.date,this.format);if(this.isInput)this.element.prop("value",formated);else{this.component&&this.element.find("input").prop("value",formated);this.element.data("date",formated)}this.element.trigger(events.dateSet,[this.date,formated])},setValue:function(newDate,dontNotify){"string"==typeof newDate?this.date=DPGlobal.parseDate(newDate,this.format):this.date=new Date(newDate);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange();dontNotify!==!0&&this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})},getValue:function(){return this.date},getViewDate:function(){return this.viewDate},moveValue:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode?DPGlobal.modesSet[mode]:DPGlobal.modes[this.viewMode];this.date["set"+mode.navFnc].call(this.date,this.date["get"+mode.navFnc].call(this.date)+mode.navStep*("prev"===dir?-1:1));this.setValue(this.date);return this.date}},place:function(){var offset=this.component?this.component.offset():this.element.offset();this.picker.css({top:offset.top+this.height,left:offset.left})},update:function(newDate){this.date=DPGlobal.parseDate("string"==typeof newDate?newDate:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill();this._triggerViewDateChange()},getDaysElements:function(){return this.picker.find("."+classes.days+" ."+classes.monthDay)},fillDow:function(){for(var dowCnt=this.weekStart,html='<tr class="'+classes.weekDays+'">';dowCnt<this.weekStart+7;)html+='<th class="dow">'+DPGlobal.dates.daysMin[dowCnt++%7]+"</th>";html+="</tr>";this.picker.find("."+classes.days+" thead").append(html)},fillMonths:function(){for(var html="",i=0;12>i;)html+='<span class="'+classes.month+'">'+DPGlobal.dates.monthsShort[i++]+"</span>";this.picker.find("."+classes.months+" td").append(html)},fill:function(){var d=new Date(this.viewDate),year=d.getFullYear(),month=d.getMonth(),currentDate=this.date.valueOf(),prevMonth=new Date(year,month-1,28,0,0,0,0),lastDayPrevMonth=DPGlobal.getDaysInMonth(prevMonth.getFullYear(),prevMonth.getMonth());prevMonth.setDate(lastDayPrevMonth);prevMonth.setDate(lastDayPrevMonth-(prevMonth.getDay()-this.weekStart+7)%7);if(this._prevDate&&this._prevDate.getMonth()===this.viewDate.getMonth()){var tbody=this.picker.find("."+classes.days+" tbody");tbody.find("."+classes.monthDay+"."+classes.active).removeClass(classes.active);var diff=lastDayPrevMonth-prevMonth.getDate(),index=diff+this.date.getDate(),irow=index/7|0,icol=index%7;tbody.find("tr:eq("+irow+") td:eq("+icol+")").addClass(classes.active);this._prevDate=new Date(this.viewDate)}else{this._prevDate=new Date(this.viewDate);this.picker.find("."+classes.days+" th:eq(1)").html(DPGlobal.dates.months[month]+" "+year);var nextMonth=new Date(prevMonth);nextMonth.setDate(nextMonth.getDate()+42);nextMonth=nextMonth.valueOf();for(var clsName,prevY,prevM,weekTr=this.picker.find("."+classes.days+" tbody tr:first-child()"),dayTd=null;prevMonth.valueOf()<nextMonth;){var currentWeekDayIndex=prevMonth.getDay()-this.weekStart;clsName=this.onRender(prevMonth);prevY=prevMonth.getFullYear();prevM=prevMonth.getMonth();month>prevM&&prevY===year||year>prevY?clsName+=" old":(prevM>month&&prevY===year||prevY>year)&&(clsName+=" new");prevMonth.valueOf()===currentDate&&(clsName+=" "+classes.active);dayTd=weekTr.find("td:eq("+currentWeekDayIndex+")");dayTd.attr("class",classes.monthDay+" "+clsName).data("date-time",prevMonth.toISOString()).children("span").text(prevMonth.getDate());this.picker.trigger(events.dayRendered,[dayTd]);prevMonth.getDay()===this.weekEnd&&(weekTr=weekTr.next("tr"));prevMonth.setDate(prevMonth.getDate()+1)}}var currentYear=this.date.getFullYear(),months=this.picker.find("."+classes.months).find("th:eq(1)").html(year).end().find("span").removeClass(classes.active);currentYear===year&&months.eq(this.date.getMonth()).addClass(classes.active);year=10*parseInt(year/10,10);var yearCont=this.picker.find("."+classes.years).find("th:eq(1)").text(year+"-"+(year+9)).end().find("td");year-=1;var i,yearSpan=yearCont.find("span:first-child()");for(i=-1;11>i;i++){yearSpan.text(year).attr("class",classes.year+(-1===i||10===i?" old":"")+(currentYear===year?" "+classes.active:""));year+=1;yearSpan=yearSpan.next()}},moveDate:function(dir,mode){if(-1!=["prev","next"].indexOf(dir&&dir.toLowerCase())){mode=mode||this.viewMode;this.viewDate["set"+DPGlobal.modes[mode].navFnc].call(this.viewDate,this.viewDate["get"+DPGlobal.modes[mode].navFnc].call(this.viewDate)+DPGlobal.modes[mode].navStep*("prev"===dir?-1:1));this.fill();this._triggerViewDateChange();this.set()}},click:function(e){e.stopPropagation();e.preventDefault();var target=$(e.target).closest("span.month, span.year, td, th");if(1===target.length){var month,year,completeMonthYear=function completeMonthYear(){if(0!==this.viewMode){this.date=new Date(this.viewDate);this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}this.showMode(-1);this.fill();this.set()}.bind(this);if(target.hasClass("switch"))this.showMode(1);else if(target.hasClass("prev")||target.hasClass("next"))this.moveDate(target[0].className);else if(target.hasClass(classes.month)){month=target.parent().find("span").index(target);this.viewDate.setMonth(month);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.year)){year=parseInt(target.text(),10)||0;this.viewDate.setFullYear(year);completeMonthYear();this._triggerViewDateChange()}else if(target.hasClass(classes.monthDay)&&!target.is(".disabled")){var day=parseInt(target.text(),10)||1;month=this.viewDate.getMonth();month+=target.hasClass("old")?-1:target.hasClass("new")?1:0;year=this.viewDate.getFullYear();this.date=new Date(year,month,day,0,0,0,0);this.viewDate=new Date(year,month,Math.min(28,day),0,0,0,0);this.fill();this._triggerViewDateChange();this.set();this.element.trigger({type:events.dateChanged,date:this.date,viewMode:DPGlobal.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation();e.preventDefault()},showMode:function(dir){dir&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+dir)));this.picker.find(">div").hide().filter("."+classes.component+"-"+DPGlobal.modes[this.viewMode].clsName).show()}};$.fn.datepicker=function(option){var vals=Array.prototype.slice.call(arguments,1),returned;this.each(function(){var $this=$(this),data=$this.data("datepicker"),options="object"==typeof option&&option;data||$this.data("datepicker",data=new DatePicker(this,$.extend({},$.fn.datepicker.defaults,options)));if("string"==typeof option){returned=data[option].apply(data,vals);if("undefined"!=typeof returned)return!1}});return"undefined"!=typeof returned?returned:this};$.fn.datepicker.defaults={onRender:function(){return""}};$.fn.datepicker.Constructor=DatePicker;exports.DatePicker=DatePicker;exports.defaults=DPGlobal;exports.utils=DPGlobal},{jquery:!1}],225:[function(require,module,exports){var $=require("jquery"),ko=require("knockout"),MessageBar=function(params,element,templateNodes){this._$component=$(element);this._$messageBarSpacer=$(".MessageBarSpacer",this._$component);this._$messageBar=$("<div>",{"class":"MessageBar",html:"<!-- ko template: { nodes: templateNodes, data: params } --><!-- /ko -->"});this._$parts=this._$messageBarSpacer.add(this._$messageBar);this.templateNodes=templateNodes;this.params=params;this.params.visible=this.params.visible||ko.observable(!0);this.params.tone=this.params.tone||ko.observable(MessageBar.tones.neutral);this._subscriptions=[];this._subscriptions.push(this.params.visible.subscribe(this.setVisible,this));this.setVisible(this.params.visible());this._subscriptions.push(this.params.tone.subscribe(this.setTone,this));this.setTone(this.params.tone());ko.applyBindings(this,this._$messageBar.get(0))};MessageBar.template='<div class="MessageBarSpacer"></div>';MessageBar.tones={neutral:{"class":""},warning:{"class":"MessageBar--warning"},success:{"class":"MessageBar--success"}};var clearToneClasses=function($messageBar){for(var tone in MessageBar.tones)$messageBar.removeClass(MessageBar.tones[tone]["class"])};MessageBar.prototype.dispose=function(){this._subscriptions.forEach(function(subscription){subscription.dispose()});this._$messageBar.remove()};MessageBar.prototype.setTone=function(tone){clearToneClasses(this._$messageBar);this._$messageBar.addClass(tone["class"])};MessageBar.prototype.setVisible=function(isVisible){isVisible?this.show():this.hide()};MessageBar.prototype.show=function(){$("body").append(this._$messageBar);this._$parts.show()};MessageBar.prototype.hide=function(){this._$parts.hide();this._$messageBar.detach()};module.exports=MessageBar},{jquery:!1,knockout:!1}],226:[function(require,module,exports){var $=require("jquery"),clearNode=function(node){for(;node.firstChild;)node.removeChild(node.firstChild)},textboxResize=function textboxResize(el){var leftbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.left")[0],rightbtn=el.parentNode.querySelectorAll(".SmartNavBar-edge.right")[0];"undefined"==typeof leftbtn&&(leftbtn={offsetWidth:0,className:""});"undefined"==typeof rightbtn&&(rightbtn={offsetWidth:0,className:""});var margin=Math.max(leftbtn.offsetWidth,rightbtn.offsetWidth);el.style.marginLeft=margin+"px";el.style.marginRight=margin+"px";var tooLong=el.offsetWidth<el.scrollWidth?!0:!1;if(tooLong){if(leftbtn.offsetWidth<rightbtn.offsetWidth){el.style.marginLeft=leftbtn.offsetWidth+"px";el.style.textAlign="right"}else{el.style.marginRight=rightbtn.offsetWidth+"px";el.style.textAlign="left"}tooLong=el.offsetWidth<el.scrollWidth?!0:!1;if(tooLong){if(new RegExp("arrow").test(leftbtn.className)){clearNode(leftbtn.childNodes[1]);el.style.marginLeft="26px"}if(new RegExp("arrow").test(rightbtn.className)){clearNode(rightbtn.childNodes[1]);el.style.marginRight="26px"}}}};exports.textboxResize=textboxResize;var SmartNavBar=function SmartNavBar(el){this.el=el;this.refresh=function refresh(){var h=$(el).children("h1").get(0);h&&textboxResize(h)};this.refresh()};exports.SmartNavBar=SmartNavBar;exports.getAll=function getAll(){var all=$(".SmartNavBar");return $.map(all,function(item){return new SmartNavBar(item)})};exports.refreshAll=function refreshAll(){$(".SmartNavBar > h1").each(function(){
textboxResize(this)})}},{jquery:!1}],227:[function(require,module,exports){"use strict";var moment=require("moment"),current=moment.locale();moment.locale("en-US-LC",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"[last] dddd",nextWeek:"dddd",sameElse:"M/D"},longDateFormat:{LT:"h:mma",LTS:"h:mm:ssa",L:"MM/DD/YYYY",l:"M/D/YYYY",LL:"MMMM Do YYYY",ll:"MMM D YYYY",LLL:"MMMM Do YYYY LT",lll:"MMM D YYYY LT",LLLL:"dddd, MMMM Do YYYY LT",llll:"ddd, MMM D YYYY LT"}});moment.locale(current)},{moment:!1}],228:[function(require,module,exports){"use strict";var $=require("jquery");exports.show=function showAnnouncementModal(options){var modal=$("#announcementModal"),primaryBtn=modal.find("#announcementModal-primaryBtn"),secondaryBtn=modal.find("#announcementModal-secondaryBtn"),body=modal.find("#announcementModal-body");options=options||{};var msg=options.message||body.data("default-text");body.multiline(msg);primaryBtn.text(options.primaryButtonText||primaryBtn.data("default-text"));primaryBtn.attr("href",options.primaryButtonLink||"#");secondaryBtn.toggle(!!options.secondaryButtonText);secondaryBtn.text(options.secondaryButtonText);secondaryBtn.attr("href",options.secondaryButtonLink||"#");return new Promise(function(resolve){modal.off("hide.bs.modal").one("hide.bs.modal",function(){resolve()});modal.modal("show")})}},{jquery:!1}],229:[function(require,module,exports){"use strict";function TextEditorModel(){this.title=ko.observable("");this.text=ko.observable("")}var ko=require("knockout"),$=require("jquery");exports.show=function showTextEditor(options){var modal=$("#textEditorModal"),vm=modal.data("viewmodel");if(!vm){vm=new TextEditorModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"");vm.text(options.text||"");return new Promise(function(resolve,reject){var save=function(){resolve(vm.text());modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject.bind(null,null));modal.off("click","#textEditorModal-save");modal.on("click","#textEditorModal-save",save);modal.one("shown.bs.modal",function(){setTimeout(function(){var $text=modal.find("textarea");$text.focus();$text.click();window.scrollTo(0,0)},100)});modal.modal("show")})}},{jquery:!1,knockout:!1}],230:[function(require,module,exports){"use strict";function twoDigits(n){return Math.floor(n/10)+""+n%10}function TimePickerModel(){var vm={title:ko.observable(""),pickedHour:ko.observable(null),pickedMinute:ko.observable(null),pickedAmpm:ko.observable(null),stepInMinutes:ko.observable(5),unsetLabel:ko.observable("Remove"),selectLabel:ko.observable("Select")};vm.locale=ko.observable({lang:"en",region:"US"});vm.hourValues=ko.computed(function(){var region=this.locale().region,step=this.stepInMinutes()/60|0;0>=step&&(step=1);var values=[],i;if("US"===region){values.push({value:0,label:12});for(i=1;12>i;i+=step)values.push({value:i,label:i})}else for(i=0;24>i;i+=step)values.push({value:i,label:i});return values},vm);vm.minuteValues=ko.computed(function(){var step=0|this.stepInMinutes();0>=step&&(step=1);if(step>=60)return[];for(var values=[],i=0;60>i;i+=step)values.push({value:i,label:twoDigits(i)});return values},vm);vm.ampmValues=ko.computed(function(){var region=this.locale().region,values=[];if("US"===region){values.push({value:0,label:"AM"});values.push({value:12,label:"PM"})}return values},vm);vm.selectedTime=ko.computed({read:function(){return{hours:this.pickedHour()+this.pickedAmpm(),minutes:this.pickedMinute(),seconds:0}},write:function(v){if("object"!=typeof v)throw new Error("Invalid input for the time picker. Value:",v);v=v||{};var region=this.locale().region;if("US"===region){this.pickedHour(v.hours/12|0);this.pickedMinute(0|v.minutes);this.pickedAmpm(v.hours%12|0)}else{this.pickedHour(0|v.hours);this.pickedMinute(0|v.minutes);this.pickedAmpm(0)}},owner:vm});vm.selectedTimeString=ko.computed({read:function(){var t=this.selectedTime();return twoDigits(t.hours)+":"+twoDigits(t.minutes)+":"+twoDigits(t.seconds)},write:function(v){v=v||"";var parts=v.split(":");this.selectedTime({hours:0|parts[0],minutes:0|parts[1],seconds:0|parts[2]})},owner:vm});return vm}var ko=require("knockout"),$=require("jquery");exports.show=function showTimePicker(options){var modal=$("#timePickerModal"),vm=modal.data("viewmodel");if(!vm){vm=new TimePickerModel;ko.applyBindings(vm,modal.get(0));modal.data("viewmodel",vm)}options=options||{};vm.title(options.title||"Select time");vm.stepInMinutes(options.stepInMinutes||5);"string"==typeof options.selectedTime?vm.selectedTimeString(options.selectedTime):vm.selectedTime(options.selectedTime||{});vm.unsetLabel(options.unsetLabel||"Remove");vm.selectLabel(options.selectLabel||"Select");return new Promise(function(resolve,reject){var unset=function(){resolve(null);modal.modal("hide")},select=function(){resolve({time:vm.selectedTime(),timeString:vm.selectedTimeString()});modal.modal("hide")};modal.off("hide.bs.modal");modal.on("hide.bs.modal",reject);modal.off("click",".timePickerModal-unset");modal.on("click",".timePickerModal-unset",unset);modal.off("click",".timePickerModal-select");modal.on("click",".timePickerModal-select",select);modal.modal("show")})}},{jquery:!1,knockout:!1}],231:[function(require,module,exports){"use strict";function Address(values){Model(this);this.model.defProperties({addressID:0,addressName:"",jobTitleID:0,userID:0,addressLine1:null,addressLine2:null,postalCode:null,city:null,stateProvinceCode:null,stateProvinceName:null,countryCode:null,latitude:null,longitude:null,specialInstructions:null,isServiceArea:!1,isServiceLocation:!1,serviceRadius:0,createdDate:null,updatedDate:null,kind:""},values);var joinList=function(list,separator){return list.filter(function(v){return!!v}).join(separator)};this.singleLine=ko.computed(function(){return joinList([this.addressLine1(),this.city(),this.postalCode(),this.stateProvinceCode()],", ")},this);this.singleLineDetailed=ko.pureComputed(function(){var r=this.addressLine1()||"";r&&(r+=" ");r+=this.addressLine2()||"";r&&(r+=" - ");r+=this.city()||"";r&&(r+=" ");this.stateProvinceCode()&&(r+="("+this.stateProvinceCode()+") ");r+=this.postalCode()||"";r+=this.specialInstructions()?" ("+this.specialInstructions()+")":"";return r},this);this.addressLine=ko.computed(function(){return joinList([this.addressLine1(),this.addressLine2()],", ")},this);this.cityState=ko.computed(function(){return joinList([this.city(),this.stateProvinceCode()],", ")},this);this.cityStateLine=ko.computed(function(){return joinList([this.city(),this.stateProvinceCode(),this.postalCode()],", ")},this);var countries={US:"United States",ES:"Spain"};this.countryName=ko.computed(function(){return countries[this.countryCode()]||"unknow"},this);this.latlng=ko.computed(function(){return{lat:this.latitude(),lng:this.longitude()}},this)}var ko=require("knockout"),Model=require("./Model");module.exports=Address;Address.kind={home:"home",billing:"billing",service:"service"}},{"./Model":264,knockout:!1}],232:[function(require,module,exports){"use strict";function Appointment(values){Model(this);this.model.defProperties({id:null,startTime:null,endTime:null,summary:"New booking",description:null,isAllDay:!1,price:0,clientUserID:null,pricing:{Model:PricingSummaryDetail,isArray:!0},address:new Address,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,jobTitleID:0,readOnly:!1,sourceEvent:{Model:CalendarEvent,defaultValue:null},sourceBooking:{Model:Booking,defaultValue:null}},values);this.address.subscribe(function(val){val||this.address(new Address)}.bind(this));this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this);this.itStarted=ko.pureComputed(function(){return this.startTime()&&new Date>=this.startTime()},this);this.itEnded=ko.pureComputed(function(){return this.endTime()&&new Date>=this.endTime()},this);this.isNew=ko.pureComputed(function(){return!this.id()},this);this.stateHeader=ko.pureComputed(function(){var text="";this.id()>0&&this.sourceEvent()&&(text=this.sourceBooking()?this.sourceBooking().bookingStatusID()===Booking.status.request?"Accept/Decline booking request":this.sourceBooking().bookingStatusID()===Booking.status.denied?"Denied":this.sourceBooking().bookingStatusID()===Booking.status.cancelled?"Cancelled":this.itStarted()?this.itEnded()?"Completed":"Now":"Upcoming":"Calendar block");return text},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PricingSummaryDetail=require("./PricingSummaryDetail"),CalendarEvent=require("./CalendarEvent"),Booking=require("./Booking"),Address=require("./Address");module.exports=Appointment;Appointment.fromCalendarEvent=function fromCalendarEvent(event){var apt=new Appointment;apt.id(event.calendarEventID());apt.startTime(event.startTime());apt.endTime(event.endTime());apt.summary(event.summary());apt.description(event.description());apt.isAllDay(event.isAllDay());apt.readOnly(event.readOnly());apt.sourceEvent(event);return apt};Appointment.fromBooking=function fromBooking(booking,event){event||(event=new CalendarEvent({calendarEventID:booking.serviceDateID(),startTime:booking.serviceDate().startTime(),endTime:booking.serviceDate().endTime(),readOnly:!0}));var apt=Appointment.fromCalendarEvent(event);apt.clientUserID(booking.clientUserID());apt.address().addressID(booking.serviceAddressID());booking.serviceAddress()?apt.address().model.updateWith(booking.serviceAddress(),!0):apt.address(null);apt.jobTitleID(booking.jobTitleID());apt.pricing(booking.pricingSummary()&&booking.pricingSummary().details());apt.preNotesToClient(booking.preNotesToClient());apt.postNotesToClient(booking.postNotesToClient());apt.preNotesToSelf(booking.preNotesToSelf());apt.postNotesToSelf(booking.postNotesToSelf());apt.readOnly(!1);var prices=booking.pricingSummary();prices&&apt.price(prices.totalPrice());apt.sourceBooking(booking);return apt};Appointment.listFromCalendarEventsBookings=function listFromCalendarEventsBookings(events,bookings){return events.map(function(event){var booking=null;bookings.some(function(searchBooking){var found=searchBooking.serviceDateID()===event.calendarEventID()||searchBooking.alternativeDate1ID()===event.calendarEventID()||searchBooking.alternativeDate2ID()===event.calendarEventID();if(found){booking=searchBooking;return!0}});return booking?Appointment.fromBooking(booking,event):Appointment.fromCalendarEvent(event)})};Appointment.specialIds={loading:0,emptyDate:-1,free:-2,newEvent:-3,newBooking:-4,unavailable:-5,preparationTime:-6};var Time=require("../utils/Time");Appointment.newFreeSlot=function newFreeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.free,startTime:start,endTime:end,summary:options.text||"Free",description:null})};Appointment.newUnavailableSlot=function newUnavailableSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.unavailable,startTime:start,endTime:end,summary:options.text||"Unavailable",description:null})};Appointment.newPreparationTimeSlot=function newPreparationTimeSlot(options){var start=options.start||new Time(options.date,0,0,0),end=options.end||new Time(options.date,0,0,0);return new Appointment({id:Appointment.specialIds.preparationTime,startTime:start,endTime:end,summary:options.text||"Preparation time",description:null})}},{"../utils/Time":327,"./Address":231,"./Booking":234,"./CalendarEvent":236,"./Model":264,"./PricingSummaryDetail":271,knockout:!1,moment:!1}],233:[function(require,module,exports){"use strict";var Booking=require("./Booking");module.exports=Booking;var PricingSummary=require("./PricingSummary.editable");Booking.editable=function(obj){var booking;booking=obj&&obj instanceof Booking?obj:new Booking(obj&&obj.model&&obj.model.toPlainObject?obj.model.toPlainObject(!0):obj);PricingSummary.editable(booking.pricingSummary());booking.connectToSelectableServicesView=function(serviceProfessionalServices){this.pricingSummary().connectToSelectableServicesView(serviceProfessionalServices)}}},{"./Booking":234,"./PricingSummary.editable":269}],234:[function(require,module,exports){"use strict";function Booking(values){Model(this);this.model.defProperties({bookingID:0,clientUserID:0,serviceProfessionalUserID:0,jobTitleID:0,languageID:0,countryID:0,bookingStatusID:0,bookingTypeID:0,cancellationPolicyID:0,parentBookingID:null,serviceAddressID:null,serviceDateID:null,alternativeDate1ID:null,alternativeDate2ID:null,pricingSummaryID:0,pricingSummaryRevision:0,paymentLastFourCardNumberDigits:null,totalPricePaidByClient:null,totalServiceFeesPaidByClient:null,totalPaidToServiceProfessional:null,totalServiceFeesPaidByServiceProfessional:null,instantBooking:!1,firstTimeBooking:!1,sendReminder:!1,sendPromotional:!1,recurrent:!1,multiSession:!1,pricingAdjustmentApplied:!1,paymentEnabled:!1,paymentCollected:!1,paymentAuthorized:!1,awaitingResponseFromUserID:null,pricingAdjustmentRequested:!1,updatedDate:null,specialRequests:null,preNotesToClient:null,postNotesToClient:null,preNotesToSelf:null,postNotesToSelf:null,reviewedByServiceProfessional:!1,reviewedByClient:!1,pricingSummary:new PricingSummary,serviceAddress:{Model:Address},serviceDate:{Model:EventDates},alternativeDate1:{Model:EventDates},alternativeDate2:{Model:EventDates},userJobTitle:{Model:PublicUserJobTitle}},values);this.canBeCancelledByServiceProfessional=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.confirmed&&this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.canBeCancelledByClient=ko.pureComputed(function(){return(this.bookingStatusID()===Booking.status.confirmed||this.bookingStatusID()===Booking.status.request)&&this.bookingTypeID()!==Booking.type.serviceProfessionalBooking},this);this.canBeDeclinedByClient=ko.pureComputed(function(){return(this.bookingStatusID()===Booking.status.confirmed||this.bookingStatusID()===Booking.status.request)&&this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.canBeDeclinedByServiceProfessional=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.request&&this.bookingTypeID()!==Booking.type.serviceProfessionalBooking},this);this.isRequest=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.request},this);this.isConfirmed=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.confirmed},this);this.isCompleted=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.completed},this);this.isIncomplete=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.incomplete},this);this.isPerformed=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.servicePerformed},this);this.isDispute=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.dispute},this);this.isCancelled=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.cancelled},this);this.isDenied=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.denied},this);this.isExpired=ko.pureComputed(function(){return this.bookingStatusID()===Booking.status.requestExpired},this);var finalStatuses=[Booking.status.cancelled,Booking.status.denied,Booking.status.requestExpired,Booking.status.completed];this.isClosed=ko.pureComputed(function(){return finalStatuses.indexOf(this.bookingStatusID())>-1},this);this.isServiceProfessionalBooking=ko.pureComputed(function(){return this.bookingTypeID()===Booking.type.serviceProfessionalBooking},this);this.displayedDate=ko.pureComputed(function(){return moment(this.serviceDate().startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.serviceDate().startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.serviceDate().endTime()).locale("en-US-LC").format("LT")},this);this.servicesSummary=ko.pureComputed(function(){return this.pricingSummary().servicesSummary()},this);this.displayPaymentAuthorizedLabel=ko.pureComputed(function(){return this.paymentAuthorized()&&!this.isCompleted()},this);this.displayPaymentCollectedLabel=ko.pureComputed(function(){return this.paymentCollected()&&!this.paymentAuthorized()},this);this.displayPaymentPaidLabel=ko.pureComputed(function(){return this.paymentEnabled()&&this.isCompleted()},this);this.bookingStatusLabel=ko.pureComputed(function(){var n=Enum.name(Booking.status,this.bookingStatusID());return statusLabels[n]||""},this)}var ko=require("knockout"),Model=require("./Model"),PricingSummary=require("./PricingSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),Address=require("./Address"),moment=require("moment"),EventDates=require("./EventDates"),statusLabels={incomplete:"This booking was never completed",request:"Booking request not yet confirmed",cancelled:"This booking has been cancelled",denied:"This booking has been cancelled",requestExpired:"This booking request expired",confirmed:"This booking is confirmed",servicePerformed:"Services have been performed",completed:"This booking has been completed",dispute:"We'll be in touch shortly"},Enum=require("../utils/Enum");module.exports=Booking;Booking.from=function from(data){return Array.isArray(data)?data.map(Booking.from):new Booking(data)};Booking.status={incomplete:1,request:2,cancelled:3,denied:4,requestExpired:5,confirmed:6,servicePerformed:7,completed:8,dispute:9};Booking.type={marketplaceBooking:1,bookNowBooking:2,serviceProfessionalBooking:3,exchangeBooking:4,partnerBooking:5}},{"../utils/Enum":312,"./Address":231,"./EventDates":242,"./Model":264,"./PricingSummary":270,"./PublicUserJobTitle":277,knockout:!1,moment:!1}],235:[function(require,module,exports){"use strict";function BookingSummary(values){Model(this);this.model.defProperties({quantity:0,concept:"",time:{isDate:!0},timeFormat:" [@] h:mma"},values);this.timePhrase=ko.pureComputed(function(){return this.timeFormat()&&this.time()&&moment(this.time()).format(this.timeFormat())||""},this);this.phrase=ko.pureComputed(function(){return this.concept()+this.timePhrase()},this);this.url=ko.pureComputed(function(){var url=this.time()&&"/calendar/"+this.time().toISOString();return url},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment");module.exports=BookingSummary},{"./Model":264,knockout:!1,moment:!1}],236:[function(require,module,exports){"use strict";function RecurrenceRule(values){Model(this);this.model.defProperties({frequencyTypeID:0,interval:1,until:null,count:null,ending:null,selectedWeekDays:[],monthlyWeekDay:!1,incompatible:!1,tooMany:!1},values)}function RecurrenceOccurrence(values){Model(this);this.model.defProperties({startTime:null,endTime:null},values)}function CalendarEvent(values){Model(this);if(values){values.startTime=values.startTime&&new Date(Date.parse(values.startTime))||null;values.endTime=values.endTime&&new Date(Date.parse(values.endTime))||null}this.model.defProperties({calendarEventID:0,userID:0,eventTypeID:3,summary:"",availabilityTypeID:0,startTime:null,endTime:null,kind:0,isAllDay:!1,timeZone:"Z",location:null,updatedDate:null,createdDate:null,description:"",readOnly:!1,recurrenceRule:{Model:RecurrenceRule},recurrenceOccurrences:{isArray:!0,Model:RecurrenceOccurrence}},values)}var Model=require("./Model");module.exports=CalendarEvent;CalendarEvent.RecurrenceRule=RecurrenceRule;CalendarEvent.RecurrenceOccurrence=RecurrenceOccurrence},{"./Model":264}],237:[function(require,module,exports){"use strict";function CalendarSyncing(values){Model(this);this.model.defProperties({icalExportUrl:"",icalImportUrl:""},values)}var Model=require("./Model");module.exports=CalendarSyncing},{"./Model":264}],238:[function(require,module,exports){"use strict";function CancellationPolicy(values){Model(this);this.model.defProperties({cancellationPolicyID:0,name:"",description:"",hoursRequired:0,cancellationFeeBefore:0,cancellationFeeAfter:0},values);this.cancellationFeeBeforeDisplay=ko.pureComputed(function(){return this.cancellationFeeBefore()>0?"be charged a "+Math.floor(100*this.cancellationFeeBefore())+"% cancellation fee":"not be charged any cancellation fee"},this);this.cancellationFeeAfterDisplay=ko.pureComputed(function(){return Math.floor(100*this.cancellationFeeAfter())+"%"},this);this.refundLimitDate=ko.computed(function(){var d=moment(observableTime()).clone();d.add(7,"days").subtract(this.hoursRequired(),"hours");return d.toDate()},this)}var Model=require("../models/Model"),ko=require("knockout"),moment=require("moment"),observableTime=ko.observable(new Date);setInterval(function(){observableTime(new Date)},6e4);module.exports=CancellationPolicy},{"../models/Model":264,knockout:!1,moment:!1}],239:[function(require,module,exports){"use strict";function CategorySearchResult(values){Model(this);this.model.defProperties({categoryID:0,categoryName:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=CategorySearchResult},{"./Model":264}],240:[function(require,module,exports){"use strict";function Client(values){Model(this);this.model.defProperties({clientUserID:0,firstName:"",lastName:"",secondLastName:"",email:"",phone:null,canReceiveSms:!1,birthMonthDay:null,birthMonth:null,notesAboutClient:null,createdDate:null,updatedDate:null,editable:!1,deleted:!1},values);this.fullName=ko.pureComputed(function(){return(this.firstName()||"")+" "+(this.lastName()||"")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this)}var ko=require("knockout"),Model=require("./Model");module.exports=Client},{"./Model":264,knockout:!1}],241:[function(require,module,exports){"use strict";function DateAvailability(values){Model(this);this.model.defProperties({date:null,weeklySchedule:{Model:WeeklySchedule},appointmentsList:{isArray:!0,Model:Appointment},schedulingPreferences:{Model:SchedulingPreferences}},values);this.freeScheduleSlots=ko.pureComputed(function(){var d=this.date(),w=this.weeklySchedule();return availabilityCalculation.createFreeScheduleSlots(d,w)},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.list=ko.pureComputed(function(){return availabilityCalculation.fillDayAvailability(this.date(),this.appointmentsList(),this.freeScheduleSlots(),this.schedulingPreferences())},this);this.workDayMinutes=ko.pureComputed(function(){var free=this.freeScheduleSlots();return free.reduce(function(v,next){return v+moment(next.end).diff(next.start,"minutes")},0)},this);this.availableMinutes=ko.pureComputed(function(){return this.list().reduce(function(minutes,apt){if(apt.id()===Appointment.specialIds.free){var et=moment(apt.endTime()),st=moment(apt.startTime());minutes+=et.diff(st,"minutes")}return minutes},0)},this);this.availablePercent=ko.pureComputed(function(){return Math.round(this.availableMinutes()/this.workDayMinutes()*100)},this);this.availableTag=ko.pureComputed(function(){var perc=this.availablePercent(),date=this.date(),today=getDateWithoutTime();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"},this);var createTimeSlots=require("../utils/createTimeSlots");this.getFreeTimeSlots=function getFreeTimeSlots(duration,slotSizeMinutes){slotSizeMinutes=slotSizeMinutes||this.schedulingPreferences().incrementsSizeInMinutes();duration||(duration=slotSizeMinutes);var date=this.date(),today=getDateWithoutTime();return today>date||this.availableMinutes()<=0?[]:createTimeSlots.forList(this.getFreeAvailableSlots(),slotSizeMinutes,duration,!0)};this.getFreeAvailableSlots=function getFreeAvailableSlots(){var date=this.date(),today=getDateWithoutTime();if(today>date||this.availableMinutes()<=0)return[];var slots=[];this.list().forEach(function(apt){apt.id()===Appointment.specialIds.free&&slots.push({availability:"free",startTime:apt.startTime(),endTime:apt.endTime()})});return slots}}var Model=require("../models/Model"),Appointment=require("../models/Appointment"),WeeklySchedule=require("../models/WeeklySchedule"),SchedulingPreferences=require("../models/SchedulingPreferences"),moment=require("moment"),ko=require("knockout"),availabilityCalculation=require("../utils/availabilityCalculation"),getDateWithoutTime=require("../utils/getDateWithoutTime");module.exports=DateAvailability},{"../models/Appointment":232,"../models/Model":264,"../models/SchedulingPreferences":285,"../models/WeeklySchedule":308,"../utils/availabilityCalculation":329,"../utils/createTimeSlots":333,"../utils/getDateWithoutTime":340,knockout:!1,moment:!1}],242:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),moment=require("moment");module.exports=function EventDates(values){Model(this);this.model.defProperties({startTime:null,endTime:null,timeZone:""},values);this.duration=ko.computed({read:function(){var s=this.startTime(),e=this.endTime();return s&&e?moment.duration(e-s):null},write:function(value){var s=this.startTime();if((value||0===value)&&s){var newEnd=moment(s).clone().add(value);this.endTime(newEnd.toDate())}else this.endTime(null)},owner:this});this.displayedDate=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").calendar()},this);this.displayedStartTime=ko.pureComputed(function(){return moment(this.startTime()).locale("en-US-LC").format("LT")},this);this.displayedEndTime=ko.pureComputed(function(){return moment(this.endTime()).locale("en-US-LC").format("LT")},this);this.displayedTimeRange=ko.pureComputed(function(){return this.displayedStartTime()+"-"+this.displayedEndTime()},this)}},{"./Model":264,knockout:!1,moment:!1}],243:[function(require,module,exports){"use strict";function ExperienceLevel(values){Model(this);this.model.defProperties({experienceLevelID:0,name:"",description:null,updatedDate:null},values)}var Model=require("./Model");ExperienceLevel.prototype.hasExperienceLevel=function(){return this.experienceLevelID()>0};module.exports=ExperienceLevel},{"./Model":264}],244:[function(require,module,exports){"use strict";function GetMore(values){Model(this);this.model.defProperties({availability:!1,payments:!1,profile:!1,coop:!0},values);var availableItems={availability:new ListViewItem({contentLine1:"Complete your availability to create a cleaner calendar",markerIcon:"fa fa-fw fa-calendar"}),payments:new ListViewItem({contentLine1:"Start accepting payments through Loconomics",markerIcon:"fa ion ion-card"}),profile:new ListViewItem({contentLine1:"Activate your profile in the marketplace",markerIcon:"fa ion ion-cash",link:"/marketplaceProfile"}),coop:new ListViewItem({contentLine1:"Learn more about our cooperative",markerIcon:"fa fa-gavel"})};this.items=ko.pureComputed(function(){var items=[];Object.keys(availableItems).forEach(function(key){this[key]()&&items.push(availableItems[key])}.bind(this));return items},this)}var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem");module.exports=GetMore},{"./ListViewItem":259,"./Model":264,knockout:!1}],245:[function(require,module,exports){"use strict";function HelpArticle(values){Model(this);this.model.defProperties({id:0,section_id:0,title:"",body:""},values);this.description=this.body;this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.title())},this);this.urlPath=ko.pureComputed(function(){return"/help/articles/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpArticle},{"../utils/slug":363,"./Model":264,knockout:!1}],246:[function(require,module,exports){"use strict";function HelpCategory(values){Model(this);this.model.defProperties({id:0,name:"",description:""},values);this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.name())},this);this.urlPath=ko.pureComputed(function(){return"/help/categories/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpCategory},{"../utils/slug":363,"./Model":264,knockout:!1}],247:[function(require,module,exports){"use strict";function HelpSection(values){Model(this);this.model.defProperties({id:0,category_id:0,name:"",description:""},values);this.tail=ko.pureComputed(function(){return this.id()+"-"+slug(this.name())},this);this.urlPath=ko.pureComputed(function(){return"/help/sections/"+this.tail()},this)}var Model=require("./Model"),ko=require("knockout"),slug=require("../utils/slug");module.exports=HelpSection},{"../utils/slug":363,"./Model":264,knockout:!1}],248:[function(require,module,exports){"use strict";function InputPaymentMethod(values){Model(this);this.model.defProperties({paymentMethodID:"",nameOnCard:"",cardNumber:null,expirationMonth:null,expirationYear:null,securityCode:null,billingAddress:{Model:Address},savePayment:!1},values);this.expirationMonthYear=ko.computed({read:function(){var m=this.expirationMonth(),y=this.expirationYear();return m||y?padLeft(m,2,"0")+"/"+padLeft(y,4,"0"):""},write:function(value){var parts=value.split("/");if(2===parts.length){this.expirationMonth(padLeft(0|parts[0],2,"0"));this.expirationYear(padLeft(0|parts[1],4,"0"))}},owner:this})}function padLeft(v,length,padLetter){if(!v)return"";v=v.toString();for(;v.length<length;)v=padLetter+v;return v}var Address=require("./Address"),Model=require("./Model"),ko=require("knockout");module.exports=InputPaymentMethod},{"./Address":231,"./Model":264,knockout:!1}],249:[function(require,module,exports){"use strict";function JobTitle(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",aliases:"",description:null,searchDescription:null,createdDate:null,updatedDate:null},values);this.model.defID(["jobTitleID"]);this.pricingTypes=ko.observableArray([]);values&&values.pricingTypes&&values.pricingTypes.forEach(function(jobpricing){this.pricingTypes.push(new JobTitlePricingType(jobpricing))}.bind(this))}var ko=require("knockout"),Model=require("./Model"),JobTitlePricingType=require("./JobTitlePricingType");module.exports=JobTitle},{"./JobTitlePricingType":254,"./Model":264,knockout:!1}],250:[function(require,module,exports){"use strict";function JobTitleCountryLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countryID:0,countryName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountryLicense},{"./LicenseCertification":258,"./Model":264}],251:[function(require,module,exports){"use strict";function JobTitleCountyLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,countyID:0,countyName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleCountyLicense},{"./LicenseCertification":258,"./Model":264}],252:[function(require,module,exports){"use strict";function JobTitleLicenses(values){Model(this);this.model.defProperties({municipality:{isArray:!0,Model:JobTitleMunicipalLicense},county:{isArray:!0,Model:JobTitleCountyLicense},stateProvince:{isArray:!0,Model:JobTitleStateProvinceLicense
},country:{isArray:!0,Model:JobTitleCountryLicense}},values)}var Model=require("./Model"),JobTitleMunicipalLicense=require("./JobTitleMunicipalLicense"),JobTitleCountyLicense=require("./JobTitleCountyLicense"),JobTitleStateProvinceLicense=require("./JobTitleStateProvinceLicense"),JobTitleCountryLicense=require("./JobTitleCountryLicense");module.exports=JobTitleLicenses},{"./JobTitleCountryLicense":250,"./JobTitleCountyLicense":251,"./JobTitleMunicipalLicense":253,"./JobTitleStateProvinceLicense":257,"./Model":264}],253:[function(require,module,exports){"use strict";function JobTitleMunicipalLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,municipalityID:0,municipalityName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleMunicipalLicense},{"./LicenseCertification":258,"./Model":264}],254:[function(require,module,exports){"use strict";function JobTitlePricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,clientTypeID:1,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID","clientTypeID"])}var Model=require("./Model");module.exports=JobTitlePricingType},{"./Model":264}],255:[function(require,module,exports){"use strict";function JobTitleSearchResult(values){Model(this);this.model.defProperties({jobTitleID:0,singularName:"",pluralName:"",description:"",searchDescription:"",averageRating:"",totalRatings:"",averageResponseTimeMinutes:0,averageHourlyRate:0,minServicePrice:0,minHourlyRate:0,minServiceValue:"",serviceProfessionalsCount:0},values)}var Model=require("./Model");module.exports=JobTitleSearchResult},{"./Model":264}],256:[function(require,module,exports){"use strict";function JobTitleServiceAttributes(values){Model(this);this.model.defProperties({jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevels:{isArray:!0,Model:ExperienceLevel},languageID:0,countryID:0},values)}var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");module.exports=JobTitleServiceAttributes},{"./ExperienceLevel":243,"./Model":264,"./ServiceAttributeCategory":288}],257:[function(require,module,exports){"use strict";function JobTitleStateProvinceLicense(values){Model(this);this.model.defProperties({jobTitleID:0,licenseCertificationID:0,required:0,stateProvinceID:0,stateProvinceName:"",languageID:0,submitted:0,optionGroup:"",licenseCertification:new LicenseCertification},values)}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=JobTitleStateProvinceLicense},{"./LicenseCertification":258,"./Model":264}],258:[function(require,module,exports){"use strict";function LicenseCertification(values){Model(this);this.model.defProperties({licenseCertificationID:0,name:"",description:"",authority:null,verificationWebsiteUrl:null,howToGetLicensedUrl:null,createdDate:null,updatedDate:null,languageID:0},values);this.model.defID(["licenseCertificationID","languageID"])}var Model=require("./Model");module.exports=LicenseCertification},{"./Model":264}],259:[function(require,module,exports){"use strict";function ListViewItem(values){Model(this);this.model.defProperties({markerLine1:null,markerLine2:null,markerIcon:null,contentLine1:"",contentLine2:null,link:"#",actionIcon:null,actionText:null,classNames:""},values)}var Model=require("./Model");module.exports=ListViewItem},{"./Model":264}],260:[function(require,module,exports){"use strict";function MailFolder(values){Model(this);this.model.defProperties({messages:[],topNumber:10},values);this.top=ko.pureComputed(function top(num){num&&this.topNumber(num);var t=this.topNumber()-1,ret=[];this.messages().some(function(e,i){if(i>=t)return!0;ret.push(e);return void 0});return ret},this)}var ko=require("knockout"),Model=require("./Model");module.exports=MailFolder},{"./Model":264,knockout:!1}],261:[function(require,module,exports){"use strict";function MarketplaceProfile(values){Model(this);this.model.defProperties({userID:0,publicBio:"",serviceProfessionalProfileUrlSlug:"",serviceProfessionalProfileUrl:"",serviceProfessionalWebsiteUrl:"",bookCode:"",photoUrl:"",createdDate:null,updatedDate:null},values)}var Model=require("./Model");module.exports=MarketplaceProfile},{"./Model":264}],262:[function(require,module,exports){"use strict";function Message(values){Model(this);this.model.defProperties({messageID:0,threadID:0,sentByUserID:null,typeID:null,auxT:null,auxID:null,bodyText:"",createdDate:null,updatedDate:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this)}var ko=require("knockout"),Model=require("./Model"),moment=require("moment");module.exports=Message},{"./Model":264,knockout:!1,moment:!1}],263:[function(require,module,exports){"use strict";function MessageView(values,app){Model(this);this.model.defProperties({id:0,createdDate:null,updatedDate:null,subject:"",content:null,link:"#",tag:"",classNames:"",sourceThread:null,sourceMessage:null},values);this.displayedDate=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").calendar()},this);this.displayedTime=ko.pureComputed(function(){return moment(this.createdDate()).locale("en-US-LC").format("LT")},this);this.quickDateTime=ko.pureComputed(function(){var date=this.createdDate(),m=moment(date).locale("en-US-LC"),t=moment().startOf("day");return m.isAfter(t)?m.format("LT"):m.fromNow()},this);var getUserData=function(userID){if(userID){if(userID===app.model.userProfile.data.userID())return app.model.userProfile.data;var user=new PublicUserProfile;app.model.users.getProfile(userID).then(function(d){user.model.updateWith(d,!0)});return user}return new PublicUserProfile({firstName:"Loconomics",lastName:"Cooperative Inc."})};this.client=ko.pureComputed(function(){var t=this.sourceThread();return t&&app?getUserData(t.clientUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.serviceProfessional=ko.pureComputed(function(){var t=this.sourceThread();return t&&app?getUserData(t.serviceProfessionalUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.sender=ko.pureComputed(function(){var m=this.sourceMessage();return m&&app?getUserData(m.sentByUserID()):null},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),Model=require("./Model"),moment=require("moment"),PublicUserProfile=require("./PublicUserProfile");module.exports=MessageView;MessageView.fromThread=function(app,thread){var msg=thread.messages();msg=msg&&msg[0]||null;var tag,classNames;if(msg){if("Booking"===msg.auxT()){tag="Booking";classNames="text-success"}}else console.error("Thread is empty",thread);return new MessageView({sourceThread:thread,sourceMessage:msg,id:thread.threadID(),createdDate:thread.createdDate(),updatedDate:thread.updatedDate(),subject:thread.subject(),content:msg&&msg.bodyText()||"",link:"#!/conversation/"+thread.threadID(),tag:tag,classNames:classNames},app)}},{"./Model":264,"./PublicUserProfile":279,knockout:!1,moment:!1}],264:[function(require,module,exports){"use strict";function Model(modelObject){if(!(this instanceof Model)){var model=new Model(modelObject);modelObject.model=model;return model}this.modelObject=modelObject;this.propertiesList=[];this.fieldsList=[];this.propertiesDefs={};this.fieldsDefs={};this.mappingOptions={};this.dataTimestamp=ko.observable(new Date).extend({rateLimit:0})}function prepareValueByDef(val,def){def.isArray&&!Array.isArray(val)&&(val=val?[val]:[]);if(def&&def.Model){var getModelInstance=function(item){if(item instanceof def.Model||null===item||"undefined"==typeof item)return item;if(def.initialValue&&def.initialValue.model){var m=new def.Model(def.initialValue.model.toPlainObject(!0));m.model.updateWith(item,!0);return m}return new def.Model(item)};val=Array.isArray(val)?val.map(getModelInstance):getModelInstance(val)}else if(def&&def.isDate){var getDate=function(v){return v instanceof Date?v:"string"==typeof v?new Date(v):"number"==typeof v?new Date(v):null};val=Array.isArray(val)?val.map(getDate):getDate(val)}return val}function createDef(givenVal,initialVal){var def,isModel=givenVal&&givenVal.model instanceof Model,isArray=Array.isArray(givenVal),isDate=givenVal instanceof Date,isObject="object"==typeof givenVal&&!isDate;if(null===givenVal||isModel||!isObject||isArray){def={defaultValue:givenVal,isArray:isArray};isModel?def.Model=givenVal.constructor:isDate&&(def.isDate=isDate)}else def=givenVal;initialVal="undefined"==typeof initialVal?def.defaultValue:initialVal;def.initialValue=prepareValueByDef(initialVal,def);return def}var ko=require("knockout");ko.mapping=require("knockout.mapping");var $=require("jquery"),clone=function(obj){return $.extend(!0,{},obj)},cloneValue=function(val,deepCopy){return"object"==typeof val?val instanceof Date?new Date(val):deepCopy===!0?val instanceof Array?val.map(function(item){return cloneValue(item,!0)}):null===val?null:val&&val.model instanceof Model?val.model.toPlainObject(deepCopy):clone(val):deepCopy===!1?val:void 0:val};module.exports=Model;Model.prototype.defProperties=function defProperties(properties,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,propertiesList=this.propertiesList,defs=this.propertiesDefs,dataTimestamp=this.dataTimestamp;Object.keys(properties).forEach(function(key){var def=createDef(properties[key],initialValues[key]);defs[key]=def;modelObject[key]=Array.isArray(def.initialValue)?ko.observableArray(def.initialValue):ko.observable(def.initialValue);modelObject[key]._defaultValue=def.defaultValue;modelObject[key]._initialValue=def.initialValue;modelObject[key].subscribe(function(){dataTimestamp(new Date)});propertiesList.push(key)});dataTimestamp(new Date)};Model.prototype.defFields=function defFields(fields,initialValues){initialValues=initialValues||{};var modelObject=this.modelObject,defs=this.fieldsDefs,fieldsList=this.fieldsList;Object.keys(fields).each(function(key){var def=createDef(fields[key],initialValues[key]);defs[key]=def;modelObject[key]=def.initialValue;fieldsList.push(key)})};Model.prototype.defID=function defID(fieldsNames){this.idFieldsNames=fieldsNames;if(1===fieldsNames.length){var field=fieldsNames[0];this.modelObject.id=ko.pureComputed(function(){return this[field]()},this.modelObject)}else this.modelObject.id=ko.pureComputed(function(){return fieldsNames.map(function(fieldName){return this[fieldName]()}.bind(this))},this.modelObject)};Model.prototype.regTimestamp=function regTimestampProperty(propertyName){var prop=this.modelObject[propertyName];if("function"!=typeof prop)throw new Error("There is no observable property with name ["+propertyName+"] to register as timestamp.");this.dataTimestamp.subscribe(function(timestamp){prop(timestamp)})};Model.prototype.toPlainObject=function toPlainObject(deepCopy){function setValue(property,val){var clonedValue=cloneValue(val,deepCopy);"undefined"!=typeof clonedValue&&(plain[property]=clonedValue)}var plain={},modelObj=this.modelObject;this.propertiesList.forEach(function(property){var val=modelObj[property]();setValue(property,val)});this.fieldsList.forEach(function(field){var val=modelObj[field];setValue(field,val)});return plain};Model.prototype.updateWith=function updateWith(data,deepCopy){var timestamp=null;if(data&&data.model instanceof Model){timestamp=data.model.dataTimestamp();data=data.model.toPlainObject(deepCopy)}var target=this.modelObject,defs=this.propertiesDefs;this.propertiesList.forEach(function(property){var val=data[property],def=defs[property];"undefined"!=typeof val&&target[property](prepareValueByDef(val,def))});defs=this.fieldsDefs;this.fieldsList.forEach(function(field){var val=data[field],def=defs[field];"undefined"!=typeof val&&(target[field]=prepareValueByDef(val,def))});timestamp&&this.modelObject.model.dataTimestamp(timestamp)};Model.prototype.mapData=function mapData(data,optionalMapping){ko.mapping.fromJS(data,optionalMapping||this.mappingOptions,this.modelObject)};Model.prototype.clone=function clone(data,deepCopy){var plain=this.toPlainObject(deepCopy),cloned=new this.modelObject.constructor(plain);data?cloned.model.updateWith(data):cloned.model.dataTimestamp(this.modelObject.model.dataTimestamp());return cloned};Model.prototype.touch=function touch(){this.dataTimestamp(new Date(Date()+1))};Model.prototype.reset=function reset(presets){var newInstance=new this.modelObject.constructor(presets);this.updateWith(newInstance,!0)}},{jquery:!1,knockout:!1,"knockout.mapping":!1}],265:[function(require,module,exports){"use strict";function OwnerAcknowledgment(values){Model(this);this.model.defProperties({userID:null,dateAcknowledged:null,acknowledgedFromIP:null,createdDate:null,updatedDate:null},values);this.isSigned=ko.pureComputed(function(){return this.createdDate()&&this.dateAcknowledged()},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=OwnerAcknowledgment},{"../models/Model":264,knockout:!1}],266:[function(require,module,exports){"use strict";function PaymentAccount(values){Model(this);this.model.defProperties({userID:"",firstName:"",lastName:"",phone:"",streetAddress:"",city:"",postalCode:"",routingNumber:"",accountNumber:"",ssn:"",stateProvinceCode:"",birthDate:"",isVenmo:!1,agree:!1,status:"",errors:{isArray:!0}},values)}var Model=require("./Model");module.exports=PaymentAccount},{"./Model":264}],267:[function(require,module,exports){"use strict";function PaymentPlan(values){Model(this);this.model.defProperties({paymentPlanID:"",name:"",summary:"",description:""},values)}var Model=require("../models/Model");module.exports=PaymentPlan},{"../models/Model":264}],268:[function(require,module,exports){"use strict";function PerformanceSummary(values){Model(this);values=values||{};this.earnings=new Earnings(values.earnings);var earningsLine=new ListViewItem;earningsLine.markerLine1=ko.computed(function(){var num=numeral(this.currentAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine1=ko.computed(function(){return this.currentConcept()},this.earnings);earningsLine.markerLine2=ko.computed(function(){var num=numeral(this.nextAmount()).format("$0,0");return num},this.earnings);earningsLine.contentLine2=ko.computed(function(){return this.nextConcept()},this.earnings);this.timeBooked=new TimeBooked(values.timeBooked);var timeBookedLine=new ListViewItem;timeBookedLine.markerLine1=ko.computed(function(){var num=numeral(this.percent()).format("0%");return num},this.timeBooked);timeBookedLine.contentLine1=ko.computed(function(){return this.concept()},this.timeBooked);this.items=ko.pureComputed(function(){var items=[];items.push(earningsLine);items.push(timeBookedLine);return items},this)}function Earnings(values){Model(this);this.model.defProperties({currentAmount:0,currentConceptTemplate:"already paid this month",nextAmount:0,nextConceptTemplate:"projected {month} earnings"},values);this.currentConcept=ko.pureComputed(function(){var month=moment().format("MMMM");return this.currentConceptTemplate().replace(/\{month\}/,month)},this);this.nextConcept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.nextConceptTemplate().replace(/\{month\}/,month)},this)}function TimeBooked(values){Model(this);this.model.defProperties({percent:0,conceptTemplate:"of available time booked in {month}"},values);this.concept=ko.pureComputed(function(){var month=moment().add(1,"month").format("MMMM");return this.conceptTemplate().replace(/\{month\}/,month)},this)}var ko=require("knockout"),Model=require("./Model"),ListViewItem=require("./ListViewItem"),moment=require("moment"),numeral=require("numeral");module.exports=PerformanceSummary},{"./ListViewItem":259,"./Model":264,knockout:!1,moment:!1,numeral:!1}],269:[function(require,module,exports){"use strict";var PricingSummary=require("./PricingSummary");module.exports=PricingSummary;var ko=require("knockout"),numeral=require("numeral"),PricingSummaryDetail=require("./PricingSummaryDetail");PricingSummary.editable=function(obj){var pricingSummary;pricingSummary=obj&&obj instanceof PricingSummary?obj:new PricingSummary(obj&&obj.model&&obj.model.toPlainObject?obj.model.toPlainObject(!0):obj);pricingSummary.gratuityPercentage=ko.observable(0);pricingSummary.gratuityAmount=ko.observable(0);pricingSummary.gratuity=ko.pureComputed(function(){var percentage=0|this.gratuityPercentage(),amount=0|this.gratuityAmount(),r=percentage>0?this.subtotalPrice()*(percentage/100):0>amount?0:amount;return r},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){total+=item.price();return total},0);this.subtotalPrice(r)},pricingSummary);ko.computed(function(){var t=+this.subtotalPrice(),f=+this.firstTimeServiceFeeFixed(),p=+this.firstTimeServiceFeePercentage(),min=+this.firstTimeServiceFeeMinimum(),max=+this.firstTimeServiceFeeMaximum();if(0===t)this.clientServiceFeePrice(0);else{var a=Math.round(100*(f+p/100*t))/100,r=Math.min(Math.max(a,min),max);this.clientServiceFeePrice(r)}},pricingSummary);ko.computed(function(){var r=this.subtotalPrice()+this.clientServiceFeePrice()+this.gratuity();this.totalPrice(r)},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){total+=item.serviceDurationMinutes();return total},0);this.serviceDurationMinutes(r)},pricingSummary);ko.computed(function(){var r=this.details().reduce(function(total,item){total+=item.firstSessionDurationMinutes();return total},0);this.firstSessionDurationMinutes(r)},pricingSummary);pricingSummary.feesMessage=ko.pureComputed(function(){var f=numeral(this.clientServiceFeePrice()).format("$#,##0.00");return"*The first-time __fees__ booking fee applies only to the very first time you connect with a professional and helps cover costs of running the marketplace. There are no fees for subsequent bookings with this professional.".replace(/__fees__/g,f)},pricingSummary);pricingSummary.items=ko.pureComputed(function(){var items=this.details().slice(),gratuity=this.gratuity();if(gratuity>0){var gratuityLabel=this.gratuityPercentage()?"Gratuity (__gratuity__%)".replace(/__gratuity__/g,0|this.gratuityPercentage()):"Gratuity";items.push(new PricingSummaryDetail({serviceName:gratuityLabel,price:gratuity}))}var fees=this.clientServiceFeePrice();if(fees>0){var feesLabel="First-time booking fee*";items.push(new PricingSummaryDetail({serviceName:feesLabel,price:fees}))}return items},pricingSummary);var duration2Language=require("../utils/duration2Language");pricingSummary.serviceDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.serviceDurationMinutes()})},pricingSummary);pricingSummary.firstSessionDurationDisplay=ko.pureComputed(function(){return duration2Language({minutes:this.firstSessionDurationMinutes()})},pricingSummary);pricingSummary.connectToSelectableServicesView=function(serviceProfessionalServices){serviceProfessionalServices.selectedServices.subscribe(function(services){this.details(services.map(function(service){return PricingSummaryDetail.fromServiceProfessionalService(service)}))},this)}}},{"../utils/duration2Language":335,"./PricingSummary":270,"./PricingSummaryDetail":271,knockout:!1,numeral:!1}],270:[function(require,module,exports){"use strict";var Model=require("./Model"),ko=require("knockout"),PricingSummaryDetail=require("./PricingSummaryDetail");module.exports=function PricingSummary(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceDurationMinutes:null,firstSessionDurationMinutes:null,subtotalPrice:null,clientServiceFeePrice:null,totalPrice:null,serviceFeeAmount:null,cancellationFeeCharged:null,cancellationDate:null,firstTimeServiceFeeFixed:null,firstTimeServiceFeePercentage:null,paymentProcessingFeePercentage:null,paymentProcessingFeeFixed:null,firstTimeServiceFeeMaximum:null,firstTimeServiceFeeMinimum:null,createdDate:null,updatedDate:null,details:{Model:PricingSummaryDetail,isArray:!0}},values);this.servicesSummary=ko.pureComputed(function(){return this.details().map(function(detail){return detail.serviceName()}).join(", ")},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}},{"./Model":264,"./PricingSummaryDetail":271,knockout:!1}],271:[function(require,module,exports){"use strict";function PricingSummaryDetail(values){Model(this);this.model.defProperties({pricingSummaryID:0,pricingSummaryRevision:0,serviceProfessionalServiceID:0,serviceProfessionalDataInput:null,clientDataInput:null,hourlyPrice:null,price:null,serviceDurationMinutes:null,firstSessionDurationMinutes:null,serviceName:"",serviceDescription:null,numberOfSessions:1,createdDate:null,updatedDate:null},values)}var Model=require("./Model");module.exports=PricingSummaryDetail;PricingSummaryDetail.fromServiceProfessionalService=function(service){var allSessionMinutes=service.numberOfSessions()>0?service.serviceDurationMinutes()*service.numberOfSessions():service.serviceDurationMinutes();return new PricingSummaryDetail({serviceName:service.name(),serviceDescription:service.description(),numberOfSessions:service.numberOfSessions(),serviceDurationMinutes:allSessionMinutes,firstSessionDurationMinutes:service.serviceDurationMinutes(),price:service.price(),serviceProfessionalServiceID:service.serviceProfessionalServiceID(),hourlyPrice:"HOUR"===(service.priceRateUnit()||"").toUpperCase()?service.priceRate():null})}},{"./Model":264}],272:[function(require,module,exports){"use strict";function PricingType(values){Model(this);this.model.defProperties({pricingTypeID:0,singularName:"",pluralName:"",slugName:"",addNewLabel:null,serviceProfessionalDescription:null,priceCalculation:null,isAddon:!1,namePlaceHolder:null,suggestedName:null,fixedName:null,durationLabel:null,priceLabel:null,priceNote:null,firstTimeClientsOnlyLabel:null,descriptionPlaceHolder:null,priceRateQuantityLabel:null,priceRateUnitLabel:null,noPriceRateLabel:null,numberOfSessionsLabel:null,inPersonPhoneLabel:null,successOnDelete:null,errorOnDelete:null,successOnSave:null,errorOnSave:null,priceRateIsRequiredValidationError:null,priceRateUnitIsRequiredValidationError:null,learnMoreLabel:null,learnMoreText:null,priceRateLearnMoreLabel:null,priceRateLearnMoreText:null,noPriceRateLearnMoreLabel:null,noPriceRateLearnMoreText:null,requireDuration:!1,includeServiceAttributes:!1,includeSpecialPromotion:!1,summaryFormat:null,summaryFormatMultipleSessions:null,summaryFormatNoDuration:null,summaryFormatMultipleSessionsNoDuration:null,withoutServiceAttributesClientMessage:null,withoutServiceAttributesServiceProfessionalMessage:null,firstTimeClientsOnlyListText:null,priceRateQuantityListLabel:null,priceRateUnitListLabel:null,noPriceRateListMessage:null,nameAndSummaryFormat:null,nameAndSummaryFormatMultipleSessions:null,nameAndSummaryFormatNoDuration:null,nameAndSummaryFormatMultipleSessionsNoDuration:null,createdDate:null,updatedDate:null},values);this.model.defID(["pricingTypeID"])}var Model=require("./Model");module.exports=PricingType;var PriceCalculationType={FixedPrice:1,HourlyPrice:2};PricingType.PriceCalculationType=PriceCalculationType},{"./Model":264}],273:[function(require,module,exports){"use strict";function PrivacySettings(values){Model(this);this.model.defProperties({userID:0,smsBookingCommunication:!1,phoneBookingCommunication:!1,loconomicsCommunityCommunication:!1,loconomicsDbmCampaigns:!1,profileSeoPermission:!1,loconomicsMarketingCampaigns:!1,coBrandedPartnerPermissions:!1,createdDate:null,updatedDate:null},values);this.model.defID(["userID"])}var Model=require("./Model");module.exports=PrivacySettings},{"./Model":264}],274:[function(require,module,exports){"use strict";function ProfileAlert(values){Model(this);this.model.defProperties({alertID:0,alertName:"",displayRank:9999,isRequired:!1},values)}var Model=require("./Model");module.exports=ProfileAlert},{"./Model":264}],275:[function(require,module,exports){"use strict";function PublicUser(values){Model(this);this.model.defProperties({profile:{Model:PublicUserProfile},rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},jobProfile:{Model:PublicUserJobTitle,isArray:!0},stats:{Model:PublicUserStats},education:{Model:UserEducation,isArray:!0},verifications:{Model:UserVerification,isArray:!0},backgroundCheckPassed:null,selectedJobTitleID:null,isClientFavorite:!1},values);this.selectedJobTitle=ko.pureComputed(function(){var jid=this.selectedJobTitleID(),jp=this.jobProfile();if(!jid||!jp)return null;var found=null;jp.some(function(jobTitle){if(jobTitle.jobTitleID()===jid){found=jobTitle;return!0}});return found},this);this.backgroundCheckLabel=ko.pureComputed(function(){var v=this.backgroundCheckPassed();return v===!0?"OK":v===!1?"FAILED":""},this);this.otherJobTitles=ko.pureComputed(function(){var jid=this.selectedJobTitleID(),jp=this.jobProfile();return jp.filter(function(jt){return jt.jobTitleID()!==jid})},this);this.otherJobTitleNames=ko.pureComputed(function(){return this.otherJobTitles().map(function(jd){return jd.jobTitleSingularName()}).join(", ")},this)}var Model=require("./Model"),PublicUserProfile=require("./PublicUserProfile"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserJobTitle=require("./PublicUserJobTitle"),PublicUserStats=require("./PublicUserStats"),UserEducation=require("./UserEducation"),UserVerification=require("./UserVerification"),ko=require("knockout");module.exports=PublicUser},{"./Model":264,"./PublicUserJobTitle":277,"./PublicUserProfile":279,"./PublicUserRating":280,"./PublicUserStats":282,"./PublicUserVerificationsSummary":284,"./UserEducation":298,"./UserVerification":304,knockout:!1}],276:[function(require,module,exports){"use strict";function PublicUserJobStats(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,servicesCount:0,minServicePrice:0,minUnitRate:0,priceRateUnit:"",minServiceValue:""},values)}var Model=require("./Model");module.exports=PublicUserJobStats},{"./Model":264}],277:[function(require,module,exports){"use strict";function PublicUserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,cancellationPolicyID:0,instantBooking:!1,isActive:!1,jobTitleSingularName:"",jobTitlePluralName:"",rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},serviceAddresses:{Model:Address,isArray:!0},services:{Model:ServiceProfessionalService,isArray:!0},serviceAttributes:{Model:PublicUserJobTitleServiceAttributes},workPhotos:{Model:WorkPhoto,isArray:!0},verifications:{Model:UserVerification,isArray:!0},licensesCertifications:{Model:UserLicenseCertification,isArray:!0}},values);this.model.defID(["userID","jobTitleID"]);var findMinValue=function(services){var s=services,maxValue={price:Number.MAX_VALUE};if(0===s.length)return null;var minValue=s.reduce(function(last,serv){return null!==serv.priceRate()&&serv.priceRate()<last.price?{price:serv.priceRate(),unit:serv.priceRateUnit()}:null!==serv.price()&&serv.price()<last.price?{price:serv.price(),unit:null}:last},maxValue);return minValue===maxValue?null:minValue};this.minServiceValue=ko.pureComputed(function(){var price=findMinValue(this.services());return price?price.unit?numeral(price.price).format("$0")+"/"+price.unit:numeral(price.price).format("$0.00"):""},this);this.clientSpecificServices=function(){return this.services().filter(function(service){return service.isClientSpecific()})};this.publicServices=function(){return this.services().filter(function(service){return!service.isClientSpecific()})};this.hasServiceAttributes=function(){return!(!this.serviceAttributes()||!this.serviceAttributes().hasAttributes())};this.hasIntro=function(){return!!this.intro()}}var ko=require("knockout"),numeral=require("numeral"),Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),Address=require("./Address"),WorkPhoto=require("./WorkPhoto"),PublicUserJobTitleServiceAttributes=require("./PublicUserJobTitleServiceAttributes"),ServiceProfessionalService=require("./ServiceProfessionalService"),UserVerification=require("./UserVerification"),UserLicenseCertification=require("./UserLicenseCertification");module.exports=PublicUserJobTitle},{"./Address":231,"./Model":264,"./PublicUserJobTitleServiceAttributes":278,"./PublicUserRating":280,"./PublicUserVerificationsSummary":284,"./ServiceProfessionalService":291,"./UserLicenseCertification":302,"./UserVerification":304,"./WorkPhoto":309,knockout:!1,numeral:!1}],278:[function(require,module,exports){"use strict";function PublicUserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{isArray:!0,Model:ServiceAttributeCategory},experienceLevel:{Model:ExperienceLevel},languageID:0,countryID:0},values)}var Model=require("./Model"),ServiceAttributeCategory=require("./ServiceAttributeCategory"),ExperienceLevel=require("./ExperienceLevel");PublicUserJobTitleServiceAttributes.prototype.hasAttributes=function(){return this.hasExperienceLevel()||this.serviceAttributes().length>0};PublicUserJobTitleServiceAttributes.prototype.hasExperienceLevel=function(){return this.experienceLevel()&&this.experienceLevel().hasExperienceLevel()};module.exports=PublicUserJobTitleServiceAttributes},{"./ExperienceLevel":243,"./Model":264,"./ServiceAttributeCategory":288}],279:[function(require,module,exports){"use strict";function PublicUserProfile(values){Model(this);this.model.defProperties({userID:0,firstName:0,lastName:0,secondLastName:0,businessName:0,publicBio:0,serviceProfessionalProfileUrlSlug:null,serviceProfessionalWebsiteUrl:null,serviceProfessionalProfileUrl:null,photoUrl:null,email:null,phone:null,isServiceProfessional:!1,isClient:!1,timeZone:null,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.publicName=ko.pureComputed(function(){var b=this.businessName();return b?b:this.fullName()},this)}var Model=require("./Model"),ko=require("knockout");module.exports=PublicUserProfile},{"./Model":264,knockout:!1}],280:[function(require,module,exports){"use strict";function PublicUserRating(values){Model(this);this.model.defProperties({rating1:0,rating2:0,rating3:0,ratingAverage:0,totalRatings:0,serviceHours:0,lastRatingDate:null},values)}var Model=require("./Model");module.exports=PublicUserRating},{"./Model":264}],281:[function(require,module,exports){"use strict";function PublicUserReview(values){Model(this);this.model.defProperties({bookingID:0,jobTitleID:0,reviewedUserID:0,reviewerUserID:0,reviewerUserSince:null,rating1:null,rating2:null,rating3:null,publicReview:"",serviceHours:null,helpfulReviewCount:0,updatedDate:null,reviewerName:""},values)}var Model=require("./Model");module.exports=PublicUserReview},{"./Model":264}],282:[function(require,module,exports){"use strict";function PublicUserStats(values){Model(this);this.model.defProperties({userID:0,responseTimeMinutes:0},values);this.responseTimeText=ko.pureComputed(function(){var min=this.responseTimeMinutes();return 1>min?"immediate":duration2Language({minutes:min})},this)}var Model=require("./Model"),duration2Language=require("../utils/duration2Language"),ko=require("knockout");module.exports=PublicUserStats},{"../utils/duration2Language":335,"./Model":264,knockout:!1}],283:[function(require,module,exports){"use strict";function PublicUserVerificationsGroup(values){
Model(this);this.model.defProperties({verificationsCount:0,groupName:"",groupID:""},values)}var Model=require("./Model");module.exports=PublicUserVerificationsGroup},{"./Model":264}],284:[function(require,module,exports){"use strict";function PublicUserVerificationsSummary(values){Model(this);this.model.defProperties({total:0,groups:PublicUserVerificationsGroup},values)}var Model=require("./Model"),PublicUserVerificationsGroup=require("./PublicUserVerificationsGroup");module.exports=PublicUserVerificationsSummary},{"./Model":264,"./PublicUserVerificationsGroup":283}],285:[function(require,module,exports){"use strict";function SchedulingPreferences(values){Model(this);this.model.defProperties({advanceTime:24,betweenTime:0,incrementsSizeInMinutes:15},values)}var Model=require("./Model");module.exports=SchedulingPreferences},{"./Model":264}],286:[function(require,module,exports){"use strict";function SearchResults(values){Model(this);this.model.defProperties({jobTitles:{isArray:!0,Model:JobTitleSearchResult},serviceProfessionals:{isArray:!0,Model:ServiceProfessionalSearchResult},categories:{isArray:!0,Model:CategorySearchResult}},values)}var Model=require("./Model"),JobTitleSearchResult=require("./JobTitleSearchResult"),ServiceProfessionalSearchResult=require("./ServiceProfessionalSearchResult"),CategorySearchResult=require("./CategorySearchResult");module.exports=SearchResults},{"./CategorySearchResult":239,"./JobTitleSearchResult":255,"./Model":264,"./ServiceProfessionalSearchResult":290}],287:[function(require,module,exports){"use strict";function ServiceAttribute(values){Model(this);this.model.defProperties({serviceAttributeID:0,name:"",description:null},values)}var Model=require("./Model");module.exports=ServiceAttribute},{"./Model":264}],288:[function(require,module,exports){"use strict";function ServiceAttributeCategory(values){Model(this);this.model.defProperties({serviceAttributeCategoryID:0,name:"",description:null,requiredInput:!1,eligibleForPackages:!1,serviceAttributes:{isArray:!0,Model:ServiceAttribute}},values)}var Model=require("./Model"),ServiceAttribute=require("./ServiceAttribute");module.exports=ServiceAttributeCategory},{"./Model":264,"./ServiceAttribute":287}],289:[function(require,module,exports){"use strict";var ServiceCollection=function(services){this.services=services};ServiceCollection.prototype.clientSpecificServices=function(){return this.services.filter(function(s){return s.isClientSpecific()})};ServiceCollection.prototype.publicServices=function(){return this.services.filter(function(s){return!s.isClientSpecific()})};module.exports=ServiceCollection},{}],290:[function(require,module,exports){"use strict";function ServiceProfessionalSearchResult(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,firstName:"",lastName:"",lastInitial:"",publicBio:"",businessName:"",instantBooking:"",jobTitleNameSingular:"",otherJobTitles:"",allJobTitles:"",distance:0,rating:{Model:PublicUserRating},verificationsSummary:{Model:PublicUserVerificationsSummary},stats:{Model:PublicUserStats},jobStats:{Model:PublicUserJobStats},photoUrl:""},values)}var Model=require("./Model"),PublicUserRating=require("./PublicUserRating"),PublicUserVerificationsSummary=require("./PublicUserVerificationsSummary"),PublicUserStats=require("./PublicUserStats"),PublicUserJobStats=require("./PublicUserJobStats");module.exports=ServiceProfessionalSearchResult},{"./Model":264,"./PublicUserJobStats":276,"./PublicUserRating":280,"./PublicUserStats":282,"./PublicUserVerificationsSummary":284}],291:[function(require,module,exports){"use strict";function ServiceProfessionalService(values){Model(this);this.model.defProperties({serviceProfessionalServiceID:0,serviceProfessionalUserID:0,jobTitleID:0,pricingTypeID:0,name:"",description:null,price:null,serviceDurationMinutes:null,firstTimeClientsOnly:!1,numberOfSessions:1,priceRate:null,priceRateUnit:"hour",noPriceRate:!1,isPhone:!1,serviceAttributes:[],createdDate:null,updatedDate:null,visibleToClientID:0},values);this.model.defID(["serviceProfessionalServiceID"]);this.noPriceRate.subscribe(function(enabled){enabled===!0&&this.priceRate(null)},this);this.refreshNoPriceRate=function refreshNoPriceRate(){if(this.serviceProfessionalServiceID()&&(0|this.priceRate())<=0){var ts=this.model.dataTimestamp();this.noPriceRate(!0);this.model.dataTimestamp(ts)}};var is=require("is_js");this.durationHoursPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)/60|0},write:function(hours){var minutes=0|this.durationMinutesPart();hours=parseInt(hours,10);is.not.number(hours)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*(0|hours)+minutes)},owner:this});this.durationMinutesPart=ko.pureComputed({read:function(){var fullMinutes=this.serviceDurationMinutes();return is.not.number(fullMinutes)?null:(0|fullMinutes)%60},write:function(minutes){var hours=0|this.durationHoursPart();minutes=parseInt(minutes,10);is.not.number(minutes)?this.serviceDurationMinutes(null):this.serviceDurationMinutes(60*hours+(0|minutes))},owner:this});this.durationText=ko.pureComputed(function(){var minutes=this.serviceDurationMinutes()||0;return minutes?numeral(minutes).format("0,0")+" minutes":""},this);this.sessionsAndDuration=ko.pureComputed(function(){var sessions=this.numberOfSessions(),dur=this.durationText();return sessions>1?sessions+" sessions, "+dur:dur},this);this.displayedPrice=ko.pureComputed(function(){var price=this.price(),rate=this.priceRate(),unit=this.priceRateUnit(),result;result=price?numeral(price).format("$0,0.00"):numeral(rate).format("$0");!price&&rate&&unit&&(result+="/"+unit);return result},this);this.displayedDurationAndPrice=ko.pureComputed(function(){var dur=this.sessionsAndDuration(),pr=this.displayedPrice();return dur&&pr?dur+", "+pr:dur||pr},this);this.clientID=function(){return this.visibleToClientID()>0?this.visibleToClientID():null};this.isClientSpecific=function(){return this.visibleToClientID()>0}.bind(this)}var Model=require("./Model"),ko=require("knockout"),numeral=require("numeral");module.exports=ServiceProfessionalService},{"./Model":264,is_js:!1,knockout:!1,numeral:!1}],292:[function(require,module,exports){"use strict";function StateProvince(values){Model(this);this.model.defProperties({code:"",name:""},values)}var Model=require("./Model");module.exports=StateProvince},{"./Model":264}],293:[function(require,module,exports){"use strict";function Thread(values){Model(this);this.model.defProperties({threadID:0,clientUserID:null,serviceProfessionalUserID:null,jobTitleID:null,statusID:null,subject:null,messages:{isArray:!0,Model:Message},createdDate:null,updatedDate:null},values)}var Model=require("./Model"),Message=require("./Message");module.exports=Thread},{"./Message":262,"./Model":264}],294:[function(require,module,exports){"use strict";function TimeRange(values){Model(this);this.model.defProperties({start:"00:00:00",end:"00:00:00"},values);this.fromMinute=ko.computed({read:function(){return timeStringToMinutes(this.start())},write:function(minutes){this.start(minutesToTimeString(0|minutes))},owner:this});this.toMinute=ko.computed({read:function(){return timeStringToMinutes(this.end())},write:function(minutes){this.end(minutesToTimeString(0|minutes))},owner:this})}function twoDigits(n){return Math.floor(n/10)+""+n%10}function minutesToTimeString(minutes){var d=moment.duration(minutes,"minutes"),h=d.hours(),m=d.minutes(),s=d.seconds();return twoDigits(h)+":"+twoDigits(m)+":"+twoDigits(s)}function timeStringToMinutes(time){return 0|moment.duration(time).asMinutes()}var Model=require("./Model"),moment=require("moment"),ko=require("knockout");module.exports=TimeRange},{"./Model":264,knockout:!1,moment:!1}],295:[function(require,module,exports){"use strict";function UpcomingAppointmentsSummary(values){Model(this);this.model.defProperties({pendingRequests:new BookingSummary({concept:"pending appointment requests",timeFormat:null}),nextOnes:new BookingSummary({concept:"more appointments coming up",timeFormat:" [Next is] MMMM Do [@] h:mma"}),pendingScheduling:new BookingSummary({concept:"to be scheduled",timeFormat:null}),nextBooking:{Model:Booking}},values);this.items=ko.pureComputed(function(){var items=[];this.pendingRequests().quantity()&&items.push(this.pendingRequests());this.nextOnes().quantity()&&items.push(this.nextOnes());this.pendingScheduling().quantity()&&items.push(this.pendingScheduling());return items},this);this.currentAppointment=ko.pureComputed(function(){var b=this.nextBooking();if(b){var today=(new Date).toISOString().substr(0,10),bookday=b.serviceDate()&&b.serviceDate().startTime()||"";bookday=("string"==typeof bookday?bookday:bookday.toISOString()).substr(0,10);if(bookday===today)return b}return null},this)}var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary"),Booking=require("./Booking");module.exports=UpcomingAppointmentsSummary},{"./Booking":234,"./BookingSummary":235,"./Model":264,knockout:!1}],296:[function(require,module,exports){"use strict";function UpcomingBookingsSummary(values){Model(this);this.model.defProperties({today:new BookingSummary({concept:"left today",timeFormat:" [ending @] h:mma"}),tomorrow:new BookingSummary({concept:"tomorrow",timeFormat:" [starting @] h:mma"}),thisWeek:new BookingSummary({concept:"this week",timeFormat:null}),nextWeek:new BookingSummary({concept:"next week",timeFormat:null}),nextBooking:{Model:Booking}},values);this.items=ko.pureComputed(function(){var items=[];this.today().quantity()&&items.push(this.today());this.tomorrow().quantity()&&items.push(this.tomorrow);this.thisWeek().quantity()&&items.push(this.thisWeek());this.nextWeek().quantity()&&items.push(this.nextWeek());return items},this)}var ko=require("knockout"),Model=require("./Model"),BookingSummary=require("./BookingSummary"),Booking=require("./Booking");module.exports=UpcomingBookingsSummary},{"./Booking":234,"./BookingSummary":235,"./Model":264,knockout:!1}],297:[function(require,module,exports){"use strict";function User(values){Model(this);this.model.defProperties({userID:0,email:"",firstName:"",lastName:"",secondLastName:"",businessName:"",alternativeEmail:"",phone:"",canReceiveSms:"",birthMonthDay:null,birthMonth:null,isServiceProfessional:!1,isClient:!1,isAdmin:!1,isCollaborator:!1,photoUrl:null,onboardingStep:null,accountStatusID:0,createdDate:null,updatedDate:null},values);this.fullName=ko.pureComputed(function(){var nameParts=[this.firstName()];this.lastName()&&nameParts.push(this.lastName());this.secondLastName()&&nameParts.push(this.secondLastName);return nameParts.join(" ")},this);this.birthDay=ko.pureComputed(function(){return this.birthMonthDay()&&this.birthMonth()?this.birthMonth()+"/"+this.birthMonthDay():null},this);this.userType=ko.pureComputed({read:function(){var c=this.isClient(),p=this.isServiceProfessional(),a=this.isAdmin(),userType=0;this.isAnonymous()&&(userType|=UserType.anonymous);c&&(userType|=UserType.client);p&&(userType|=UserType.serviceProfessional);a&&(userType|=UserType.admin);return userType},owner:this});this.isAnonymous=ko.pureComputed(function(){return this.userID()<1},this);this.isUserType=function isUserType(type){return this.userType()&type}.bind(this)}var ko=require("knockout"),Model=require("./Model"),UserType={none:0,anonymous:1,client:2,serviceProfessional:4,member:12,admin:16,loggedUser:30,user:31,system:32};module.exports=User;User.UserType=UserType;User.newAnonymous=function newAnonymous(){return new User({userID:0,email:"",firstName:"",onboardingStep:null})}},{"./Model":264,knockout:!1}],298:[function(require,module,exports){"use strict";function UserEducation(values){Model(this);this.model.defProperties({educationID:0,userID:0,institutionName:"",degreeCertificate:"",fieldOfStudy:"",fromYearAttended:null,toYearAttended:null},values)}var Model=require("./Model");module.exports=UserEducation},{"./Model":264}],299:[function(require,module,exports){"use strict";function UserFeePayment(values){Model(this);this.model.defProperties({userFeePaymentID:0,userID:0,paymentTransactionID:"",subscriptionID:"",paymentDate:null,paymentPlan:"",paymentAmount:0,paymentMethod:"",paymentStatus:"",createdDate:null,updatedDate:null},values)}var Model=require("../models/Model");module.exports=UserFeePayment},{"../models/Model":264}],300:[function(require,module,exports){"use strict";function UserJobTitle(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,intro:null,statusID:0,cancellationPolicyID:0,instantBooking:!1,bookMeButtonReady:!1,collectPaymentAtBookMeButton:!1,createdDate:null,updatedDate:null,alerts:{isArray:!0,Model:ProfileAlert}},values);this.model.defID(["userID","jobTitleID"]);this.requiredAlerts=ko.pureComputed(function(){return this.alerts().filter(function(profileAlert){return profileAlert.isRequired()})},this);this.isComplete=ko.pureComputed(function(){var statusComplete=this.statusID()===UserJobTitle.status.on||this.statusID()===UserJobTitle.status.off,hasRequiredAlerts=this.requiredAlerts().length>0;return statusComplete&&!hasRequiredAlerts},this)}var ko=require("knockout"),Model=require("./Model"),ProfileAlert=require("./ProfileAlert");module.exports=UserJobTitle;UserJobTitle.status={on:1,incomplete:2,off:3}},{"./Model":264,"./ProfileAlert":274,knockout:!1}],301:[function(require,module,exports){"use strict";function extendValuesByCategory(obs){obs.notifyChanges=obs.valueHasMutated;obs.serviceAttributeCategoriesIDs=ko.pureComputed(function(){return Object.keys(obs()||{}).filter(function(key){return 0===(0|key)})});var catsObs={};obs.getServiceCategoryAttributes=function(catID){var catObs=catsObs[catID]=catsObs[catID]||ko.observable({});return ko.computed(function(){var base=obs.peek();catObs();return base&&base[catID]||[]})};var prevValue=obs();obs.subscribe(function(v){if(v!==prevValue){prevValue=v;Object.keys(catsObs).forEach(function(a){a.valueHasMutated&&a.valueHasMutated()})}});obs.push=function(catID,attID){var v=obs();if(v){var cat=v[catID]||(v[catID]=[]);if(-1===cat.indexOf(attID)){cat.push(attID);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}else{v={};v[catID]=[attID];obs(v);catsObs[catID]&&catsObs[catID].valueHasMutated()}};obs.remove=function(catID,attID){var v=obs(),cat=v&&v[catID];if(cat){var i=cat.indexOf(attID);if(i>-1){cat.splice(i,1);obs.notifyChanges();catsObs[catID]&&catsObs[catID].valueHasMutated()}}}}function UserJobTitleServiceAttributes(values){Model(this);this.model.defProperties({userID:0,jobTitleID:0,serviceAttributes:{},proposedServiceAttributes:{},experienceLevelID:!1,languageID:0,countryID:0},values);extendValuesByCategory(this.serviceAttributes);extendValuesByCategory(this.proposedServiceAttributes)}var Model=require("./Model"),ko=require("knockout");module.exports=UserJobTitleServiceAttributes},{"./Model":264,knockout:!1}],302:[function(require,module,exports){"use strict";function UserLicenseCertification(values){Model(this);this.model.defProperties({userLicenseCertificationID:0,userID:0,jobTitleID:0,licenseCertificationID:0,statusID:0,licenseCertificationNumber:"",licenseCertificationUrl:"",expirationDate:null,issueDate:null,firstName:null,lastName:null,middleInitial:null,secondLastName:null,businessName:null,comments:null,verifiedBy:null,lastVerifiedDate:null,submitDate:null,submittedBy:null,submittedImageLocalURL:null,status:null,statusDescription:null,licenseCertification:new LicenseCertification,localTempFilePath:null,localTempPhotoPreviewUrl:null,localTempFileData:null,localTempPhotoPreview:null,localTempFileName:null},values);this.model.defID(["userLicenseCertificationID"])}var Model=require("./Model"),LicenseCertification=require("./LicenseCertification");module.exports=UserLicenseCertification},{"./LicenseCertification":258,"./Model":264}],303:[function(require,module,exports){"use strict";function UserPaymentPlan(values){Model(this);this.model.defProperties({userPaymentPlanID:0,userID:0,subscriptionID:"",paymentPlan:"",paymentMethod:"",paymentPlanLastChangedDate:null,nextPaymentDueDate:null,nextPaymentAmount:null,firstBillingDate:null,subscriptionEndDate:null,paymentMethodToken:null,paymentExpiryDate:null,planStatus:"",daysPastDue:null},values);this.isNew=ko.pureComputed(function(){return!this.userPaymentPlanID()},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=UserPaymentPlan},{"../models/Model":264,knockout:!1}],304:[function(require,module,exports){"use strict";function UserVerification(values){Model(this);this.model.defProperties({userID:0,verificationID:0,jobTitleID:0,lastVerifiedDate:null,statusID:0,verification:{Model:Verification}},values);var statusTextsenUS={"verification.status.confirmed":"Confirmed","verification.status.pending":"Pending","verification.status.revoked":"Revoked","verification.status.obsolete":"Obsolete"};this.statusText=ko.pureComputed(function(){var statusName=Verification.getStatusName(this.statusID());return statusTextsenUS["verification.status."+statusName]},this);this.isStatus=function(statusName){var id=this.statusID();return Verification.status[statusName]===id}.bind(this)}var Model=require("./Model"),ko=require("knockout"),Verification=require("./Verification");module.exports=UserVerification},{"./Model":264,"./Verification":305,knockout:!1}],305:[function(require,module,exports){"use strict";function Verification(values){Model(this);this.model.defProperties({verificationID:0,name:"",description:null,icon:null,summaryGroup:null},values)}function enumGetName(value,enumList){var found=null;Object.keys(enumList).some(function(k){if(enumList[k]===value){found=k;return!0}});return found}var Model=require("./Model");Verification.status={confirmed:1,pending:2,revoked:3,obsolete:4};Verification.getStatusName=function getStatusName(value){return enumGetName(value,Verification.status)};module.exports=Verification},{"./Model":264}],306:[function(require,module,exports){"use strict";module.exports={general:0,nps:1,signup:2,calendar:3,inbox:4,scheduling:5,cms:6,payments:7,performance:8,marketplaceProfile:9,mobileFriendly:10,desktopFriendly:11,coopBenefits:12,coopFee:13,senseOfCommunity:14,clientServiceAgents:15,helpPages:16,boardNomination:17,dashboard:18,booking:19,welcome:20}},{}],307:[function(require,module,exports){"use strict";function WeekDaySchedule(obsArray){obsArray||(obsArray=ko.observableArray([]));obsArray.isEnabled=ko.computed({read:function(){var r=obsArray()&&obsArray()[0];return r&&r.fromMinute()<r.toMinute()||!1},write:function(val){obsArray.removeAll();val===!0&&obsArray.push(new TimeRange({start:"09:00:00",end:"17:00:00"}))}}).extend({rateLimit:0});obsArray.isAllDay=ko.computed({read:function(){var r=obsArray()&&obsArray()[0];return r?"00:00:00"===r.start()&&"24:00:00"===r.end():!1},write:function(val){if(val===!0){obsArray.removeAll();obsArray.push(new TimeRange({start:"00:00:00",end:"24:00:00"}))}}}).extend({rateLimit:0});obsArray.addTimeRange=function(){var arr=obsArray(),last=arr[arr.length-1],lastTime=last&&last.end()||"00:00:00",tr=new TimeRange({start:lastTime}),nextHour=tr.fromMinute()+60;nextHour>=1439&&(nextHour=1410);tr.fromMinute(nextHour);nextHour+=60;nextHour>1439&&(nextHour=1439);tr.toMinute(nextHour);obsArray.push(tr)};obsArray.canAddMore=ko.computed(function(){var arr=obsArray(),last=arr[arr.length-1],lastMinute=last&&last.toMinute();return 1439>lastMinute});obsArray.removeTimeRange=function(timeRange){obsArray.remove(timeRange)};return obsArray}var ko=require("knockout"),TimeRange=require("./TimeRange");module.exports=WeekDaySchedule},{"./TimeRange":294,knockout:!1}],308:[function(require,module,exports){"use strict";function WeeklySchedule(values){Model(this);this.model.defProperties({sunday:{isArray:!0,Model:TimeRange},monday:{isArray:!0,Model:TimeRange},tuesday:{isArray:!0,Model:TimeRange},wednesday:{isArray:!0,Model:TimeRange},thursday:{isArray:!0,Model:TimeRange},friday:{isArray:!0,Model:TimeRange},saturday:{isArray:!0,Model:TimeRange},isAllTime:!1,timeZone:""},values);this.weekDays=[this.sunday,this.monday,this.tuesday,this.wednesday,this.thursday,this.friday,this.saturday];this.weekDays.forEach(WeekDaySchedule);this.displayedTimeZoneFormatter=function(tzid){var zone=moment.tz.zone(tzid),m=moment().startOf("year");return tzid?tzid+" ("+zone.abbr(m.valueOf())+")":""};this.timeZoneDisplayName=ko.computed(function(){var tzid=this.timeZone();return tzid?timeZoneList.timeZoneToDisplayFormat(this.timeZone()):""},this)}var ko=require("knockout"),moment=require("moment-timezone"),Model=require("./Model"),WeekDaySchedule=require("./WeekDaySchedule"),TimeRange=require("./TimeRange"),timeZoneList=require("../utils/timeZoneList");module.exports=WeeklySchedule},{"../utils/timeZoneList":366,"./Model":264,"./TimeRange":294,"./WeekDaySchedule":307,knockout:!1,"moment-timezone":!1}],309:[function(require,module,exports){"use strict";function WorkPhoto(values){Model(this);this.model.defProperties({workPhotoID:0,userID:0,jobTitleID:0,caption:"",fileName:"",url:"",rankPosition:0,updatedDate:null,rotationAngle:0,localTempFilePath:null,localTempFileData:null,localTempPhotoPreview:null},values);this.photoRotationStyle=ko.pureComputed(function(){var r=0|this.rotationAngle(),sr="rotate("+r+"deg)",s=1;(90===r||270===r)&&(s=FIXED_IMAGE_RATE);var ss="scale("+s+", "+s+")";return"transform: "+sr+" "+ss},this)}var Model=require("./Model"),ko=require("knockout"),FIXED_IMAGE_WIDTH=442,FIXED_IMAGE_HEIGHT=332,FIXED_IMAGE_RATE=FIXED_IMAGE_HEIGHT/FIXED_IMAGE_WIDTH;module.exports=WorkPhoto},{"./Model":264,knockout:!1}],310:[function(require,module,exports){"use strict";function CacheControl(options){options=options||{};this.ttl=moment.duration(options.ttl).asMilliseconds();this.latest=options.latest||null;this.mustRevalidate=function mustRevalidate(){var tdiff=this.latest&&new Date-this.latest||Number.POSITIVE_INFINITY;return tdiff>this.ttl};this.touch=function touch(){this.latest=new Date};this.reset=function reset(){this.latest=null};this.data=options.data||null}var moment=require("moment");module.exports=CacheControl},{moment:!1}],311:[function(require,module,exports){"use strict";var moment=require("moment"),CacheControl=require("./CacheControl");module.exports=function DateCache(settings){this.Model=settings&&settings.Model||null;this.ttl=settings&&settings.ttl||{minutes:1};this.byDate={};this.clear=function(){this.byDate={}};this.getSingle=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));return this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?this.byDate[dateKey].data:null};this.remove=function(date){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));delete this.byDate[dateKey]};this.get=function(start,end){for(var date=new Date(start),resultsPerDate={},holes=[],minRequest=null,maxRequest=null;end>=date;){var dateKey=moment(date).format("YYYY-MM-DD");this.byDate.hasOwnProperty(dateKey)&&!this.byDate[dateKey].control.mustRevalidate()?resultsPerDate[dateKey]=this.byDate[dateKey].data:holes.push(new Date(date));date.setDate(date.getDate()+1)}holes.sort(function(a,b){return a===b?0:b>a?-1:1});minRequest=holes.length?holes[0]:null;maxRequest=holes.length?holes[holes.length-1]:null;return{byDate:resultsPerDate,holes:holes,minHole:minRequest,maxHole:maxRequest}};this.set=function(date,data){var dateKey=date;date instanceof Date&&(dateKey=moment(date).format("YYYY-MM-DD"));var c=this.byDate[dateKey];if(c&&c.data)this.Model?c.data.model.updateWith(data):c.data=data;else{c={data:this.Model?new this.Model(data):data,control:new CacheControl({ttl:this.ttl})};this.byDate[dateKey]=c}c.control.touch();return c}}},{"./CacheControl":310,moment:!1}],312:[function(require,module,exports){var Enum={parse:function(enumType,str,caseSensitive){if(caseSensitive)return enumType[str]||null;str=str.toLowerCase();for(var e in enumType)if(e.toLowerCase&&e.toLowerCase()==str)return enumType[e];return null},name:function(enumType,value){for(var e in enumType)if(enumType[e]===value)return e}};module.exports=Enum},{}],313:[function(require,module,exports){"use strict";var EventEmitterListener=function(target,event,handler){this.target=target;this.event=event;this.handler=handler;target.on(event,handler)};EventEmitterListener.prototype.dispose=function(){this.target.removeListener(this.event,this.handler)};module.exports=EventEmitterListener},{}],314:[function(require,module,exports){Function.prototype._delayed=function delayed(milliseconds){var fn=this;return function(){var context=this,args=arguments;setTimeout(function(){fn.apply(context,args)},milliseconds)}}},{}],315:[function(require,module,exports){Function.prototype._inherits=function _inherits(superCtor){this.prototype=Object.create(superCtor.prototype,{constructor:{value:this,enumerable:!1,writable:!0,configurable:!0}})}},{}],316:[function(require,module,exports){"use strict";(function f(){}).name||Object.defineProperty(Function.prototype,"name",{get:function(){var name=this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1];Object.defineProperty(this,"name",{value:name});return name}})},{}],317:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupListRemoteModel(settings){function notImplemented(){throw new Error("Not Implemented")}settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedGroupListCache({listTtl:settings.listTtl,groupIdField:settings.groupIdField,itemIdField:settings.itemIdField});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchGroupFromLocal=notImplemented;this.fetchGroupFromRemote=notImplemented;this.pushGroupToLocal=notImplemented;this.pushItemToRemote=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getList=function getList(groupID){var cacheEntry=cache.getGroupCache(groupID);if(cacheEntry.request)return cacheEntry.request;if(cacheEntry.control.mustRevalidate()){if(cacheEntry.list){api.state.isSyncing(!0);cacheEntry.request=this.fetchGroupFromRemote(groupID).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}api.state.isLoading(!0);cacheEntry.request=this.fetchGroupFromLocal(groupID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchGroupFromRemote(groupID).then(function(serverData){cache.setGroupCache(groupID,serverData);this.pushGroupToLocal(groupID,serverData);api.state.isSyncing(!1);return serverData}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.setGroupCache(groupID,data);this.pushGroupToLocal(groupID,data);api.state.isLoading(!1);cacheEntry.request=null;return data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}return Promise.resolve(cacheEntry.list)};api.getItem=function getItem(groupID,itemID){return api.getList(groupID).then(function(){var cacheItem=cache.getItemCache(groupID,itemID);if(!cacheItem){console.warn("GroupListRemoteModel Not found",groupID,itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api._pushItemToCache=function(serverData){if(serverData){var groupID=serverData[settings.groupIdField];cache.setItemCache(groupID,serverData[settings.itemIdField],serverData);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list)}};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushItemToRemote(data).then(function(serverData){serverData&&api._pushItemToCache(serverData);api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(groupID,itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(groupID,itemID).then(function(removedData){cache.delItemCache(groupID,itemID);this.pushGroupToLocal(groupID,cache.getGroupCache(groupID).list);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};api.asModel=function asModel(object){var Model=this.settings.Model;return Array.isArray(object)?object.map(function(item){return new Model(item)}):new Model(object)};api.getItemModel=function getItemModel(groupID,itemID){return api.getItem(groupID,itemID).then(function(data){return data?api.asModel(data):null})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(groupID,itemID){return api.getItemModel(groupID,itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItemVersion=function newItemVersion(values){var version=new ModelVersion(new this.settings.Model(values));version.version.model.touch();return version}}var ko=require("knockout"),IndexedGroupListCache=require("./IndexedGroupListCache");module.exports=GroupListRemoteModel;GroupListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchGroupFromLocal=function fetchFromLocal(groupID){return localforage.getItem(baseName+groupID)};this.pushGroupToLocal=function pushToLocal(groupID,data){return localforage.setItem(baseName+groupID,data)};this.removeGroupFromLocalCache=function(groupID){return localforage.removeItem(baseName+groupID)}};GroupListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchGroupFromRemote=function fetchFromRemote(groupID){return restClient.get(baseUrl+groupID)};this.pushItemToRemote=function pushToRemote(data){var groupID=data[this.settings.groupIdField],itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+groupID+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(groupID,itemID){return restClient["delete"](baseUrl+groupID+"/"+itemID)}}},{"../utils/ModelVersion":322,"./IndexedGroupListCache":319,knockout:!1,localforage:!1}],318:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function GroupRemoteModel(settings){function notImplemented(){throw new Error("Not Implemented")}settings=settings||{};settings.ttl=required(settings.ttl,"ttl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=required(settings.Model,"Model is required");this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache={},getCacheItem=function(id){var c=cache[id];c||(c=cache[id]=new CacheControl({ttl:settings.ttl}));return c},setCacheItem=function(id,rawData){var c=getCacheItem(id);c.data?c.data.model.updateWith(rawData,!0):c.data=new settings.Model(rawData);c.touch();return c};this.clearCache=function(){cache={}};this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchItemFromLocal=notImplemented;this.fetchItemFromRemote=notImplemented;this.pushItemToLocal=notImplemented;this.pushItemToRemote=notImplemented;
this.removeItemFromLocal=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;api.getItem=function getItem(itemID,forceRemoteLoad){var cacheEntry=getCacheItem(itemID);if(cacheEntry.request)return cacheEntry.request;if(forceRemoteLoad||cacheEntry.mustRevalidate()){if(cacheEntry.data){api.state.isSyncing(!0);cacheEntry.request=this.fetchItemFromRemote(itemID).then(function(data){var cached=setCacheItem(itemID,data);this.pushItemToLocal(itemID,data);api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}api.state.isLoading(!0);cacheEntry.request=this.fetchItemFromLocal(itemID).then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchItemFromRemote(itemID).then(function(serverData){var cached=setCacheItem(itemID,serverData);this.pushItemToLocal(itemID,serverData);api.state.isSyncing(!1);return cached.data}.bind(this));return data?data:remotePromise}.bind(this)).then(function(data){var cached=setCacheItem(itemID,data);api.state.isLoading(!1);cacheEntry.request=null;return cached.data}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cacheEntry.request=null;throw err});return cacheEntry.request}return Promise.resolve(cacheEntry.data)};api.setItem=function setItem(data){data=data&&data.model&&data.model.toPlainObject(!0)||data;api.state.isSaving(!0);return this.pushItemToRemote(data[settings.itemIdField],data).then(function(serverData){var cached;if(serverData){var itemID=serverData[settings.itemIdField];cached=setCacheItem(serverData[settings.itemIdField],serverData);this.pushItemToLocal(itemID,cached.data.model.toPlainObject(!0))}api.state.isSaving(!1);return cached&&cached.data}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){delete cache[itemID];this.removeItemFromLocal(itemID);api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};var ModelVersion=require("../utils/ModelVersion");api.getItemVersion=function getItemVersion(itemID){var cached=cache[itemID],initialModel=cached&&cached.data||new settings.Model,version=new ModelVersion(initialModel);version.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),lastError:ko.observable(null)};if(itemID&&(!cached||cached.mustRevalidate())){version.state.isLoading(!0);api.getItem(itemID).then(function(model){version.state.lastError(null);version.state.isLoading(!1);version.original.model.updateWith(model,!0);version.version.model.updateWith(model,!0)})["catch"](function(err){version.state.lastError(err);version.state.isLoading(!1)})}version.load=function load(newItemID,forceRemoteLoad){version.state.isSyncing(!0);var oItemID=newItemID||version.original[settings.itemIdField]();return api.getItem(oItemID,forceRemoteLoad).then(function(model){version.state.lastError(null);version.state.isSyncing(!1);version.original.model.updateWith(model,!0);version.pull({evenIfNewer:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSyncing(!1);throw err})};version.reset=function reset(){version.original.model.reset();version.version.model.reset()};version.save=function save(){version.state.isSaving(!0);return api.setItem(version.version).then(function(model){version.state.lastError(null);version.state.isSaving(!1);version.version.model.updateWith(model,!0);version.push({evenIfObsolete:!0});return model})["catch"](function(err){version.state.lastError(err);version.state.isSaving(!1);throw err})};return version};api.newItemVersion=function newItemVersion(values){var version=api.getItemVersion();values&&version.version.model.updateWith(values,!0);version.version.model.touch();return version}}var ko=require("knockout"),CacheControl=require("./CacheControl");module.exports=GroupRemoteModel;GroupRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchItemFromLocal=function fetchFromLocal(itemID){return localforage.getItem(baseName+itemID)};this.pushItemToLocal=function pushToLocal(itemID,data){return localforage.setItem(baseName+itemID,data)};this.remoteItemFromLocal=function remoteFromLocal(itemID){return localforage.removeItem(baseName+itemID)}};GroupRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl,suffixUrl){suffixUrl=suffixUrl||"";this.fetchItemFromRemote=function fetchFromRemote(itemID){return restClient.get(baseUrl+itemID+suffixUrl)};this.pushItemToRemote=function pushToRemote(itemID,data){var method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"")+suffixUrl;return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+itemID+suffixUrl)}}},{"../utils/ModelVersion":322,"./CacheControl":310,knockout:!1,localforage:!1}],319:[function(require,module,exports){"use strict";function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[item[byField]]={index:itemIndex,item:item}});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function IndexedGroupListCache(settings){function newCacheEntry(list){return{control:new CacheControl({ttl:settings.listTtl}),list:list||null,index:list&&createIndex(list,settings.itemIdField)||{}}}function setGroupCache(groupID,list){var cacheEntry=cache[groupID];if(cacheEntry){cacheEntry.list=list||[];cacheEntry.index=createIndex(list||[],settings.itemIdField)}else cacheEntry=cache[groupID]=newCacheEntry(list);cacheEntry.control.latest=new Date}function getGroupCache(groupID){var cacheEntry=cache[groupID];return cacheEntry||newCacheEntry()}function getItemCache(groupID,itemID){var cacheEntry=cache[groupID];return cacheEntry?cacheEntry.index[itemID]||null:null}function setItemCache(groupID,itemID,item){var cacheEntry=cache[groupID]||newCacheEntry([]),itemEntry=cacheEntry.index[itemID];if(itemEntry){cacheEntry.list[itemEntry.index]=item;itemEntry.item=item}else{var itemIndex=cacheEntry.list.push(item)-1;cacheEntry.index[itemID]={index:itemIndex,item:item}}}function delItemCache(groupID,itemID){var groupEntry=cache[groupID]||null;if(groupEntry){var itemEntry=groupEntry.index[itemID];if(itemEntry){groupEntry.list.splice(itemEntry.index,1);delete groupEntry.index[itemID];Object.keys(groupEntry.index).forEach(function(key){groupEntry.index[key].index>itemEntry.index&&groupEntry.index[key].index--})}}}function delGroupCache(groupID){var groupEntry=cache[groupID]||null;groupEntry&&delete cache[groupID]}settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.groupIdField=required(settings.groupIdField,"groupIdField is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");var cache={};this.clearCache=function clearCache(){cache={}};this.setGroupCache=setGroupCache;this.getGroupCache=getGroupCache;this.getItemCache=getItemCache;this.setItemCache=setItemCache;this.delItemCache=delItemCache;this.delGroupCache=delGroupCache}var CacheControl=require("./CacheControl");module.exports=IndexedGroupListCache},{"./CacheControl":310}],320:[function(require,module,exports){"use strict";function createItemIndexEntry(list,itemIndex){return{index:itemIndex,get item(){return list[this.index]}}}function createIndex(list,byField){var index={};list.forEach(function(item,itemIndex){index[ko.unwrap(item[byField])]=createItemIndexEntry(list,itemIndex)});return index}function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function defaultItemAdapter(oldItem,newItem){return newItem}function IndexedListCache(settings){function getItemCache(itemID){return cache.index[itemID]||null}function adaptItem(newItem){var oldItem=getItemCache(ko.unwrap(newItem[settings.itemIdField]));return settings.itemAdapter(oldItem,newItem)}function adaptList(list){return(list||[]).map(adaptItem)}function setList(list){cache.list(adaptList(list));cache.index=createIndex(cache.list(),settings.itemIdField);cache.control.latest=new Date;unused=!1}function setItemCache(item){var itemID=ko.unwrap(item[settings.itemIdField]),itemEntry=cache.index[itemID];if(itemEntry)cache.list()[itemEntry.index]=adaptItem(item);else{var itemIndex=cache.list.push(adaptItem(item))-1;cache.index[itemID]=createItemIndexEntry(cache.list(),itemIndex)}}function delItemCache(itemID){var itemEntry=cache.index[itemID];if(itemEntry){cache.list.splice(itemEntry.index,1);delete cache.index[itemID];Object.keys(cache.index).forEach(function(key){cache.index[key].index>itemEntry.index&&cache.index[key].index--})}}settings=settings||{};settings.ttl=settings.ttl||0;settings.listTtl=settings.listTtl||settings.ttl||0;settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.itemAdapter="function"==typeof settings.itemAdapter?settings.itemAdapter:defaultItemAdapter;var unused=!0,cache={control:new CacheControl({ttl:settings.listTtl}),list:ko.observableArray([]),index:{}};this.clearCache=function clearCache(){cache.control.latest=null;cache.list([]);cache.index={};unused=!0};this.getItemCache=getItemCache;jsPropertiesTools.defineGetter(this,"control",function(){return cache.control});jsPropertiesTools.defineGetter(this,"list",function(){return cache.list});jsPropertiesTools.defineSetter(this,"list",function(list){return setList(list)});jsPropertiesTools.defineGetter(this,"index",function(){return cache.index});jsPropertiesTools.defineGetter(this,"unused",function(){return unused});this.setItemCache=setItemCache;this.delItemCache=delItemCache}var CacheControl=require("./CacheControl"),jsPropertiesTools=require("./jsPropertiesTools"),ko=require("knockout");module.exports=IndexedListCache},{"./CacheControl":310,"./jsPropertiesTools":347,knockout:!1}],321:[function(require,module,exports){"use strict";function required(val,msg){if(null===val||"undefined"==typeof val)throw new Error(msg||"Required parameter");return val}function ListRemoteModel(settings){function itemAdapter(oldItem,newItem){if(settings.Model){if(oldItem&&oldItem instanceof settings.Model){oldItem.model.updateWith(newItem);return oldItem}return new settings.Model(newItem)}return newItem}function notImplemented(){throw new Error("Not Implemented")}function getPlainCachedList(){var arr=cache.list();return arr.map(function(item){return item&&settings.Model&&item instanceof settings.Model?item.model.toPlainObject():item})}settings=settings||{};settings.listTtl=required(settings.listTtl,"listTtl is required");settings.itemIdField=required(settings.itemIdField,"itemIdField is required");settings.Model=settings.Model||null;this.settings=settings;this.state={isLoading:ko.observable(!1),isSyncing:ko.observable(!1),isSaving:ko.observable(!1),isDeleting:ko.observable(!1)};var cache=new IndexedListCache({listTtl:settings.listTtl,itemIdField:settings.itemIdField,itemAdapter:itemAdapter});this.clearCache=cache.clearCache;this.state.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()||this.isDeleting()},this.state);this.fetchListFromLocal=notImplemented;this.fetchListFromRemote=notImplemented;this.pushListToLocal=notImplemented;this.pushListToRemote=notImplemented;this.removeItemFromRemote=notImplemented;var api=this;jsPropertiesTools.defineGetter(api,"list",function(){return cache.list});jsPropertiesTools.defineSetter(api,"list",function(list){return cache.list=list});api.sync=function sync(){return api.getList()};api.getList=function getList(){if(cache.request)return cache.request;if(cache.control.mustRevalidate()){if(cache.unused){api.state.isLoading(!0);cache.request=this.fetchListFromLocal().then(function(data){api.state.isSyncing(!0);var remotePromise=this.fetchListFromRemote().then(function(serverData){cache.list=serverData;this.pushListToLocal(serverData);api.state.isSyncing(!1);return serverData}.bind(this))["catch"](function(err){if(!data)throw err;api.state.isSyncing(!1);console.error("ListRemoteModel: remote synchronization failed",err)});return data?data:remotePromise}.bind(this)).then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);cache.request=null;return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;throw err});return cache.request}api.state.isSyncing(!0);cache.request=this.fetchListFromRemote().then(function(data){data=data||[];cache.list=data;this.pushListToLocal(data);api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;return cache.list}.bind(this))["catch"](function(err){api.state.isLoading(!1);api.state.isSyncing(!1);cache.request=null;throw err});return cache.request}return Promise.resolve(cache.list)};api.getItem=function getItem(itemID){return api.getList().then(function(){var cacheItem=cache.getItemCache(itemID);if(!cacheItem){console.warn("ListRemoteModel Not found",itemID,settings.Model);throw new Error("Not Found")}return cacheItem.item})};api.getObservableItem=function getObservableItem(itemID){var firstValue=cache.getItemCache(itemID);firstValue=firstValue&&firstValue.item||void 0;var obs=ko.observable(firstValue);obs.sync=function syncObservableItem(){return api.getItem(itemID).then(function(itemModel){obs(itemModel)})};firstValue||obs.sync();return obs};api.createWildcardItem=function createWildcardItem(){var hasID=function(id){return null!==id&&"undefined"!=typeof id},obs=ko.observable(void 0),lastID;obs.sync=function syncObservableItem(itemID){var idChanged=hasID(itemID)&&itemID!==lastID;lastID=hasID(itemID)?itemID:lastID;if(idChanged){var cachedItem=cache.getItemCache(lastID);cachedItem&&cachedItem.item&&obs(cachedItem.item)}return api.getItem(lastID).then(function(itemModel){obs(itemModel);return itemModel})};obs.newItem=function newItem(defaults){obs(settings.Model?new settings.Model(defaults):defaults||{})};return obs};api.setItem=function setItem(data){api.state.isSaving(!0);return this.pushListToRemote(data).then(function(serverData){if(serverData){cache.setItemCache(serverData);this.pushListToLocal(getPlainCachedList())}api.state.isSaving(!1);return serverData}.bind(this))["catch"](function(err){api.state.isSaving(!1);throw err})};api.delItem=function delItem(itemID){api.state.isDeleting(!0);return this.removeItemFromRemote(itemID).then(function(removedData){cache.delItemCache(itemID);this.pushListToLocal(getPlainCachedList());api.state.isDeleting(!1);return removedData}.bind(this))["catch"](function(err){api.state.isDeleting(!1);throw err})};var ModelVersion=require("../utils/ModelVersion");api.createItemVersion=function createItemVersion(itemID){return api.getItem(itemID).then(function(model){return model?new ModelVersion(model):null})};api.newItem=function newItem(values){var version=new ModelVersion(new settings.Model(values));version.version.model.touch();return version}}var ko=require("knockout"),IndexedListCache=require("./IndexedListCache"),jsPropertiesTools=require("./jsPropertiesTools");module.exports=ListRemoteModel;ListRemoteModel.prototype.addLocalforageSupport=function addLocalforageSupport(baseName){var localforage=require("localforage");this.fetchListFromLocal=function fetchListFromLocal(){return localforage.getItem(baseName)};this.pushListToLocal=function pushListToLocal(data){return localforage.setItem(baseName,data)}};ListRemoteModel.prototype.addRestSupport=function addRestSupport(restClient,baseUrl){this.fetchListFromRemote=function fetchListFromRemote(){return restClient.get(baseUrl)};this.pushListToRemote=function pushListToRemote(data){var itemID=data[this.settings.itemIdField],method=itemID?"put":"post",url=baseUrl+(itemID?"/"+itemID:"");return restClient[method](url,data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return restClient["delete"](baseUrl+"/"+itemID)}};ListRemoteModel.prototype.addMockedRemote=function addMockedRemote(dataList){this.fetchListFromRemote=function fetchListFromRemote(){return Promise.resolve(dataList)};this.pushListToRemote=function pushListToRemote(data){return Promise.resolve(data)};this.removeItemFromRemote=function removeItemFromRemote(itemID){return Promise.resolve(itemID)}}},{"../utils/ModelVersion":322,"./IndexedListCache":320,"./jsPropertiesTools":347,knockout:!1,localforage:!1}],322:[function(require,module,exports){"use strict";function ModelVersion(original){EventEmitter.call(this);this.original=original;this.version=original.model.clone(null,!0);this.areDifferent=ko.pureComputed(function areDifferent(){return this.original.model.dataTimestamp()!==this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isNewer=ko.pureComputed(function isNewer(){return this.original.model.dataTimestamp()<this.version.model.dataTimestamp()},this).extend({rateLimit:0});this.isObsolete=ko.pureComputed(function isComputed(){return this.original.model.dataTimestamp()>this.version.model.dataTimestamp()},this).extend({rateLimit:0})}function createRollbackFunction(modelInstance){var backedData=modelInstance.model.toPlainObject(!0),backedTimestamp=modelInstance.model.dataTimestamp();return function rollback(){modelInstance.model.updateWith(backedData,!0);modelInstance.model.dataTimestamp(backedTimestamp)}}var ko=require("knockout"),EventEmitter=require("events").EventEmitter;module.exports=ModelVersion;ModelVersion._inherits(EventEmitter);ModelVersion.prototype.getRollback=function getRollback(from){if("version"===from)return createRollbackFunction(this.version);if("original"===from)return createRollbackFunction(this.original);throw new Error("from value not valid")};ModelVersion.prototype.pull=function pull(options){options=options||{};var result=!1,rollback=null;if(options.evenIfNewer||!this.isNewer()){rollback=createRollbackFunction(this.version);this.version.model.updateWith(this.original,!0);result=!0}this.emit("pull",result,rollback);return result};ModelVersion.prototype.push=function push(options){options=options||{};var result=!1,rollback=null;if(options.evenIfObsolete||!this.isObsolete()){rollback=createRollbackFunction(this.original);this.original.model.updateWith(this.version,!0);result=!0}this.emit("push",result,rollback);return result};ModelVersion.prototype.sync=function sync(){return this.isNewer()?this.push():this.isObsolete()?this.pull():!1}},{events:!1,knockout:!1}],323:[function(require,module,exports){"use strict";function PasswordValidator(password){var test=function(value){this.correctLength=rLength.test(value);this.correctSymbol=rSymbol.test(value);this.correctNumber=rNumber.test(value);this.correctUpper=rUpper.test(value);this.correctLower=rLower.test(value);this.correctCharacterKindsCount=this.correctSymbol+this.correctNumber+this.correctUpper+this.correctLower;this.correctCharacterKinds=this.correctCharacterKindsCount>=MIN_REQUIREMENTS}.bind(this);test(password||"")}var rLength=/.{8,}/,rSymbol=/[^\w\s]|_/,rNumber=/[0-9]/,rUpper=/[A-Z]/,rLower=/[a-z]/,MIN_REQUIREMENTS=3;PasswordValidator.prototype.isCorrectLength=function(){return this.correctLength};PasswordValidator.prototype.isCorrectSymbol=function(){return this.correctSymbol};PasswordValidator.prototype.isCorrectNumber=function(){return this.correctNumber};PasswordValidator.prototype.isCorrectUpper=function(){return this.correctUpper};PasswordValidator.prototype.isCorrectLower=function(){return this.correctLower};PasswordValidator.prototype.getCorrectCharacterKindsCount=function(){return this.correctCharacterKindsCount};PasswordValidator.prototype.isCorrectCharacterKinds=function(){return this.correctCharacterKinds};PasswordValidator.prototype.isValid=function(){return this.isCorrectLength()&&this.isCorrectCharacterKinds()};module.exports=PasswordValidator},{}],324:[function(require,module,exports){"use strict";function RemoteModel(options){EventEmitter.call(this);options=options||{};var firstTimeLoad=!0;this.isLoading=ko.observable(!1);this.isSaving=ko.observable(!1);this.isSyncing=ko.observable(!1);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);if(!options.data)throw new Error("RemoteModel data must be set on constructor and no changed later");this.data=options.data;this.cache=new CacheControl({ttl:options.ttl});this.clearCache=function clearCache(){this.cache.latest=null;this.data.model.reset();firstTimeLoad=!0};this.localStorageName=options.localStorageName||null;this.getData=function getData(){this.load();return this.data};this.newVersion=function newVersion(){var v=new ModelVersion(this.data);this.isLoading.subscribe(function(isIt){isIt||v.pull({evenIfNewer:!0})});v.pushSave=function pushSave(){var rollback=v.getRollback("original");v.push({evenIfObsolete:!0});return this.save().then(function(){v.pull({evenIfNewer:!0})})["catch"](function(error){rollback();throw error})}.bind(this);return v};this.fetch=options.fetch||function fetch(){throw new Error("Not implemented")};this.push=options.push||function push(){throw new Error("Not implementd")};this.loadFromLocal=function loadFromLocal(){var data=this.data;return localforage.getItem(this.localStorageName).then(function(localData){localData&&data.model.updateWith(localData,!0);return localData})};var loadFromRemote=function loadFromRemote(){return this.fetch().then(function(serverData){if(!serverData)throw new Error('Remote model did not returned data, response must be a "Not Found"');this.data.model.updateWith(serverData,!0);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.isLoading()?this.emit("loaded",serverData):this.emit("synced",serverData);this.isLoading(!1);this.isSyncing(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){var wasLoad=this.isLoading();this.isLoading(!1);this.isSyncing(!1);var errPkg={task:wasLoad?"load":"sync",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);throw err}.bind(this))}.bind(this);this.load=function load(options){options=options||{};if(options.forceRemoteUpdate||this.cache.mustRevalidate()){firstTimeLoad?this.isLoading(!0):this.isSyncing(!0);var promise=null;promise=!options.forceRemoteUpdate&&firstTimeLoad&&this.localStorageName?this.loadFromLocal().then(function(localData){if(localData){this.isLoading(!1);this.isSyncing(!1);loadFromRemote()["catch"](function(){});return this.data}return loadFromRemote()}.bind(this)):loadFromRemote();if(firstTimeLoad){firstTimeLoad=!1;return promise}promise["catch"](function(){});return Promise.resolve(this.data)}return Promise.resolve(this.data)};this.saveLocal=function(){return this.localStorageName?localforage.setItem(this.localStorageName,this.data.model.toPlainObject(!0)):Promise.resolve(null)};this.save=function save(){this.isSaving(!0);var ts=this.data.model.dataTimestamp();return this.push().then(function(serverData){this.data.model.updateWith(serverData,!0);this.data.model.dataTimestamp(ts);this.localStorageName&&localforage.setItem(this.localStorageName,serverData);this.emit("saved",serverData);this.isSaving(!1);this.cache.latest=new Date;return this.data}.bind(this))["catch"](function(err){this.isSaving(!1);var errPkg={task:"save",error:err};EventEmitter.listenerCount(this,"error")>0?this.emit("error",errPkg):console.error("RemoteModel Error",errPkg);throw err}.bind(this))};this.sync=function sync(options){this.load(options)["catch"](function(){})}}var ModelVersion=require("../utils/ModelVersion"),CacheControl=require("../utils/CacheControl"),ko=require("knockout"),localforage=require("localforage"),EventEmitter=require("events").EventEmitter;module.exports=RemoteModel;RemoteModel._inherits(EventEmitter)},{"../utils/CacheControl":310,"../utils/ModelVersion":322,events:!1,knockout:!1,localforage:!1}],325:[function(require,module,exports){"use strict";function lowerFirstLetter(n){return n&&n[0]&&n[0].toLowerCase&&n[0].toLowerCase()+n.slice(1)||n}function lowerCamelizeObject(obj){if(!obj||"object"!=typeof obj)return obj;var ret=Array.isArray(obj)?[]:{};for(var k in obj)if(obj.hasOwnProperty(k)){var newk=lowerFirstLetter(k);ret[newk]="object"==typeof obj[k]?lowerCamelizeObject(obj[k]):obj[k]}return ret}function Rest(optionsOrUrl){var url="string"==typeof optionsOrUrl?optionsOrUrl:optionsOrUrl&&optionsOrUrl.url;this.baseUrl=url;this.extraHeaders=null}var $=require("jquery");require("jquery.ajaxQueue");Rest.prototype.get=function get(apiUrl,data){return this.request(apiUrl,"get",data)};Rest.prototype.put=function get(apiUrl,data){return this.request(apiUrl,"put",data)};Rest.prototype.post=function get(apiUrl,data){return this.request(apiUrl,"post",data)};Rest.prototype["delete"]=function get(apiUrl,data){return this.request(apiUrl,"delete",data)};Rest.prototype.putFile=function putFile(apiUrl,data){return this.request(apiUrl,"delete",data,"multipart/form-data")};Rest.prototype.request=function request(apiUrl,httpMethod,data,contentType){var thisRest=this,url=this.baseUrl+apiUrl,xhr=$.ajaxQueue({url:url,cache:!1,dataType:"json",method:httpMethod,headers:this.extraHeaders,data:data&&JSON.parse(JSON.stringify(data)),contentType:contentType||"application/x-www-form-urlencoded"}),promiseXhr=Promise.resolve(xhr).then(lowerCamelizeObject)["catch"](function(err){if(401===err.status){var retry=request.bind(this,apiUrl,httpMethod,data,contentType),retryPromise=thisRest.onAuthorizationRequired(retry);if(retryPromise)return Promise.resolve(retryPromise)["catch"](function(){throw err})}throw err});promiseXhr.xhr=xhr;return promiseXhr};Rest.prototype.onAuthorizationRequired=function onAuthorizationRequired(){};module.exports=Rest},{jquery:!1}],326:[function(require,module,exports){"use strict";var RouteParser=require("route-parser"),$=require("jquery"),Route=function(expression,defaults){this.routeParser=new RouteParser(expression);this.defaults=defaults||{}};Route.prototype.match=function(url){var match=this.routeParser.match(url);return match?$.extend(this.defaults,match):!1};var RouteMatcher=function(routes,defaults){this.routes=routes;this.defaults=defaults||{}};RouteMatcher.prototype.match=function(url){var firstMatch=!1;this.routes.some(function(route){var m=route.match(url);if(m){firstMatch=m;return!0}});return firstMatch?$.extend(this.defaults,firstMatch):!1};module.exports={RouteMatcher:RouteMatcher,Route:Route,RouteParser:RouteParser}},{jquery:!1,"route-parser":98}],327:[function(require,module,exports){function Time(date,hour,minute,second){if(!(date instanceof Date)){second=minute;minute=hour;hour=date;date=new Date}return new Date(date.getFullYear(),date.getMonth(),date.getDate(),hour||0,minute||0,second||0)}module.exports=Time},{}],328:[function(require,module,exports){"use strict";module.exports=function createAccessControl(app){return function accessControl(route){var activity=app.getActivityControllerByRoute(route),user=app.model.user(),currentType=user&&user.userType();if(activity&&activity.accessLevel){var can=activity.accessLevel&currentType;if(!can)return{requiredLevel:activity.accessLevel,currentType:currentType}}return null}}},{}],329:[function(require,module,exports){"use strict";var Appointment=require("../models/Appointment"),moment=require("moment-timezone");exports.sortAppointments=function(a,b){var as=a.startTime(),ae=a.endTime(),bs=b.startTime(),be=b.endTime();if(null===as)return-1;if(null===bs)return 1;var eq=as.toISOString()===bs.toISOString();return eq?null===ae?-1:null===be?1:ae-be:as-bs};exports.fillPreparationTimeSlots=function fillPreparationTimeSlots(date,slots,preparationHours){if(0!==preparationHours){var prevEnd=date;slots.forEach(function(slot,index){if(slot.id()>0&&slot.sourceBooking()){var end=slot.startTime(),start=moment(end).subtract(preparationHours,"hours").toDate();if(end>prevEnd){start=prevEnd>start?prevEnd:start;slots.splice(index,0,Appointment.newPreparationTimeSlot({start:start,end:end}))}}prevEnd=slot.endTime()})}};exports.fillDayAvailability=function fillDayAvailability(date,appointmentsList,freeScheduleSlots,schedulingPreferences){var slots=appointmentsList.slice(0);slots.sort(exports.sortAppointments);exports.fillPreparationTimeSlots(date,slots,schedulingPreferences.betweenTime());var filledSlots=[],zeroTime="00:00:00",last=zeroTime,lastDateTime=null,timeFormat="HH:mm:ss";if(0===slots.length){var fullStart=moment(date).startOf("day"),fullEnd=fullStart.clone().add(1,"days");filledSlots=exports.createScheduleSlots({start:fullStart.toDate(),end:fullEnd.toDate()},freeScheduleSlots)}else{slots.forEach(function(slot){var start=slot.startTime(),s=moment(start),end=slot.endTime(),e=moment(end);if(s.format(timeFormat)>last){null===lastDateTime&&(lastDateTime=new Date(start.getFullYear(),start.getMonth(),start.getDate(),0,0,0));filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:start},freeScheduleSlots))}filledSlots.push(slot);lastDateTime=end;last=e.format(timeFormat)});var lastEnd=lastDateTime&&moment(lastDateTime).format(timeFormat);if(lastEnd!==zeroTime){var nextMidnight=new Date(lastDateTime.getFullYear(),lastDateTime.getMonth(),lastDateTime.getDate()+1,0,0,0);filledSlots.push.apply(filledSlots,exports.createScheduleSlots({start:lastDateTime,end:nextMidnight},freeScheduleSlots))}}return filledSlots};exports.createScheduleSlots=function createScheduleSlots(range,freeScheduleSlots){if(freeScheduleSlots.length){var lists=freeScheduleSlots.map(function(freeRange){return exports.createScheduleSlotsForRanges(range.start,range.end,freeRange.start,freeRange.end)}),l=lists.reduce(function(l,nl){return l.concat.apply(l,nl)},[]);return l}return exports.createScheduleSlotsForRanges(range.start,range.end,range.start,range.start)};exports.createScheduleSlotsForRanges=function createScheduleSlotsForRanges(start,end,from,to){var list=[],beforeSchedule=from>start&&from>=end,afterSchedule=end>to&&start>=to,insideSchedule=start>=from&&to>=end;if(beforeSchedule||afterSchedule)list.push(Appointment.newUnavailableSlot({start:start,end:end}));else if(insideSchedule)list.push(Appointment.newFreeSlot({start:start,end:end}));else{var crossStart=from>start&&end>from,crossEnd=to>start&&end>to;crossStart&&list.push(Appointment.newUnavailableSlot({start:start,end:from}));crossEnd&&list.push(Appointment.newUnavailableSlot({start:to,end:end}));crossStart&&crossEnd?list.push(Appointment.newFreeSlot({start:from,end:to})):crossStart?list.push(Appointment.newFreeSlot({start:from,end:end})):crossEnd&&list.push(Appointment.newFreeSlot({start:start,end:to}))}return list.sort(exports.sortAppointments)};var timeZoneList=require("./timeZoneList");exports.createFreeScheduleSlots=function(date,weeklySchedule){var scheduleTimeZone=weeklySchedule.timeZone();scheduleTimeZone||(scheduleTimeZone=timeZoneList.getLocalTimeZone());var localStart=moment(date).startOf("day"),localEnd=moment(date).endOf("day"),tzStart=localStart.clone().tz(scheduleTimeZone),tzEnd=localEnd.clone().tz(scheduleTimeZone),computeScheduleHoursAsLocal=function(weekDaySchedule,tzDateMoment){return weekDaySchedule.map(function(range){return{start:tzDateMoment.clone().startOf("day").add(moment.duration(range.start())).toDate(),end:tzDateMoment.clone().startOf("day").add(moment.duration(range.end())).toDate()}})},weekDayStart=tzStart.day(),schedule=weeklySchedule.weekDays[weekDayStart](),locals=computeScheduleHoursAsLocal(schedule,tzStart),weekDayEnd=tzEnd.day();if(weekDayStart!==weekDayEnd){schedule=weeklySchedule.weekDays[weekDayEnd]();locals=locals.concat(computeScheduleHoursAsLocal(schedule,tzEnd))}var f=[];locals.forEach(function(range){range.end<=localStart||range.start>=localEnd||f.push({start:new Date(Math.max(localStart,range.start)),end:new Date(Math.min(localEnd,range.end))
})});return f}},{"../models/Appointment":232,"./timeZoneList":366,"moment-timezone":!1}],330:[function(require,module,exports){"use strict";function createHelpers(ko){var helpers={};helpers.popover={update:function(element,valueAccessor){var srcOptions=ko.unwrap(valueAccessor()),options=$.extend(!0,{},srcOptions);options.content=ko.unwrap(srcOptions.content);if(options.content){options.content=exports.i18n&&exports.i18n.t(options.content)||options.content;$(element).popover("destroy").popover(options);$(element).is(":focus")&&$(element).popover("show")}else $(element).popover("destroy")}};return helpers}function plugIn(ko,prefix){var name,helpers=createHelpers(ko);for(var h in helpers)if(!helpers.hasOwnProperty||helpers.hasOwnProperty(h)){name=prefix?prefix+h[0].toUpperCase()+h.slice(1):h;ko.bindingHandlers[name]=helpers[h]}}var $=require("jquery");exports.i18n=null;exports.plugIn=plugIn;exports.createBindingHelpers=createHelpers},{jquery:!1}],331:[function(require,module,exports){"use strict";var $=require("jquery");require("bootstrap");require("bootstrap-switch");exports.plugIn=function plugIn(ko,prefix){ko.bindingHandlers[prefix?prefix+"switch":"switch"]={init:function(element,valueAccessor){$(element).bootstrapSwitch();$(element).on("switchChange.bootstrapSwitch",function(e,state){var v=valueAccessor()||{},oldState=!!ko.unwrap(v.state),newState=!!state;oldState!==newState&&(ko.isObservable(v.state)?ko.isWriteableObservable(v.state)&&v.state(newState):v.state=newState)})},update:function(element,valueAccessor){var srcOptions=valueAccessor(),options=srcOptions||{};options=ko.toJS(options);var $el=$(element);Object.keys(options).forEach(function(key){$el.bootstrapSwitch(key,options[key])})}}}},{jquery:!1}],332:[function(require,module,exports){"use strict";function copyText(text){var errMsg;try{if(window.cordova&&window.cordova.plugins&&window.cordova.plugins.clipboard)window.cordova.plugins.clipboard.copy(text);else{var $code=$('<textarea style="position:absolute;left:-90999px;z-index:-9000"/>"');$code.appendTo("body").val(text).select().get(0).setSelectionRange(0,99999);document.execCommand("copy")||(errMsg="Impossible to copy text.");$code.remove()}}catch(err){console.error("clipboard.copyText",err);errMsg="Impossible to copy text."}return errMsg}var $=require("jquery");exports.copy=function(value){if(null===value||"undefined"==typeof value)return"Nothing to copy";"number"==typeof value&&(value=value.toString());return"string"==typeof value?copyText(value):"Cannot copy: "+typeof value}},{jquery:!1}],333:[function(require,module,exports){"use strict";var moment=require("moment");exports.forRange=function forRange(from,to,size,duration,roundUp,includeEndTime){from=new Date(from);to=new Date(to);if(!duration)throw new Error("forRange: Duration is required");var i=moment(from),d,slots=[],now=new Date,enought;if(roundUp){var r=moment(from),minutes=r.minutes(),rest=minutes%size;rest&&(minutes=minutes-rest+size);from=r.minutes(minutes).seconds(0).toDate();i=r}includeEndTime&&(to=moment(to).add(size,"minutes").toDate());if(from>=to)return slots;for(;i.toDate()<to;){d=i.clone().toDate();enought=i.clone().add(duration,"minutes").toDate();d>=now&&to>=enought&&slots.push(d);i.add(size,"minutes")}return slots};exports.forList=function forList(list,size,duration,roundUp,includeEndTime){var slots=[];list.forEach(function(item){"free"===item.availability&&slots.push.apply(slots,exports.forRange(item.startTime,item.endTime,size,duration,roundUp,includeEndTime))});return slots};exports.getTotalFreeMinutes=function getTotalFreeMinutes(list){return list.reduce(function(count,item){if("free"===item.availability){var s=moment(item.startTime),e=moment(item.endTime);return count+e.diff(s,"minutes")}return count},0)};exports.getAvailabilityTag=function(list){if(!list||0===list.length)return"none";var minutes=exports.getTotalFreeMinutes(list),perc=minutes/480*100,date=moment(list[0].startTime).startOf("day").toDate(),today=moment().startOf("day").toDate();return today>date?"past":perc>=100?"full":perc>=50?"medium":perc>0?"low":"none"};exports.filterListBy=function filterListBy(list,start,end){var nstart=new Date(start),nend=new Date(end),result=[];list.some(function(timeRange){var ts=new Date(timeRange.startTime),te=new Date(timeRange.endTime);if(ts>=nend)return!0;te>nstart&&(nstart>ts?result.push({startTime:nstart.toISOString(),endTime:(te>nend?nend:te).toISOString(),availability:timeRange.availability}):te>nend?result.push({startTime:ts.toISOString(),endTime:nend.toISOString(),availability:timeRange.availability}):result.push(timeRange));return void 0});return result};exports.splitListInLocalDates=function filterListBy(list){var isodateFormat="YYYY-MM-DD",lastIsodate,group,result={};list.forEach(function(timeRange){var start=moment(timeRange.startTime),isostart=start.format(isodateFormat);if(isostart!==lastIsodate){group=result[isostart]=[];lastIsodate=isostart}var end=moment(timeRange.endTime),endJustDate=end.startOf("day"),isoend=end.format(isodateFormat),nextDayStart=start.clone().startOf("day").add(1,"day");if(isostart!==isoend&&end.format()!==nextDayStart.format()){group.push({startTime:start.format(),endTime:nextDayStart.format(),availability:timeRange.availability});for(var idate=nextDayStart.clone();endJustDate>idate;){var idateIso=idate.format(isodateFormat),idatetimeIso=idate.format();idate.add(1,"day");result[idateIso]=[{startTime:idatetimeIso,endTime:idate.format(),availability:timeRange.availability}]}result[idate.format(isodateFormat)]=[{startTime:idate.format(),endTime:end.format(),availability:timeRange.availability}]}else group.push(timeRange)});return result}},{moment:!1}],334:[function(require,module,exports){"use strict";var $=require("jquery"),moment=require("moment"),createTimeSlots=require("./createTimeSlots");exports.create=function createDatepickerAvailability(app,$datepicker,isLoading){var daysElements=$datepicker.datepicker("getDaysElements"),prevMonth=null,prevUserID=null;app.model.availability.on("clearCache",function(){prevMonth=null});var tagAvailability=function tagAvailability(date,userID,refresh){var month=date.getMonth();if(userID&&(month!==prevMonth||prevUserID!==userID||refresh)){prevMonth=month;prevUserID=userID;var start=moment(date).clone().startOf("month").startOf("week"),end=start.clone().add(6,"weeks");isLoading&&isLoading(!0);app.model.availability.times(userID,start,end).then(function(result){if(month===$datepicker.datepicker("getViewDate").getMonth()){var byDate=createTimeSlots.splitListInLocalDates(result.times);daysElements.each(function(){var $dateTd=$(this),id=$dateTd.data("date-time"),timeRangeList=byDate[moment(id).format("YYYY-MM-DD")];if(id&&timeRangeList){var cellClass=$dateTd.attr("class").replace(/(^|\s)tag-[^\s]+/,""),cls="";switch(createTimeSlots.getAvailabilityTag(timeRangeList)){case"past":cls="tag-muted";break;case"full":cls="tag-blank";break;case"medium":cls="tag-dark";break;case"low":cls="tag-warning";break;case"none":cls="tag-danger"}$dateTd.attr("class",cellClass+" "+cls)}})}})["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){isLoading&&isLoading(!1)}.bind(this))}};$datepicker.on("viewDateChanged",function(e,d){"days"===d.viewMode&&tagAvailability(d.viewDate,prevUserID)});return tagAvailability}},{"./createTimeSlots":333,jquery:!1,moment:!1}],335:[function(require,module,exports){"use strict";var moment=require("moment");module.exports=function duration2Language(duration){duration=moment.duration(duration);var y=duration.years(),d=duration.days(),h=duration.hours(),m=duration.minutes(),s=duration.seconds(),l=duration.milliseconds(),parts=[];1===y?parts.push("a year"):y&&parts.push(y+" years");1===d?parts.push("a day"):d&&parts.push(d+" days");1===h?parts.push("an hour"):h&&parts.push(h+" hours");1===m?parts.push("a minute"):m&&parts.push(m+" minutes");1===s?parts.push("a second"):s&&parts.push(s+" seconds");1===l?parts.push("a millisecond"):l&&parts.push(l+" milliseconds");return parts.join(", ")}},{moment:!1}],336:[function(require,module,exports){"use strict";var specials=["-","[","]","/","{","}","(",")","*","+","?",".","\\","^","$","|"],regex=RegExp("["+specials.join("\\")+"]","g"),escapeRegExp=function(str){return str.replace(regex,"\\$&")};module.exports=escapeRegExp},{}],337:[function(require,module,exports){"use strict";var specials=["#","&","~","=",">","'",":",'"',"!",";",","],regexSpecials=[".","*","+","|","[","]","(",")","/","^","$"],sRE=new RegExp("("+specials.join("|")+"|\\"+regexSpecials.join("|\\")+")","g");module.exports=function(selector){return selector.replace(sRE,"\\$1")}},{}],338:[function(require,module,exports){"use strict";var loader=require("./loader"),$=require("jquery"),ko=require("knockout"),settings={language:"en-US",appId:null},apiStatus={ready:ko.observable(!!window.FB),loading:!1,stack:[]};exports.load=function(){if(!apiStatus.loading){apiStatus.loading=!0;settings.language=$("[data-facebook-language]").data("facebook-language");settings.appId=$("[data-facebook-appid]").data("facebook-appid");loader.load({scripts:["//connect.facebook.net/"+settings.language+"/all.js"],completeVerification:function(){return!!window.FB},complete:function(){window.FB.init({appId:settings.appId,status:!0,cookie:!0,xfbml:!1,version:"v2.8"});apiStatus.ready(!0);apiStatus.loading=!1;for(var i=0;i<apiStatus.stack.length;i++)try{apiStatus.stack[i](window.FB)}catch(e){console&&console.error&&console.error(e)}}})}};exports.isReady=ko.pureComputed(function(){return apiStatus.ready()});exports.ready=function facebookReady(readyCallback){if(apiStatus.ready())"function"==typeof readyCallback&&readyCallback(window.FB);else{apiStatus.stack.push(readyCallback);exports.load()}};exports.login=function facebookLogin(options){return new Promise(function(success,error){exports.ready(function(FB){FB.login(function(response){response.authResponse?success({authResponse:response.authResponse,FB:FB,response:response}):error({response:response,FB:FB})},options)})})}},{"./loader":348,jquery:!1,knockout:!1}],339:[function(require,module,exports){"use strict";var $=require("jquery");require("jquery.fileupload-image");exports.plugIn=function plugIn(ko){ko.bindingHandlers.fileUploader={init:function(element,valueAccessor,allBindings,viewModel){var setup=valueAccessor();if(setup){var opts=ko.unwrap(setup.options);if(opts){var handlers=ko.unwrap(setup.eventHandlers),$el=$(element).fileupload(opts);handlers&&Object.keys(handlers).forEach(function(eventName){$el.on(eventName,handlers[eventName].bind(viewModel))})}}}}}},{jquery:!1}],340:[function(require,module,exports){"use strict";module.exports=function getDateWithoutTime(date){date?date instanceof Date||(date=new Date(date)):date=new Date;return new Date(date.getFullYear(),date.getMonth(),date.getDate(),0,0,0)}},{}],341:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function getObservable(obsOrValue){return"function"==typeof obsOrValue?obsOrValue:ko.observable(obsOrValue)}},{knockout:!1}],342:[function(require,module,exports){"user strict";module.exports=function getUrlQuery(url){url=url||window.location.href;var vars=[],hash,queryIndex=url.indexOf("?");if(queryIndex>-1)for(var hashes=url.slice(queryIndex+1).split("&"),i=0;i<hashes.length;i++){hash=hashes[i].split("=");vars.push(hash[0]);vars[hash[0]]=decodeURIComponent(hash[1])}return vars}},{}],343:[function(require,module,exports){var loader=require("./loader"),stack=[],googleMapReady=module.exports=function googleMapReady(ready){stack.push(ready);if(googleMapReady.isReady)ready(google);else if(!googleMapReady.isLoading){googleMapReady.isLoading=!0;loader.load({scripts:["https://www.google.com/jsapi"],completeVerification:function(){return!!window.google},complete:function(){google.load("maps","3.23",{other_params:"libraries=places",callback:function(){googleMapReady.isReady=!0;googleMapReady.isLoading=!1;for(var i=0;i<stack.length;i++)try{stack[i](google)}catch(e){}}})}})}};googleMapReady.refreshMap=function refreshMaps(map){googleMapReady(function(){var center=map.getCenter();google.maps.event.addListenerOnce(map,"resize",function(){center&&map.setCenter(center)});google.maps.event.trigger(map,"resize")})}},{"./loader":348}],344:[function(require,module,exports){"use strict";function groupBy(collection,iteratee,defaultKeys){var defaultGroups={};defaultKeys=defaultKeys||[];defaultKeys.forEach(function(key){defaultGroups[key]=[]});return $.extend(defaultGroups,lodashGroupBy(collection,iteratee))}var lodashGroupBy=require("lodash/groupBy"),$=require("jquery");module.exports=groupBy},{jquery:!1,"lodash/groupBy":78}],345:[function(require,module,exports){var i18n={};i18n.distanceUnits={ES:"km",US:"miles"};i18n.numericMilesSeparator={"es-ES":".","es-US":".","en-US":",","en-ES":","};i18n.numericDecimalSeparator={"es-ES":",","es-US":",","en-US":".","en-ES":"."};i18n.moneySymbolPrefix={ES:"",US:"$"};i18n.moneySymbolSufix={ES:"€",US:""};i18n.getCurrentCulture=function getCurrentCulture(){var c=document.documentElement.getAttribute("data-culture"),s=c.split("-");return{culture:c,language:s[0],country:s[1]}};i18n.convertMilesKm=function convertMilesKm(q,unit){var MILES_TO_KM=1.609;if("miles"==unit)return MILES_TO_KM*q;if("km"==unit)return q/MILES_TO_KM;console&&console.log&&console.log("convertMilesKm: Unrecognized unit "+unit);return 0};"undefined"!=typeof module&&module.exports&&(module.exports=i18n)},{}],346:[function(require,module,exports){"use strict";var $=require("jquery");$.fn.multiline=function(text){this.text(text);this.html(this.html().replace(/\n/g,"<br/>"));return this}},{jquery:!1}],347:[function(require,module,exports){"use strict";function accessorDescriptor(field,fun){var desc={enumerable:!0,configurable:!0};desc[field]=fun;return desc}function defineGetter(obj,prop,get){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("get",get));if(Object.prototype.__defineGetter__)return obj.__defineGetter__(prop,get);throw new Error("browser does not support getters")}function defineSetter(obj,prop,set){if(Object.defineProperty)return Object.defineProperty(obj,prop,accessorDescriptor("set",set));if(Object.prototype.__defineSetter__)return obj.__defineSetter__(prop,set);throw new Error("browser does not support setters")}module.exports={defineGetter:defineGetter,defineSetter:defineSetter}},{}],348:[function(require,module,exports){"use strict";function promiseTimeout(milliseconds){return new Promise(function(resolve){setTimeout(function(){resolve()},milliseconds)})}var $=require("jquery");exports.load=function(opts){function performComplete(){if("function"!=typeof opts.completeVerification||opts.completeVerification()){opts.complete();return Promise.resolve()}console&&console.warn&&console.warn("LC.load.completeVerification failed for "+opts.scripts[0]+" retrying it in "+opts.trialsInterval+"ms");return promiseTimeout(opts.trialsInterval).then(performComplete)}function load(){return Promise.all(opts.scripts.map(function(sc){return $.getScript(sc)})).then(opts.complete?performComplete:null)}opts=$.extend(!0,{scripts:[],complete:null,completeVerification:null,loadDelay:0,trialsInterval:500},opts);return opts.scripts.length?opts.loadDelay?promiseTimeout(opts.loadDelay).then(load):load():Promise.resolve()}},{jquery:!1}],349:[function(require,module,exports){"use strict";function mapBy(collection,mapping){var mapped={};collection.forEach(function(object){mapped[mapping(object)]=object});return mapped}module.exports=mapBy},{}],350:[function(require,module,exports){"use strict";function takePhotoSupported(){return navigator.camera&&navigator.camera.getPicture}function getPreviewPhotoUrl(url){if(!url)return null;var iFile=url.indexOf("file://");if(userAgentFlags.isWkWebview&&0===window.location.protocol.indexOf("http")&&0===iFile){var m=/\/Application\/[^\/]+(.+)$/.exec(url);return m&&2===m.length?m[1]:url.substr(iFile)}return url}function cameraGetPicture(settings){return new Promise(function(resolve,reject){navigator.camera.getPicture(resolve,reject,extend(!0,{},defaultPhotoSettings,settings))})}function moveLocalPhoto(uri,destFolder,destName){return new Promise(function(resolve,reject){var onTempEntry=function(entry){var d=new Date,n=d.getTime(),newFileName=(destName||n)+".jpg";window.requestFileSystem(window.LocalFileSystem.PERSISTENT,0,function(fileSys){fileSys.root.getDirectory(destFolder,{create:!0},function(directory){entry.moveTo(directory,newFileName,function(new_entry){var path=new_entry.fullPath,url=new_entry.toURL();resolve({path:path,url:url})},reject)},reject)},reject)};window.resolveLocalFileSystemURI(uri,onTempEntry,reject)})}function uploadLocalFile(localFileUri,remoteUri,options){return new Promise(function(resolve,reject){remoteUri=encodeURI(remoteUri);var fuopts=new FileUploadOptions;Object.keys(options).forEach(function(option){fuopts[option]=options[option]});fuopts.fileKey||(fuopts.fileKey="file");fuopts.fileName||(fuopts.fileName=localFileUri.substr(localFileUri.lastIndexOf("/")+1));fuopts.mimeType||(fuopts.mimeType="image/jpeg");fuopts.headers=fuopts.headers||{};fuopts.headers.Connection="close";var ft=new FileTransfer;ft.upload(localFileUri,remoteUri,resolve,reject,fuopts)})}var extend=require("jquery").extend,userAgentFlags=require("./userAgentFlags")(),defaultPhotoSettings={destinationType:window.Camera&&window.Camera.DestinationType.FILE_URI,quality:78,mediaType:window.Camera&&window.Camera.MediaType.PICTURE,saveToPhotoAlbum:!1};exports.defaultPhotoSettings=defaultPhotoSettings;exports.takePhotoSupported=takePhotoSupported;exports.getPreviewPhotoUrl=getPreviewPhotoUrl;exports.cameraGetPicture=cameraGetPicture;exports.moveLocalPhoto=moveLocalPhoto;exports.uploadLocalFile=uploadLocalFile;exports.uploadLocalFileJson=function(localFileUri,remoteUri,options){return uploadLocalFile(localFileUri,remoteUri,options).then(function(data){if(data&&data.response&&"string"==typeof data.response)try{return JSON.parse(data.response)}catch(ex){}return null})}},{"./userAgentFlags":368,jquery:!1}],351:[function(require,module,exports){"use strict";var $=require("jquery");exports.plugIn=function plugIn(ko){ko.bindingHandlers.pressEnter={init:function(element,valueAccessor,allBindings,viewModel){var callback=valueAccessor();$(element).keypress(function(event){var keyCode=event.which?event.which:event.keyCode;if(13===keyCode){callback.call(viewModel);return!1}return!0})}}}},{jquery:!1}],352:[function(require,module,exports){"use strict";var map={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","Æ":"AE","Ç":"C","È":"E","É":"E","Ê":"E","Ë":"E","Ì":"I","Í":"I","Î":"I","Ï":"I","Ð":"D","Ñ":"N","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","Ù":"U","Ú":"U","Û":"U","Ü":"U","Ý":"Y","ß":"s","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"C","ć":"c","Ĉ":"C","ĉ":"c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"G","ĝ":"g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"H","ĥ":"h","Ħ":"H","ħ":"h","Ĩ":"I","ĩ":"i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"N","ń":"n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":"O","ő":"o","Œ":"OE","œ":"oe","Ŕ":"R","ŕ":"r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"S","ś":"s","Ŝ":"S","ŝ":"s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"U","ũ":"u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":"U","ű":"u","Ų":"U","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","ź":"z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s","ƒ":"f","Ơ":"O","ơ":"o","Ư":"U","ư":"u","Ǎ":"A","ǎ":"a","Ǐ":"I","ǐ":"i","Ǒ":"O","ǒ":"o","Ǔ":"U","ǔ":"u","Ǖ":"U","ǖ":"u","Ǘ":"U","ǘ":"u","Ǚ":"U","ǚ":"u","Ǜ":"U","ǜ":"u","Ǻ":"A","ǻ":"a","Ǽ":"AE","ǽ":"ae","Ǿ":"O","ǿ":"o"};module.exports=function removeAccent(str){for(var res="",c,i=0,l=str.length;l>i;i++){c=str.charAt(i);res+=map[c]||c}return res}},{}],353:[function(require,module,exports){"use strict";var $=require("jquery");module.exports=function scrollToElement(el,options){el=el instanceof $?el:$(el);var parent=$(el).parent(),topOffset=options&&options.topOffset||0,animation=options&&options.animation,atRoot=!1;do{if(!parent||!parent.length)return;atRoot=parent.is("html,body");var relativeTop=el.offset().top,elementTop=relativeTop-topOffset;if(atRoot)animation?$("html,body").stop().animate({scrollTop:elementTop},animation):window.scroll(0,elementTop);else{var scrollingTop=elementTop+parent.scrollTop()-parent.offset().top;animation?parent.stop().animate({scrollTop:scrollingTop},animation):parent.scrollTop(scrollingTop)}parent=parent.parent()}while(!atRoot)}},{jquery:!1}],354:[function(require,module,exports){"use strict";function DomItemsManager(settings){this.idAttributeName=settings.idAttributeName||"id";this.allowDuplicates=!!settings.allowDuplicates||!1;this.root=settings.root||"body";this.$root=null;var defaultDelay=140,flags=getFlags();(!flags.isMobile||flags.isChrome||flags.isWkWebview)&&(defaultDelay=40);this.switchDelay=settings.switchDelay||defaultDelay}var $=require("jquery"),escapeSelector=require("../escapeSelector"),getFlags=require("../userAgentFlags");module.exports=DomItemsManager;DomItemsManager.prototype.getAllItems=function getAllItems(){return this.$root.children("["+this.idAttributeName+"]")};DomItemsManager.prototype.find=function find(containerName,root){var $root=$(root||this.$root);return $root.children("["+this.idAttributeName+'="'+escapeSelector(containerName)+'"]')};DomItemsManager.prototype.getActive=function getActive(){return this.$root.children("["+this.idAttributeName+"]:visible")};DomItemsManager.prototype.inject=function inject(name,html){html=html.replace(/^[\s\S]*<body.*?>|<\/body>[\s\S]*$/g,"");var $html=$("<div/>",{html:html}),$c=this.find(name,$html);0===$c.length&&($c=$html.attr(this.idAttributeName,name));if(!this.allowDuplicates){var $prev=this.find(name);if($prev.length>0){$prev.replaceWith($c);$c=$prev}}$c.appendTo(this.$root)};DomItemsManager.prototype["switch"]=function switchActiveItem($from,$to,shell,state){function hideit(){var fromIsHidden=$from.is("[hidden]");if($from.length>0&&!fromIsHidden){shell.emit(shell.events.willClose,$from,state);$from.find(":focus").blur();$from.attr("hidden","hidden").css("display","none").css("z-index","");shell.emit(shell.events.closed,$from,state)}else $from.find(":focus").blur()}var toName=state.route.name;this.disableAccess();var toIsHidden=$to.is("[hidden]");if(toIsHidden){shell.emit(shell.events.willOpen,$to,state);$to.css("zIndex",-1);$to.removeAttr("hidden").css("display","block");shell.emit(shell.events.itemReady,$to,state);setTimeout(function(){if(toName===shell.currentRoute.name){hideit();$to.css("zIndex",201);this.enableAccess();shell.emit(shell.events.opened,$to,state)}}.bind(this),this.switchDelay)}else{if(toName!==shell.currentRoute.name)return;shell.emit(shell.events.itemReady,$to,state);this.enableAccess();hideit()}};DomItemsManager.prototype.init=function init(){this.$root=$(this.root||"body");this.getAllItems().attr("hidden","hidden").css("display","none");$('<div class="items-backstage"/>').css({background:this.$root.css("background-color")||"white",position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:0}).appendTo(this.$root);var $disableLayer=$('<div class="items-disable-layer"/>').css({background:"White",opacity:0,position:"fixed",top:0,right:0,bottom:0,left:0,zIndex:-1}).appendTo(this.$root);this.disableAccess=function(){$disableLayer.css("zIndex",90900)};this.enableAccess=function(){$disableLayer.css("zIndex",-2)}}},{"../escapeSelector":337,"../userAgentFlags":368,jquery:!1}],355:[function(require,module,exports){"use strict";function Shell(settings){deps.EventEmitter.call(this);this.$=settings.jquery||deps.jquery;this.$root=this.$(settings.root);this.baseUrl=settings.baseUrl||"";this.forceHashbang=settings.forceHashbang||!1;this.useSingleHashForRouting=this.forceHashbang?!1:settings.useSingleHashForRouting||!1;this.linkEvent=settings.linkEvent||"click";this.parseUrl=(settings.parseUrl||deps.parseUrl).bind(this,this.baseUrl);this.absolutizeUrl=(settings.absolutizeUrl||deps.absolutizeUrl).bind(this,this.baseUrl);this.history=settings.history||window.history;this.indexName=settings.indexName||"index";this.items=settings.domItemsManager;this.loader="undefined"==typeof settings.loader?deps.loader:settings.loader;this.loader&&(this.loader.baseUrl=this.baseUrl);this.events={willOpen:"shell-will-open",willClose:"shell-will-close",itemReady:"shell-item-ready",closed:"shell-closed",opened:"shell-opened"};this.accessControl=settings.accessControl||deps.accessControl;this.forbiddenAccessName=settings.forbiddenAccessName||this.indexName;this.currentRoute=null;this.referrerRoute=null}var deps=require("./dependencies");Shell.prototype=Object.create(deps.EventEmitter.prototype,{constructor:{value:Shell,enumerable:!1,writable:!0,configurable:!0}});module.exports=Shell;Shell.prototype.go=function go(url,state,useReplace){if("string"==typeof url){this.forceHashbang?/^#!/.test(url)||(url="#!"+url):url=this.absolutizeUrl(url);useReplace?this.history.replaceState(state,void 0,url):this.history.pushState(state,void 0,url);return this.replace(state)}console.error("Shell.go aborted. It needs a string as URL, given:",url)};Shell.prototype.goBack=function goBack(state,steps){steps=0-(steps||1);if(0>steps&&Math.abs(steps)>=this.history.length)this.go(this.indexName);else{this._pendingStateUpdate=state;this.history.go(steps)}};Shell.prototype.getUpdatedState=function getUpdatedState(state){state=this._pendingStateUpdate||state||this.history.state||{};this._pendingStateUpdate=null;var isHashBang=/#!/.test(location.href)||this.forceHashbang,link=isHashBang?location.hash:location.pathname;if(location.search){var sep=-1!==link.indexOf("?")?"&":"?";link+=sep+location.search.substr(1)}state.route=this.parseUrl(link);return state};Shell.prototype._getLocationRoutedUrl=function(){var reg=/^#!/;return reg.test(window.location.hash)?window.location.hash:window.location.pathname+window.location.search+window.location.hash};Shell.prototype._refreshReferrer=function(){this.referrerRoute=this.parseUrl(this._getLocationRoutedUrl())};Shell.prototype._refreshCurrent=function(){this.currentRoute=this.parseUrl(this._getLocationRoutedUrl())};Shell.prototype.replaceState=function replaceState(state,title,url){this._refreshReferrer();this.history.replaceState(state,title,url);this._refreshCurrent()};Shell.prototype.pushState=function pushState(state,title,url){this._refreshReferrer();this.history.pushState(state,title,url);this._refreshCurrent()};Shell.prototype.replace=function replace(state){state=this.getUpdatedState(state);state.route.root===!0&&(state.route=this.parseUrl(this.indexName));this.referrerRoute=this.currentRoute;this.currentRoute=state.route;var accessError=this.accessControl(state.route);if(accessError&&this.currentRoute.name!==this.forbiddenAccessName)return this.go(this.forbiddenAccessName,accessError,!0);var $cont=this.items.find(state.route.name),shell=this,promise=null;if($cont&&$cont.length)promise=new Promise(function(resolve,reject){try{var $oldCont=shell.items.getActive();$oldCont=$oldCont.not($cont);shell.items["switch"]($oldCont,$cont,shell,state);resolve()}catch(ex){reject(ex)}});else if(this.loader)promise=this.loader.load(state.route).then(function(html){shell.items.inject(state.route.name,html);return shell.items.find(state.route.name).length?shell.replace(state):void 0});else{var err=new Error("Page not found ("+state.route.name+")");console.warn("Shell Page not found, state:",state);promise=Promise.reject(err);setTimeout(function(){this.goBack()}.bind(this),1)}var thisShell=this;promise["catch"](function(err){err instanceof Error||(err=new Error(err));console.error("Shell, unexpected error.",err);thisShell.emit("error",err);throw err});return promise};Shell.prototype.run=function run(){var shell=this;this.$(window).on(this.history.popstateEvent||"popstate",function(event){var state=event.state||event.originalEvent&&event.originalEvent.state||shell.history.state;shell.replace(state)});var linkWorking=null,linkWorkingDelay=80;this.$(document).on(this.linkEvent,"[href], [data-href]",function(e){if(linkWorking)return!1;linkWorking=setTimeout(function(){linkWorking=null},linkWorkingDelay);var $t=shell.$(this),href=$t.attr("href")||$t.data("href");if(href){var target=$t.attr("target");if(!/^[a-z]+:/i.test(href)&&!target)if(this.useSingleHashForRouting||!/^#([^!]|$)/.test(href)){e.preventDefault();setTimeout(function(){shell.go(href)},1)}else{e.preventDefault();shell.emit("fragmentNavigation",href,this,e)}}else e.preventDefault()});this.items.init();this.replace()}},{"./dependencies":357}],356:[function(require,module,exports){"use strict";function absolutizeUrl(baseUrl,url){url=sanitizeUrl(url);var matchBase=new RegExp("^"+escapeRegExp(baseUrl),"i");return matchBase.test(url)?url:sanitizeUrl(baseUrl+url)}var sanitizeUrl=require("./sanitizeUrl"),escapeRegExp=require("../escapeRegExp");module.exports=absolutizeUrl},{"../escapeRegExp":336,"./sanitizeUrl":362}],357:[function(require,module,exports){"use strict";module.exports={parseUrl:null,absolutizeUrl:null,jquery:null,loader:null,accessControl:function allowAll(){return null},EventEmitter:null}},{}],358:[function(require,module,exports){"use strict";function getSuid(hash){var suid=+getUrlQuery(hash)._suid;return isNaN(suid)?null:suid}function setSuid(hash,suid){var qs=getUrlQuery(hash);qs.push("_suid");qs._suid=suid;for(var query=[],i=0;i<qs.length;i++)query.push(qs[i]+"="+encodeURIComponent(qs[qs[i]]));query=query.join("&");if(query){var index=hash.indexOf("?");index>-1&&(hash=hash.substr(0,index));hash+="?"+query}return hash}function persist(){setTimeout(function(){sessionStorage.setItem("hashbangHistory.store",JSON.stringify(session))},1500)}function checkState(state){return state?Object.keys(state).length>0?state:null:state}function cannonicalUrl(url){url=sanitizeUrl(url||"");var ihash=url.indexOf("#");ihash>-1&&(url=url.substr(ihash+1));url=url.replace(/^!/,"");return url}var $=require("jquery"),sanitizeUrl=require("./sanitizeUrl"),getUrlQuery=require("../getUrlQuery"),session=sessionStorage.getItem("hashbangHistory.store");session=session?JSON.parse(session):{states:[]};var hashchangeTriggeredManually=!1,hashbangHistory={pushState:function pushState(state,title,url){url=cannonicalUrl(url);state=checkState(state)||null;if(null!==state){session.states.push(state);var suid=session.states.length-1;url=setSuid(url,suid);persist()}hashchangeTriggeredManually=!0;location.hash="#!"+url},replaceState:function replaceState(state,title,url){url=cannonicalUrl(url);var suid=getSuid(url),hasOldState=null!==suid;state=checkState(state)||null;if(null!==state||hasOldState){if(hasOldState)session.states[suid]=state;else{session.states.push(state);suid=session.states.length-1;url=setSuid(url,suid)}persist()}var hash="#!"+url;window.history.replaceState(state,title,location.origin+location.pathname+hash)},get state(){var suid=getSuid(location.hash);return null!==suid?session.states[suid]:null},get length(){return window.history.length},go:function go(offset){window.history.go(offset)},back:function back(){window.history.back()},forward:function forward(){window.history.forward()}},$w=$(window);$w.on("hashchange",function(e){var url=e.originalEvent.newURL;url=cannonicalUrl(url);if(hashchangeTriggeredManually)hashchangeTriggeredManually=!1;else{var suid=getSuid(url),state=null;null!==suid&&(state=session.states[suid]);
$w.trigger(new $.Event("popstate",{state:state}),"hashbangHistory")}});$w.on("popstate",function(e,source){if("hashbangHistory"!==source){e.preventDefault();e.stopImmediatePropagation()}});module.exports=hashbangHistory},{"../getUrlQuery":342,"./sanitizeUrl":362,jquery:!1}],359:[function(require,module,exports){"use strict";var deps=require("./dependencies"),DomItemsManager=require("./DomItemsManager"),parseUrl=require("./parseUrl"),absolutizeUrl=require("./absolutizeUrl"),$=require("jquery"),loader=require("./loader"),EventEmitter=require("events").EventEmitter;$.extend(deps,{parseUrl:parseUrl,absolutizeUrl:absolutizeUrl,jquery:$,loader:loader,EventEmitter:EventEmitter});var Shell=require("./Shell");exports.Shell=Shell;exports.DomItemsManager=DomItemsManager},{"./DomItemsManager":354,"./Shell":355,"./absolutizeUrl":356,"./dependencies":357,"./loader":360,"./parseUrl":361,events:!1,jquery:!1}],360:[function(require,module,exports){"use strict";var $=require("jquery");module.exports={baseUrl:"/",load:function load(route){return new Promise(function(resolve,reject){console.log("Shell loading on demand",route.name,route);$.ajax({url:module.exports.baseUrl+route.name+".html",cache:!1}).then(resolve,reject)})}}},{jquery:!1}],361:[function(require,module,exports){"use strict";function parseUrl(baseUrl,link){link=link||"";var rawUrl=link;link=link.replace(/^#!/,"").replace(/^#/,"");link=link.replace(/^\/|^\.\//,"");var query=getUrlQuery(link||"?");link=link.replace(/\?.*$/,"");baseUrl=baseUrl.replace(/^\//,"");var path=link.replace(new RegExp("^"+escapeRegExp(baseUrl),"i"),""),match=/^\/?([^\/\.]+)[^\/]*(\/.*)*$/.exec(path),parsed={root:!0,name:null,segments:null,path:null,url:rawUrl,query:query};if(match){parsed.root=!1;if(match[1]){parsed.name=match[1];if(match[2]){parsed.path=match[2];parsed.segments=match[2].replace(/^\//,"").split("/")}else{parsed.path="/";parsed.segments=[]}}}return parsed}var getUrlQuery=require("../getUrlQuery"),escapeRegExp=require("../escapeRegExp");module.exports=parseUrl},{"../escapeRegExp":336,"../getUrlQuery":342}],362:[function(require,module,exports){"use strict";function sanitizeUrl(url){return url.replace(/\.{2,}/g,"").replace(/\/{2,}/g,"/")}module.exports=sanitizeUrl},{}],363:[function(require,module,exports){"use strict";module.exports=function slug(str){str=str.replace(/^\s+|\s+$/g,"");str=str.toLowerCase();for(var from="ãàáäâẽèéëêìíïîõòóöôùúüûñç·/_,:;'",to="aaaaaeeeeeiiiiooooouuuunc-------",i=0,l=from.length;l>i;i++)str=str.replace(new RegExp(from.charAt(i),"g"),to.charAt(i));str=str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-");return str}},{}],364:[function(require,module,exports){var $=require("jquery"),throttle=require("iagosrl/throttle");module.exports=function snapPoints($scrollerElement,points,precision){if(points&&Object.keys(points).length){$scrollerElement=$scrollerElement||$(window);precision=0===precision?0:Math.abs(0|precision)||16;var record={},checkScroll=function(){var top=$scrollerElement.scrollTop();Object.keys(points).forEach(function(point){point=0|point;var type;point===top?"there"!==record[point]&&(type="there"):top>point?"after"!==record[point]&&(type="after"):"before"!==record[point]&&(type="before");if(type){$scrollerElement.trigger(points[point],[type]);record[point]=type}})};precision>0&&(checkScroll=throttle(checkScroll,precision));$scrollerElement.scroll(checkScroll);checkScroll()}}},{jquery:!1}],365:[function(require,module,exports){"use strict";var removeAccent=require("./removeAccent");module.exports=function textSearch(search,text){var s=removeAccent(search||"").toLowerCase(),t=removeAccent(text||"").toLowerCase();return t.indexOf(s)>-1}},{"./removeAccent":352}],366:[function(require,module,exports){"use strict";function displayTimeZone(tzid,zone,instantMoment,ts){return"UTC"+instantMoment.tz(tzid).format("Z")+" "+tzid+" ("+zone.abbr(ts)+")"}var moment=require("moment-timezone");exports.getLocalTimeZone=function(){return moment.tz.guess()};exports.timeZoneToDisplayFormat=function(tzid,instant){instant=instant?moment(instant).clone():moment().startOf("year");var zone=moment.tz.zone(tzid),ts=instant.valueOf();return displayTimeZone(tzid,zone,instant,ts)};var createDisplayList=function(tzList,m,ts){return tzList.map(function(tzid){var z=moment.tz.zone(tzid);return{id:tzid,offset:z.offset(ts),label:displayTimeZone(tzid,z,m,ts)}}).sort(function(a,b){return a.offset!==b.offset?a.offset>b.offset?-1:1:a.id>b.id?1:-1})};exports.getFullList=function(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names();return createDisplayList(list,m,ts)};exports.getUserList=function getUserList(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names().filter(function(z){return-1!==z.indexOf("/")&&moment.tz.zone(z).population});return createDisplayList(list,m,ts)};exports.getUsZones=function getUsZones(){var m=moment().startOf("year"),ts=m.valueOf(),list=moment.tz.names().filter(function(z){return 0===z.indexOf("US/")});return createDisplayList(list,m,ts)};exports.getTopUsZones=function getTopUsZones(){return[{id:"US/Hawaii",label:"UTC-10:00 Hawaii Time (HST)"},{id:"US/Alaska",label:"UTC-09:00 Alaska Time (AKST)"},{id:"US/Pacific",label:"UTC-08:00 Pacific Time (PST)"},{id:"US/Arizona",label:"UTC-07:00 Arizona Time (MST)"},{id:"US/Mountain",label:"UTC-07:00 Mountain Time (MST)"},{id:"US/Central",label:"UTC-06:00 Central Time (CST)"},{id:"US/East-Indiana",label:"UTC-05:00 Indiana (East) Time (EST)"},{id:"US/Eastern",label:"UTC-05:00 Eastern Time (EST)"}]};var usAliasesInverted={"America/New_York":"US/Eastern","America/Detroit":"US/Michigan","America/Kentucky/Louisville":"US/Eastern","America/Kentucky/Monticello":"US/Eastern","America/Indiana/Indianapolis":"US/East-Indiana","America/Indiana/Vincennes":"US/East-Indiana","America/Indiana/Winamac":"US/East-Indiana","America/Indiana/Marengo":"US/East-Indiana","America/Indiana/Petersburg":"US/East-Indiana","America/Indiana/Vevay":"US/East-Indiana","America/Chicago":"US/Central","America/Indiana/Tell_City":"US/Indiana-Starke","America/Indiana/Knox":"US/Indiana-Starke","America/Menominee":"US/Central","America/North_Dakota/Center":"US/Central","America/North_Dakota/New_Salem":"US/Central","America/North_Dakota/Beulah":"US/Central","America/Denver":"US/Mountain","America/Boise":"US/Mountain","America/Phoenix":"US/Arizona","America/Los_Angeles":"US/Pacific","America/Anchorage":"US/Alaska","America/Juneau":"US/Alaska","America/Sitka":"US/Alaska","America/Metlakatla":"US/Alaska","America/Yakutat":"US/Alaska","America/Nome":"US/Alaska","America/Adak":"US/Aleutian","Pacific/Honolulu":"US/Hawaii","Pacific/Pago_Pago":"US/Samoa"};exports.getUsAliasWhenPossible=function(tzid){return usAliasesInverted.hasOwnProperty(tzid)?usAliasesInverted[tzid]:tzid}},{"moment-timezone":!1}],367:[function(require,module,exports){"use strict";var $=require("jquery");exports.on=function(){function closeActionSheet(el){el=el||$(".ActionSheet");el.attr("hidden","hidden").trigger("close.ActionSheet");$("body").removeClass("has-ActionSheet-open")}$(document).on("click","[data-toggle=ActionSheet]",function(){var $e=$(this),t=$e.data("target"),$t=$("#"+t);if($t.attr("hidden")){closeActionSheet();$t.removeAttr("hidden").trigger("open.ActionSheet");$("body").addClass("has-ActionSheet-open")}else closeActionSheet($t);$t.one("click",function(){closeActionSheet($t)})})}},{jquery:!1}],368:[function(require,module,exports){"use strict";module.exports=function getFlags(){if(window.navigator&&window.navigator.userAgent){var ua=window.navigator.userAgent,iOsWebview=/iOS|iPad|iPhone|iPod/.test(ua),iOsVersion=/OS ((\d+_?){2,3})\s/.exec(ua);if(iOsVersion&&iOsVersion.length>1){iOsVersion={full:iOsVersion[1]||""};iOsVersion.parts=iOsVersion.full.split("_");iOsVersion.major=0|iOsVersion.parts[0];iOsVersion.minor=0|iOsVersion.parts[1];iOsVersion.revision=0|iOsVersion.parts[2]}var isWkWebview=!!(iOsWebview&&window.cordova&&window.indexedDB),isAndroid=/Android/.test(ua),isChrome=/Chrome\//.test(ua),isMobile=iOsWebview||isAndroid;return{isIos:iOsWebview,iOsVersion:iOsVersion,isWkWebview:isWkWebview,isAndroid:isAndroid,isChrome:isChrome,isMobile:isMobile}}return{}}},{}],369:[function(require,module,exports){"use strict";var RouteParser=require("../utils/Router").RouteParser,alertPresets={positionservices:{label:"Add details to your listing",route:new RouteParser("/servicesOverview/:jobTitleID")},availability:{label:"When can you be booked?",route:new RouteParser("/schedulingPreferences?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},personalinfo:{label:"How do we reach you?",route:new RouteParser("/aboutMe?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},photo:{label:"Add your profile photo",route:new RouteParser("/aboutMe?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},payment:{label:"How do you want to be paid?",route:new RouteParser("/paymentAccount?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},pricingdetails:{label:"Create a bookable offering",route:new RouteParser("/serviceProfessionalService/:jobTitleID")},publicbio:{label:"Add a personal bio",route:new RouteParser("/aboutMe?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},professionallicense:{label:"Verify your professional license or certification",route:new RouteParser("/licensesCertifications/:jobTitleID")},location:{label:"Where do you work?",route:new RouteParser("/serviceAddresses/:jobTitleID")},"add-education":{label:"Add training or education",route:new RouteParser("/education?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},verifyemail:{label:"Verify your account (check your e-mail)",route:new RouteParser("/verifications?mustReturn=marketplaceJobtitles/:jobTitleID&returnText=Back to listing")},showcasework:{label:"Add photos of your work",route:new RouteParser("/workPhotos/:jobTitleID")},"required-professionallicense":{label:"Verify your professional license or certification",route:new RouteParser("/licensesCertifications/:jobTitleID")}},undefinedPreset={label:"",route:{reverse:function(){return""}}},AlertLink=function(label,href){this._label=label;this._href=href};AlertLink.prototype.href=function(){return this._href};AlertLink.prototype.label=function(){return this._label};AlertLink.fromProfileAlert=function(profileAlert,options){var preset=alertPresets[profileAlert.alertName()]||undefinedPreset;return new AlertLink(preset.label,preset.route.reverse({jobTitleID:options.jobTitleID}))};module.exports=AlertLink},{"../utils/Router":326}],370:[function(require,module,exports){function AppointmentCardViewModel(params){EventEmitter.call(this);this.sourceItem=getObservable(params.sourceItem);var app=this.app=ko.unwrap(params.app);this.editMode=getObservable(params.editMode);this.editedVersion=ko.observable(null);this.isSaving=ko.observable(!1);this.isLoading=getObservable(params.isLoading);this.item=ko.observable(AppointmentView(this.sourceItem(),app));this.allowBookUnavailableTime=ko.observable(!1);this.specialAppointmentIds=Appointment.specialIds;this.currentID=ko.pureComputed(function(){var it=this.item();return it&&it.id()||0},this);this.currentDatetime=ko.pureComputed(function(){return this.item()&&this.item().startTime()||new Date},this);this.currentDate=ko.pureComputed(function(){return getDateWithoutTime(this.item()&&this.item().startTime())},this);this.isNew=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.newBooking||id===Appointment.specialIds.newEvent},this);this.isBooking=ko.pureComputed(function(){return this.item()&&this.item().sourceBooking()},this);this.isEvent=ko.pureComputed(function(){return this.item()&&this.item().sourceEvent()&&!this.item().sourceBooking()},this);this.isReadOnlyEvent=ko.pureComputed(function(){return this.isEvent()?this.item().sourceEvent().readOnly():!1},this);this.isLocked=ko.pureComputed(function(){return this.isReadOnlyEvent()||this.isSaving()||this.isLoading()},this);this.headerClass=ko.pureComputed(function(){return this.isBooking()?this.editMode()?"Card-title--warning":"Card-title--primary":this.isEvent()?"Card-title--danger":""},this);this.newAppointmentVisible=ko.pureComputed(function(){var id=this.currentID();return id===Appointment.specialIds.free||id===Appointment.specialIds.emptyDate||id===Appointment.specialIds.unavailable},this);this.editScheduleVisible=ko.pureComputed(function(){return this.currentID()===Appointment.specialIds.unavailable},this);this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?this.isNew()&&this.isBooking()?"Book":"Save changes":"Saved"},this);this.sourceItem.subscribe(function(sourceItem){this.item(AppointmentView(sourceItem,app));this.editedVersion(null);this.editMode(!1);this.isNew()&&this.editMode(!0)},this);this.editMode.subscribe(function(isEdit){if(!(this.currentID()<=0)||this.isNew())if(isEdit){var version=new ModelVersion(this.sourceItem());version.version.sourceEvent(this.sourceItem().sourceEvent());version.version.sourceBooking(this.sourceItem().sourceBooking());this.editedVersion(version);this.item(AppointmentView(version.version,app));if(this.isNew()&&this.isEvent()){this.item().sourceEvent().availabilityTypeID(0);this.item().isAllDay(!1);this.item().sourceEvent().eventTypeID(3);this.item().summary("")}}else this.item(AppointmentView(this.sourceItem(),app))},this);this.edit=function edit(){this.isLocked()||this.editMode(!0)}.bind(this);var afterSave=function afterSave(savedApt){var version=this.editedVersion();version.original.model.updateWith(savedApt,!0);version.pull({evenIfNewer:!0});this.editMode(!1);if(this.isBooking()&&this.item().client()){var msg=this.item().client().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Confirmed!",message:msg})}}.bind(this);this.save=function save(){if(!this.isLocked()){var version=this.editedVersion();if(version&&version.areDifferent()){this.isSaving(!0);app.model.calendar.setAppointment(version.version,this.allowBookUnavailableTime()).then(afterSave)["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}}}.bind(this);this.cancel=function cancel(){if(!this.isLocked()){this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0});this.editMode(!1)}}.bind(this);this.confirmCancel=function confirmCancel(){var v=this.editedVersion();v&&v.areDifferent()?this.app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this)):this.cancel()}.bind(this);this.deleteEvent=function(){};this.bookingID=ko.pureComputed(function(){return this.item()&&this.item().sourceBooking()&&this.item().sourceBooking().bookingID()},this);this.bookingCanBeCancelledByServiceProfessional=ko.computed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.canBeCancelledByServiceProfessional():!1},this);this.bookingCanBeDeclinedByServiceProfessional=ko.computed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.canBeDeclinedByServiceProfessional():!1},this);this.isBookingRequest=ko.pureComputed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.isRequest():!1},this);this.isServiceProfessionalBooking=ko.pureComputed(function(){var b=this.item()&&this.item().sourceBooking();return b?b.isServiceProfessionalBooking():!1},this);this.canChangePricing=ko.pureComputed(function(){if(this.isNew())return!0;var b=this.item()&&this.item().sourceBooking();if(b){var bt=b.bookingTypeID();return bt===Booking.type.serviceProfessionalBooking||bt===Booking.type.bookNowBooking&&!b.paymentCollected}return!1},this);var afterSaveBooking=function(booking,saveEvent){var version=this.editedVersion();if(version){version.original.sourceBooking(booking);version.pull({evenIfNewer:!0});this.editMode(!1)}else this.sourceItem().sourceBooking(booking);var msg=this.item().client().firstName()+" will receive an e-mail confirmation.";app.modals.showNotification({title:"Done!",message:msg}).then(function(){this.emit(saveEvent,this.sourceItem())}.bind(this))}.bind(this);this.cancelBookingByServiceProfessional=function(){if(this.bookingCanBeCancelledByServiceProfessional()){this.isSaving(!0);app.model.bookings.cancelBookingByServiceProfessional(this.bookingID()).then(function(booking){afterSaveBooking(booking,events.cancelled)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.declineBookingByServiceProfessional=function(){if(this.isBookingRequest()){this.isSaving(!0);app.model.bookings.declineBookingByServiceProfessional(this.bookingID()).then(function(booking){afterSaveBooking(booking,events.declined)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.confirmBookingRequest=function(dateType){if(this.isBookingRequest()){this.isSaving(!0);app.model.bookings.confirmBookingRequest(this.bookingID(),dateType).then(function(booking){afterSaveBooking(booking,events.confirmed)})["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}};this.confirmCancelBookingByServiceProfessional=function(){this.app.modals.confirm({title:"Cancel booking",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancelBookingByServiceProfessional()}.bind(this))}.bind(this);this.selectedRequestDateType=ko.observable();this.observerSelected=function(dateType){return ko.pureComputed(function(){return this.selectedRequestDateType()===ko.unwrap(dateType)},this)}.bind(this);this.setSelectedRequestDateType=function(dateType){this.selectedRequestDateType(dateType)}.bind(this);this.performSelectedBookingRequestAnswer=function(){var option=this.selectedRequestDateType();return"deny"===option?this.declineBookingByServiceProfessional():this.confirmBookingRequest(option)}.bind(this);var editFieldOn=function editFieldOn(activity,data){data.appointment=this.item().model.toPlainObject(!0);data.cancelLink=this.cancelLink;if(this.progress&&!this.progress.ended){data.progress=this.progress;var step=data.progress.step||1,total=data.progress.total||1;data.title=step+" of "+total;data.navTitle=null}else{data.progress=this.progress;data.title=null;data.navTitle=this.isBooking()?"Booking":"Event"}app.shell.go(activity,data)}.bind(this);this.pickDateTime=function pickDateTime(){if(!this.isLocked()){var item=this.item();item.getServiceDurationMinutes().then(function(minutes){editFieldOn("datetimePicker",{selectedDatetime:item.startTime(),datetimeField:"startTime",headerText:"Select the start time",requiredDuration:minutes})})}}.bind(this);this.pickEndDateTime=function pickEndDateTime(){this.isLocked()||editFieldOn("datetimePicker",{selectedDatetime:this.item().endTime(),datetimeField:"endTime",headerText:"Select the end time",includeEndTime:!0})}.bind(this);this.pickClient=function pickClient(){this.isLocked()||editFieldOn("clients",{selectClient:!0,selectedClientID:this.item().sourceBooking().clientUserID()})}.bind(this);this.pickService=function pickService(){if(!this.isLocked()){var activity="serviceProfessionalService/"+this.item().jobTitleID()+"/client/"+this.item().clientUserID();editFieldOn(activity,{selectPricing:!0,selectedServices:this.item().pricing().map(function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),price:ko.unwrap(pricing.price)}})})}}.bind(this);this.changePrice=function changePrice(){this.isLocked()}.bind(this);this.pickLocation=function pickLocation(){this.isLocked()||editFieldOn("serviceAddresses/"+this.item().jobTitleID(),{selectAddress:!0,selectedAddressID:this.item().address()?this.item().address().addressID():0,clientUserID:this.item().clientUserID()})}.bind(this);var textFieldsHeaders={preNotesToClient:"Notes to client",postNotesToClient:"Notes to client (afterwards)",preNotesToSelf:"Notes to self",postNotesToSelf:"Booking summary",summary:"What?"};this.editTextField=function editTextField(field){this.isLocked()||app.modals.showTextEditor({title:textFieldsHeaders[field],text:this.item()[field]()}).then(function(text){this.item()[field](text)}.bind(this))["catch"](function(err){err&&app.modals.showError({error:err})})}.bind(this);"function"==typeof params.api&&params.api(this);ko.computed(function calculateEndTime(){var duration=this.item().serviceDurationMinutes(),start=moment(this.item().startTime()),end;if(this.isBooking()&&start.isValid()){end=start.add(duration,"minutes").toDate();this.item().endTime(end)}},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),moment=require("moment"),getObservable=require("../utils/getObservable"),Appointment=require("../models/Appointment"),AppointmentView=require("../viewmodels/AppointmentView"),ModelVersion=require("../utils/ModelVersion"),getDateWithoutTime=require("../utils/getDateWithoutTime"),PricingSummaryDetail=require("../models/PricingSummaryDetail"),EventEmitter=require("events").EventEmitter,Booking=require("../models/Booking"),Address=require("../models/Address"),events={confirmed:"confirmed",declined:"declined",cancelled:"cancelled"};AppointmentCardViewModel._inherits(EventEmitter);AppointmentCardViewModel.prototype.passIn=function passIn(requestData){if(requestData.appointment){this.editMode(!0);this.item().model.updateWith(requestData.appointment)}else this.isNew()||this.cancel();this.selectedRequestDateType("");requestData.selectClient===!0&&this.item().clientUserID(requestData.selectedClientID);if("undefined"!=typeof requestData.selectedDatetime){var field=requestData.datetimeField;this.item()[field](requestData.selectedDatetime);this.allowBookUnavailableTime(requestData.allowBookUnavailableTime)}requestData.selectedJobTitleID&&this.item().jobTitleID(requestData.selectedJobTitleID);if(requestData.selectAddress===!0){this.item().address()||this.item().address(new Address);requestData.address?this.item().address().model.updateWith(requestData.address,!0):requestData.selectedAddressID&&this.item().address().addressID(requestData.selectedAddressID)}requestData.selectPricing===!0&&this.item().pricing(requestData.selectedServices.map(function(pricing){return new PricingSummaryDetail(pricing)}));if(this.isNew())if(requestData&&requestData.cancelLink)this.cancelLink=requestData.cancelLink;else{var referrerUrl=this.app.shell.referrerRoute;referrerUrl=referrerUrl&&referrerUrl.url||"calendar";this.cancelLink=referrerUrl}if(this.currentID()===Appointment.specialIds.newBooking)if(requestData.progress){if(requestData.progress){this.progress=requestData.progress;var step=this.progress.step||1;if(2>step){this.progress.step=2;this.pickService()}else if(3>step){requestData.progress.step=3;this.pickDateTime()}else if(4>step){requestData.progress.step=4;this.pickLocation()}else this.progress.ended=!0}}else{this.progress={step:1,total:4,ended:!1};this.pickClient()}else this.progress=null};AppointmentCardViewModel.events=events;module.exports=AppointmentCardViewModel},{"../models/Address":231,"../models/Appointment":232,"../models/Booking":234,"../models/PricingSummaryDetail":271,"../utils/ModelVersion":322,"../utils/getDateWithoutTime":340,"../utils/getObservable":341,"../viewmodels/AppointmentView":371,events:!1,knockout:!1,moment:!1}],371:[function(require,module,exports){"use strict";function pricingSummaryDetailView(pricingSummaryDetail,jobTitleID,app){var observable=ko.observable(app.model.serviceProfessionalServices.asModel()),serviceID=pricingSummaryDetail.serviceProfessionalServiceID();pricingSummaryDetail.serviceProfessionalService=observable;app.model.serviceProfessionalServices.getItem(jobTitleID,serviceID).then(function(service){var serviceModel=app.model.serviceProfessionalServices.asModel(service);observable(serviceModel)});return pricingSummaryDetail}var ko=require("knockout");module.exports=function AppointmentView(appointment,app){if(appointment._isAppointmentView)return appointment;appointment._isAppointmentView=!0;appointment.client=ko.computed(function(){var b=this.sourceBooking();if(!b)return null;var cid=this.clientUserID();return cid?app.model.clients.getObservableItem(cid,!0)():null},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var add=this.address(),aid=add&&add.addressID(),jid=this.jobTitleID();aid&&jid&&app.model.serviceAddresses.getItem(jid,aid).then(function(serverAddress){serverAddress.addressID===aid&&add.model.updateWith(serverAddress,!0)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.addressSummary=ko.computed(function(){var eventData=this.sourceEvent(),add=this.address();return add&&add.singleLineDetailed()||eventData&&eventData.location()||""},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.pricingWithInfo=ko.computed(function(){var b=this.sourceBooking();if(!b)return[];var jid=this.jobTitleID(),details=this.pricing();return details.map(function(det){return pricingSummaryDetailView(det,jid,app)})},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});appointment.servicesSummary=ko.computed(function(){return this.pricingWithInfo().map(function(service){return service.serviceProfessionalService().name()}).join(", ")},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});appointment.getServiceDurationMinutes=function(){var jid=this.jobTitleID(),pricing=this.pricing();if(!pricing)return Promise.resolve(0);var tasks=pricing.map(function(service){var id=service.serviceProfessionalServiceID();return app.model.serviceProfessionalServices.getItem(jid,id)});return Promise.all(tasks).then(function(services){return services.reduce(function(prev,service){return prev+service.serviceDurationMinutes},0)})};appointment.serviceDurationMinutes=ko.computed(function(){var pricing=this.pricingWithInfo(),sum=pricing.reduce(function(prev,service){return prev+service.serviceProfessionalService().serviceDurationMinutes()},0);return sum},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});ko.computed(function(){var pricing=appointment.pricing();if(0===pricing.length)this.price(0);else{var p=pricing[0].price();if(null===p||"undefined"==typeof p)return;this.price(pricing.reduce(function(prev,cur){return prev+cur.price()},0))}},appointment).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});return appointment}},{knockout:!1}],372:[function(require,module,exports){"use strict";function BaseClientBookingCardVM(app){this.app=app;this.originalBooking=ko.observable();this.editedVersion=ko.observable(null);this.serviceProfessionalServices=new ServiceProfessionalServiceVM(app);this.serviceProfessionalServices.isSelectionMode(!0);this.serviceProfessionalServices.preSelectedServices([]);this.serviceProfessionalServices.serviceListGroupsFactory=serviceListGroupFactories.clientBookedServices;this.serviceAddresses=new ServiceAddresses;this.serviceAddresses.isSelectionMode(!0);this.isLoadingServiceAddresses=ko.observable(!1);this.clientAddresses=new ServiceAddresses;this.clientAddresses.isSelectionMode(!0);this.addressEditorOpened=new ko.observable(!1);this.supportsGratuity=ko.observable(!1);this.presetGratuity=ko.observable(0);this.gratuityAmount=ko.observable(0);this.serviceStartDatePickerView=ko.observable(null);this.timeFieldToBeSelected=ko.observable("");this.progress=new BookingProgress({step:-1});this.isSaving=ko.observable(!1);this.isCancelMode=ko.observable(!1);this.postalCodeVM=ko.observable(null);var siteUrl=(app.model.config.siteUrl||"https://loconomics.com")+"/";this.urlTos=ko.observable(siteUrl+"#!terms/terms-of-service?mustReturn=true");this.urlPp=ko.observable(siteUrl+"#!terms/privacy-policy?mustReturn=true");this.urlBcp=ko.observable(siteUrl+"#!terms/background-check-policy?mustReturn=true");this.errorMessages={postalCode:ko.observable("")};this.reset=function reset(){this.originalBooking(null);this.editedVersion(null);this.serviceProfessionalServices.reset();this.serviceProfessionalServices.isSelectionMode(!0);this.serviceProfessionalServices.preSelectedServices([]);this.serviceAddresses.reset();this.serviceAddresses.isSelectionMode(!0);this.isLoadingServiceAddresses(!1);this.clientAddresses.reset();this.clientAddresses.isSelectionMode(!0);this.addressEditorOpened(!1);this.supportsGratuity(!1);this.presetGratuity(0);this.gratuityAmount(0);this.timeFieldToBeSelected("");this.isSaving(!1);this.isCancelMode(!1);this.progress.reset();this.postalCodeVM(null);this.errorMessages.postalCode("")}.bind(this);this.isEditMode=ko.pureComputed(function(){return!!this.editedVersion()},this);this.isLoading=ko.pureComputed(function(){return this.isLoadingServiceProfessionalInfo()||this.serviceProfessionalServices.isLoading()},this);this.isLocked=ko.pureComputed(function(){return this.isLoading()||this.isSaving()},this);this.canEdit=ko.pureComputed(function(){return this.originalBooking()&&this.booking()?!this.booking().bookingID()||this.booking().instantBooking()&&this.booking().isConfirmed():!1},this);this.canCancel=ko.pureComputed(function(){return this.originalBooking()&&(this.originalBooking().canBeCancelledByClient()||this.originalBooking().canBeDeclinedByClient())},this);this.isAnonymous=ko.pureComputed(function(){var u=app.model.user();return u&&u.isAnonymous()});this.edit=function edit(){if(!this.isLocked()){this.canCancel()&&this.isCancelMode(!0);if(this.canEdit()){var version=new ModelVersion(this.originalBooking());Booking.editable(version.version);version.version.connectToSelectableServicesView(this.serviceProfessionalServices);this.postalCodeVM(new PostalCodeVM({appModel:app.model,address:version.version.serviceAddress,postalCodeError:this.errorMessages.postalCode,enabled:this.addressEditorOpened}));this.editedVersion(version);version.version.pricingSummary().details().length&&this.loadServices();version.version.serviceAddress()&&version.version.serviceAddress().addressID()&&this.loadServiceAddresses()}}}.bind(this);this.cancel=function cancel(){if(!this.isLocked()){this.isCancelMode(!1);this.editedVersion()&&this.editedVersion().pull({evenIfNewer:!0});this.editedVersion(null);this.progress.reset()}}.bind(this);this.booking=ko.pureComputed(function(){var v=this.editedVersion();return v?v.version:this.originalBooking()},this);this.gratuityPercentage=ko.pureComputed(function(){var preset=this.presetGratuity();return"custom"===preset?0:preset},this);this.gratuityPercentage.subscribe(function(v){this.booking()&&this.booking().pricingSummary().gratuityPercentage(v)},this);this.gratuityAmount.subscribe(function(v){this.booking()&&this.booking().pricingSummary().gratuityAmount(v)},this);this.hasServicesSelected=ko.pureComputed(function(){var s=this.serviceProfessionalServices.selectedServices();return s&&s.length>0||!1},this);var setAddress=function(add){if(add&&this.booking()){this.booking().serviceAddress(add);this.isRestoring&&this.isRestoring()||this.nextStep()}}.bind(this);this.serviceAddresses.selectedAddress.subscribe(function(add){if(add){setAddress(add);this.clientAddresses.selectedAddress(null)}}.bind(this));this.clientAddresses.selectedAddress.subscribe(function(add){if(add){setAddress(add);this.serviceAddresses.selectedAddress(null)}}.bind(this));this.hasServiceArea=ko.pureComputed(function(){return this.serviceAddresses.serviceAreas().length>0},this);this.addAddress=function(serviceArea,event){event.preventDefault();this.booking().serviceAddress(new Address);this.postalCodeVM().onFormLoaded();this.addressEditorOpened(!0)}.bind(this);this.serviceProfessionalInfo=ko.observable(new PublicUser);this.isLoadingServiceProfessionalInfo=ko.observable(!1);
ko.computed(function(){var userID=this.booking()&&this.booking().serviceProfessionalUserID();if(userID){this.isLoadingServiceProfessionalInfo(!0);app.model.users.getUser(userID).then(function(info){info.selectedJobTitleID=this.booking().jobTitleID();this.serviceProfessionalInfo().model.updateWith(info,!0);this.isLoadingServiceProfessionalInfo(!1)}.bind(this))["catch"](function(err){this.isLoadingServiceProfessionalInfo(!1);app.modals.showError({error:err})}.bind(this))}else{this.serviceProfessionalInfo().model.reset();this.isLoadingServiceProfessionalInfo(!1)}},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.urlCp=ko.pureComputed(function(){var info=this.serviceProfessionalInfo();info=info&&info.selectedJobTitle();var id=info&&info.cancellationPolicyID()||"";return siteUrl+"#!cancellationPolicies/"+id+"?mustReturn=true"},this);this.singleTimeOption=ko.pureComputed(function(){return this.originalBooking()?this.originalBooking().instantBooking()||!(this.originalBooking().isRequest()||this.originalBooking().isIncomplete()):null},this);ko.computed(function triggerSelectedDatetime(){if(this.booking()){var v=this.serviceStartDatePickerView(),dt=v&&v.selectedDatetime(),current=this.booking().serviceDate(),field=this.timeFieldToBeSelected.peek();if(dt&&field&&dt.toString()!==(current&&current.startTime().toString())){this.booking()[field](new EventDates({startTime:dt}));this.booking()[field]().duration({minutes:this.booking().pricingSummary().firstSessionDurationMinutes()});this.timeFieldToBeSelected("");this.singleTimeOption()&&this.progress.next()}}},this);ko.computed(function(){var b=this.booking();if(b){var minutes=b.pricingSummary().firstSessionDurationMinutes();this.serviceStartDatePickerView()&&minutes&&this.serviceStartDatePickerView().requiredDurationMinutes(minutes)}},this);this.pickServiceDate=function(){this.timeFieldToBeSelected("serviceDate")}.bind(this);this.pickAlternativeDate1=function(){this.timeFieldToBeSelected("alternativeDate1")}.bind(this);this.pickAlternativeDate2=function(){this.timeFieldToBeSelected("alternativeDate2")}.bind(this);this.hasSomeDateSelected=ko.pureComputed(function(){var b=this.booking();return b?b.serviceDate()&&b.serviceDate().startTime()||b.alternativeDate1()&&b.alternativeDate1().startTime()||b.alternativeDate2()&&b.alternativeDate2().startTime():!1},this);this.isPhoneServiceOnly=ko.pureComputed(function(){return this.isEditMode()&&!this.serviceProfessionalServices.isLoading()?this.serviceProfessionalServices.selectedServices().every(function(service){return service.isPhone()}):!this.booking()||!this.booking().serviceAddress()},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}});this.specialRequestsPlaceholder=ko.pureComputed(function(){var sp=this.serviceProfessionalInfo();sp=sp.profile()&&sp.profile().firstName();return sp?"Add notes to "+sp:"Add notes"},this);this.pickSpecialRequests=function(){app.modals.showTextEditor({title:this.specialRequestsPlaceholder(),text:this.booking().specialRequests()}).then(function(text){this.booking().specialRequests(text)}.bind(this))["catch"](function(err){err&&app.modals.showError({error:err})})}.bind(this);this.nextStep=function(){this.progress.next()}.bind(this);this.getStepLabel=function(stepName){return stepsLabels[stepName]||stepName};this.isAtSelectTimes=this.progress.observeStep("selectTimes");this.isAtSelectTime=this.progress.observeStep("selectTime");this.isAtServices=this.progress.observeStep("services");this.isAtLocation=this.progress.observeStep("selectLocation");this.isAtPayment=this.progress.observeStep("payment");this.isAtConfirm=this.progress.observeStep("confirm");this.pickDateTime=function(){var single=this.singleTimeOption();this.progress.go(single?"selectTime":"selectTimes")}.bind(this);this.pickLocation=function(){this.progress.go("selectLocation")}.bind(this);this.pickServices=function(){this.progress.go("services")}.bind(this);this.pickPayment=function(){this.progress.go("payment")}.bind(this);ko.computed(function(){if(this.booking())switch(this.progress.currentStep()){case"selectTime":this.prepareDatePicker("serviceDate");break;case"selectTimes":this.prepareDatePicker("")}},this);ko.computed(function(){var list=["services"];if(this.originalBooking()&&this.booking()){this.isPhoneServiceOnly()||list.push("selectLocation");list.push(this.singleTimeOption()?"selectTime":"selectTimes");this.booking().paymentEnabled()&&this.booking().pricingSummary().totalPrice()>0&&list.push("payment")}list.push("confirm");this.progress.stepsList(list)},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:20}})}var ko=require("knockout"),Booking=require("../models/Booking.editable"),ServiceProfessionalServiceVM=require("../viewmodels/ServiceProfessionalService"),ServiceAddresses=require("../viewmodels/ServiceAddresses"),BookingProgress=require("../viewmodels/BookingProgress"),Address=require("../models/Address"),EventDates=require("../models/EventDates"),PublicUser=require("../models/PublicUser"),ModelVersion=require("../utils/ModelVersion"),serviceListGroupFactories=require("../viewmodels/ServiceListGroupFactories"),PostalCodeVM=require("../viewmodels/PostalCode"),stepsLabels={services:"Services",selectLocation:"Select a location",selectTimes:"Select preferred times",selectTime:"Select the time",payment:"Payment",confirm:"Confirm"};module.exports=BaseClientBookingCardVM;BaseClientBookingCardVM.prototype.loadServices=function(){var b=this.booking();this.serviceProfessionalServices.preSelectedServices(this.booking().pricingSummary().details().map(function(s){return s.model.toPlainObject()}));var spid=b.serviceProfessionalUserID(),jid=b.jobTitleID();if(this.serviceProfessionalServices.serviceProfessionalID()!==spid||this.serviceProfessionalServices.jobTitleID()!==jid){var servicesPromise=this.app.model.users.getServiceProfessionalServices(spid,jid);return this.serviceProfessionalServices.loadData(spid,jid,servicesPromise)}};BaseClientBookingCardVM.prototype.loadServiceAddresses=function(){var add=this.booking().serviceAddress();add&&add.addressID()&&this.serviceAddresses.selectedAddress(add);this.serviceAddresses.sourceAddresses([]);this.isLoadingServiceAddresses(!0);return this.app.model.users.getServiceAddresses(this.booking().serviceProfessionalUserID(),this.booking().jobTitleID()).then(function(list){this.serviceAddresses.sourceAddresses(this.app.model.serviceAddresses.asModel(list));return this.serviceAddresses.serviceAreas().length&&!this.isAnonymous()?this.app.model.serviceAddresses.getList(0):null}.bind(this)).then(function(clientList){clientList&&this.clientAddresses.sourceAddresses(clientList.map(function(a){a.isServiceLocation=!0;return this.app.model.serviceAddresses.asModel(a)}.bind(this)));this.isLoadingServiceAddresses(!1)}.bind(this))["catch"](function(err){this.isLoadingServiceAddresses(!1);this.app.modals.showError({error:err})}.bind(this))};BaseClientBookingCardVM.prototype.prepareDatePicker=function(fieldToBeSelected){this.timeFieldToBeSelected(fieldToBeSelected);var picker=this.serviceStartDatePickerView();picker.selectedDatetime(null);picker.userID(this.booking().serviceProfessionalUserID());picker.selectedDate(new Date);var ptz=this.serviceProfessionalInfo().profile().timeZone();picker.specialTimeZones([{id:ptz,label:"Service Professional's Time Zone ("+ptz+")"}]);picker.timeZone(ptz)}},{"../models/Address":231,"../models/Booking.editable":233,"../models/EventDates":242,"../models/PublicUser":275,"../utils/ModelVersion":322,"../viewmodels/BookingProgress":373,"../viewmodels/PostalCode":388,"../viewmodels/ServiceAddresses":390,"../viewmodels/ServiceListGroupFactories":393,"../viewmodels/ServiceProfessionalService":394,knockout:!1}],373:[function(require,module,exports){"use strict";function BookingProgress(values){Model(this);this.model.defProperties({currentStep:"",stepsList:[]},values);this.step=ko.pureComputed({read:function(){return this.stepsList().indexOf(this.currentStep())},write:function(index){var name=this.stepsList()[index]||"";this.currentStep(name)},owner:this});this.totalSteps=ko.pureComputed(function(){return this.stepsList().length},this);var maxStepReachedEver=ko.observable(-1);ko.computed(function(){var s=this.step();s>maxStepReachedEver()&&maxStepReachedEver(s)},this);this.ended=ko.pureComputed(function(){var lastStep=this.totalSteps()-1;return lastStep<=maxStepReachedEver()},this);this.reset=function(){maxStepReachedEver(-1);this.currentStep("");return this}}var Model=require("../models/Model"),ko=require("knockout");module.exports=BookingProgress;BookingProgress.prototype.next=function(){if(this.ended())this.step(this.totalSteps()-1);else{var step=Math.max(0,Math.min(this.step()+1,this.totalSteps()-1));this.step(step)}return this};BookingProgress.prototype.observeStep=function(stepName){return ko.pureComputed(function(){return this.currentStep()===stepName},this)};BookingProgress.prototype.isStep=function(stepName){return this.currentStep()===stepName};BookingProgress.prototype.go=function(stepName){this.currentStep(stepName);return this}},{"../models/Model":264,knockout:!1}],374:[function(require,module,exports){"use strict";var ko=require("knockout"),PostalCodeVM=require("../viewmodels/PostalCode");module.exports=function ContactInfoVM(app){this.user=app.model.userProfile.data;this.headerText=ko.pureComputed(function(){return app.model.onboarding.inProgress()?"How can we reach you?":"Contact information"});this.errorMessages={postalCode:ko.observable("")};var userProfile=app.model.userProfile,profileVersion=userProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.months=ko.observableArray([{id:1,name:"January"},{id:2,name:"February"},{id:3,name:"March"},{id:4,name:"April"},{id:5,name:"May"},{id:6,name:"June"},{id:7,name:"July"},{id:8,name:"August"},{id:9,name:"September"},{id:10,name:"October"},{id:11,name:"November"},{id:12,name:"December"}]);this.selectedBirthMonth=ko.computed({read:function(){var birthMonth=this.profile.birthMonth();return birthMonth?this.months()[birthMonth-1]:null},write:function(month){this.profile.birthMonth(month&&month.id||null)},owner:this});this.monthDays=ko.observableArray([]);for(var iday=1;31>=iday;iday++)this.monthDays.push(iday);var homeAddress=app.model.homeAddress,homeAddressVersion=homeAddress.newVersion();homeAddressVersion.isObsolete.subscribe(function(itIs){itIs&&homeAddressVersion.pull({evenIfNewer:!0})});this.address=homeAddressVersion.version;this.postalCodeVM=new PostalCodeVM({appModel:app.model,address:this.address,postalCodeError:this.errorMessages.postalCode});this.isLocked=ko.computed(function(){return userProfile.isLocked()||homeAddress.isLocked()},this);this.isLoading=ko.computed(function(){return userProfile.isLoading()||homeAddress.isLoading()},this);this.isSaving=ko.computed(function(){return userProfile.isSaving()||homeAddress.isSaving()},this);this.isLoading.subscribe(function(isLoading){isLoading||this.postalCodeVM.onFormLoaded()},this);this.discard=function discard(){profileVersion.pull({evenIfNewer:!0});homeAddressVersion.pull({evenIfNewer:!0})}.bind(this);this.sync=function sync(){app.model.userProfile.sync();app.model.homeAddress.sync()};this.save=function save(){return Promise.all([profileVersion.pushSave(),homeAddressVersion.pushSave()])}.bind(this)}},{"../viewmodels/PostalCode":388,knockout:!1}],375:[function(require,module,exports){"use strict";var countries=[[1,"United States"],[2,"Spain"],[3,"Afghanistan"],[4,"Albania"],[5,"Algeria"],[6,"American Samoa"],[7,"Andorra"],[8,"Angola"],[9,"Anguilla"],[10,"Antarctica"],[11,"Antigua and Barbuda"],[12,"Argentina"],[13,"Armenia"],[14,"Aruba"],[15,"Australia"],[16,"Austria"],[17,"Azerbaijan"],[18,"Bahamas"],[19,"Bahrain"],[20,"Bangladesh"],[21,"Barbados"],[22,"Belarus"],[23,"Belgium"],[24,"Belize"],[25,"Benin"],[26,"Bermuda"],[27,"Bhutan"],[28,"Bolivia"],[29,"Bosnia and Herzegovina"],[30,"Botswana"],[31,"Bouvet Island"],[32,"Brazil"],[33,"British Indian Ocean Territory"],[34,"Brunei Darussalam"],[35,"Bulgaria"],[36,"Burkina Faso"],[37,"Burundi"],[38,"Cambodia"],[39,"Cameroon"],[40,"Canada"],[41,"Cape Verde"],[42,"Cayman Islands"],[43,"Central African Republic"],[44,"Chad"],[45,"Chile"],[46,"China"],[47,"Christmas Island"],[48,"Cocos Keeling) Islands"],[49,"Colombia"],[50,"Comoros"],[51,"Congo"],[52,"Congo Democratic Republic"],[53,"Cook Islands"],[54,"Costa Rica"],[55,"Cote DIvoire"],[56,"Croatia"],[57,"Cuba"],[58,"Cyprus"],[59,"Czech Republic"],[60,"Denmark"],[61,"Djibouti"],[62,"Dominica"],[63,"Dominican Republic"],[64,"Ecuador"],[65,"Egypt"],[66,"El Salvador"],[67,"Equatorial Guinea"],[68,"Eritrea"],[69,"Estonia"],[70,"Ethiopia"],[71,"Falkland Islands Malvinas)"],[72,"Faroe Islands"],[73,"Fiji"],[74,"Finland"],[75,"France"],[76,"French Guiana"],[77,"French Polynesia"],[78,"French Southern Territories"],[79,"Gabon"],[80,"Gambia"],[81,"Georgia"],[82,"Germany"],[83,"Ghana"],[84,"Gibraltar"],[85,"Greece"],[86,"Greenland"],[87,"Grenada"],[88,"Guadeloupe"],[89,"Guam"],[90,"Guatemala"],[91,"Guinea"],[92,"Guinea-Bissau"],[93,"Guyana"],[94,"Haiti"],[95,"Heard and Mcdonald Islands"],[96,"Holy See Vatican City State"],[97,"Honduras"],[98,"Hong Kong"],[99,"Hungary"],[100,"Iceland"],[101,"India"],[102,"Indonesia"],[103,"Iran Islamic Republic of"],[104,"Iraq"],[105,"Ireland"],[106,"Israel"],[107,"Italy"],[108,"Jamaica"],[109,"Japan"],[110,"Jordan"],[111,"Kazakhstan"],[112,"Kenya"],[113,"Kiribati"],[114,"Korea South"],[115,"Korea North"],[116,"Kuwait"],[117,"Kyrgyzstan"],[118,"Laos"],[119,"Latvia"],[120,"Lebanon"],[121,"Lesotho"],[122,"Liberia"],[123,"Libyan Arab Jamahiriya"],[124,"Liechtenstein"],[125,"Lithuania"],[126,"Luxembourg"],[127,"Macao"],[128,"Macedonia"],[129,"Madagascar"],[130,"Malawi"],[131,"Malaysia"],[132,"Maldives"],[133,"Mali"],[134,"Malta"],[135,"Marshall Islands"],[136,"Martinique"],[137,"Mauritania"],[138,"Mauritius"],[139,"Mayotte"],[140,"Mexico"],[141,"Micronesia"],[142,"Moldova"],[143,"Monaco"],[144,"Mongolia"],[145,"Montserrat"],[146,"Morocco"],[147,"Mozambique"],[148,"Myanmar"],[149,"Namibia"],[150,"Nauru"],[151,"Nepal"],[152,"Netherlands"],[153,"Netherlands Antilles"],[154,"New Caledonia"],[155,"New Zealand"],[156,"Nicaragua"],[157,"Niger"],[158,"Nigeria"],[159,"Niue"],[160,"Norfolk Island"],[161,"Northern Mariana Islands"],[162,"Norway"],[163,"Oman"],[164,"Pakistan"],[165,"Palau"],[166,"Palestinian"],[167,"Panama"],[168,"Papua New Guinea"],[169,"Paraguay"],[170,"Peru"],[171,"Philippines"],[172,"Pitcairn"],[173,"Poland"],[174,"Portugal"],[175,"Puerto Rico"],[176,"Qatar"],[177,"Reunion"],[178,"Romania"],[179,"Russian Federation"],[180,"Rwanda"],[181,"Saint Helena"],[182,"Saint Kitts and Nevis"],[183,"Saint Lucia"],[184,"Saint Pierre and Miquelon"],[185,"Saint Vincent/ theGrenadines"],[186,"Samoa"],[187,"San Marino"],[188,"Sao Tome and Principe"],[189,"Saudi Arabia"],[190,"Senegal"],[191,"Serbia and Montenegro"],[192,"Seychelles"],[193,"Sierra Leone"],[194,"Singapore"],[195,"Slovakia"],[196,"Slovenia"],[197,"Solomon Islands"],[198,"Somalia"],[199,"South Africa"],[200,"South Georgia"],[201,"Sri Lanka"],[202,"Sudan"],[203,"Suriname"],[204,"Svalbard and Jan Mayen"],[205,"Swaziland"],[206,"Sweden"],[207,"Switzerland"],[208,"Syrian Arab Republic"],[209,"Taiwan"],[210,"Tajikistan"],[211,"Tanzania"],[212,"Thailand"],[213,"Timor-Leste"],[214,"Togo"],[215,"Tokelau"],[216,"Tonga"],[217,"Trinidad and Tobago"],[218,"Tunisia"],[219,"Turkey"],[220,"Turkmenistan"],[221,"Turks and Caicos Islands"],[222,"Tuvalu"],[223,"Uganda"],[224,"Ukraine"],[225,"United Arab Emirates"],[226,"United Kingdom"],[227,"US Minor Outlying Islands"],[228,"Uruguay"],[229,"Uzbekistan"],[230,"Vanuatu"],[231,"Venezuela"],[232,"Viet Nam"],[233,"Virgin Islands British"],[234,"Virgin Islands U.S."],[235,"Wallis and Futuna"],[236,"Western Sahara"],[237,"Yemen"],[238,"Zambia"],[239,"Zimbabwe"]],unitedStates=countries[0],option=function(country){return{id:country[0],name:country[1]}},countriesOptions=function(){return countries.map(option)};countriesOptions.unitedStates=option(unitedStates);module.exports=countriesOptions},{}],376:[function(require,module,exports){"use strict";function DatetimePickerVM(app,element){this.selectedDate=ko.observable(getDateWithoutTime());this.userID=ko.observable();this.isLoading=ko.observable(!1);this.requiredDurationMinutes=ko.observable(0);this.includeEndTime=ko.observable(!1);this.timeZone=ko.observable("");this.specialTimeZones=ko.observableArray([]);this.durationDisplay=ko.pureComputed(function(){var fullMinutes=this.requiredDurationMinutes();if(0>=fullMinutes)return"";var hours=Math.floor(fullMinutes/60),minutes=fullMinutes%60,text="";hours>0&&(text+=moment.duration({hours:hours}).humanize()+" ");minutes>0&&(text+=moment.duration({minutes:minutes}).humanize());return text},this);this.getDateAtTimeZone=function(date,timeZone){var s;s=timeZone?moment.tz(moment(date).format("Y-MM-DD"),timeZone):moment(date).startOf("day");return s};this.dateAvail=ko.observable();this.groupedSlots=ko.computed(function(){var requiredDurationMinutes=this.requiredDurationMinutes(),includeEndTime=this.includeEndTime(),tz=this.timeZone()||timeZoneList.getLocalTimeZone(),baseDate=this.getDateAtTimeZone(this.selectedDate()||new Date,tz),groups=[{group:"Morning",slots:[],starts:baseDate.clone().hour(0).minute(0).second(0),ends:baseDate.clone().hour(12).minute(0).second(0)},{group:"Afternoon",slots:[],starts:baseDate.clone().hour(12).minute(0).second(0),ends:baseDate.clone().hour(17).minute(0).second(0)},{group:"Evening",slots:[],starts:baseDate.clone().hour(17).minute(0).second(0),ends:baseDate.clone().hour(24).minute(0).second(0)}],slots=this.dateAvail()&&this.dateAvail().getFreeTimeSlots(requiredDurationMinutes,void 0,includeEndTime)||[];slots.forEach(function(slot){slot=moment(slot).tz(tz);groups.some(function(group){if(slot>=group.starts&&slot<group.ends){group.slots.push(slot);return!0}})});return groups},this);this.selectedDatetime=ko.observable(null);this.selectDatetime=function(selectedDatetime,event){event.preventDefault();event.stopImmediatePropagation();this.selectedDatetime(selectedDatetime)}.bind(this);this.pickedTime=ko.observable();this.allowBookUnavailableTime=ko.observable(!1);this.unavailableTimeBtnEnabled=ko.observable(!1);this.getPickedDatetime=function(){var t=this.pickedTime();if(!(t instanceof Date)){var timespan=moment.duration(t);t=moment(this.selectedDate()).startOf("day").add(timespan).toDate()}return t};this.setPickedAsSelected=function(){this.allowBookUnavailableTime(!0);this.selectedDatetime(this.getPickedDatetime())}.bind(this);this.showTimePicker=function(){app.modals.showTimePicker({title:"Book an unavailable time",selectedTime:null,unsetLabel:"Cancel"}).then(function(pickedValue){if(pickedValue.time){this.pickedTime(pickedValue.time);this.setPickedAsSelected()}}.bind(this))["catch"](function(){})}.bind(this);this.reset=function(){this.selectedDatetime(null);this.pickedTime(null);this.allowBookUnavailableTime(!1);this.timeZone("");this.specialTimeZones.removeAll();this.isTimeZonePickerOpen(!1)}.bind(this);this.bindDateData=function(date){if(date&&this.userID()){var tz=this.timeZone();this.isLoading(!0);var s=this.getDateAtTimeZone(date,tz),e=s.clone().add(1,"day");return app.model.availability.times(this.userID(),s,e).then(function(data){this.dateAvail(data)}.bind(this))["catch"](function(err){app.modals.showError({title:"Error loading availability",error:err})}.bind(this)).then(function(){this.isLoading(!1)}.bind(this))}}.bind(this);var $datePicker=$(element).find(".calendar-placeholder");$datePicker.show().datepicker({extraClasses:"DatePicker--tagged"});this.tagAvailability=datepickerAvailability.create(app,$datePicker,this.isLoading);$datePicker.on("dateChanged",function(e){"days"===e.viewMode&&this.selectedDate(e.date)}.bind(this));this.selectedDate.subscribe(function(date){this.bindDateData(date);var elDate=$datePicker.datepicker("getValue");elDate!==date&&$datePicker.datepicker("setValue",date,!0)}.bind(this));this.timeZone.subscribe(function(){this.bindDateData(this.selectedDate())}.bind(this));ko.computed(function(){this.dateAvail()&&this.userID()&&this.tagAvailability(this.selectedDate(),this.userID())},this).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:60}});$datePicker.datepicker("fill");var autoTz=timeZoneList.getUsAliasWhenPossible(timeZoneList.getLocalTimeZone()),autoLabel="Auto ("+timeZoneList.timeZoneToDisplayFormat(autoTz)+")";this.autoTimeZone=ko.observable({id:autoTz,label:autoLabel});this.timeZonesList=ko.observable(timeZoneList.getUserList());this.topUsTimeZones=ko.observable(timeZoneList.getTopUsZones());this.isTimeZonePickerOpen=ko.observable(!1);this.openTimeZonePicker=function(){this.isTimeZonePickerOpen(!0)}}var ko=require("knockout"),$=require("jquery"),getDateWithoutTime=require("../utils/getDateWithoutTime"),moment=require("moment-timezone");require("../components/DatePicker");var datepickerAvailability=require("../utils/datepickerAvailability"),timeZoneList=require("../utils/timeZoneList");module.exports=DatetimePickerVM},{"../components/DatePicker":224,"../utils/datepickerAvailability":334,"../utils/getDateWithoutTime":340,"../utils/timeZoneList":366,jquery:!1,knockout:!1,"moment-timezone":!1}],377:[function(require,module,exports){"use strict";function EditClientBookingCardVM(app){BaseClientBookingCardVM.call(this,app);this.isLoadingBooking=ko.observable(!1);var baseIsLoading=this.isLoading;this.isLoading=ko.pureComputed(function(){return this.isLoadingBooking()||baseIsLoading()},this);var baseReset=this.reset;this.reset=function reset(){baseReset();this.isLoadingBooking(!1)}.bind(this);this.submitText=ko.pureComputed(function(){var v=this.editedVersion();return this.isLoading()?"Loading...":this.isSaving()?"Saving changes":v&&v.areDifferent()?"Save changes":"Saved"},this);var baseCancel=this.cancel.bind(this);this.cancel=function cancel(){baseCancel();this.progress.go("confirm")}.bind(this);this.confirmCancel=function(){var v=this.editedVersion();v&&v.areDifferent()?app.modals.confirm({title:"Cancel",message:"Are you sure?",yes:"Yes",no:"No"}).then(function(){this.cancel()}.bind(this)):this.cancel()};this.confirmCancelBookingByClient=function(){app.modals.confirm({title:"Cancel booking",message:"Are you sure? Cancellation fees may apply.",yes:"Yes",no:"No"}).then(function(){this.cancelBookingByClient()}.bind(this))}.bind(this);this.load=function(bookingIdOrModel){if(bookingIdOrModel&&bookingIdOrModel.model){this.originalBooking(bookingIdOrModel);this.progress.reset().go("confirm");return Promise.resolve()}var bookingID=0|bookingIdOrModel;this.isLoadingBooking(!0);return app.model.bookings.getBooking(bookingID).then(function(booking){this.originalBooking(booking);this.progress.reset().go("confirm");this.isLoadingBooking(!1)}.bind(this))["catch"](function(err){this.isLoadingBooking(!1);app.modals.showError({error:err})}.bind(this))}.bind(this);var afterSaveBooking=function(serverBooking){this.originalBooking().model.updateWith(serverBooking,!0);var version=this.editedVersion();version&&this.editedVersion(null);this.isCancelMode(!1);var msg="You're all set! We'll notify {0} of your changes.".replace("{0}",this.serviceProfessionalInfo().profile().firstName());app.modals.showNotification({title:"Done!",message:msg});this.isSaving(!1);app.model.availability.clearUserCache(this.originalBooking().serviceProfessionalUserID())}.bind(this);this.save=function(){this.isSaving(!0);app.model.bookings.setClientBooking(this.booking()).then(afterSaveBooking)["catch"](function(err){this.isSaving(!1);app.modals.showError({error:err})}.bind(this))}.bind(this);this.cancelBookingByClient=function(){if(this.canCancel()){this.isSaving(!0);var apiCall=this.booking().canBeCancelledByClient()?app.model.bookings.cancelBookingByClient:app.model.bookings.declineBookingByClient;apiCall(this.booking().bookingID()).then(afterSaveBooking)["catch"](function(err){app.modals.showError({title:"There was an error saving the data.",error:err})}).then(function(){this.isSaving(!1)}.bind(this))}}}var ko=require("knockout"),BaseClientBookingCardVM=require("../viewmodels/BaseClientBookingCardVM");EditClientBookingCardVM._inherits(BaseClientBookingCardVM);module.exports=EditClientBookingCardVM},{"../viewmodels/BaseClientBookingCardVM":372,knockout:!1}],378:[function(require,module,exports){"use strict";var ko=require("knockout"),Field=function(){var obs=ko.observable("");obs.error=ko.observable("");obs.subscribe(function(){obs.error("")});return obs};module.exports=Field},{knockout:!1}],379:[function(require,module,exports){"use strict";function FormCredentials(){this.username=ko.observable("");this.password=ko.observable("");var emailRegexp=/^[-0-9A-Za-z!#$%&'*+\/=?^_`{|}~.]+@[-0-9A-Za-z!#$%&'*+\/=?^_`{|}~.]+$/;this.username.error=ko.observable("");this.username.subscribe(function(v){v?emailRegexp.test(v)?this.username.error(""):this.username.error("Is not a valid email"):this.username.error("Required")}.bind(this));this.password.error=ko.observable("");this.password.subscribe(function(v){var err="";v||(err="Required");this.password.error(err)}.bind(this))}var ko=require("knockout");module.exports=FormCredentials},{knockout:!1}],380:[function(require,module,exports){"use strict";var $=require("jquery"),ko=require("knockout"),photoTools=require("../utils/photoTools"),MarketplaceProfileVM=require("./MarketplaceProfileVM");module.exports=function MarketplaceProfilePictureVM(app){MarketplaceProfileVM.call(this,app);this.user=app.model.userProfile.data;this.photoUploadUrl=app.model.rest.baseUrl+"me/profile-picture";this.photoEditRestUrl="me/profile-picture/edit";this.photoUploadFieldName="profilePicture";this.localPhotoData=ko.observable();this.localPhotoPreview=ko.observable();this.takePhotoSupported=ko.observable(photoTools.takePhotoSupported());if(this.takePhotoSupported()){this.uploaderOptions=null;this.uploaderEventHandlers=null}else{this.uploaderOptions={url:this.photoUploadUrl,dataType:"json",type:"PUT",paramName:this.photoUploadFieldName,autoUpload:!1,acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5e6,disableImageResize:!0,previewMaxWidth:120,previewMaxHeight:120,previewCrop:!0};this.uploaderEventHandlers={fileuploadadd:function(e,data){this.localPhotoData(data);this.rotationAngle(0)},fileuploadprocessalways:function(e,data){var file=data.files[data.index];file.error?console.error("Photo Preview",file.error):file.preview&&this.localPhotoPreview(file.preview)}}}var baseDiscard=this.discard;this.discard=function discard(){baseDiscard();this.localPhotoUrl("");this.previewPhotoUrl("");this.localPhotoData(null);this.localPhotoPreview(null);this.rotationAngle(0)}.bind(this);var baseSave=this.save;this.save=function save(){this.isSaving(!0);return this.uploadPhoto().then(function(data){data&&$.get(data.profilePictureUrl);return baseSave()}).then(function(){this.isSaving(!1)}.bind(this))["catch"](function(err){this.isSaving(!1);throw err}.bind(this))}.bind(this);var cameraSettings={targetWidth:600,targetHeight:600,quality:90};this.previewPhotoUrl=ko.observable("");this.localPhotoUrl=ko.observable("");var takePickPhoto=function takePhoto(fromCamera){var settings=$.extend({},cameraSettings,{sourceType:fromCamera?window.Camera&&window.Camera.PictureSourceType.CAMERA:window.Camera&&window.Camera.PictureSourceType.PHOTOLIBRARY});photoTools.takePhotoSupported()?photoTools.cameraGetPicture(settings).then(function(imgLocalUrl){this.localPhotoUrl(imgLocalUrl);this.previewPhotoUrl(photoTools.getPreviewPhotoUrl(imgLocalUrl));this.rotationAngle(0)}.bind(this))["catch"](function(err){err&&"no image selected"!==err&&"has no access to camera"!==err&&app.modals.showError({error:err,title:"Error getting photo."})}):app.modals.showNotification({message:"Take photo is not supported on the web right now"})}.bind(this);this.takePhoto=function(){takePickPhoto(!0)}.bind(this);this.pickPhoto=function(){takePickPhoto(!1)}.bind(this);var editRemotePhoto=function(){var r=this.rotationAngle();return 0===r?Promise.resolve(null):app.model.rest.post(this.photoEditRestUrl,{rotationAngle:r})}.bind(this),nativeUploadPhoto=function(){if(!this.localPhotoUrl())return editRemotePhoto();var uploadSettings={fileKey:this.photoUploadFieldName,mimeType:"image/jpeg",httpMethod:"PUT",headers:$.extend(!0,{},app.model.rest.extraHeaders),params:{rotationAngle:this.rotationAngle()}};return photoTools.uploadLocalFileJson(this.localPhotoUrl(),this.photoUploadUrl,uploadSettings)}.bind(this),webUploadPhoto=function(){var fd=this.localPhotoData();if(!fd)return editRemotePhoto();fd.headers=$.extend(!0,{},app.model.rest.extraHeaders);fd.formData=[{name:"rotationAngle",value:this.rotationAngle()}];return Promise.resolve(fd.submit())}.bind(this);this.uploadPhoto=function(){return photoTools.takePhotoSupported()?nativeUploadPhoto():webUploadPhoto()}.bind(this);this.rotationAngle=ko.observable(0);this.rotatePhoto=function(){var d=0|this.rotationAngle();this.rotationAngle((d+90)%360)};this.photoRotationStyle=ko.pureComputed(function(){var d=0|this.rotationAngle();return"transform: rotate("+d+"deg);"},this)};module.exports._inherits(MarketplaceProfileVM)},{"../utils/photoTools":350,"./MarketplaceProfileVM":381,jquery:!1,knockout:!1}],381:[function(require,module,exports){"use strict";var ko=require("knockout"),clipboard=require("../utils/clipboard");module.exports=function MarketplaceProfileVM(app){var marketplaceProfile=app.model.marketplaceProfile,profileVersion=marketplaceProfile.newVersion();profileVersion.isObsolete.subscribe(function(itIs){itIs&&profileVersion.pull({evenIfNewer:!0})});this.profile=profileVersion.version;this.isLoading=marketplaceProfile.isLoading;this.isSaving=marketplaceProfile.isSaving;this.isLocked=marketplaceProfile.isLocked;this.discard=function discard(){profileVersion.pull({evenIfNewer:!0});this.copyCustomUrlButtonText("Copy")}.bind(this);this.save=function save(){return profileVersion.pushSave()};this.sync=app.model.marketplaceProfile.sync.bind(app.model.marketplaceProfile);this.customUrlProtocol=ko.observable("https://");this.customUrlDomainPrefix=ko.observable("www.loconomics.com/-");this.customUrlDraft=ko.pureComputed(function(){return this.customUrlProtocol()+this.customUrlDomainPrefix()+this.profile.serviceProfessionalProfileUrlSlug()},this);this.copyCustomUrlButtonText=ko.observable("Copy");this.profile.serviceProfessionalProfileUrlSlug.subscribe(function(){this.copyCustomUrlButtonText("Copy")}.bind(this));this.copyCustomUrl=function(){var url=this.customUrlDraft(),errMsg=clipboard.copy(url);errMsg?app.modals.showError({error:errMsg}):this.copyCustomUrlButtonText("Copied!")}.bind(this)}},{"../utils/clipboard":332,knockout:!1}],382:[function(require,module,exports){function NavAction(values){Model(this);this.model.defProperties({link:"",icon:"",text:"",isTitle:!1,isModal:!1,isShell:!1,isMenu:!1,handler:null},values);this.runHandler=function runHandler(obj,event){var handler=this.handler();if(handler){event.stopImmediatePropagation();event.preventDefault();handler.call(this,event,obj)}}.bind(this)}var Model=require("../models/Model");module.exports=NavAction;NavAction.prototype.getHref=function getHref(){return this.handler()||this.isMenu()||this.isModal()||this.isShell()?"#":this.link()};NavAction.prototype.getModalTarget=function getModalTarget(){return this.handler()||this.isMenu()||!this.isModal()||this.isShell()?"":this.link()};NavAction.prototype.getShellCommand=function getShellCommand(){return this.handler()||this.isMenu()||!this.isShell()?"":this.link()};NavAction.prototype.getMenuID=function getMenuID(){return this.handler()||!this.isMenu()?"":this.link()};NavAction.prototype.getMenuLink=function getMenuLink(){return this.handler()||!this.isMenu()?"":"#"+this.link()};NavAction.goHome=new NavAction({link:"/",icon:"fa ion ion-stats-bars"});NavAction.goBack=new NavAction({link:"goBack",icon:"fa ion ion-ios-arrow-left",
isShell:!0});NavAction.menuIn=new NavAction({link:"menuIn",icon:"menu",isMenu:!0});NavAction.menuNewItem=new NavAction({link:"menuNewItem",icon:"fa ion ion-ios-plus-empty",isMenu:!0});NavAction.goMarketplace=new NavAction({link:"/home",icon:"fa ion ion-ios-cart-outline"});NavAction.goHelpIndex=new NavAction({link:"/contactForm/general?mustReturn=true",text:"Contact us",isModal:!1});NavAction.goLogin=new NavAction({link:"/login",text:"Log in"});NavAction.goLogout=new NavAction({link:"/logout",text:"Log out"});NavAction.goSignup=new NavAction({link:"/signup",text:"Sign up"})},{"../models/Model":264}],383:[function(require,module,exports){function NavBar(values){Model(this);this.model.defProperties({title:"",leftAction:{Model:NavAction},rightAction:{Model:NavAction},hidden:!1,additionalNavClasses:""},values)}var Model=require("../models/Model"),NavAction=require("./NavAction");module.exports=NavBar},{"../models/Model":264,"./NavAction":382}],384:[function(require,module,exports){"use strict";function saveLastBooking(s){return new Promise(function(resolve){var d=JSON.stringify(s);sessionStorage.setItem("lastBooking",d);resolve(d)})}function loadLastBooking(){return new Promise(function(resolve){var d=sessionStorage.getItem("lastBooking");resolve(JSON.parse(d))})}function clearLastBooking(){return new Promise(function(resolve){sessionStorage.removeItem("lastBooking");resolve()})}function NewClientBookingCardVM(app){BaseClientBookingCardVM.call(this,app);this.newDataReady=ko.observable(!1);this.bookCode=ko.observable(null);this.makeRepeatBooking=ko.observable(!1);this.promotionalCode=ko.observable("");this.paymentMethod=ko.observable(null);this.signupVM=new SignupVM(app);this.isLoadingNewBooking=ko.observable(!1);this.isRestoring=ko.observable(!1);this.isDone=ko.observable(!1);var baseIsLoading=this.isLoading;this.isLoading=ko.pureComputed(function(){return this.isLoadingNewBooking()||baseIsLoading()},this);var baseReset=this.reset;this.reset=function reset(){baseReset();this.newDataReady(!1);this.bookCode(null);this.promotionalCode("");this.paymentMethod(null);this.makeRepeatBooking(!1);this.signupVM.reset();this.isSaving(!1);this.isDone(!1)}.bind(this);this.saveState=function saveState(){if(!this.booking())return Promise.resolve();var s={serviceProfessionalUserID:this.booking().serviceProfessionalUserID(),jobTitleID:this.booking().jobTitleID(),bookCode:this.bookCode()},services=this.serviceProfessionalServices.selectedServices();s.services=services.map(function(serv){return serv.serviceProfessionalServiceID()});s.presetGratuity=this.presetGratuity();s.gratuityAmount=this.gratuityAmount();s.promotionalCode=this.promotionalCode();var add=this.booking().serviceAddress();s.serviceAddress=add&&add.model.toPlainObject(!0)||null;s.serviceDate=this.booking().serviceDate();s.serviceDate=s.serviceDate?s.serviceDate.model.toPlainObject():null;s.alternativeDate1=this.booking().alternativeDate1();s.alternativeDate1=s.alternativeDate1?s.alternativeDate1.model.toPlainObject():null;s.alternativeDate2=this.booking().alternativeDate2();s.alternativeDate2=s.alternativeDate2?s.alternativeDate2.model.toPlainObject():null;s.specialRequests=this.booking().specialRequests();var pm=this.paymentMethod();s.paymentMethod=pm?pm.model.toPlainObject(!0):null;return saveLastBooking(s)}.bind(this);this.restoreState=function restoreState(){this.isRestoring(!0);return loadLastBooking().then(function(s){if(s){clearLastBooking();var spuid=this.booking().serviceProfessionalUserID(),jid=this.booking().jobTitleID();if(s.serviceProfessionalUserID===spuid&&s.jobTitleID===jid){this.bookCode(s.bookCode);this.serviceProfessionalServices.once("loaded",function(){this.isRestoring(!0);this.serviceProfessionalServices.list().forEach(function(serv){if(s.services.indexOf(serv.serviceProfessionalServiceID())>-1){serv.isSelected(!0);this.serviceProfessionalServices.selectedServices.push(serv)}}.bind(this));this.isRestoring(!1)}.bind(this));this.presetGratuity(s.presetGratuity);this.gratuityAmount(s.gratuityAmount);this.promotionalCode(s.promotionalCode);if(s.serviceAddress)var addressSubscription=this.isLoadingServiceAddresses.subscribe(function(isIn){if(!isIn){addressSubscription.dispose();this.isRestoring(!0);if(s.serviceAddress.addressID){var foundAddress,searchAddress=function(add){if(add.addressID()===s.serviceAddress.addressID){foundAddress=add;return!0}};this.serviceAddresses.addresses().some(searchAddress);if(foundAddress)this.serviceAddresses.selectedAddress(foundAddress);else{this.clientAddresses.addresses().some(searchAddress);foundAddress&&this.clientAddresses.selectedAddress(foundAddress)}}else{this.booking().serviceAddress(new Address(s.serviceAddress));this.addressEditorOpened(!0)}this.isRestoring(!1)}}.bind(this));this.booking().serviceDate(s.serviceDate?new EventDates(s.serviceDate):null);this.booking().alternativeDate1(s.alternativeDate1?new EventDates(s.alternativeDate1):null);this.booking().alternativeDate2(s.alternativeDate2?new EventDates(s.alternativeDate2):null);this.booking().specialRequests(s.specialRequests);var pm=s.paymentMethod;pm&&this.paymentMethod()&&this.paymentMethod().model.updateWith(pm,!0)}this.isRestoring(!1)}else this.isRestoring(!1)}.bind(this))["catch"](function(err){console.error("Last Booking state could not being restored",err);this.isRestoring(!1)}.bind(this))}.bind(this);this.confirmBtnText=ko.pureComputed(function(){return this.isSaving()?"Confirming...":this.isAnonymous()?"Sign up and confirm":"Confirm"},this);this.paymentMethodDisplay=ko.pureComputed(function(){var n=this.booking().paymentLastFourCardNumberDigits();return n?"Card ending in "+n:""},this);ko.computed(function(){var pm=this.paymentMethod(),number=pm&&pm.cardNumber();if(number){var last=number.slice(-4);this.booking().paymentLastFourCardNumberDigits(last)}},this);this.initBooking=function(serviceProfessionalID,jobTitleID,bookCode){this.reset();this.bookCode(bookCode);this.isLoadingNewBooking(!0);app.model.bookings.getNewClientBooking({serviceProfessionalUserID:serviceProfessionalID,jobTitleID:jobTitleID,bookCode:bookCode}).then(function(bookingData){this.originalBooking(new Booking(bookingData));if(this.originalBooking().paymentEnabled()){var ipm=new InputPaymentMethod;ipm.billingAddress(new Address);this.paymentMethod(ipm)}return this.restoreState()}.bind(this)).then(function(){this.isLoadingNewBooking(!1);this.newDataReady(!0);this.edit();this.progress.reset();this.nextStep()}.bind(this))["catch"](function(err){this.isLoadingNewBooking(!1);app.modals.showError({error:err})}.bind(this))}.bind(this);this.bookingHeader=ko.pureComputed(function(){var v=this.booking()&&this.booking().instantBooking();return v===!0?"Your instant booking":v===!1?"Your booking request":""},this);this.save=function(){this.isSaving(!0);var saveIt=function(){var requestOptions={promotionalCode:this.promotionalCode(),bookCode:this.bookCode()};return app.model.bookings.requestClientBooking(this.booking(),requestOptions,this.paymentMethod())}.bind(this),success=function(serverBooking){this.isSaving(!1);this.originalBooking().model.updateWith(serverBooking,!0);this.editedVersion(null);app.model.availability.clearUserCache(this.originalBooking().serviceProfessionalUserID());this.isDone(!0);app.modals.showNotification({title:"Done!",message:"Your booking was created!"}).then(function(){app.shell.go("/")})}.bind(this),onerror=function(err){this.isSaving(!1);app.modals.showError({error:err})}.bind(this);this.isAnonymous()?this.signupVM.performSignup().then(saveIt).then(success)["catch"](onerror):saveIt().then(success)["catch"](onerror)}.bind(this);this.goLogin=function(d,e){app.shell.go("/login",{redirectUrl:app.shell.currentRoute.url});if(e){e.preventDefault();e.stopImmediatePropagation()}}.bind(this)}var ko=require("knockout"),Booking=require("../models/Booking"),BaseClientBookingCardVM=require("../viewmodels/BaseClientBookingCardVM"),InputPaymentMethod=require("../models/InputPaymentMethod"),SignupVM=require("../viewmodels/Signup"),Address=require("../models/Address"),EventDates=require("../models/EventDates");NewClientBookingCardVM._inherits(BaseClientBookingCardVM);module.exports=NewClientBookingCardVM},{"../models/Address":231,"../models/Booking":234,"../models/EventDates":242,"../models/InputPaymentMethod":248,"../viewmodels/BaseClientBookingCardVM":372,"../viewmodels/Signup":395,knockout:!1}],385:[function(require,module,exports){function OnboardingProgress(values){var stepNumberFinished=-1;Model(this);this.model.defProperties({stepNumber:stepNumberFinished,selectedJobTitleID:null},values);this.totalSteps=ko.pureComputed(function(){return this.stepNames.length-1},this);this.incrementStep=function(){var currentStep=this.stepNumber();this.isFinished()||(currentStep==this.stepNames.length-1?this.finish():this.stepNumber(currentStep+1))};this.stepAfter=function(stepName){var nextStep=new OnboardingProgress({selectedJobTitleID:this.selectedJobTitleID()});nextStep.setStepByName(stepName);nextStep.incrementStep();return nextStep};this.stepName=ko.pureComputed(function(){return this.stepNames[this.stepNumber()]||null},this);this.stepNames=OnboardingProgress.steps.names;this.stepUrl=ko.pureComputed(function(){var name=this.stepName();if(!name)return null;var url="/"+name,def=OnboardingProgress.steps.definitions[name],jobID=this.selectedJobTitleID();jobID&&def&&def.jobTitleSpecific&&(url+="/"+jobID);return url},this);this.progressText=ko.pureComputed(function(){return this.stepNumber()+" of "+this.totalSteps()},this);this.inProgress=ko.pureComputed(function(){return!this.isFinished()},this);this.finish=function(){this.stepNumber(stepNumberFinished)};this.isFinished=ko.pureComputed(function(){return this.stepNumber()===stepNumberFinished},this)}var Model=require("../models/Model"),ko=require("knockout");module.exports=OnboardingProgress;OnboardingProgress.prototype.setStepByName=function setStepByName(name){var stepIndex=this.stepNames.indexOf(name);if(stepIndex>-1){this.stepNumber(stepIndex);return!0}return!1};OnboardingProgress.steps={names:["welcome","addJobTitles","schedulingPreferences","serviceProfessionalService","serviceAddresses","bookingPolicies","licensesCertifications","aboutMe","paymentAccount"],definitions:{welcome:{},addJobTitles:{},schedulingPreferences:{},serviceProfessionalService:{jobTitleSpecific:!0},serviceAddresses:{jobTitleSpecific:!0},bookingPolicies:{jobTitleSpecific:!0},licensesCertifications:{jobTitleSpecific:!0},aboutMe:{},paymentAccount:{}}}},{"../models/Model":264,knockout:!1}],386:[function(require,module,exports){"use strict";module.exports=function OnboardingProgressBarVM(app){this.isInOnboarding=app.model.onboarding.inProgress}},{}],387:[function(require,module,exports){"use strict";var ko=require("knockout");module.exports=function OnboardingProgressMarkVM(app){var o=app.model.onboarding;this.progressText=o.progressText;var getClassNames=function(i){var n=o.stepNumber();return n>i?"ion-ios-checkmark text-success":i===n?"ion-ios-checkmark-outline text-success":"ion-ios-checkmark-outline"};this.marks=ko.pureComputed(function(){for(var t=o.totalSteps(),l=[],i=1;t>=i;i++)l.push({classNames:ko.pureComputed(getClassNames.bind(null,i))});return l},this)}},{knockout:!1}],388:[function(require,module,exports){"use strict";var ko=require("knockout"),PostalCode=function(options){if(!options)throw"Options required at postal code auto-lookup";if(!options.address)throw"Address required (must have address-like observable fields with standard names)";if(!ko.isObservable(options.postalCodeError))throw"Postal Code Error observable required";if(!options.appModel)throw"A reference to the App Model instance is required";var postalCodeError=options.postalCodeError,isErrorMasked=ko.observable(!1),maskedPostalCodeError=ko.observable(""),addressModel=ko.isObservable(options.address)?options.address:ko.observable(options.address),model=options.appModel.postalCodes,enabled=ko.isObservable(options.enabled)?options.enabled:ko.observable(!0),lookup=function postalCodeLookup(address,postalCode){postalCode?model.isValid(postalCode)&&model.getItem(postalCode).then(function(addressObject){if(addressObject){model.updateAddressModel(addressObject,address);maskedPostalCodeError("")}})["catch"](function(err){model.updateAddressModel(model.emptyAddress,address);err&&err.responseJSON&&err.responseJSON.errorMessage?maskedPostalCodeError(err.responseJSON.errorMessage):console.error("Server error validating Zip Code",err)}):model.updateAddressModel(model.emptyAddress,address)};this.onBlur=function(){isErrorMasked(!1)};this.onFormLoaded=function(){isErrorMasked(addressModel()&&!addressModel().postalCode())};this.onFormLoaded();ko.computed(function(){postalCodeError(isErrorMasked()?"":maskedPostalCodeError())});ko.computed(function(){if(enabled()){var address=ko.unwrap(addressModel);if(address){var postalCode=address.postalCode();lookup(address,postalCode)}}}).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}})};module.exports=PostalCode},{knockout:!1}],389:[function(require,module,exports){"use strict";var SearchResults=require("../models/SearchResults"),ko=require("knockout"),DEFAULT_LOCATION={lat:"37.788479",lng:"-122.40297199999998",searchDistance:30,city:"San Francisco, CA USA"};module.exports=function SearchJobTitlesVM(app){this.isLoading=ko.observable(!1);this.searchTerm=ko.observable();this.lat=ko.observable(DEFAULT_LOCATION.lat);this.lng=ko.observable(DEFAULT_LOCATION.lng);this.city=ko.observable();this.searchDistance=ko.observable(DEFAULT_LOCATION.searchDistance);this.searchResults=new SearchResults;var latestRequest=null;this.loadData=function(searchTerm,lat,lng){latestRequest&&latestRequest.xhr.abort();this.isLoading(!0);latestRequest=app.model.rest.get("search",{searchTerm:searchTerm,origLat:lat||DEFAULT_LOCATION.lat,origLong:lng||DEFAULT_LOCATION.lng,searchDistance:DEFAULT_LOCATION.searchDistance});return latestRequest.then(function(searchResults){searchResults?this.searchResults.model.updateWith(searchResults,!0):this.searchResults.model.reset();this.isLoading(!1)}.bind(this))["catch"](function(err){this.isLoading(!1);return err&&"abort"===err.statusText?null:void 0}.bind(this))};this.search=function(){var s=this.searchTerm();s&&s.length>2?this.loadData(s,this.lat(),this.lng()):this.searchResults.model.reset()};ko.computed(function(){this.search()},this).extend({rateLimit:{method:"notifyAtFixedRate",timeout:300}});this.isInput=ko.pureComputed(function(){var s=this.searchTerm();return s&&s.length>2},this);this.onClickJobTitle=function(){};this.clickJobTitle=function(d,e){try{this.onClickJobTitle(d,e)}catch(ex){}this.searchTerm("")}.bind(this);this.onClickNoJobTitle=function(){};this.clickNoJobTitle=function(d,e){try{this.onClickNoJobTitle(this.searchTerm(),e)}catch(ex){}this.searchTerm("")}.bind(this);this.jobTitleHref=ko.observable("");this.noJobTitleHref=ko.observable("");this.customResultsButtonText=ko.observable("");this.resultsButtonText=ko.pureComputed(function(){var t=this.customResultsButtonText();if(t)return t;var anon=app.model.userProfile.data.isAnonymous();return anon?"Sign up":"Add"},this);this.thereAreJobTitles=ko.pureComputed(function(){var jts=this.searchResults.jobTitles();return jts.length>0},this)}},{"../models/SearchResults":286,knockout:!1}],390:[function(require,module,exports){"use strict";function ServiceAddressesViewModel(){this.isSelectionMode=ko.observable(!1);this.sourceAddresses=ko.observableArray([]);this.selectedAddress=ko.observable(null);this.reset=function(){this.isSelectionMode(!1);this.sourceAddresses([]);this.selectedAddress(null)};this.addresses=ko.pureComputed(function(){var list=this.sourceAddresses();this.isSelectionMode()&&(list=list.filter(function(add){return add.isServiceLocation()}));return list},this);this.hasAddresses=ko.pureComputed(function(){var adds=this.addresses();return adds&&adds.length>0},this);this.serviceAreas=ko.pureComputed(function(){var list=this.sourceAddresses();return list.filter(function(add){return add.isServiceArea()})},this);this.selectAddress=function(selectedAddress,event){this.selectedAddress(selectedAddress);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.observerSelected=function(item){return ko.pureComputed(function(){var sid=this.selectedAddress()&&ko.unwrap(this.selectedAddress().addressID),iid=item&&ko.unwrap(item.addressID);return sid===iid},this)}.bind(this);this.presetSelectedAddressID=function(addressID){if(this.isSelectionMode()){this.selectedAddress(null);this.addresses().some(function(add){if(add.addressID()===addressID){this.selectedAddress(add);return!0}}.bind(this))}}.bind(this)}var ko=require("knockout");module.exports=ServiceAddressesViewModel},{knockout:!1}],391:[function(require,module,exports){"use strict";var ServiceList=function(options){this.services=options.services;this.title=options.title;this.newButtons=options.newButtons||[]};ServiceList.NewButton=function(options){this.label=options.label;this.pricingTypeID=options.pricingTypeID;this.isClientSpecific=options.isClientSpecific};module.exports=ServiceList},{}],392:[function(require,module,exports){"use strict";var groupBy=require("../utils/groupBy"),mapBy=require("../utils/mapBy"),ServiceList=require("./ServiceList"),$=require("jquery"),ServiceListGroup=function(options){var optionsDefaults={title:"",services:[],pricingTypes:[],defaultPricingTypes:[],isClientSpecific:!1};options=$.extend(optionsDefaults,options);this.title=options.title;this.services=options.services;this.pricingTypes=options.pricingTypes;this.defaultPricingTypes=options.defaultPricingTypes;this.isClientSpecific=options.isClientSpecific};ServiceListGroup.prototype.serviceLists=function(){var groups=groupBy(this.services,function(service){return service.pricingTypeID()},this.defaultGroups());return Object.keys(groups).map(function(pricingTypeID){var pricingType=this.pricingTypesByID()[pricingTypeID],listTitle=this.listTitle({pricingType:pricingType});return new ServiceList({services:groups[pricingTypeID],title:listTitle,newButtons:this.newButtons({pricingType:pricingType})})}.bind(this))};ServiceListGroup.prototype.listTitle=function(options){return options.pricingType.pluralName()||"Services"};ServiceListGroup.prototype.newButtonLabel=function(options){return options.pricingType.addNewLabel()};ServiceListGroup.prototype.newButtons=function(options){var newButtonOptions={label:this.newButtonLabel({pricingType:options.pricingType}),pricingTypeID:options.pricingType.pricingTypeID(),isClientSpecific:this.isClientSpecific};return[new ServiceList.NewButton(newButtonOptions)]};ServiceListGroup.prototype.defaultGroups=function(){return this.defaultPricingTypes.map(function(type){return type.pricingTypeID()})};ServiceListGroup.prototype.pricingTypesByID=function(){return mapBy(this.pricingTypes,function(type){return type.pricingTypeID()})};module.exports=ServiceListGroup},{"../utils/groupBy":344,"../utils/mapBy":349,"./ServiceList":391,jquery:!1}],393:[function(require,module,exports){"use strict";var ServiceCollection=require("../models/ServiceCollection"),ServiceListGroup=require("./ServiceListGroup"),ServiceList=require("./ServiceList"),$=require("jquery"),Factories={},ClientBookedServicesListGroup=function(options){ServiceListGroup.call(this,options)};ClientBookedServicesListGroup._inherits(ServiceListGroup);ClientBookedServicesListGroup.prototype.listTitle=function(options){var pricingTypeLabel=options.pricingType&&options.pricingType.pluralName()||"Services",postFix=this.isClientSpecific?" Just For You":"";return"Select From "+pricingTypeLabel+postFix};ClientBookedServicesListGroup.prototype.newButtons=function(){return[]};Factories.clientBookedServices=function(services,pricingTypes){var serviceCollection=new ServiceCollection(services),options={pricingTypes:pricingTypes},clientListGroup=new ClientBookedServicesListGroup($.extend(options,{services:serviceCollection.clientSpecificServices(),isClientSpecific:!0})),publicListGroup=new ClientBookedServicesListGroup($.extend(options,{services:serviceCollection.publicServices(),isClientSpecific:!1}));return[clientListGroup,publicListGroup]};var ProviderBookedServicesListGroup=function(options){ServiceListGroup.call(this,options)};ProviderBookedServicesListGroup._inherits(ServiceListGroup);ProviderBookedServicesListGroup.prototype.listTitle=function(options){var pricingTypeLabel=options.pricingType&&options.pricingType.pluralName()||"Services";return"Select From "+pricingTypeLabel};var ProviderBookedClientServicesListGroup=function(options){this.clientName=options.clientName;this.pricingTypes=options.pricingTypes;this.services=options.services;this.title="Offerings only available to "+options.clientName};ProviderBookedClientServicesListGroup.prototype.newButtons=function(){var clientName=this.clientName;return this.pricingTypes.map(function(pricingType){return new ServiceList.NewButton({label:pricingType.addNewLabel()+" just for "+clientName,pricingTypeID:pricingType.pricingTypeID(),isClientSpecific:!0})})};ProviderBookedClientServicesListGroup.prototype.serviceLists=function(){var serviceList=new ServiceList({services:this.services,title:"",newButtons:this.newButtons()});return[serviceList]};Factories.providerBookedServices=function(services,pricingTypes,clientName){services=new ServiceCollection(services);var options={pricingTypes:pricingTypes},clientListGroup=new ProviderBookedClientServicesListGroup($.extend(options,{services:services.clientSpecificServices(),clientName:clientName})),publicListGroup=new ProviderBookedServicesListGroup($.extend(options,{services:services.publicServices(),isClientSpecific:!1,defaultPricingTypes:pricingTypes,title:"Offerings Available to Everyone"}));return[clientListGroup,publicListGroup]};var ProviderManagedServicesListGroup=function(options){this.clientName=options.clientName;ServiceListGroup.call(this,options)};ProviderManagedServicesListGroup._inherits(ServiceListGroup);ProviderManagedServicesListGroup.prototype.listTitle=function(options){var clientPostfix=this.clientName.length>0?" for "+this.clientName:"",pricingType=options.pricingType,pricingTypeLabel=pricingType&&pricingType.pluralName()||"Services";return pricingTypeLabel+clientPostfix};Factories.providerManagedServices=function(services,pricingTypes,clientName,isClientSpecific){var serviceListGroup=new ProviderManagedServicesListGroup({services:services,clientName:clientName,pricingTypes:pricingTypes,defaultPricingTypes:pricingTypes,isClientSpecific:isClientSpecific});return[serviceListGroup]};module.exports=Factories},{"../models/ServiceCollection":289,"./ServiceList":391,"./ServiceListGroup":392,jquery:!1}],394:[function(require,module,exports){"use strict";function ServiceProfessionalServiceViewModel(app){EventEmitter.call(this);this.list=ko.observableArray([]);this.jobTitleID=ko.observable(0);this.serviceProfessionalID=ko.observable(null);this.jobTitle=ko.observable(null);this.pricingTypes=ko.observableArray([]);this.isAdditionMode=ko.observable(!1);this.isSelectionMode=ko.observable(!1);this.selectedServices=ko.observableArray([]);this.preSelectedServices=ko.observableArray([]);this.isLoading=ko.observable(!1);this.reset=function(){this.isLoading(!1);this.list([]);this.jobTitleID(0);this.pricingTypes([]);this.serviceProfessionalID(null);this.jobTitle(null);this.isAdditionMode(!1);this.isSelectionMode(!1);this.selectedServices([]);this.preSelectedServices([])};this.serviceListGroupsFactory=function(){return[]};this.serviceListGroups=ko.computed(function(){return this.serviceListGroupsFactory(this.list(),this.pricingTypes())},this);this.toggleServiceSelection=function(service){var inIndex=-1,isSelected=this.selectedServices().some(function(selectedServices,index){if(selectedServices===service){inIndex=index;return!0}});service.isSelected(!isSelected);isSelected?this.selectedServices.splice(inIndex,1):this.selectedServices.push(service)}.bind(this);this.editServiceURL=function(jobTitleID,serviceID){return"#!serviceProfessionalServiceEditor/"+jobTitleID+"/"+serviceID}.bind(this);this.editServiceRequest=function(){return{}}.bind(this);this.editService=function(service){app.shell.go(this.editServiceURL(this.jobTitleID(),service.serviceProfessionalServiceID()),this.editServiceRequest())}.bind(this);this.tapService=function(service,event){this.isSelectionMode()?this.toggleServiceSelection(service):this.editService(service);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.newServiceURL=function(jobTitleID,pricingTypeID){return"#!serviceProfessionalServiceEditor/"+jobTitleID+"/pricingType/"+pricingTypeID+"/new"}.bind(this);this.newServiceRequest=function(){return{}}.bind(this);this.tapNewService=function(newButton,event){var url=this.newServiceURL(this.jobTitleID(),newButton.pricingTypeID,newButton.isClientSpecific),request=$.extend({},this.newServiceRequest(),{selectedJobTitleID:this.jobTitleID()});this.isSelectionMode()&&(request.selectedServices=this.selectedServices().map(this.selectedServiceRequest));app.shell.go(url,request);event.preventDefault();event.stopImmediatePropagation()}.bind(this);this.selectedServiceRequest=function(pricing){return{serviceProfessionalServiceID:ko.unwrap(pricing.serviceProfessionalServiceID),totalPrice:ko.unwrap(pricing.totalPrice)}};this.loadData=function(serviceProfessionalID,jobTitleID,servicesPromise){this.serviceProfessionalID(serviceProfessionalID);this.jobTitleID(jobTitleID);this.isLoading(!0);return app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){this.jobTitle(jobTitle);var pricingTypeIDs=jobTitle.pricingTypes().map(function(type){return type.pricingTypeID()});return app.model.pricingTypes.getListByIDs(pricingTypeIDs)}.bind(this)).then(function(pricingTypes){this.pricingTypes(pricingTypes);return servicesPromise}.bind(this)).then(function(list){list=app.model.serviceProfessionalServices.asModel(list);var preset=this.preSelectedServices(),selection=this.selectedServices;list.forEach(function(item){var preSelected=preset.some(function(pr){return pr.serviceProfessionalServiceID===item.serviceProfessionalServiceID()?!0:void 0})||!1;item.isSelected=ko.observable(preSelected);preSelected&&selection.push(item)});this.list(list);this.isLoading(!1);this.emit("loaded")}.bind(this))["catch"](function(err){this.isLoading(!1);app.modals.showError({title:"There was an error while loading.",error:err})}.bind(this))}.bind(this);this.clearData=function(){this.serviceProfessionalID(null);this.list([]);this.jobTitle(null)}.bind(this)}var ko=require("knockout"),$=require("jquery"),EventEmitter=require("events").EventEmitter;ServiceProfessionalServiceViewModel._inherits(EventEmitter);module.exports=ServiceProfessionalServiceViewModel},{events:!1,jquery:!1,knockout:!1}],395:[function(require,module,exports){"use strict";function SignupVM(app){EventEmitter.call(this);fb.load();this.confirmationCode=ko.observable(null);this.firstName=new Field;this.lastName=new Field;this.phone=new Field;this.postalCode=new Field;this.countriesOptions=countriesOptions();this.country=new Field;this.country(countriesOptions.unitedStates);this.referralCode=new Field;this.device=new Field;this.facebookUserID=ko.observable();this.facebookAccessToken=ko.observable();this.jobTitleID=ko.observable();this.jobTitleName=ko.observable();this.email=new Field;this.validatedPassword=new ValidatedPasswordViewModel;this.isCountryVisible=ko.observable(!0);this.isEmailSignupDisplayed=ko.observable(!1);this.isFirstNameValid=ko.pureComputed(function(){var firstNameRegex=/^(\S{2,}\s*)+$/;return firstNameRegex.test(this.firstName())},this);this.isLastNameValid=ko.pureComputed(function(){var lastNameRegex=/^(\S{2,}\s*)+$/;return lastNameRegex.test(this.lastName())},this);this.isPostalCodeValid=ko.pureComputed(function(){var postalCodeRegex=/^\d{5}([\-]?\d{4})?$/;return postalCodeRegex.test(this.postalCode())},this);this.isPhoneValid=ko.pureComputed(function(){var phoneRegex=/^\([1-9]\d{2}\)\ \d{3}\-\d{4,8}$|^[1-9]\d{2}\-\d{3}\-\d{4,8}$|^[1-9]\d{2}\.\d{3}\.\d{4,8}$|^[1-9]\d{9,13}$/;return phoneRegex.test(this.phone())},this);this.isEmailValid=ko.pureComputed(function(){var emailRegex=/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;return emailRegex.test(this.email())},this);this.isReferralCodeValid=ko.pureComputed(function(){var referralCodeRegex=/^.{3,}$/;return referralCodeRegex.test(this.referralCode())},this);this.signupError=ko.observable("");this.isSigningUp=ko.observable(!1);this.isSigningUpWithFacebook=ko.observable(!1);this.enableFacebookButton=ko.pureComputed(function(){return!this.isSigningUpWithFacebook()&&fb.isReady()},this);this.profile=ko.observable("");this.emailIsLocked=ko.observable(!1);this.reset=function(){this.confirmationCode(null);this.firstName("");this.lastName("");this.phone("");this.postalCode("");this.country(countriesOptions.unitedStates);this.referralCode("");this.device("");this.facebookUserID("");this.facebookAccessToken("");this.email("");this.validatedPassword.reset();this.signupError("");this.isSigningUp(!1);this.isSigningUpWithFacebook(!1);this.profile("");this.emailIsLocked(!1);this.jobTitleID(null);this.jobTitleName(null);this.isEmailSignupDisplayed(!1)};this.submitText=ko.pureComputed(function(){return this.isSigningUp()?"Signing up...":"Sign up"},this);this.facebookSubmitText=ko.pureComputed(function(){return fb.isReady()?this.isSigningUpWithFacebook()?"Signing up with Facebook...":"Sign up with Facebook":"Loading Facebook..."},this);this.performSignup=function performSignup(){this.isSigningUp(!0);this.signupError("");var plainData={confirmationCode:this.confirmationCode(),email:this.email(),password:this.validatedPassword.password(),firstName:this.firstName(),lastName:this.lastName(),phone:this.phone(),postalCode:this.postalCode(),countryID:this.country().id,referralCode:this.referralCode(),device:this.device(),facebookUserID:this.facebookUserID(),facebookAccessToken:this.facebookAccessToken(),profileType:this.profile(),jobTitleID:this.jobTitleID(),jobTitleName:this.jobTitleName()};return app.model.signup(plainData).then(function(signupData){if(app.model.onboarding){app.model.onboarding.selectedJobTitleID(signupData.onboardingJobTitleID);app.model.onboarding.setStep(signupData.onboardingStep)}try{this.emit("signedup",signupData)||this.reset()}catch(ex){this.reset()}return signupData}.bind(this))["catch"](function(err){err=err&&err.responseJSON;var msg=err&&err.errorMessage;app.modals.showError({title:"There was an error signing-up",error:err});err&&"validation"===err.errorSource&&err.errors?Object.keys(err.errors).forEach(function(fieldKey){this[fieldKey]&&this[fieldKey].error&&this[fieldKey].error(err.errors[fieldKey])}.bind(this)):this.signupError(msg||err&&err.statusText||"Invalid username or password");this.isSigningUp(!1);throw err}.bind(this))}.bind(this);this.clickSignup=function(){this.performSignup()["catch"](function(err){this.emit("signuperror",err)}.bind(this))}.bind(this);this.forServiceProfessional=ko.pureComputed(function(){return this.profile()===profileType.serviceProfessional},this);this.forClient=ko.pureComputed(function(){return!this.forServiceProfessional()},this);this.facebook=function(){var vm=this;this.isSigningUpWithFacebook(!0);this.isEmailSignupDisplayed(!1);facebookLogin().then(function(result){var auth=result.authResponse;vm.facebookUserID(auth.userID);vm.facebookAccessToken(auth.accessToken);return facebookMe()}).then(function(user){vm.email(user.email);vm.firstName(user.first_name);vm.lastName(user.last_name)}).then(this.clickSignup).then(function(){this.isSigningUpWithFacebook(!1)}.bind(this))["catch"](function(err){this.emit("signuperror",err)}.bind(this))};this.showEmailSignup=function(){this.isEmailSignupDisplayed(!0)}}var ko=require("knockout"),EventEmitter=require("events").EventEmitter,ValidatedPasswordViewModel=require("./ValidatedPassword"),Field=require("./Field"),fb=require("../utils/facebookUtils"),countriesOptions=require("./CountriesOptions"),profileType={
serviceProfessional:"service-professional",client:"client"},facebookLogin=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.login(["email"],s,e)}):fb.login({scope:"email"})},facebookMe=function(){return window.facebookConnectPlugin?new Promise(function(s,e){window.facebookConnectPlugin.api("/me?fields=email,first_name,last_name",["email"],s,e)}):window.FB?new Promise(function(s,e){window.FB.api("/me",{fields:"email,first_name,last_name"},function(r){!r||r.error?e(r&&r.error):s(r)})}):void 0};SignupVM._inherits(EventEmitter);module.exports=SignupVM;SignupVM.profileType=profileType},{"../utils/facebookUtils":338,"./CountriesOptions":375,"./Field":378,"./ValidatedPassword":398,events:!1,knockout:!1}],396:[function(require,module,exports){"use strict";function TimeSlotViewModel(params){this.startTime=getObservable(params.startTime||null);this.endTime=getObservable(params.endTime||null);this.subject=getObservable(params.subject||null);this.description=getObservable(params.description||null);this.link=getObservable(params.link||null);this.actionIcon=getObservable(params.actionIcon||null);this.actionText=getObservable(params.actionText||null);this.classNames=getObservable(params.classNames||null)}var getObservable=require("../utils/getObservable");module.exports=TimeSlotViewModel;var numeral=require("numeral"),Appointment=require("../models/Appointment");TimeSlotViewModel.fromAppointment=function fromAppointment(apt){var link="#!appointment/"+apt.startTime().toISOString()+"/"+apt.id();apt.id()===Appointment.specialIds.preparationTime&&(link="#!schedulingPreferences?mustReturn=1");var classNames=null;if(Appointment.specialIds.free===apt.id())classNames="Tile--tag-gray-lighter ";else if(apt.id()>0&&apt.sourceBooking()){classNames=apt.sourceBooking().isRequest()?"Tile--tag-warning ":"Tile--tag-primary ";classNames+="ItemAddonTile--largerContent "}else classNames="Tile--tag-danger ";return new TimeSlotViewModel({startTime:apt.startTime,endTime:apt.endTime,subject:apt.summary,description:apt.description,link:link,actionIcon:apt.sourceBooking()?null:apt.sourceEvent()?"fa ion ion-ios-arrow-right":apt.id()?null:"fa ion ion-plus",actionText:apt.sourceBooking()&&apt.sourceBooking().pricingSummary()?numeral(apt.sourceBooking().pricingSummary().totalPrice()||0).format("$0.00"):null,classNames:classNames})}},{"../models/Appointment":232,"../utils/getObservable":341,numeral:!1}],397:[function(require,module,exports){"use strict";function UserJobProfileViewModel(app){function syncJobTitle(jobTitleID){return app.model.jobTitles.getJobTitle(jobTitleID).then(function(jobTitle){jobTitlesIndex[jobTitleID]=jobTitle})}function attachJobTitle(userJobTitle){userJobTitle.jobTitle=ko.computed(function(){return jobTitlesIndex[this.jobTitleID()]},userJobTitle);userJobTitle.displayedSingularName=ko.computed(function(){return this.jobTitle()&&this.jobTitle().singularName()||"Unknow"},userJobTitle)}function attachMarketplaceStatus(userJobtitle){userJobtitle.marketplaceStatusHtml=ko.pureComputed(function(){var status=this.statusID(),isComplete=this.isComplete();return isComplete&&status===UserJobTitle.status.on?'Marketplace listing: <strong class="text-success">ON</strong>':isComplete&&status===UserJobTitle.status.off?'Marketplace listing: <strong class="text-danger">OFF</strong>':'<span class="text-danger">Steps remaining to activate listing</span>'},userJobtitle)}function attachExtras(userJobtitle){attachJobTitle(userJobtitle);attachMarketplaceStatus(userJobtitle)}this.showMarketplaceInfo=ko.observable(!1);var jobTitlesIndex={},showLoadingError=function showLoadingError(err){app.modals.showError({title:"An error happening when loading your job profile.",error:err});this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!0)}.bind(this);this.userJobProfile=ko.observableArray([]);app.model.userJobProfile.list.subscribe(function(list){Promise.all(list.map(function(userJobTitle){return syncJobTitle(userJobTitle.jobTitleID())})).then(function(){list.forEach(attachExtras);this.userJobProfile(list);this.isLoading(!1);this.isSyncing(!1);this.thereIsError(!1)}.bind(this))["catch"](showLoadingError)},this);this.isFirstTime=ko.observable(!0);this.isLoading=ko.observable(!1);this.isSyncing=ko.observable(!1);this.thereIsError=ko.observable(!1);this.baseUrl=ko.observable("/jobtitles");this.selectJobTitle=function(jobTitle){app.shell.go(this.baseUrl()+"/"+jobTitle.jobTitleID());return!1}.bind(this);this.sync=function sync(){var firstTime=this.isFirstTime();this.isFirstTime(!1);firstTime?this.isLoading(!0):this.isSyncing(!0);app.model.userJobProfile.syncList()["catch"](showLoadingError)}.bind(this)}var ko=require("knockout"),UserJobTitle=require("../models/UserJobTitle");module.exports=UserJobProfileViewModel},{"../models/UserJobTitle":300,knockout:!1}],398:[function(require,module,exports){"use strict";function ValidatedPassword(){var MINIMUM_HEIGHT_FOR_SCROLL=700,SCROLL_ANIMATION_DURATION=300,hasScrolledToField=!1,showRequirements=ko.observable(!1),showRequirementsLink=ko.observable(!0);this.password=new Field;this.reset=function(){showRequirements(!1);showRequirementsLink(!0);this.password("");hasScrolledToField=!1};this.requirementsLinkClick=function(){showRequirements(!0)}.bind(this);var scrollTarget=function(field){return $(field).parents(".ValidatedPassword").first()},scrollToField=function(target){if($(window).height()<MINIMUM_HEIGHT_FOR_SCROLL&&!hasScrolledToField){hasScrolledToField=!0;scrollToElement(target,{animation:{duration:SCROLL_ANIMATION_DURATION}})}};this.fieldFocus=function(viewModel,event){showRequirements()||showRequirementsLink(!1);showRequirements(!0);scrollToField(scrollTarget(event.target))}.bind(this);this.showRequirements=ko.pureComputed(function(){return showRequirements()},this);this.showRequirementsLink=ko.pureComputed(function(){return showRequirementsLink()},this);var validator=ko.pureComputed(function(){return new PasswordValidator(this.password())},this);this.isValid=ko.pureComputed(function(){return validator().isValid()},this);this.isLengthValid=ko.pureComputed(function(){return validator().isCorrectLength()},this);this.isCharacterKindsValid=ko.pureComputed(function(){return validator().isCorrectCharacterKinds()},this);this.usesSymbol=ko.pureComputed(function(){return validator().isCorrectSymbol()},this);this.usesUpper=ko.pureComputed(function(){return validator().isCorrectUpper()},this);this.usesLower=ko.pureComputed(function(){return validator().isCorrectLower()},this);this.usesNumber=ko.pureComputed(function(){return validator().isCorrectNumber()},this);this.characterKindsLabel=ko.pureComputed(function(){var count=validator().getCorrectCharacterKindsCount(),labels=["Includes at least 3 character types:","Includes at least 2 more character types:","Includes at least 1 more character type:","Includes at least 3 character types"];return labels[Math.min(count,labels.length-1)]},this)}var $=require("jquery"),ko=require("knockout"),PasswordValidator=require("../utils/PasswordValidator"),Field=require("./Field"),scrollToElement=require("../utils/scrollToElement");module.exports=ValidatedPassword},{"../utils/PasswordValidator":323,"../utils/scrollToElement":353,"./Field":378,jquery:!1,knockout:!1}],399:[function(require,module,exports){"use strict";var groupBy=require("../../utils/groupBy"),mapBy=require("../../utils/mapBy"),ServicesSummaryPresenter=function(jobTitle,services,pricingTypes){this._jobTitle=jobTitle;this._services=services;this._pricingTypesByID=mapBy(pricingTypes,function(p){return p.pricingTypeID()})};ServicesSummaryPresenter.prototype.hasServices=function(){return this._services.length>0};ServicesSummaryPresenter.prototype.jobTitle=function(){return this._jobTitle.singularName()};ServicesSummaryPresenter.prototype.jobTitleID=function(){return this._jobTitle.jobTitleID()};ServicesSummaryPresenter.prototype.summaryText=function(){return this.serviceTypeSummaries().sort().reverse().join(", ")};ServicesSummaryPresenter.prototype.serviceTypeSummaries=function(){var servicesByPricingTypeID=groupBy(this._services,function(s){return s.pricingTypeID()}),pricingTypeName=function(type,count){return 1==count?type.singularName():type.pluralName()};return Object.keys(servicesByPricingTypeID).map(function(pricingTypeID){var services=servicesByPricingTypeID[pricingTypeID],pricingType=this._pricingTypesByID[pricingTypeID];return services.length+" "+pricingTypeName(pricingType,services.length).toLowerCase()}.bind(this))};ServicesSummaryPresenter.summaries=function(jobTitles,services,pricingTypes){var jobTitlesByID=mapBy(jobTitles,function(t){return t.jobTitleID()}),servicesByJobTitleID=groupBy(services,function(s){return s.jobTitleID()},Object.keys(jobTitlesByID));return Object.keys(servicesByJobTitleID).map(function(jobTitleID){return new ServicesSummaryPresenter(jobTitlesByID[jobTitleID],servicesByJobTitleID[jobTitleID],pricingTypes)})};ServicesSummaryPresenter.sortByJobTitle=function(a,b){return a.jobTitle().localeCompare(b.jobTitle())};module.exports=ServicesSummaryPresenter},{"../../utils/groupBy":344,"../../utils/mapBy":349}]},{},[178]);