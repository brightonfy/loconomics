@using WebMatrix.Data;
@{
    LcMessaging.SecureTemplate();
    
    Layout = LcUrl.RenderLangPath + "_EmailLayout.cshtml";
    Page.Title = "Loconomics.com - Booking";

    // All the data for this email:
    var info = LcEmailTemplateHelper.GetBookingInfo();

    // Data for the EmailLayout:
    // This will be changed on body by more specific texts:
    PageData["messageTitle"] = "Booking";
    PageData["ViewOnSiteURL"] = info.ViewOnSiteURL;
}

<div>
    @{
        PageData["messageTitle"] = LcData.Booking.GetBookingTitleFor(info.Booking.BookingStatusID, info.PairUser, info.SentTo);
        PageData["messageSubtitle"] = LcEmailTemplateHelper.GetLastUpdateText(info.Booking.UpdatedDate);
    }

    @* When booking is not cancelled and service date is passed, show Review options:
        *@
    @if (info.Booking.BookingStatusID < 6 && DateTime.Now > info.Booking.ConfirmedDateEnd)
    {
    <div style="float: right;">
        @switch ((LcData.UserInfo.UserType)info.SentTo)
        {
            // What the user see if is the Customer in the booking
            case LcData.UserInfo.UserType.Customer:
                <a class="respond" style="@LcEmailTemplateHelper.StyleRespondButton()" href="@PageData["viewOnSiteUrl"]" target="_blank">
                    @(info.Booking.ReviewedByCustomer == true ? "View my review" : "Review provider")
                </a>
                if (info.Booking.ReviewedByProvider == true) {
                <a class="respond" style="@LcEmailTemplateHelper.StyleRespondButton()" href="@PageData["viewOnSiteUrl"]" target="_blank">
                    View provider review
                </a>
                }
                break;

            // What the user see if is the Provider in the booking
            case LcData.UserInfo.UserType.Provider:
                <a class="respond" style="@LcEmailTemplateHelper.StyleRespondButton()" href="@PageData["viewOnSiteUrl"]" target="_blank">
                    @(info.Booking.ReviewedByProvider == true ? "View my review" : "Review customer")
                </a>
                if (info.Booking.ReviewedByCustomer == true) {
                <a class="respond" style="@LcEmailTemplateHelper.StyleRespondButton()" href="@PageData["viewOnSiteUrl"]" target="_blank">
                    View customer review
                </a>
                }
                break;
        }
    </div>
    }

    <h4 @LcEmailTemplateHelper.StyleH4("color: #8B2143;")>@info.PairUserType information</h4>
    @RenderPage(LcUrl.RenderLangPath + "Email/$EmailUserInfoWidget.cshtml", new Dictionary<string, object>{ 
        {"AddContainerStyle", LcEmailTemplateHelper.StyleMessageSection()},        
        {"Data", info.PairUser},
        {"DataPrefix", ""},
        {"Size", "medium"},
        {"UserType", info.PairUserType.ToString().ToLower()}
    })

    <h4 @LcEmailTemplateHelper.StyleH4("color: #8B2143;")>Booking time and location</h4>
    <div style="@LcEmailTemplateHelper.StyleMessageSection()">
        <h5 @LcEmailTemplateHelper.StyleH5("font-size: 1.1em;margin: 8px 0 0;color: #6c6c6c;")>Position: </h5>
        <span>@info.Booking.PositionSingular</span>

        <h5 @LcEmailTemplateHelper.StyleH5("font-size: 1.1em;margin: 8px 0 0;color: #6c6c6c;")>Scheduled time: </h5>
        @if (info.Booking.ConfirmedDateStart is DateTime && info.Booking.ConfirmedDateEnd is DateTime)
        {
        <span>@LcHelpers.DateTimeRangeToString(info.Booking.ConfirmedDateStart, info.Booking.ConfirmedDateEnd)</span>
        }
        else
        {
            // Null values:
            <span>Date not available</span>
        }

        <h5 @LcEmailTemplateHelper.StyleH5("font-size: 1.1em;margin: 8px 0 0;color: #6c6c6c;")>Location: </h5>
        @LcEmailTemplateHelper.PrintAddressBlock(info.Booking)
    </div>

    <h4 @LcEmailTemplateHelper.StyleH4("color: #8B2143;")>Requested services and pricing estimate</h4>
    @RenderPage("$EmailRequestedBookingServicesWidget.cshtml", info.Booking, info.SentTo.ToString().ToLower())

    <h4 @LcEmailTemplateHelper.StyleH4("color: #8B2143;")>Reminders</h4>
    @RenderPage("$EmailBookingRemindersWidget.cshtml", info.SentTo.ToString().ToLower())
</div>
